[
  {
    "article_id": "7133559411896746014",
    "audit_status": 2,
    "brief_content": "OAuth2\u5ba2\u6237\u7aef\u51ed\u636e\u6388\u6743\u76f8\u6bd4\u4e8e\u6388\u6743\u7801\u6388\u6743\u66f4\u76f4\u63a5\uff0c\u5b83\u901a\u5e38\u7528\u4e8eCRON\u4efb\u52a1\u548c\u5176\u4ed6\u7c7b\u578b\u7684\u540e\u7aef\u6570\u636e\u5904\u7406\u7b49\u64cd\u4f5c\u3002\u5728\u672c\u6587\u4e2d\uff0c\u60a8\u5c06\u4e86\u89e3\u4f7f\u7528Spring Security\u6784\u5efaOAuth2\u5ba2\u6237\u7aef\u51ed\u636e\u6388\u6743\u3002",
    "category_id": "6809637769959178254",
    "collect_count": 1,
    "comment_count": 0,
    "content": "",
    "cover_image": "",
    "ctime": "1660911302",
    "digg_count": 0,
    "display_count": 0,
    "draft_id": "7133556935504658469",
    "hot_index": 4,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "\u672c\u6587\u5df2\u53c2\u4e0e\u300c\u65b0\u4eba\u521b\u4f5c\u793c\u300d\u6d3b\u52a8\uff0c\u4e00\u8d77\u5f00\u542f\u6398\u91d1\u521b\u4f5c\u4e4b\u8def\u3002\n\n## Spring Security OAuth2\u5ba2\u6237\u7aef\u51ed\u636e\u6388\u6743\n\n### \u6982\u8ff0\n\n\u5728\u6ca1\u6709\u660e\u786e\u7684\u8d44\u6e90\u62e5\u6709\u8005\uff0c\u6216\u5bf9\u4e8e\u5ba2\u6237\u7aef\u6765\u8bf4\u8d44\u6e90\u62e5\u6709\u8005\u4e0d\u53ef\u533a\u5206\uff0c\u8be5\u600e\u4e48\u529e\uff1f\u8fd9\u662f\u4e00\u79cd\u76f8\u5f53\u5e38\u89c1\u7684\u573a\u666f\u3002\u6bd4\u5982\u540e\u7aef\u7cfb\u7edf\u4e4b\u95f4\u9700\u8981\u76f4\u63a5\u901a\u4fe1\u65f6\uff0c\u5c06\u4f7f\u7528**\u5ba2\u6237\u7aef\u51ed\u636e\u6388\u6743**\u3002\n\nOAuth2.0\u6587\u6863\u63cf\u8ff0\u5ba2\u6237\u7aef\u51ed\u636e\u6388\u6743\uff1a\n\n> \u5ba2\u6237\u7aef\u4f7f\u7528\u5ba2\u6237\u7aef\u51ed\u636e\u6388\u4e88\u7c7b\u578b\u6765\u83b7\u53d6\u7528\u6237\u4e0a\u4e0b\u6587\u4e4b\u5916\u7684\u8bbf\u95ee\u4ee4\u724c\u3002\u8fd9\u901a\u5e38\u88ab\u5ba2\u6237\u7aef\u7528\u6765\u8bbf\u95ee\u5173\u4e8e\u4ed6\u4eec\u81ea\u5df1\u7684\u8d44\u6e90\uff0c\u800c\u4e0d\u662f\u8bbf\u95ee\u7528\u6237\u7684\u8d44\u6e90\u3002\n\n\n\n\u5728\u672c\u6587\u4e2d\uff0c\u60a8\u5c06\u4e86\u89e3\u4f7f\u7528Spring Security\u6784\u5efaOAuth2\u5ba2\u6237\u7aef\u51ed\u636e\u6388\u6743\uff0c\u5728\u6ca1\u6709\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u7684\u60c5\u51b5\u4e0b\u5141\u8bb8\u670d\u52a1\u5b89\u5168\u7684\u76f8\u4e92\u64cd\u4f5c\u3002\n\n\n\nOAuth2\u5ba2\u6237\u7aef\u51ed\u636e\u6388\u6743\u76f8\u6bd4\u4e8e\u6388\u6743\u7801\u6388\u6743\u66f4\u76f4\u63a5\uff0c\u5b83\u901a\u5e38\u7528\u4e8eCRON\u4efb\u52a1\u548c\u5176\u4ed6\u7c7b\u578b\u7684\u540e\u7aef\u6570\u636e\u5904\u7406\u7b49\u64cd\u4f5c\u3002\n\n\n\n### \u5ba2\u6237\u7aef\u51ed\u636e\u6388\u4e88\u6d41\u7a0b\n\n\u5f53\u5e94\u7528\u7a0b\u5e8f\u8bf7\u6c42\u8bbf\u95ee\u4ee4\u724c\u4ee5\u8bbf\u95ee\u5176\u81ea\u5df1\u7684\u8d44\u6e90\u65f6\uff0c\u5c06\u4f7f\u7528\u5ba2\u6237\u7aef\u51ed\u636e\u6388\u6743\uff0c\u800c\u4e0d\u662f\u4ee3\u8868\u7528\u6237\u3002\n\n#### \u8bf7\u6c42\u53c2\u6570\n\n##### grant_type\uff08\u5fc5\u9700\uff09\n\n\u8be5`grant_type`\u53c2\u6570\u5fc5\u987b\u8bbe\u7f6e\u4e3a`client_credentials`\u3002\n\n##### scope\uff08\u53ef\u9009\u7684\uff09\n\n\u60a8\u7684\u670d\u52a1\u53ef\u4ee5\u652f\u6301\u5ba2\u6237\u7aef\u51ed\u636e\u6388\u4e88\u7684\u4e0d\u540c\u8303\u56f4\u3002\n\n##### \u5ba2\u6237\u7aef\u8eab\u4efd\u9a8c\u8bc1\uff08\u5fc5\u9700\uff09\n\n\u5ba2\u6237\u7aef\u9700\u8981\u5bf9\u6b64\u8bf7\u6c42\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002\u901a\u5e38\uff0c\u8be5\u670d\u52a1\u5c06\u5141\u8bb8\u9644\u52a0\u8bf7\u6c42\u53c2\u6570`client_id`\u548c`client_secret`\uff0c\u6216\u63a5\u53d7 HTTP Basic auth \u6807\u5934\u4e2d\u7684\u5ba2\u6237\u7aef ID \u548c\u673a\u5bc6\u3002\n\n\n![client-credentials.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/971c1fa43e614f59886b09593c133b17~tplv-k3u1fbpfcp-watermark.image?)\n\n\n\n### OAuth2\u6388\u6743\u670d\u52a1\u5668\n\n\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528[Spring Authorization Server](https://spring.io/projects/spring-authorization-server#learn)\u6784\u5efaOAuth2\u6388\u6743\u670d\u52a1\u5668\uff0c\u5177\u4f53\u8be6\u7ec6\u7ec6\u8282\u6211\u8fd9\u91cc\u5c31\u4e0d\u91cd\u590d\u8d58\u8ff0\uff0c\u53ef\u4ee5\u53c2\u8003\u6b64\u6587[JWT\u4e0eSpring Security OAuth2\u7ed3\u5408\u4f7f\u7528](https://juejin.cn/post/7131723527237861390)\u4e2d\u6388\u6743\u670d\u52a1\u5668\u642d\u5efa\uff0c\u8fd9\u91cc\u4ec5\u8bf4\u660e\u4e0e\u4e4b\u524d\u6388\u6743\u7801\u6388\u4e88\u6d41\u7a0b\u6388\u6743\u670d\u52a1\u914d\u7f6e\u7684\u4e0d\u540c\u4e4b\u5904\u3002\n\n#### \u914d\u7f6e\n\n\u5728\u6211\u4eec\u4f7f\u7528*RegisteredClient*\u6784\u5efa\u5668\u7c7b\u578b\u521b\u5efa\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u5c06\u914d\u7f6e\u6b64\u5ba2\u6237\u7aef\u652f\u6301\u5ba2\u6237\u7aef\u51ed\u636e\u6388\u6743\uff0c\u5e76\u7b80\u5355\u7684\u5c06\u5b83\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\u3002\n\n```java\n@Bean\npublic RegisteredClientRepository registeredClientRepository() {\n  RegisteredClient registeredClient = RegisteredClient.withId(UUID.randomUUID().toString())\n    .clientId(\"relive-client\")\n    .clientSecret(\"{noop}relive-client\")\n    .clientAuthenticationMethods(s -> {\n      s.add(ClientAuthenticationMethod.CLIENT_SECRET_POST);\n      s.add(ClientAuthenticationMethod.CLIENT_SECRET_BASIC);\n    })\n    .authorizationGrantType(AuthorizationGrantType.CLIENT_CREDENTIALS)\n    .redirectUri(\"http://127.0.0.1:8070/login/oauth2/code/messaging-client-model\")\n    .scope(\"message.read\")\n    .clientSettings(ClientSettings.builder()\n                    .requireAuthorizationConsent(true)\n                    .requireProofKey(false)\n                    .build())\n    .tokenSettings(TokenSettings.builder()\n                   .accessTokenFormat(OAuth2TokenFormat.SELF_CONTAINED) \n                   .idTokenSignatureAlgorithm(SignatureAlgorithm.RS256)\n                   .accessTokenTimeToLive(Duration.ofSeconds(30 * 60))\n                   .refreshTokenTimeToLive(Duration.ofSeconds(60 * 60))\n                   .reuseRefreshTokens(true)\n                   .build())\n    .build();\n\n  return new InMemoryRegisteredClientRepository(registeredClient);\n}\n```\n\n\u4e0a\u8ff0\u6211\u4eec\u914d\u7f6e\u4e86\u4e00\u4e2aOAuth2\u5ba2\u6237\u7aef\uff0c\u5e76\u5c06*authorizationGrantType*\u6307\u5b9a\u4e3a**client_credentials**\uff1a\n\n- **clientId**: relive-client\n- **clientSecret**: relive-client\n- **redirectUri**: [http://127.0.0.1:8070/login/oauth2/code/messaging-client-model](http://127.0.0.1:8070/login/oauth2/code/messaging-client-model)\n- **scope**: message.read\n\n\n\n### \u4f7f\u7528Spring Security\u6784\u5efaOAuth2\u8d44\u6e90\u670d\u52a1\u5668\n\nOAuth2\u8d44\u6e90\u670d\u52a1\u5668\u914d\u7f6e\u4e0e\u6b64\u6587[JWT\u4e0eSpring Security OAuth2\u7ed3\u5408\u4f7f\u7528](https://juejin.cn/post/7131723527237861390)\u4e2d\u8d44\u6e90\u670d\u52a1\u642d\u5efa\u4e00\u81f4\uff0c\u60a8\u53ef\u4ee5\u53c2\u8003\u6b64\u6587\u4e2dOAuth2\u8d44\u6e90\u670d\u52a1\u4ecb\u7ecd\uff0c\u6216\u53ef\u4ee5\u5728\u6587\u672b\u4e2d\u83b7\u53d6\u672c\u6587\u6e90\u7801\u5730\u5740\u8fdb\u884c\u67e5\u770b\u3002\n\n#### \u914d\u7f6e\n\nOAuth2\u8d44\u6e90\u670d\u52a1\u5668\u63d0\u4f9b\u4e86\u4e00\u4e2a/*resource*/*article*\u53d7\u4fdd\u62a4\u7aef\u70b9\uff0c\u5e76\u4f7f\u7528Spring Security\u4fdd\u62a4\u6b64\u670d\u52a1\u3002\n\n```java\n@Bean\nSecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n  http.requestMatchers()\n    .antMatchers(\"/resource/article\")\n    .and()\n    .authorizeRequests()\n    .mvcMatchers(\"/resource/article\")\n    .access(\"hasAuthority('SCOPE_message.read')\")\n    .and()\n    .oauth2ResourceServer(OAuth2ResourceServerConfigurer::jwt);\n  return http.build();\n}\n```\n\n\u8bf7\u6ce8\u610f\uff0cOAuth2\u8d44\u6e90\u670d\u52a1/*resource*/*article*\u7aef\u70b9\u8981\u6c42\u62e5\u6709\u201cmessage.read\u201d\u6743\u9650\u624d\u53ef\u4ee5\u8bbf\u95ee\uff0cSpring \u81ea\u52a8\u5728\u6240\u9700\u8303\u56f4\u540d\u79f0\u524d\u6dfb\u52a0\u201cSCOPE_\u201d\uff0c\u8fd9\u6837\u5b9e\u9645\u6240\u9700\u7684\u8303\u56f4\u662f\u201cmessage.read\u201d\u800c\u4e0d\u662f\u201cSCOPE_message.read\u201d\u3002\n\n\n\n### \u4f7f\u7528Spring Security\u6784\u5efaOAuth2\u5ba2\u6237\u7aef\n\n\u5728\u672c\u8282\u4e2d\uff0c\u60a8\u5c06\u4f7f\u7528\u5f53\u524d\u63a8\u8350\u7684WebClient\uff0cWebClient \u662f Spring \u7684 WebFlux \u5305\u7684\u4e00\u90e8\u5206\u3002\u8fd9\u662f Spring \u7684\u53cd\u5e94\u5f0f\u3001\u975e\u963b\u585e API\uff0c\u60a8\u53ef\u4ee5\u5728[Spring\u6587\u6863](https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html)\u4e2d\u4e86\u89e3\u66f4\u591a\u4fe1\u606f\u3002\n\n\n\n\u5728\u6b64\u5ba2\u6237\u7aef\u4e2d\uff0c\u5728`@Scheduled`\u6b64\u6ce8\u89e3\u5b9a\u4e49\u7684CRON\u4efb\u52a1\u4e0b\uff0c\u60a8\u5c06\u4f7f\u7528`WebClient`\u6765\u53d1\u51fa\u8bf7\u6c42\u3002\n\n\n\n#### maven\u4f9d\u8d56\n\n```xml\n<dependency>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-starter-web</artifactId>\n  <version>2.6.7</version>\n</dependency>\n<dependency>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-starter-security</artifactId>\n  <version>2.6.7</version>\n</dependency>\n<dependency>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-starter-oauth2-client</artifactId>\n  <version>2.6.7</version>\n</dependency>\n<dependency>\n  <groupId>org.springframework</groupId>\n  <artifactId>spring-webflux</artifactId>\n  <version>5.3.9</version>\n</dependency>\n<dependency>\n  <groupId>io.projectreactor.netty</groupId>\n  <artifactId>reactor-netty</artifactId>\n  <version>1.0.9</version>\n</dependency>\n```\n\n#### \u914d\u7f6e\n\n\u6388\u6743\u6211\u4eec\u5c06\u5728application.yml\u4e2d\u914d\u7f6eOAuth2\u6388\u6743\u4fe1\u606f\uff0c\u5e76\u6307\u5b9aOAuth2\u5ba2\u6237\u7aef\u670d\u52a1\u7aef\u53e3\u53f7\uff1a\n\n```yaml\nserver:\n  port: 8070\n\nspring:\n  security:\n    oauth2:\n      client:\n        registration:\n          messaging-client-model:\n            provider: client-provider\n            client-id: relive-client\n            client-secret: relive-client\n            authorization-grant-type: client_credentials\n            client-authentication-method: client_secret_post\n            scope: message.read\n            client-name: messaging-client-model\n        provider:\n          client-provider:\n            token-uri: http://127.0.0.1:8080/oauth2/token\n```\n\n<br>\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a*SecurityConfig*\u7c7b\u7528\u6765\u914d\u7f6eSpring Security OAuth2\u5ba2\u6237\u7aef\u6240\u9700Bean\uff1a\n\n```java\n@Bean\nSecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n  http\n    .authorizeRequests(authorizeRequests ->\n                       authorizeRequests.anyRequest().permitAll()\n                      )\n    .oauth2Client(withDefaults());\n  return http.build();\n}\n\n@Bean\nWebClient webClient(OAuth2AuthorizedClientManager authorizedClientManager) {\n  ServletOAuth2AuthorizedClientExchangeFilterFunction oauth2Client = new ServletOAuth2AuthorizedClientExchangeFilterFunction(authorizedClientManager);\n  return WebClient.builder()\n    .filter(oauth2Client)\n    .build();\n}\n\n@Bean\nOAuth2AuthorizedClientManager authorizedClientManager(ClientRegistrationRepository clientRegistrationRepository,\n                                                      OAuth2AuthorizedClientService authorizedClientService) {\n\n  OAuth2AuthorizedClientProvider authorizedClientProvider = OAuth2AuthorizedClientProviderBuilder\n    .builder()\n    .clientCredentials()\n    .build();\n  AuthorizedClientServiceOAuth2AuthorizedClientManager authorizedClientManager = new AuthorizedClientServiceOAuth2AuthorizedClientManager(clientRegistrationRepository, authorizedClientService);\n  authorizedClientManager.setAuthorizedClientProvider(authorizedClientProvider);\n\n  return authorizedClientManager;\n}\n```\n\n\u6211\u4eec\u521b\u5efa\u4e00\u4e2aWebClient\u5b9e\u4f8b\u7528\u4e8e\u5411\u8d44\u6e90\u670d\u52a1\u5668\u6267\u884cHTTP\u8bf7\u6c42\uff0c\u5e76\u7ed9WebClient\u6dfb\u52a0\u4e86\u4e00\u4e2aOAuth2\u6388\u6743\u8fc7\u6ee4\u5668\u3002`AuthorizedClientServiceOAuth2AuthorizedClientManager`\u8fd9\u662f\u534f\u8c03OAuth2\u5ba2\u6237\u7aef\u51ed\u636e\u6388\u4e88\u8bf7\u6c42\u7684\u9ad8\u7ea7\u63a7\u5236\u5668\u7c7b\uff0c\u8fd9\u91cc\u6211\u5c06\u6307\u51fa`AuthorizedClientServiceOAuth2AuthorizedClientManager`\u662f\u4e00\u4e2a\u4e13\u95e8\u8bbe\u8ba1\u7528\u4e8e\u5728 HttpServletRequest \u7684\u4e0a\u4e0b\u6587\u4e4b\u5916\u4f7f\u7528\u7684\u7c7b\u3002\n\n\u6765\u81ea[Spring \u6587\u6863](https://docs.spring.io/spring-security/site/docs/5.4.5/reference/html5/#oauth2Client-authorized-manager-provider)\uff1a\n\n> DefaultOAuth2AuthorizedClientManager \u65e8\u5728\u7528\u4e8e HttpServletRequest \u7684\u4e0a\u4e0b\u6587\u4e2d\u3002\u5728 HttpServletRequest \u4e0a\u4e0b\u6587\u4e4b\u5916\u64cd\u4f5c\u65f6\uff0c\u8bf7\u6539\u7528 AuthorizedClientServiceOAuth2AuthorizedClientManager\u3002\n\n\n\n<br>\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u521b\u5efa\u4f7f\u7528`@Scheduled`\u6ce8\u89e3\u5b9a\u4e49\u7684\u4efb\u52a1\uff0c\u5e76\u6ce8\u5165WebClient\u8c03\u7528\u8d44\u6e90\u670d\u52a1\u8bf7\u6c42\uff1a\n\n```java\n@Service\npublic class ArticleJob {\n\n  @Autowired\n  private WebClient webClient;\n\n  @Scheduled(cron = \"0/2 * * * * ? \")\n  public void exchange() {\n    List list = this.webClient\n      .get()\n      .uri(\"http://127.0.0.1:8090/resource/article\")\n      .attributes(clientRegistrationId(\"messaging-client-model\"))\n      .retrieve()\n      .bodyToMono(List.class)\n      .block();\n    log.info(\"\u8c03\u7528\u8d44\u6e90\u670d\u52a1\u5668\u6267\u884c\u7ed3\u679c\uff1a\" + list);\n  }\n}\n\n```\n\n\u8fd9\u4e2a\u7c7b\u4e2d`exchange()`\u65b9\u6cd5\u4f7f\u7528`@Scheduled`\u6ce8\u89e3\u6bcf2\u79d2\u89e6\u53d1\u4e00\u6b21\u8bf7\u6c42\uff0c\u5728\u6211\u4eec\u542f\u52a8\u6240\u6709\u670d\u52a1\u540e\uff0c\u4f60\u5e94\u8be5\u770b\u5230\u8fd9\u6837\u7684\u8f93\u51fa\uff1a\n\n```\n2022-07-09 19:55:22.281  INFO 20305 --- [   scheduling-1] com.relive.ArticleJob                    : \u8c03\u7528\u8d44\u6e90\u670d\u52a1\u5668\u6267\u884c\u7ed3\u679c\uff1a[article1, article2, article3]\n2022-07-09 19:55:24.023  INFO 20305 --- [   scheduling-1] com.relive.ArticleJob                    : \u8c03\u7528\u8d44\u6e90\u670d\u52a1\u5668\u6267\u884c\u7ed3\u679c\uff1a[article1, article2, article3]\n2022-07-09 19:55:26.015  INFO 20305 --- [   scheduling-1] com.relive.ArticleJob                    : \u8c03\u7528\u8d44\u6e90\u670d\u52a1\u5668\u6267\u884c\u7ed3\u679c\uff1a[article1, article2, article3]\n2022-07-09 19:55:28.009  INFO 20305 --- [   scheduling-1] com.relive.ArticleJob                    : \u8c03\u7528\u8d44\u6e90\u670d\u52a1\u5668\u6267\u884c\u7ed3\u679c\uff1a[article1, article2, article3]\n```\n\n\n\n### \u7ed3\u8bba\n\n\u4e0e\u5f80\u5e38\u4e00\u6837\uff0c\u672c\u6587\u4e2d\u4f7f\u7528\u7684\u6e90\u4ee3\u7801\u53ef[\u5728 GitHub \u4e0a](https://github.com/ReLive27/spring-security-oauth2-sample/tree/main/oauth2-client-model)\u83b7\u5f97\u3002\n\n",
    "mtime": "1660966943",
    "original_author": "",
    "original_type": 0,
    "rank_index": 5.57022405,
    "rtime": "1660966943",
    "status": 2,
    "tag_ids": [
      6809641037787561984,
      6809640445233070080
    ],
    "title": "Spring Security OAuth2\u5ba2\u6237\u7aef\u51ed\u636e\u6388\u6743",
    "user_id": "4051073081555869",
    "user_index": 6.786121069406377,
    "verify_status": 1,
    "view_count": 100,
    "visible_level": 0
  },
  {
    "article_id": "7133554714377420814",
    "audit_status": 2,
    "brief_content": "\u672c\u6587\u5df2\u53c2\u4e0e\u300c\u65b0\u4eba\u521b\u4f5c\u793c\u300d\u6d3b\u52a8\uff0c\u4e00\u8d77\u5f00\u542f\u6398\u91d1\u521b\u4f5c\u4e4b\u8def\u3002# \u4e00\u3001\u524d\u8a00 \u4e0a\u4e00\u7ae0\u66f2\u9e1f\u5168\u6808UI\u81ea\u52a8\u5316\u6559\u5b66(\u516d)\uff1a\u5f00\u59cb\u5b9e\u6218\u5427\uff01\u5b9e\u6218\u73af\u5883\u51c6\u5907\u6211\u4eec\u901a\u8fc7\u4f7f\u7528\u7985\u9053\u771f\u6b63\u7684\u5b9e\u73b0\u4e86\u7b2c\u4e00\u4e2a\u5b9e\u6218\u811a\u672c\uff0c\u6587\u672b\u7684\u7ec3\u4e60\u9898\u5c0f\u4f19\u4f34\u5b9e\u73b0\u4e86\u5417\uff1f\u4e0b",
    "category_id": "6809637769959178254",
    "collect_count": 0,
    "comment_count": 0,
    "content": "",
    "cover_image": "",
    "ctime": "1660910196",
    "digg_count": 1,
    "display_count": 0,
    "draft_id": "7133554562765422623",
    "hot_index": 4,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "\u672c\u6587\u5df2\u53c2\u4e0e\u300c\u65b0\u4eba\u521b\u4f5c\u793c\u300d\u6d3b\u52a8\uff0c\u4e00\u8d77\u5f00\u542f\u6398\u91d1\u521b\u4f5c\u4e4b\u8def\u3002# \u4e00\u3001\u524d\u8a00\n\u4e0a\u4e00\u7ae0\u66f2\u9e1f\u5168\u6808UI\u81ea\u52a8\u5316\u6559\u5b66(\u516d)\uff1a\u5f00\u59cb\u5b9e\u6218\u5427\uff01\u5b9e\u6218\u73af\u5883\u51c6\u5907\u6211\u4eec\u901a\u8fc7\u4f7f\u7528\u7985\u9053\u771f\u6b63\u7684\u5b9e\u73b0\u4e86\u7b2c\u4e00\u4e2a\u5b9e\u6218\u811a\u672c\uff0c\u6587\u672b\u7684\u7ec3\u4e60\u9898\u5c0f\u4f19\u4f34\u5b9e\u73b0\u4e86\u5417\uff1f\u4e0b\u9762\u4e3a\u4f60\u516c\u5e03\u7b54\u6848\u3002\n\n]\n---\n# \u4e8c\u3001\u516c\u5e03\u4e0a\u4e00\u7ae0\u7ec3\u4e60\u9898\u7b54\u6848\n\u8bb0\u5f97\u628a\u4f60\u5bf9\u5e94\u8c37\u6b4c\u6d4f\u89c8\u5668\u7248\u672c\u7684`chromedriver`\u653e\u5165\u9879\u76ee\u4e2d:\n\n```python\nimport datetime\nimport random\nimport time\n\n\nfrom selenium import webdriver\nfrom selenium.webdriver.common.by import By\ndriver = webdriver.Chrome()\ndriver.implicitly_wait(2)\ndriver.maximize_window()\n\ndriver.get('http://127.0.0.1/zentao/user-login.html')\ntime.sleep(0.5)\ndriver.find_element(By.XPATH,'//*[@id=\"account\"]').send_keys('admin')\ntime.sleep(0.5)\ndriver.find_element(By.XPATH,'//*[@id=\"loginPanel\"]/div/div[2]/form/table/tbody/tr[2]/td/input').send_keys('\u66ff\u6362\u4e3a\u4f60\u81ea\u5df1\u7684\u5bc6\u7801') #\u8fd9\u91cc\u66ff\u6362\u4e3a\u4f60\u81ea\u5df1\u7684\u5bc6\u7801\ntime.sleep(0.5)\ndriver.find_element(By.XPATH,'//*[@id=\"submit\"]').click()\ntime.sleep(0.5)\ndriver.find_element(By.XPATH,'//*[@id=\"menuMainNav\"]/li[3]/a').click()\ndriver.switch_to.frame('appIframe-product')\ntime.sleep(0.5)\ny=driver.find_elements(By.XPATH,'//a[@class=\"btn btn-primary create-product-btn\"]')\ntime.sleep(0.5)\ndriver.find_element(By.XPATH,'//*[@id=\"mainMenu\"]/div[2]/a[3]').click()\ntime.sleep(0.5)\ndriver.find_element(By.XPATH,'//*[@id=\"name\"]').send_keys('selenium2')\ntime.sleep(0.5)\ndriver.find_element(By.XPATH,'//*[@id=\"code\"]').send_keys('002')\ntime.sleep(0.5)\ndriver.find_element(By.XPATH,'//*[@id=\"submit\"]').click()\n```\n\n---\n\n# \u4e09\u3001\u7b54\u6848\u548c\u4e0d\u8db3\u5206\u6790\n\u4e4b\u524d\u7ec3\u4e60\u9898\u4e3b\u8981\u662f\u5c06\u6574\u4e2a\u6d41\u7a0b\u8fdb\u884c\u4e86\u4e32\u8054\uff0c\u5176\u4e2d\u6709\u4e2a\u7279\u6b8a\u7684\u64cd\u4f5c\u662f\u9700\u8981\u5207\u6362iframe\uff0c\u5176\u4ed6\u5c31\u6ca1\u4ec0\u4e48\u7279\u6b8a\u7684\u5730\u65b9\u4e86\u3002\n\n\u4f46\u5982\u679c\u6309\u7167\u4e0a\u9762\u7684\u4ee3\u7801\u5199\u7684\u8bdd\uff0c\u5b9e\u9645\u4e0a\u662f\u975e\u5e38\u5197\u4f59\u548c\u4f4e\u6548\u7684\u3002\u9996\u5148\uff0c\u4e3a\u4e86\u5b9e\u73b0\u6bcf\u4e2a\u6b65\u9aa4\u90fd\u7b49\u5f850.5\u79d2\u6267\u884c\uff0c\u6211\u4eec\u5728\u6240\u6709\u6b65\u9aa4\u4ee3\u7801\u4e4b\u95f4\u90fd\u52a0\u4e86\u4ee3\u7801`time.sleep(0.5)`\uff0c\u800c\u4e14\u5bf9\u6d4b\u8bd5\u7528\u4f8b\u6ca1\u6709\u5f88\u597d\u7684\u7ba1\u7406\uff0c\u672a\u5bf9\u64cd\u4f5c\u4e8b\u4ef6\u3001\u5143\u7d20\u5730\u5740\u7b49\u8fdb\u884c\u5c01\u88c5\uff0c\u5bfc\u81f4\u53ef\u8bfb\u6027\u4f4e\u3001\u7ef4\u62a4\u6027\u4f4e\u7b49\u3002\n\u6240\u4ee5\u5199\u51fa\u81ea\u52a8\u5316\u811a\u672c\u5f88\u7b80\u5355\uff0c\u4f46\u8fd9\u5e76\u4e0d\u4ee3\u8868\u4f60\u638c\u63e1\u4e86\u81ea\u52a8\u5316\uff0c\u80fd\u591f\u80dc\u4efb\u4e00\u4efd\u81ea\u52a8\u5316\u6d4b\u8bd5\u7684\u5de5\u4f5c\u3002\u4e5f\u6b63\u56e0\u5982\u6b64\uff0c\u6211\u4eec\u9700\u8981\u642d\u5efa\u81ea\u52a8\u5316\u6d4b\u8bd5\u6846\u67b6\uff0c\u5c06\u6570\u636e\u548c\u4ee3\u7801\u64cd\u4f5c\u8fdb\u884c\u5206\u79bb\uff0c\u5c01\u88c5\u6709\u7528\u7684\u516c\u5171\u65b9\u6cd5\u6765\u63d0\u9ad8\u6211\u4eec\u7684\u6548\u7387\u3002\n\n\u4e0b\u9762\u6211\u4eec\u7ed3\u5408pytest\u5bf9\u6211\u4eec\u7684\u4ee3\u7801\u8fdb\u884c\u4e00\u4e9b\u4f18\u5316\uff0c\u8ba9\u81ea\u52a8\u5316\u6846\u67b6\u521d\u5177\u6a21\u578b\u3002\n\n---\n# \u56db\u3001Pytest\u7b80\u5355\u4ecb\u7ecd\u548c\u6ce8\u610f\u4e8b\u9879\n\npytest\u662f\u4e00\u4e2a\u975e\u5e38\u6210\u719f\u7684\u5168\u529f\u80fd\u7684Python\u6d4b\u8bd5\u6846\u67b6\uff0c\u529f\u80fd\u5f88\u5168\uff0c\u5f88\u7075\u6d3b\uff0c\u80fd\u591f\u4e0e\u5f88\u591a\u7b2c\u4e09\u65b9\u63d2\u4ef6\u8fdb\u884c\u7ed3\u5408\uff0c\u6bd4\u5982\uff1apytest-html\uff08\u5b8c\u7f8ehtml\u6d4b\u8bd5\u62a5\u544a\u751f\u6210\uff09\u3001pytest-rerunfailures\uff08\u5931\u8d25case\u91cd\u590d\u6267\u884c\uff09\u3001pytest-xdist\uff08\u591aCPU\u5206\u53d1\uff09\u7b49\uff1b\u8fd8\u53ef\u4ee5\u8ddf\u7c7b\u4f3cJenkins\u7684CI\u5de5\u5177\u8fdb\u884c\u7ed3\u5408\u3002\n\n\u5c0f\u4f19\u4f34\u53ef\u80fd\u5728\u7f51\u4e0a\u53d1\u73b0\u5f88\u591a\u6559\u7a0b\u7684\u81ea\u52a8\u5316\u662f\u4e0b\u9762\u8fd9\u6837\u5199\u7684\uff0c\u4e00\u6761\u7528\u4f8b\u5c31\u8981\u5199\u4e00\u4e2a\u51fd\u6570\u65b9\u6cd5\uff1a\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68c7f72bcb0241d7b41eea4c59aa77cc~tplv-k3u1fbpfcp-zoom-1.image)\n\n---\n**\u8fd9\u91cc\u6781\u5176\u4e0d\u63a8\u8350\u8fd9\u6837\u505a\u7684\uff01\u7b49\u4e8e\u6bcf\u6b21\u5199\u7528\u4f8b\u8fd8\u8981\u5199\u4ee3\u7801\uff0c\u8fd9\u662f\u4e25\u91cd\u7684\u4f4e\u6548\u7387\u548c\u4f4e\u7ef4\u62a4\u7684\u884c\u4e3a\uff0c\u4e0d\u53ef\u53d6\uff01**\n\n---\n\n# \u4e94\u3001\u642d\u5efa\u81ea\u52a8\u5316\u6d4b\u8bd5\u6846\u67b6\n## 1. \u5b89\u88c5pytest\ncmd\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a\n\n`pip install pytest -i https://pypi.tuna.tsinghua.edu.cn/simple some-package`\n\n---\n## 2. \u6846\u67b6\u601d\u8def\u5206\u6790\n\u6211\u4eec\u7406\u60f3\u7684\u6548\u679c\u662f\u6d4b\u8bd5\u7528\u4f8b\u8ddf\u4ee3\u7801\u8fdb\u884c\u5206\u79bb\uff0c\u4e5f\u5c31\u662f\u8bf4\u5f53\u6211\u4eec\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b\u7684\u65f6\u5019\uff0c\u4e0d\u9700\u8981\u53bb\u6539\u52a8\u54ea\u6015\u4e00\u884c\u4ee3\u7801\u3002\n\n### 1\uff09\u6570\u636e\u5c42\u9762\n\u6211\u4eec\u5148\u6765\u5206\u6790\u6570\u636e\u5c42\u9762\uff0c\u5bf9\u4e8eSelenium\u7684\u64cd\u4f5c\uff0c\u65e0\u8bba\u662f\u70b9\u51fb\u3001\u8fd8\u662f\u8f93\u5165\u3001\u8fd8\u662f\u5f3a\u5236\u7b49\u5f85\u7b49\u6700\u591a\u9700\u8981\u56db\u6837\u53c2\u6570\uff1a\n1. \u5143\u7d20\u5730\u5740\uff1b\n2. \u5b9a\u4f4d\u65b9\u5f0f\uff1b\n3. \u64cd\u4f5c\u65b9\u5f0f\uff08\u70b9\u51fb/\u8f93\u5165\u5185\u5bb9/\u5f3a\u5236\u7b49\u5f85/\u8bbf\u95ee\u7f51\u5740 \u7b49\uff09\uff1b\n4. \u64cd\u4f5c\u7684\u503c\uff08\u90e8\u5206\u64cd\u4f5c\u6709\uff0c\u4f8b\u5982\uff1a\u8f93\u5165\u5185\u5bb9\u3001\u5f3a\u5236\u7b49\u5f85\u64cd\u4f5c\u9700\u8981\u3001\u70b9\u51fb\u64cd\u4f5c\u4e0d\u9700\u8981\uff09\uff1b\n\n---\n\u73b0\u5728\u6211\u4eec\u6765\u7528Excel\u5b9e\u9645\u7684\u5199\u4e00\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u3010\u7528\u6237\u6253\u5f00\u7985\u9053\u5e76\u8f93\u5165\u6b63\u786e\u7684\u5e10\u53f7\u5bc6\u7801\u8fdb\u884c\u767b\u5f55\u3011\uff1a\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2e0f7d568403456d90b8db51df7d14a9~tplv-k3u1fbpfcp-zoom-1.image)\n\n\n---\n\n\u6e05\u6670\u660e\u4e86\u7684\u77e5\u9053\u4e86\u6bcf\u6b65\u64cd\u4f5c\u9700\u8981\u5e72\u561b\u53ca\u4f7f\u7528\u4e86\u4ec0\u4e48\u6837\u7684\u53c2\u6570\u3002\n\n---\n\n### 2\uff09\u4ee3\u7801\u5c42\u9762\n\u7528\u4f8b\u5199\u597d\u4e86\uff0c\u8be5\u8003\u8651\u5982\u4f55\u5199\u4ee3\u7801\u4e86\u3002\u6211\u4eec\u9700\u8981\u5199\u4e2a\u65b9\u6cd5\u6765\u9002\u914d\u4e0a\u8ff0\u7528\u4f8b\u7684\u6267\u884c\uff0c\u9700\u8981\u7684\u529f\u80fd\u70b9\uff1a\n1. \u80fd\u6839\u636e\u586b\u5199\u7684\u64cd\u4f5c\u65b9\u5f0f\u9009\u62e9\u6b63\u786e\u7684selenium\u7684\u6267\u884c\u65b9\u6cd5\uff0c\u4f8b\u5982\u4e0a\u8ff0\u7528\u4f8b\u4e2d\u64cd\u4f5c\u65b9\u5f0f\u4e3aget\uff0c\u90a3\u8be5\u65b9\u6cd5\u4f1a\u6267\u884c`driver.get`\u65b9\u6cd5\u5e76\u5c06\u3010\u64cd\u4f5c\u7684\u503c\u3011\u4e2d\u7684\u6570\u636e\u4f5c\u4e3a\u7f51\u5740\u8fdb\u884c\u6267\u884c\uff1b\n2. \u80fd\u591f\u6839\u636e\u7528\u4f8b\u3010\u5b9a\u4f4d\u65b9\u5f0f\u3011\u7684\u5185\u5bb9\u9009\u62e9\u6b63\u786e\u7684\u5b9a\u4f4d\u65b9\u5f0f\u8fdb\u884c\u6267\u884c\uff1b\n3. \u5143\u7d20\u5730\u5740\u80fd\u591f\u6b63\u786e\u7684\u586b\u5199\uff1b\n4. \u64cd\u4f5c\u7684\u503c\u4e5f\u662f\u540c\u7406\uff1b\n\n---\n\n\u6839\u636e\u4e0a\u8ff0\u8981\u6c42\u5199\u4e86\u5982\u4e0b\u7684\u4ee3\u7801\uff0c\u5148\u770b\u76ee\u5f55\u7ed3\u6784\uff1a\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2957f473a4524936a641f1c5dc774df0~tplv-k3u1fbpfcp-zoom-1.image)\n\n---\n**\u518d\u770b\u5177\u4f53\u4ee3\u7801**\n\n1\uff09`main.py`\uff1a\n\n```python\nimport pytest\n# \u6267\u884c\u6d4b\u8bd5\u7528\u4f8b\npytest.main(['test_case.py'])\n```\n2\uff09`comDef.py`\uff1a\n\n```python\nfrom openpyxl import load_workbook\n\n\ndef load_excel(file):\n    \"\"\"\n    \u7528\u4e8e\u8bfb\u53d6\u6d4b\u8bd5\u7528\u4f8b\u6240\u5728\u7684\u8868\u683c\n    \"\"\"\n    _data = load_workbook(file)\n    _value = _data.active\n    return _value\n\n\ndef parse_case(file):\n    \"\"\"\n    \u7528\u4e8e\u5c06excel\u4e2d\u7684\u6d4b\u8bd5\u7528\u4f8b\u8f6c\u4e3apytest\u53ef\u8bc6\u522b\u7684\u6d4b\u8bd5\u7528\u4f8b\n    \"\"\"\n    excel_value = load_excel(file)\n    _cases = []\n    for i in range(2, excel_value.max_row + 1):\n        _cases.append({'path': excel_value['B' + str(i)].value, 'location_method': excel_value['C' + str(i)].value,\n                       'action': excel_value['D' + str(i)].value, 'value': excel_value['E' + str(i)].value})\n    return _cases\n\n```\n\n---\n3\uff09`test_case.py`\uff1a\n\n```python\nimport pytest\nimport time\nfrom selenium.webdriver.common.by import By\nfrom selenium import webdriver\nfrom comDef import parse_case\n\n# \u521d\u59cb\u5316driver\ndriver = webdriver.Chrome()\ndriver.implicitly_wait(2)\ndriver.maximize_window()\n\n\n@pytest.mark.parametrize(\"data\", parse_case('\u81ea\u52a8\u5316\u6d4b\u8bd5\u7528\u4f8b.xlsx'))\ndef test_run_case(data):\n    path, location_method = data.get('path'), data.get('location_method')\n    action, value = data.get('action'), data.get('value')\n    if path:\n        if location_method:\n            _driver = driver.find_element(getattr(By, location_method), path)\n            if action == 'click':\n                _driver.click()\n            elif action == 'send_keys' and value:\n                _driver.send_keys(value)\n    elif value:\n        if action == 'sleep':\n            time.sleep(float(value))\n        elif action == 'get':\n            driver.get(value)\n    else:\n        return False\n```\n\n---\n\n### 3\uff09\u6267\u884c\u6548\u679c\n\n---\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e47b7e533384dbb97aecfa275d7d660~tplv-k3u1fbpfcp-zoom-1.image)\n\n---\n\n# \u516d\u3001\u603b\u7ed3\n\u4e0a\u9762\u7684\u4ee3\u7801\u770b\u4e0d\u61c2\u4e0d\u8981\u7d27\uff0c\u540e\u9762\u4f1a\u8fdb\u884c\u8bb2\u89e3\u3002\uff08\u5b8c\u6574\u4ee3\u7801\u83b7\u53d6\u53ef\u4ee5\u5173\u6ce8\u6587\u672b\u4e0b\u65b9\u7684\u516c\u4f17\u53f7\u56de\u590d\uff1a\u9879\u76ee\u4ee3\u7801\uff0c\u8fdb\u884c\u83b7\u53d6\uff09\u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u5b9e\u73b0\u4e86\u4e00\u4e2a\u81ea\u52a8\u5316\u6d4b\u8bd5\u6846\u67b6\u96cf\u5f62\uff0c\u8fbe\u5230\u4e86\u6570\u636e\u548c\u4ee3\u7801\u7684\u5206\u79bb\uff0c\u7528\u6237\u53ea\u9700\u8981\u586b\u5199excel\u5c31\u80fd\u591f\u8fbe\u5230\u6267\u884c\u81ea\u52a8\u5316\u6d4b\u8bd5\u7684\u6548\u679c\u3002\n\n\u4f46\u521a\u521a\u4e5f\u8bf4\u4e86\uff0c\u8fd9\u4e2a\u6846\u67b6\u53ea\u662f\u4e2a\u96cf\u5f62\uff0c\u5f88\u591a\u529f\u80fd\u8fd8\u8fd8\u9700\u589e\u52a0\uff0c\u6bd4\u5982\uff1a\n1. \u66f4\u591a\u64cd\u4f5c\u7684\u5c01\u88c5\uff08\u5207\u6362iframe\uff0c\u5207\u6362\u7a97\u53e3\uff0c\u6eda\u52a8\u3001\u83b7\u53d6\u6587\u672c\u7b49\uff09\uff1b\n2. \u6bcf\u6b65\u6267\u884c\u6210\u529f\u5931\u8d25\u7684\u6821\u9a8c\u548c\u7ed3\u679c\u5b58\u50a8\uff1b\n3. \u5143\u7d20\u5730\u5740\u7684\u7ba1\u7406\uff1b\n4. \u6d4b\u8bd5\u62a5\u544a\u7684\u751f\u6210\uff1b\n5. \u57fa\u4e8e\u6b65\u9aa4\u7684\u65ad\u70b9\u8c03\u8bd5\uff1b\n6. \u7528\u4f8b\u5931\u8d25\u91cd\u8bd5\uff1b\n\n\u5c0f\u4f19\u4f34\u53ef\u4ee5\u5148\u6309\u81ea\u5df1\u7684\u7406\u89e3\u8fdb\u884c\u4e0a\u8ff0\u529f\u80fd\u7684\u5b9e\u73b0\uff0c\u540e\u7eed\u6211\u4e5f\u4f1a\u7ee7\u7eed\u8fdb\u884c\u5206\u4eab\uff01\n",
    "mtime": "1660966912",
    "original_author": "",
    "original_type": 0,
    "rank_index": 5.58306484,
    "rtime": "1660966912",
    "status": 2,
    "tag_ids": [
      6809640408797167616,
      6809640448827588608,
      6809640427465998336
    ],
    "title": "\u66f2\u9e1f\u5168\u6808UI\u81ea\u52a8\u5316\u6559\u5b66(\u4e03)\uff1a\u4f7f\u7528Pytest\u6765\u642d\u5efa\u81ea\u52a8\u5316\u6d4b\u8bd5\u6846\u67b6",
    "user_id": "3017489401778999",
    "user_index": 6.88386016946279,
    "verify_status": 1,
    "view_count": 79,
    "visible_level": 0
  },
  {
    "article_id": "7133793654912581639",
    "audit_status": 2,
    "brief_content": "Compose\u5236\u4f5c\u4e00\u4e2a\u5f53\u4e0b\u70ed\u95e8\u7684\u77ed\u89c6\u9891\u7ffb\u9875\u6d41App\uff0c\u90fd\u5e94\u8be5\u6709\u7684\u89c6\u9891\u8fdb\u5ea6\u6761Loading\uff0c\u770b\u5b8c\u522b\u5fd8\u8bb0\uff1a\u70b9\u8d5e\u2764\ufe0f+\u5173\u6ce8\u2764\ufe0f+\u6536\u85cf\u2764\ufe0f \u4e09\u8fde~~~",
    "category_id": "6809635626879549454",
    "collect_count": 0,
    "comment_count": 0,
    "content": "",
    "cover_image": "",
    "ctime": "1660965858",
    "digg_count": 1,
    "display_count": 0,
    "draft_id": "7133503767420338206",
    "hot_index": 5,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "---\ntheme: smartblue\n---\n\u643a\u624b\u521b\u4f5c\uff0c\u5171\u540c\u6210\u957f\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 8 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c1\u5929\uff0c[\u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5](https://juejin.cn/post/7123120819437322247 \"https://juejin.cn/post/7123120819437322247\")\u3002\n\n\u73b0\u5728\u4e92\u8054\u7f51\u4ea7\u54c1\uff0c**\u611f\u89c9**\u8c01\u5bb6\u7684App\u4e0d\u6574\u70b9\u89c6\u9891\u529f\u80fd\uff0c\u4e25\u683c\u610f\u4e49\u4e0a\u90fd\u4e0d\u80fd\u8bf4\u662f\u4e00\u4e2a\u73b0\u4ee3\u4e92\u8054\u7f51App\u4e86\ud83d\ude02\uff0c\u6211\u4eec\u77e5\u9053\u6700\u706b\u7684\u662f\u6296\u97f3\u3001\u5feb\u624b\u8fd9\u7c7b\u77ed\u89c6\u9891App\uff0c\u5728\u5237\u89c6\u9891\u7684\u540c\u65f6\uff0c\u4ed6\u4eec\u7684App\u4ea4\u4e92\u4e0a\u9762\u7684\u4e00\u4e9b\u7279\u8272\u80fd\u8ba9\u6211\u4eec\u4e00\u76f4\u6c89\u6d78\u5728\u5237\u89c6\u9891\u4e2d\uff1b\n\n\u6bd4\u5982\uff0c\u6211\u4eec\u4eca\u5929\u8981\u804a\u7684\uff0c\u77ed\u89c6\u9891\u7ffb\u9875\u6d41\u5217\u8868\uff0c\u89c6\u9891\u52a0\u8f7d\u7f13\u51b2\u7684\u65f6\u5019\uff0c**Loading\u7684\u8bbe\u8ba1**\uff1a\n\n```js\n\u5b83\u8bbe\u8ba1\uff1a\u5728\u89c6\u9891\u5e95\u90e8\uff0c\u8fdb\u5ea6\u6761\u4e0a\u9762\uff0c\u5f53\u89c6\u9891\u7f13\u51b2\u52a0\u8f7d\u7b49\u5f85\u7684\u65f6\u5019\uff0c\u5b83\u6709\u4e00\u4e2a\u6ce2\u7eb9\u7684\u6269\u6563\u6548\u679c\uff0c\n\u5373\u4e0d\u5e72\u6270\u7528\u6237\u5237\u89c6\u9891\u7684\u64cd\u4f5c\uff0c\u4e5f\u6ca1\u6709\u5f88\u660e\u663e\u7684\u7a81\u5140\u6548\u679c\n\uff08\u6bd4\u5982\uff1a\u7a81\u5140\u7684\u5c4f\u5e55\u4e2d\u95f4\u5927\u5706\u5708Loading\uff0c\u5c31\u5f88\u7a81\u5140\uff09\n```\n\n**\u4e00\u5b9a\u8981\u8bb0\u5f97**\uff1a\u300e**\u70b9\u8d5e\u2764\ufe0f+\u5173\u6ce8\u2764\ufe0f+\u6536\u85cf\u2764\ufe0f**\u300f\u8d77\u6765\uff0c**\u5212\u8d70\u4e86**\u53ef\u5c31**\u518d\u4e5f\u627e\u4e0d\u5230\u4e86**\ud83d\ude05\ud83d\ude05\ud83d\ude48\ud83d\ude48\n\n\u6211\u4eec\u5148\u6765\u770b\u4e00\u4e0b\u201c**\u6296\u97f3\u3001\u5feb\u624bApp**\u201d\u7684\u89c6\u9891\u8fdb\u5ea6\u6761**Loading**\u6548\u679c\uff08`GIF\u56fe\u7a0d\u5fae\u5931\u771f\u4e86\u70b9`\uff09\n\n<p align=center><img  width=\"60%\" src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a8dac6959c654b238fe1b4b4b67e3163~tplv-k3u1fbpfcp-watermark.image?\" alt=\"2022-08-20 09_33_56.gif\"  /><br/><b>\u5feb\u624b\u77ed\u89c6\u9891\u9996\u9875\u7684\u89c6\u9891Loading</b></p>\n\n\u4ece\u89c6\u9891\u91cc\u9762\u53ef\u4ee5\u770b\u51fa\u6765\u5728\u89c6\u9891\u5e95\u90e8\uff0c\u51fa\u73b0\u7f13\u51b2\u52a0\u8f7d\u89c6\u9891\u7684\u65f6\u5019\uff0c\u4f1a\u6709\u4e00\u4e2a\uff1a\u201c\u4ece**\u4e2d\u95f4\u5f802\u8fb9\u6269\u6563**\u201d\u7684\u6548\u679c\u3002\n\nGIF\u56fe\u653e\u6162\u4e86\u4e00\u70b9\uff0c\u65b9\u4fbf\u5927\u5bb6\u89c2\u770b\uff0c\u5b9e\u9645\u7814\u7a76\u8fc7\u7a0b\uff0c\u6211\u4e00\u822c\u662f\u901a\u8fc7\u5f55\u5236\u5b8c\u89c6\u9891\uff0c\u901a\u8fc7\u76f8\u518c\u7684\u89c6\u9891\u7f16\u8f91\uff0c\u53bb**\u4e00\u5e27\u4e00\u5e27\u770b**\uff0c\u505a\u4e86\u54ea\u4e9b\u52a8\u4f5c\uff0c\u5982\u4e0b\uff1a\n\n<p align=center><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/08c96045befe44d6a5debf97ad5916ab~tplv-k3u1fbpfcp-watermark.image?\" alt=\"2022-08-20 09_44_25.gif\" width=\"30%\" /></p>\n\n\u770b\u5b8c\uff0c\u6211\u4eec\u53d1\u73b0\uff1a\n\n```js\n1\u3001\u4e00\u5f00\u59cb\u662f\u5728\u5c4f\u5e55\u4e2d\u95f4\u7684\u4f4d\u7f6e\uff0c\u5927\u6982\u662f20dp\u5de6\u53f3\u7684\u5bbd\u5ea6\u5f00\u59cb\u663e\u793a\uff1b\n2\u3001\u4ece\u4e2d\u95f4\u6269\u6563\u5230\u5c4f\u5e55\u8fb9\u7f18\u4e4b\u540e\uff0c\u4f1a\u6267\u884c\u6e10\u9690\uff1b\n3\u3001\u6e10\u9690\u5230\u900f\u660e\uff0c\u53c8\u5f00\u59cb\u4ece\u4e2d\u95f4\u5f802\u8fb9\u6269\u6563\uff1b\n```\n\u6709\u4e86\u4e0a\u9762\u7684\u524d\u594f\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u59cb\u6211\u4eec\u7684\u7f16\u7801\u4e86\uff0c\u90a3\u4e48\u5728\u5f00\u59cb\u7f16\u7801\u524d\uff0c\u80af\u5b9a\u9700\u8981\u77e5\u9053\u5bbd\u5ea6\u662f\u591a\u5c11\uff0c\u8fd9\u91cc\u6211\u4eec\u62ff**BoxWithConstraints**\u6765\u5305\u6211\u4eec\u7684child composable\uff0c\n\u6211\u4eec\u53ef\u4ee5\u770b\u5230BoxWithConstraints\u7684\u4ee3\u7801\u5982\u4e0b\uff1a\n\n\n```kotlin\n// \u4ee3\u7801\u6765\u81ea\uff1aandroidx.compose.foundation.layout\n@Composable\n@UiComposable\nfun BoxWithConstraints(\n    modifier: Modifier = Modifier,\n    contentAlignment: Alignment = Alignment.TopStart,\n    propagateMinConstraints: Boolean = false,\n    content:\n        @Composable @UiComposable BoxWithConstraintsScope.() -> Unit\n) {\n    val measurePolicy = rememberBoxMeasurePolicy(contentAlignment, propagateMinConstraints)\n    SubcomposeLayout(modifier) { constraints ->\n        val scope = BoxWithConstraintsScopeImpl(this, constraints)\n        val measurables = subcompose(Unit) { scope.content() }\n        with(measurePolicy) { measure(measurables, constraints) }\n    }\n}\n```\n\n\u91cc\u9762\u7528\u5230\u4e86SubcomposeLayout\uff0c\u6765\u63a8\u8fdf\u5185\u5bb9\u7ec4\u5408\uff0c\u6211\u4eec\u53ef\u4ee5\u5728**BoxWithConstraintsScope**\u91cc\u9762\u83b7\u53d6\u5230\u6700\u5927\u5bbd\u5ea6maxWidth **(\u5355\u4f4ddp)**\u3002\n\nLoading\u7ebf\u6761\uff0c\u6211\u4eec\u53ef\u4ee5\u7528DrawScope.drawLine\u6765\u753b\uff0c\u6269\u6563\u6548\u679c\u80af\u5b9a\u9700\u8981\u6709\u52a8\u753b\u6765\u66f4\u65b0\u3002\n\n\u6211\u4eec\u4f7f\u7528 **rememberInfiniteTransition()** \u6267\u884c\u65e0\u9650\u52a8\u753b\uff0c\u4f7f\u7528**animateFloat**\u6765\u83b7\u53d6\u52a8\u753b\u66f4\u65b0\u7684\u503c\uff1a\n\n```kotlin\n// \u4ee3\u7801\u6765\u81ea\uff1aandroidx.compose.animation.core\n@Composable\nfun InfiniteTransition.animateFloat(\n    initialValue: Float,\n    targetValue: Float,\n    animationSpec: InfiniteRepeatableSpec<Float>\n): State<Float>\n```\n\u521d\u59cb\u503c(**initialValue**)\u53ef\u4ee5\u5b9a\u4e49\u621050F`(\u8bfb\u8005\u53ef\u81ea\u884c\u4fee\u6539)`\uff0c\u76ee\u6807\u503c(**targetValue**)\u5b9a\u4e49\u591a\u5c11\u5408\u9002\u5462\uff1f\n\n\u901a\u8fc7\u6162\u955c\u5934\u67e5\u770b\u201c**\u6296\u97f3\u3001\u5feb\u624b**\u201d\u7684\u6548\u679c\uff0c\u53d1\u73b0\u5b83\u6269\u6563\u5b8c\uff0c\u4f1a\u201c\u6e10\u9690\u5230\u900f\u660e\u201d\uff0c\u7136\u540e\u518d\u4ece**intialValue**\u5904\u5f00\u59cb\u91cd\u65b0\u6269\u6563\u3002\n\n**targetValue**\u5b9a\u4e49\u6210**maxWidth\u4e0d\u884c**\uff0c\u90a3\u4e48\u6211\u4eec\u62c9\u5927\u8fd9\u4e2a\u6570\u503c\uff0c\u53ef\u4ee5\u5b9a\u4e49\u6210\u5927\u6982**1.8\u500d\u7684maxWidth**;\n\n\u7531\u4e8emaxWidth\u83b7\u53d6\u5230\u7684\u662fdp\u5355\u4f4d\u7684\uff0c\u6211\u4eec\u9700\u8981\u8f6c\u6362\u6210px\uff0c\u4e0b\u9762\u6211\u4eec\u7edf\u4e00\u53eb\uff1a**width**\n\n\n```kotlin\nval width = with(LocalDensity.current) {  maxWidth.toPx() }\n```\n\n\u7136\u540e\uff0c\u6211\u4eec\u7684**\u7ebf\u6761\u52a8\u753b\u503c**\u5c31\u53d8\u6210\u4e0b\u9762\u8fd9\u6837\uff1a\n\n```kotlin\nval lineProgressAnimValue by infiniteTransition.animateFloat(\n    initialValue = 100F,\n    targetValue = width * 1.8F,\n    animationSpec = infiniteRepeatable(\n            animation = tween(\n            durationMillis = TIME_PERIOD,\n            easing = FastOutLinearInEasing\n        )\n    )\n)\nprivate const val TIME_PERIOD = 1100\n```\n\n\u7ebf\u6761\u6269\u6563\u5230\u5c4f\u5e55\u8fb9\u7f18\u7684\u65f6\u5019\uff0c\u9700\u8981**\u6267\u884c\u6e10\u9690**\uff0c\u5f97\u51fa\u4e0b\u9762\u7684alpha\n\n```kotlin\nval lineAlphaValue = if(lineProgressAnimValue <= width) {\n    // \u8bfb\u8005\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u4f53\u9a8c\n    lineProgressAnimValue * 1.0F/ width * 1.0F\n    // \u8bfb\u8005\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u4f53\u9a8c\n    //Math.min((lineProgressAnimValue.value) * 1.0F / width * 1.0F, 0.7F)\n    // \u6296\u97f3\u3001\u5feb\u624b\u770b\u6548\u679c\u90fd\u662f1F\uff0c\u6839\u636e\u81ea\u5df1\u4f53\u9a8c\u6765\u8bbe\u7f6e\u5427\n    // 1F\n} else {\n    // \u6269\u6563\u5230\u5c4f\u5e55\u8fb9\u7f18\u7684\u65f6\u5019\uff0c\u5f00\u59cb\u89e6\u53d1\uff1a\u6e10\u9690\n    (width * 1.8F - lineProgressAnimValue) / width * 0.8F\n}\n// \u7ebf\u6761\u5bbd\u5ea6\nval lineWidth = if(lineProgressAnimValue <= width) {\n    lineProgressAnimValue / 2\n} else {\n    width / 2\n}\n```\n\n\u6700\u540e\uff0c\u6211\u4eec\u901a\u8fc7**Canvas**\u6765\u7ed8\u5236\u8fd9\u4e2a\u7ebf\u6761\n\n```kotlin\nCanvas(modifier = modifier) {\n    drawLine(\n        color = Color.White.copy(alpha = lineAlphaValue),\n        start = Offset(x = size.width / 2 - lineWidth, y = 0F),\n        end = Offset(x = size.width / 2 + lineWidth, y = 0F),\n        strokeWidth = 2.5F\n    )\n}\n```\n\u6765\u770b\u770b\u6211\u4eec\u7684\u6700\u7ec8\u6548\u679c\u5427\uff1a\n\n<p align=center><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c3823d91b2204aba93dd21e257100406~tplv-k3u1fbpfcp-watermark.image?\" alt=\"2022-08-20 10_51_22.gif\" width=\"70%\" /></p>\n\n\n---------\n\n\n**\u5f80\u671f\u6587\u7ae0\u63a8\u8350\uff1a**    \n[**1.Jetpack Compose UI\u521b\u5efa\u5e03\u5c40\u7ed8\u5236\u6d41\u7a0b+\u539f\u7406 \u2014\u2014 \u5185\u542b\u6982\u5ff5\u8be6\u89e3\uff08\u6ee1\u6ee1\u5e72\u8d27\uff09**](https://juejin.cn/post/7003606223438217223)<br/>\n[**2.\u6b63\u786e\u5b9e\u8df5Jetpack SplashScreen API \u2014\u2014 \u5728\u6240\u6709Android\u7cfb\u7edf\u4e0a\u4f7f\u7528\u603b\u7ed3\uff0c\u5185\u542b\u539f\u7406\u5206\u6790**](https://juejin.cn/post/7019839767441309733)<br/>\n[**3.\u6e90\u7801\u5206\u6790 | ThreadedRenderer\u7a7a\u6307\u9488\u95ee\u9898\uff0c\u987a\u4fbf\u628aChoreographer\u8ba4\u8bc6\u4e00\u4e0b**](https://juejin.cn/post/7002537215154716686)<br/>\n[**4.\u6e90\u7801\u5206\u6790 | \u4e8b\u4ef6\u662f\u600e\u4e48\u4f20\u9012\u5230Activity\u7684\uff1f**](https://juejin.cn/post/6994376402330091551)<br/>\n[**5.Jetpack Compose - FloatingActionButton \u5c55\u5f00/\u6298\u53e0 \u7684\u591a\u7ea7\u60ac\u6d6e\u83dc\u5355**](https://juejin.cn/post/6969562505878175781)<br/>\n[**6.\u5982\u4f55\u7981\u7528\u65e0\u969c\u788d\u6a21\u62df\u70b9\u51fb\uff0c\u63d0\u9ad8\u5e94\u7528\u6536\u76ca**](https://juejin.cn/post/6953937584443621412)    \n",
    "mtime": "1660966728",
    "original_author": "",
    "original_type": 0,
    "rank_index": 8.50490567,
    "rtime": "1660966727",
    "status": 2,
    "tag_ids": [
      6809640400832167936,
      6809641107346063360,
      6809640615584727040
    ],
    "title": "Compose\u5236\u4f5c\u201c\u6296\u97f3\u201d\u3001\u201c\u5feb\u624b\u201d\u89c6\u9891\u8fdb\u5ea6\u6761Loading\u52a8\u753b\u6548\u679c",
    "user_id": "8451824316670",
    "user_index": 12.245623163941787,
    "verify_status": 1,
    "view_count": 101,
    "visible_level": 0
  },
  {
    "article_id": "7133528305512218637",
    "audit_status": 2,
    "brief_content": "\u672c\u7bc7\u535a\u5ba2\u4f7f\u7528\u591a\u9636\u6bb5\u6784\u5efa\u7684\u65b9\u5f0f\u521b\u5efa\u7d27\u51d1\u7684 Docker \u955c\u50cf\uff0c\u63a2\u7a76\u5982\u4f55\u663e\u8457\u7f29\u5c0f Docker \u955c\u50cf\u7684\u5927\u5c0f\u3002",
    "category_id": "6809637769959178254",
    "collect_count": 0,
    "comment_count": 0,
    "content": "",
    "cover_image": "https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/64fde3e688c14d29a71654bb95f6ae93~tplv-k3u1fbpfcp-watermark.image?",
    "ctime": "1660904086",
    "digg_count": 1,
    "display_count": 0,
    "draft_id": "7133508699548549157",
    "hot_index": 5,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "\u591a\u9636\u6bb5\u6784\u5efa\u65b9\u5f0f\uff0c\u662f\u5728 `Dockerfile` \u4e2d\u4f7f\u7528\u591a\u4e2a `FROM` \u6307\u4ee4\uff0c\u6bcf\u4e2a `FORM` \u6307\u4ee4\u90fd\u662f\u4e00\u4e2a\u65b0\u7684\u6784\u5efa\u9636\u6bb5\uff0c\u5e76\u4e14\u53ef\u4ee5\u65b9\u4fbf\u5730\u590d\u5236\u4e4b\u524d\u9636\u6bb5\u7684\u6784\u4ef6\u3002\u8ba9\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u7b80\u5355\u7684 `Go` \u7a0b\u5e8f\u3002\u4ee3\u7801\u5982\u4e0b\u3002\u70b9\u51fb[\u6b64\u5904](https://go.dev/play/p/I8Fk3DHcPcP)\u60a8\u53ef\u4ee5\u83b7\u53d6\u4ee3\u7801\u3002\n\n\n![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fec055b0ee544f1198ae23036fb74ec2~tplv-k3u1fbpfcp-watermark.image?)\n\u8ba9\u6211\u4eec\u6765\u4e3a\u5b83\u6784\u5efa `Docker` \u955c\u50cf\uff0c`Dockerfile` \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\u3002\n\n```Dockerfile\nFROM golang:1.19-alpine\nWORKDIR /build\nCOPY go.mod .\nRUN go mod download\nCOPY . .\nRUN go build -o /main main.go\nENTRYPOINT [\"/main\"]\n```\n\n\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a 359 MB\u5927\u5c0f\u7684\u955c\u50cf\u3002\n![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bba86afc8eb5404ca7ca15b0e5bda2ea~tplv-k3u1fbpfcp-watermark.image?)\n\n\u73b0\u5728\u8ba9\u6211\u4eec\u6784\u5efa\u76f8\u540c\u7684\u7a0b\u5e8f\uff0c\u4f46\u4f7f\u7528**\u591a\u9636\u6bb5\u6784\u5efa**\uff1a\n```Dockerfile\nFROM golang:1.19-alpine as builder\nWORKDIR /build\nCOPY go.mod .\nRUN go mod download\nCOPY . .\nRUN go build -o /main main.go\n\nFROM alpine:3\nCOPY --from=builder main /bin/main\nENTRYPOINT [\"/bin/main\"]\n```\n\n\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u5c45\u7136\u5f97\u5230\u4e86\u4e00\u4e2a\u53ea\u6709 12 MB \u5927\u5c0f\u7684 `Docker` \u955c\u50cf\u3002\u8fd8\u4e0d\u9519\uff0c\u6211\u4eec\u628a\u955c\u50cf\u5927\u5c0f\u51cf\u5c11\u4e86\u7ea6 30 \u500d\u3002\u6211\u4eec\u662f\u5982\u4f55\u5b8c\u6210\u7684\u5462\uff1f\n\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d0bc87e9888946cea329fb64671189a9~tplv-k3u1fbpfcp-watermark.image?)\n\n\u5728\u7b2c\u4e00\u79cd\u60c5\u51b5\uff0c\u4f7f\u7528\u5355\u9636\u6bb5\u6784\u5efa\uff0c`Docker` \u955c\u50cf\u4e2d\u5305\u542b\u4e86\u4ee5\u4e0b\u5185\u5bb9\u3002\n- golang:1.19-alpine -- 345.93 MB\n- source size -- 11.1 KB\n- \u7f16\u8bd1\u540e\u7684\u5e94\u7528\u7a0b\u5e8f\u5927\u5c0f -- 6.5 MB\n\n\u5728\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u5148\u7f16\u8bd1\u5e76\u6784\u5efa\u4e86\u5e94\u7528\u7a0b\u5e8f\uff0c\u7136\u540e\u5c06\u5df2\u7ecf\u7f16\u8bd1\u7684\u7ed3\u679c\u590d\u5236\u5230\u6700\u540e\u4e00\u4e2a\u9636\u6bb5\u3002\n- alpine size:3 -- 5.54 MB\n- \u7f16\u8bd1\u540e\u7684\u5e94\u7528\u7a0b\u5e8f\u5927\u5c0f -- 6.5 MB\n\n**\u662f\u5426\u53ef\u4ee5\u518d\u51cf\u5c0f Docker \u955c\u50cf\u7684\u5927\u5c0f\uff1f**\n\n\u7b54\u6848\u662f\uff1a\u80fd\u3002\u4f46\u4e3a\u6b64\u6211\u4eec\u9700\u8981\u4f7f\u7528 [`Docker Scratch`](https://hub.docker.com/_/scratch) -- \u5b83\u662f\u4e00\u4e2a 0 MB \u7684 `Docker` \u955c\u50cf\u3002\n```Dockerfile\nFROM golang:1.19-alpine as builder\n\nWORKDIR /build\nCOPY go.mod .\nRUN go mod download\nCOPY . .\nRUN CGO_ENABLED=0 GOOS=linux go build -o /main main.go\n\nFROM scratch\nCOPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/\nCOPY --from=builder main /bin/main\nENTRYPOINT [\"/bin/main\"]\n```\n\n\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u7684\u955c\u50cf\u5927\u5c0f\u4e3a 6.66 MB\u3002\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/26cddcf7cf5549adb8cb6ceddc0122f6~tplv-k3u1fbpfcp-watermark.image?)",
    "mtime": "1660966681",
    "original_author": "",
    "original_type": 0,
    "rank_index": 6.25413758,
    "rtime": "1660966681",
    "status": 2,
    "tag_ids": [
      6809640364677267456,
      6809640396788858880
    ],
    "title": "\u591a\u9636\u6bb5\u6784\u5efa\u4f18\u5316\u60a8\u7684 Go \u7a0b\u5e8f\u955c\u50cf",
    "user_id": "571401779807175",
    "user_index": 7.803550848397884,
    "verify_status": 1,
    "view_count": 103,
    "visible_level": 0
  },
  {
    "article_id": "7133522794641358884",
    "audit_status": 2,
    "brief_content": "SPI\u5168\u79f0Service Provider Interface\uff0c\u662fJava\u63d0\u4f9b\u7684\u4e00\u5957\u7528\u6765\u88ab\u7b2c\u4e09\u65b9\u5b9e\u73b0\u6216\u8005\u6269\u5c55\u7684\uff0c\u5b83\u53ef\u4ee5\u7528\u6765\u542f\u7528\u6846\u67b6\u6269\u5c55\u548c\u66ff\u6362\u7ec4\u4ef6\u3002 \u6211\u4eec\u7cfb\u7edf\u91cc\u62bd\u8c61\u7684\u5404\u4e2a\u6a21\u5757\uff0c\u5f80\u5f80\u6709\u5f88\u591a\u4e0d\u540c\u7684\u5b9e\u73b0.",
    "category_id": "6809637769959178254",
    "collect_count": 0,
    "comment_count": 0,
    "content": "",
    "cover_image": "https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf31629882714e86a8e31341b33f9592~tplv-k3u1fbpfcp-watermark.image?",
    "ctime": "1660902728",
    "digg_count": 0,
    "display_count": 0,
    "draft_id": "7133520074761043998",
    "hot_index": 4,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "## \u7b80\u4ecb\n\nSPI\u5168\u79f0Service Provider Interface\uff0c\u662fJava\u63d0\u4f9b\u7684\u4e00\u5957\u7528\u6765\u88ab\u7b2c\u4e09\u65b9\u5b9e\u73b0\u6216\u8005\u6269\u5c55\u7684\uff0c\u5b83\u53ef\u4ee5\u7528\u6765\u542f\u7528\u6846\u67b6\u6269\u5c55\u548c\u66ff\u6362\u7ec4\u4ef6\u3002\n\n\u6211\u4eec\u7cfb\u7edf\u91cc\u62bd\u8c61\u7684\u5404\u4e2a\u6a21\u5757\uff0c\u5f80\u5f80\u6709\u5f88\u591a\u4e0d\u540c\u7684\u5b9e\u73b0\u65b9\u6848\uff0c\u6bd4\u5982\u65e5\u5fd7\u6a21\u5757\u3001xml\u89e3\u6790\u6a21\u5757\u3001jdbc\u6a21\u5757\u7b49\u65b9\u6848\u3002\u9762\u5411\u7684\u5bf9\u8c61\u7684\u8bbe\u8ba1\u91cc\uff0c\u6211\u4eec\u4e00\u822c\u63a8\u8350\u6a21\u5757\u4e4b\u95f4\u57fa\u4e8e\u63a5\u53e3\u7f16\u7a0b\uff0c\u6a21\u5757\u4e4b\u95f4\u4e0d\u5bf9\u5b9e\u73b0\u7c7b\u8fdb\u884c\u786c\u7f16\u7801\u3002\u4e00\u65e6\u4ee3\u7801\u91cc\u6d89\u53ca\u5177\u4f53\u7684\u5b9e\u73b0\u7c7b\uff0c\u5c31\u8fdd\u53cd\u4e86\u53ef\u62d4\u63d2\u7684\u539f\u5219\uff0c\u5982\u679c\u9700\u8981\u66ff\u6362\u4e00\u79cd\u5b9e\u73b0\uff0c\u5c31\u9700\u8981\u4fee\u6539\u4ee3\u7801\u3002\u4e3a\u4e86\u5b9e\u73b0\u5728\u6a21\u5757\u88c5\u914d\u7684\u65f6\u5019\u80fd\u4e0d\u5728\u7a0b\u5e8f\u91cc\u52a8\u6001\u6307\u660e\uff0c\u8fd9\u5c31\u9700\u8981\u4e00\u79cd\u670d\u52a1\u53d1\u73b0\u673a\u5236\u3002 Java SPI\u5c31\u662f\u63d0\u4f9b\u8fd9\u6837\u7684\u4e00\u4e2a\u673a\u5236\uff1a\u4e3a\u67d0\u4e2a\u63a5\u53e3\u5bfb\u627e\u670d\u52a1\u5b9e\u73b0\u7684\u673a\u5236\u3002\u6709\u70b9\u7c7b\u4f3cIOC\u7684\u601d\u60f3\uff0c\u5c31\u662f\u5c06\u88c5\u914d\u7684\u63a7\u5236\u6743\u79fb\u5230\u7a0b\u5e8f\u4e4b\u5916\uff0c\u5728\u6a21\u5757\u5316\u8bbe\u8ba1\u4e2d\u8fd9\u4e2a\u673a\u5236\u5c24\u5176\u91cd\u8981\u3002\n\n## Java\u7684SPI\u673a\u5236: ServiceLoader\n\n### \u7528\u6cd5\n\n```\n// java.sql.Driver\n// 1.new\u4e00\u4e2aServiceLoader\nServiceLoader<Driver> drivers = ServiceLoader.load(Driver.class);\nIterator<Driver> iterator = drivers.iterator();\n// 2.\u8c03\u7528\u5ef6\u8fdf\u52a0\u8f7d\u5668\u7684hashNext\nwhile (iterator.hasNext()) {\n \u00a0// 3.\u8c03\u7528\u5ef6\u8fdf\u52a0\u8f7d\u5668\u7684next\n \u00a0Driver next = iterator.next();\n \u00a0System.out.println(next.getClass());\n}\n\u200b\n// result:\nclass com.mysql.jdbc.Driver\nclass com.mysql.fabric.jdbc.FabricMySQLDriver\nclass com.alibaba.druid.proxy.DruidDriver\nclass com.alibaba.druid.mock.MockDriver\n```\n\n### \u539f\u7406\n\nServiceLoader\u5e76\u4e0d\u4f1a\u5728load\u7684\u65f6\u5019\u53bb\u52a0\u8f7d\u6240\u6709 \u63a5\u53e3\u5bf9\u5e94\u5b9e\u73b0\u7c7b\u7684\u6587\u4ef6\u3002\u800c\u662f\u5728\u6267\u884c\u63a5\u53e3\u7684\u65f6\u5019\u53bb\u904d\u5386\u52a0\u8f7d\u3002\n\n### ServiceLoader\u7684\u6838\u5fc3\u5c5e\u6027\n\n```\n// \u63a5\u53e3\u5168\u9650\u5b9a\u540d\u7684\u6587\u4ef6\u7684\u8def\u5f84\u524d\u7f00\nprivate static final String PREFIX = \"META-INF/services/\";\n\u200b\n// \u88ab\u52a0\u8f7d\u7684\u63a5\u53e3\nprivate final Class<S> service;\n\u200b\n// \u7c7b\u7684\u52a0\u8f7d\u5668\nprivate final ClassLoader loader;\n\u200b\n// \u521b\u5efaserviceLoader\u65f6 \u8bbf\u95ee\u63a7\u5236\u4e0a\u4e0b\u6587\nprivate final AccessControlContext acc;\n\u200b\n// \u670d\u52a1\u7f13\u5b58\u6c60\uff08k-> \u7c7b\u5168\u62a5\u540d  v-> \u5b9e\u73b0\u7c7b\u4fe1\u606f\uff09\nprivate LinkedHashMap<String,S> providers = new LinkedHashMap<>();\n\u200b\n// \u5ef6\u8fdf\u52a0\u8f7d\u7684\u8fed\u4ee3\u5668\nprivate LazyIterator lookupIterator;\n```\n\n### LazyIterator\u7684\u6838\u5fc3\u5c5e\u6027\n\n```\n// \u63a5\u53e3\u7c7b\u578b\nClass<S> service;\n// \u63a5\u7684\u52a0\u8f7d\u5668\nClassLoader loader;\n// META-INF/services/\u5185\u914d\u7f6e\u6587\u4ef6\u7684URL\u96c6\u5408\nEnumeration<URL> configs = null;\n// \u9700\u52a0\u8f7d\u7684\u5b9e\u73b0\u7c7b\u7684\u5168\u5305\u540d\u96c6\u5408\nIterator<String> pending = null;\n// \u4e0b\u4e00\u4e2a\u5b9e\u73b0\u7c7b\u7684\u5168\u62a5\u540d\uff0c\u7528\u4e8e\u8fed\u4ee3\u5668\u5ef6\u8fdf\u52a0\u8f7d\u7684\u4e0b\u4e00\u4e2a\u7c7b\nString nextName = null;\n```\n\n### \u6e90\u7801\u89e3\u6790\n\n1\u3001load\u65b9\u6cd5\n\n```\n// 1\u3001load\u65b9\u6cd5\npublic static <S> ServiceLoader<S> load(Class<S> service) {\n \u00a0// \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u7684\u7c7b\u52a0\u8f7d\u5668\n \u00a0ClassLoader cl = Thread.currentThread().getContextClassLoader();\n \u00a0// \u7ee7\u7eed\u8c03\u7528\u91cd\u8f7d\u7684\u65b9\u6cd5\n \u00a0return ServiceLoader.load(service, cl);\n}\n\u200b\n// 2\u3001\u8c03\u7528\u91cd\u8f7d\u65b9\u6cd5\npublic static <S> ServiceLoader<S> load(Class<S> service, ClassLoader loader) {\n \u00a0// new \u4e00\u4e2aServiceLoader\u5bf9\u8c61\n \u00a0return new ServiceLoader<>(service, loader);\n}\n\u200b\n// 3\u3001new \u4e00\u4e2aserviceLoader\u5bf9\u8c61\nprivate ServiceLoader(Class<S> svc, ClassLoader cl) {\n \u00a0// PS\uff1a\u670d\u52a1\u63a5\u53e3\u4e0d\u80fd\u4e3a\u7a7a\n \u00a0service = Objects.requireNonNull(svc, \"Service interface cannot be null\");\n \u00a0// \u6307\u5b9a\u52a0\u8f7d\u5668\n \u00a0loader = (cl == null) ? ClassLoader.getSystemClassLoader() : cl;\n \u00a0// \u6307\u5b9a\u4e0b\u4e0a\u5bb9\u5668\uff08\u9ed8\u8ba4\u4e3anull\uff09\n \u00a0acc = (System.getSecurityManager() != null) ? AccessController.getContext() : null;\n \u00a0// \u5237\u65b0\uff1a1.\u91cd\u7f6e\u670d\u52a1\u7f13\u51b2\u6c60 2.new\u4e00\u4e2a\u5ef6\u8fdf\u52a0\u8f7d\u7684\u8fed\u4ee3\u5668\n \u00a0reload();\n}\n\u200b\n// 4\u3001\u5237\u65b0 \u00a0\npublic void reload() {\n \u00a0// \u91cd\u7f6e\u670d\u52a1\u7f13\u5b58\u6c60\n \u00a0providers.clear();\n \u00a0// \u6784\u9020\u4e00\u4e2a\u5ef6\u8fdf\u52a0\u8f7d\u7684\u8fed\u4ee3\u5668\n \u00a0lookupIterator = new LazyIterator(service, loader);\n}\n\u200b\n// 5\u3001new LazyIterator\nprivate LazyIterator(Class<S> service, ClassLoader loader) {\n \u00a0// \u6307\u5b9a\u63a5\u53e3\u7684\u7c7b\u4fe1\u606f\n \u00a0this.service = service;\n \u00a0// \u6307\u5b9a\u7c7b\u52a0\u8f7d\u5668\n \u00a0this.loader = loader;\n}\n```\n\n2\u3001\u83b7\u53d6\u5ef6\u8fdf\u52a0\u8f7d\u7684\u8fed\u4ee3\u5668\n\n3\u3001\u8c03\u7528\u5ef6\u8fdf\u52a0\u8f7d\u8fed\u4ee3\u5668\u7684hasNext()\u65b9\u6cd5\n\n```\n// 1\u3001\u8c03\u7528hasNext()\u65b9\u6cd5\npublic boolean hasNext() {\n  // \u9ed8\u8ba4 acc\u4e3anull\n \u00a0if (acc == null) {\n \u00a0 \u00a0// \u6267\u884chasNextService()\u65b9\u6cd5\n \u00a0 \u00a0return hasNextService();\n  } else {\n \u00a0 \u00a0PrivilegedAction<Boolean> action = new PrivilegedAction<Boolean>() {\n \u00a0 \u00a0 \u00a0public Boolean run() { return hasNextService(); }\n \u00a0  };\n \u00a0 \u00a0return AccessController.doPrivileged(action, acc);\n  }\n}\n\u200b\n// 2\u3001\u8c03\u7528hasNextService()\u65b9\u6cd5\nprivate boolean hasNextService() {\n \u00a0// \u9ed8\u8ba4\u7b2c\u4e00\u6b21\u6267\u884c nextName\u4e3anull\n \u00a0if (nextName != null) {\n \u00a0 \u00a0return true;\n  }\n \u00a0// \u9ed8\u8ba4\u7b2c\u4e00\u6b21\u6267\u884c configs\u4e3anull, \u901a\u8fc7\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\u7c7b\u7684\u5168\u62a5\u540d\uff0c\u7136\u540e\u83b7\u53d6URL\u3002\n \u00a0if (configs == null) {\n \u00a0 \u00a0try {\n \u00a0 \u00a0 \u00a0// \"META-INF/services/\" + java.sql.Driver\n \u00a0 \u00a0 \u00a0// 1.file:/Users/zhouzeng/.m2/repository/mysql/mysql-connector-java/5.1.38/mysql-connector-java-5.1.38.jar!/META-INF/services/java.sql.Driver\n \u00a0 \u00a0 \u00a0// 2.file:/Users/zhouzeng/.m2/repository/com/alibaba/druid/1.0.28/druid-1.0.28.jar!/META-INF/services/java.sql.Driver\n \u00a0 \u00a0 \u00a0String fullName = PREFIX + service.getName();\n \u00a0 \u00a0 \u00a0if (loader == null) {\n \u00a0 \u00a0 \u00a0 \u00a0configs = ClassLoader.getSystemResources(fullName);\n \u00a0 \u00a0  } else {\n \u00a0 \u00a0 \u00a0 \u00a0configs = loader.getResources(fullName);\n \u00a0 \u00a0  }\n \u00a0  } catch (IOException x) {\n \u00a0 \u00a0 \u00a0fail(service, \"Error locating configuration files\", x);\n \u00a0  }\n  }\n \u00a0// \u9ed8\u8ba4\u7b2c\u4e00\u6b21\u6267\u884c pending\u4e3anull\n \u00a0while ((pending == null) || !pending.hasNext()) {\n \u00a0 \u00a0if (!configs.hasMoreElements()) {\n \u00a0 \u00a0 \u00a0return false;\n \u00a0  }\n \u00a0 \u00a0// \u6839\u636e \u63a5\u53e3+ URL \u89e3\u6790 \n \u00a0 \u00a0/**\n \u00a0 \u00a0 * 1.0 = \"com.mysql.jdbc.Driver\" 1 = \"com.mysql.fabric.jdbc.FabricMySQLDriver\"\n \u00a0 \u00a0 * 2.0 = \"com.alibaba.druid.proxy.DruidDriver\" 1 = \"com.alibaba.druid.mock.MockDriver\"\n \u00a0 \u00a0 **/\n \u00a0 \u00a0pending = parse(service, configs.nextElement());\n  }\n \u00a0// com.mysql.jdbc.Driver\n \u00a0nextName = pending.next();\n \u00a0return true;\n}\n\u200b\n```\n\n4\u3001next()\u65b9\u6cd5\n\n```\n// 1.\u6267\u884cnext\u65b9\u6cd5\npublic S next() {\n \u00a0// \u9ed8\u8ba4 acc\u4e3anull\n \u00a0if (acc == null) {\n \u00a0 \u00a0// \u8c03\u7528nexrService()\u65b9\u6cd5\n \u00a0 \u00a0return nextService();\n  } else {\n \u00a0 \u00a0PrivilegedAction<S> action = new PrivilegedAction<S>() {\n \u00a0 \u00a0 \u00a0public S run() { return nextService(); }\n \u00a0  };\n \u00a0 \u00a0return AccessController.doPrivileged(action, acc);\n  }\n}\n\u200b\n// 2.\u6267\u884cnextService()\u65b9\u6cd5\nprivate S nextService() {\n \u00a0// \u5224\u65ad\u662f\u5426\u8fd8\u6709\u4e0b\u4e00\u4e2a\u7c7b\u9700\u8981\u52a0\u8f7d\n \u00a0if (!hasNextService()) {\n \u00a0 \u00a0throw new NoSuchElementException(); \u00a0\n  }\n \u00a0// 1.com.mysql.jdbc.Driver\n \u00a0// 2.com.mysql.fabric.jdbc.FabricMySQLDriver\n \u00a0// 3.com.alibaba.druid.proxy.DruidDriver\n \u00a0// 4.com.alibaba.druid.mock.MockDriver\n \u00a0String cn = nextName;\n \u00a0nextName = null;\n \u00a0Class<?> c = null;\n \u00a0try {\n \u00a0 \u00a0// \u751f\u6210\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\n \u00a0 \u00a0c = Class.forName(cn, false, loader);\n  } catch (ClassNotFoundException x) {\n \u00a0 \u00a0fail(service, \"Provider \" + cn + \" not found\");\n  }\n \u00a0// \u6821\u9a8c\u5b9e\u73b0\u7c7b \u662f\u4e0d\u662f\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\n \u00a0if (!service.isAssignableFrom(c)) {\n \u00a0 \u00a0fail(service, \u00a0\"Provider \" + cn \u00a0+ \" not a subtype\");\n  }\n \u00a0try {\n \u00a0 \u00a0// \u5c06\u5b9e\u73b0\u7c7b\u7684\u5b9e\u4f8b\uff0c\u8f6c\u5316\u4e3a\u63a5\u53e3\u7c7b\u578b\uff08\u7c7b\u578b\u8f6c\u5316\uff09\n \u00a0 \u00a0S p = service.cast(c.newInstance());\n \u00a0 \u00a0// \u653e\u5230\u7f13\u5b58\u6c60\u4e2d\n \u00a0 \u00a0providers.put(cn, p);\n \u00a0 \u00a0return p;\n  } catch (Throwable x) {\n \u00a0 \u00a0fail(service, \"Provider \" + cn + \" could not be instantiated\", x);\n  }\n \u00a0throw new Error();\n}\n```\n\n## \u4f18\u7f3a\u70b9\n\n\u4f18\u70b9\uff1a\u5c06\u4e1a\u52a1\u4ee3\u7801\u548c\u5177\u4f53\u5b9e\u73b0\u7c7b\u89e3\u8026\uff0c\u65b9\u4fbf\u6269\u5c55\u3002\u5982\u9700\u589e\u52a0\u65b0\u903b\u8f91\uff0c\u65e0\u9700\u4fee\u6539\u4e3b\u6d41\u7a0b\uff0c\u76f4\u63a5\u5728PI\u914d\u7f6e\u6587\u4ef6\u589e\u52a0\u5b9e\u73b0\u7c7b\u7684\u5168\u9650\u5b9a\u540d\u5373\u53ef\u3002\n\n\u7f3a\u70b9\uff1a\u9897\u7c92\u5ea6\u4e0d\u591f\u7ec6\uff0c\u65e0\u6cd5\u51c6\u786e\u5b9a\u4f4d\u67d0\u4e00\u4e2a\u5b9e\u73b0\u7c7b\u3002\u8981\u6267\u884c\u5c31\u6267\u884c\u6240\u6709\u7684\u5b9e\u73b0\u7c7b\u3002\n\n## SpringBoot \u4e4bSPI\u673a\u5236\uff1aSpringFactoriesLoader\n\n### \u5e94\u7528\n\n1.\u521b\u5efa\u4e00\u4e2aenableConfiguration\n\n```\n@Configuration\n@EnableConfigurationProperties({MybatisProperties.class})\npublic class MybatisAutoConfiguration {\n \u00a0 \u00a0\n}\n```\n\n2.\u5728resources\u4e0b\u5b9a\u4e49META-INF/spring.factories\n\n```\n# Auto Configure\norg.springframework.boot.autoconfigure.EnableAutoConfiguration=\\\norg.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration\n```\n\n3.\u7528SpringBoot\u542f\u52a8\n\n```\n@SpringBootApplication\npublic class Application extends SpringBootServletInitializer {\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    } \n}\n```\n\n\u5728springbot\u542f\u52a8\u65f6\u56de\u53bb\u52a0\u8f7dMybatisAutoConfiguration\u8fd9\u4e2a\u7c7b\u3002\n\n### \u539f\u7406\n\n1\u3001\u5728SpringBoot\u542f\u52a8\u65f6\uff0c\u5728refreshContext()\u65f6\uff0c\u56de\u53bb\u8c03\u7528@Import\u7684selector\u3002\n\n2\u3001\u7136\u540e\u6267\u884c AutoConfigurationImportSelector\u7684process()\u65b9\u6cd5 \u83b7\u53d6\u5bf9\u5e94\u7684configuration\u7684List\u3002\n\n3\u3001\u7531Spring \u53bb\u52a0\u8f7d\u5b9e\u4f8b\u5316configuration\u7684\u914d\u7f6e\u7c7b\u3002\n\n```\n// 1.SpringBootApplication\u4e2d\u7684SpringBootConfiguration\n@Target(ElementType.TYPE)\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Inherited\n@SpringBootConfiguration\n@EnableAutoConfiguration\n@ComponentScan(excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),\n\t\t@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) })\npublic @interface SpringBootApplication {\n\n\t@AliasFor(annotation = EnableAutoConfiguration.class)\n\tClass<?>[] exclude() default {};\n\n\t@AliasFor(annotation = EnableAutoConfiguration.class)\n\tString[] excludeName() default {};\n\n\t@AliasFor(annotation = ComponentScan.class, attribute = \"basePackages\")\n\tString[] scanBasePackages() default {};\n\n\n\t@AliasFor(annotation = ComponentScan.class, attribute = \"basePackageClasses\")\n\tClass<?>[] scanBasePackageClasses() default {};\n\n}\n\n// 2.SpringBootConfiguration\n@Target(ElementType.TYPE)\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Inherited\n@AutoConfigurationPackage\n@Import(AutoConfigurationImportSelector.class)\npublic @interface EnableAutoConfiguration {\n\n\tString ENABLED_OVERRIDE_PROPERTY = \"spring.boot.enableautoconfiguration\";\n\n\tClass<?>[] exclude() default {};\n\n\tString[] excludeName() default {};\n}\n\n// 3.\u67e5\u770b AutoConfigurationImportSelector\u7684selectImports()\u65b9\u6cd5\npublic String[] selectImports(AnnotationMetadata annotationMetadata) {\n  if (!this.isEnabled(annotationMetadata)) {\n    return NO_IMPORTS;\n  } else {\n    AutoConfigurationMetadata autoConfigurationMetadata = AutoConfigurationMetadataLoader.loadMetadata(this.beanClassLoader);\n    AnnotationAttributes attributes = this.getAttributes(annotationMetadata);\n    // \u83b7\u53d6enableautoconfiguration\u76f8\u5173\u7684\u7c7b\n    List<String> configurations = this.getCandidateConfigurations(annotationMetadata, attributes);\n    configurations = this.removeDuplicates(configurations);\n    Set<String> exclusions = this.getExclusions(annotationMetadata, attributes);\n    this.checkExcludedClasses(configurations, exclusions);\n    configurations.removeAll(exclusions);\n    configurations = this.filter(configurations, autoConfigurationMetadata);\n    this.fireAutoConfigurationImportEvents(configurations, exclusions);\n    return StringUtils.toStringArray(configurations);\n  }\n}\n// 4. \u6267\u884cgetCandidateConfigurations()\u65b9\u6cd5\nprotected List<String> getCandidateConfigurations(AnnotationMetadata metadata, \n                                                  AnnotationAttributes attributes) {\n  // \u83b7\u53d6configurations\n  List<String> configurations = SpringFactoriesLoader.loadFactoryNames(\n    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthis.getSpringFactoriesLoaderFactoryClass(), this.getBeanClassLoader());\n  Assert.notEmpty(configurations, \"No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct.\");\n  return configurations;\n}\n\n// 5. \u6267\u884cloadFactoryNames()\u65b9\u6cd5\npublic static List<String> loadFactoryNames(Class<?> factoryClass, @Nullable ClassLoader classLoader) {\n  // org.springframework.boot.autoconfigure.EnableAutoConfiguration\n  String factoryClassName = factoryClass.getName();\n  // \u52a0\u8f7dspring.fatories\u7684\u914d\u7f6e\u9879\uff0c\u7136\u540e\u83b7\u53d6key\u4e3aEnableAutoConfiguration\u7684value\n  return (List)loadSpringFactories(classLoader).getOrDefault(factoryClassName, Collections.emptyList());\n}\n```\n\n### SpringFactoriesLoader\u7684\u6838\u5fc3\u5c5e\u6027\n\n```\n// 1.spring \u8d44\u6e90\u52a0\u8f7d\u7684\u9ed8\u8ba4\u8def\u5f84\npublic static final String FACTORIES_RESOURCE_LOCATION = \"META-INF/spring.factories\";\n\n// 2.\u7f13\u5b58\u6c60 K\u4e3a\u7c7b\u52a0\u8f7d\u5668 HK\u4e3a\u63a5\u53e3\u5168\u5305\u540d HV\u4e3a\u5b9e\u73b0\u7c7b\nprivate static final Map<ClassLoader, MultiValueMap<String, String>> cache = new ConcurrentReferenceHashMap<>();\n```\n\n```\n// 6.\u6267\u884cloadSpringFactories()\u65b9\u6cd5\uff0c\u6839\u636e\u7c7b\u52a0\u8f7d\u5668\uff0c\u83b7\u53d6META-INF/spring.factories\u4e0b\u7684\u914d\u7f6e\nprivate static Map<String, List<String>> loadSpringFactories(@Nullable ClassLoader classLoader) {\n  // \u5728\u7f13\u5b58\u6c60\u4e2d\u83b7\u53d6\uff0c\u6709\u5219\u76f4\u63a5\u8fd4\u56de\u3002\n  MultiValueMap<String, String> result = cache.get(classLoader);\n  if (result != null) {\n    return result;\n  }\n\n  try {\n    // \u83b7\u53d6\"META-INF/spring.factories\"\u7684URL\n    Enumeration<URL> urls = (classLoader != null ?\n                             classLoader.getResources(FACTORIES_RESOURCE_LOCATION) :\n                             ClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION));\n    result = new LinkedMultiValueMap<>();\n    while (urls.hasMoreElements()) {\n      URL url = urls.nextElement();\n      UrlResource resource = new UrlResource(url);\n      Properties properties = PropertiesLoaderUtils.loadProperties(resource);\n      for (Map.Entry<?, ?> entry : properties.entrySet()) {\n        List<String> factoryClassNames = Arrays.asList(\n          StringUtils.commaDelimitedListToStringArray((String) entry.getValue()));\n        result.addAll((String) entry.getKey(), factoryClassNames);\n      }\n    }\n    // \u5c06\u89e3\u6790\u51fa\u6765\u7684\u6570\u636e\u653e\u5230\u7f13\u5b58\u6c60\u4e2d\u3002\n    cache.put(classLoader, result);\n    return result;\n  }\n  catch (IOException ex) {\n    throw new IllegalArgumentException(\"Unable to load factories from location [\" +\n                                       FACTORIES_RESOURCE_LOCATION + \"]\", ex);\n  }\n}\n```\n\n## Dubbo\u7684SPI\u673a\u5236\n\n### \u7528\u6cd5\n\n#### \u4ee3\u7801\n\n```\n// 1.\u5b9a\u4e49\u63a5\u53e3\n@SPI(\"wechat\")\npublic interface Order {\n\n    /**\n     * \u652f\u4ed8\u65b9\u6cd5\n     *\n     * @return \u7ed3\u679c\n     */\n    String way();\n}\n\n// 2.\u63a5\u53e3\u5b9e\u73b0AlipayOrder\npublic class AlipayOrder implements Order {\n    @Override\n    public String way() {\n        System.out.println(\"--- \u652f\u4ed8\u5b9dway() ---\");\n        return \"\u652f\u4ed8\u5b9d\u652f\u4ed8\u65b9\u5f0f\";\n    }\n}\n\n// 3.\u63a5\u53e3\u5b9e\u73b0WeChatOrder\npublic class WeChatOrder implements Order {\n    @Override\n    public String way() {\n        System.out.println(\"--- \u5fae\u4fe1way() ---\");\n        return \"\u5fae\u4fe1\u652f\u4ed8\u65b9\u5f0f\";\n    }\n}\n```\n\n#### \u914d\u7f6e\n\n\u5728META-INF/dubbo\u76ee\u5f55\u4e0b\u6dfb\u52a0\u914d\u7f6e\u6587\u4ef6\uff08com.example.spidemo.dubbo.base.Order\uff09\n\n```\nwechat,wechat2=com.example.spidemo.dubbo.base.impl.WeChatOrder\nalipay=com.example.spidemo.dubbo.base.impl.AlipayOrder\n```\n\n#### \u6d4b\u8bd5\u7c7b\n\n```\npublic static void test1() {\n  ExtensionLoader<Order> loader = ExtensionLoader.getExtensionLoader(Order.class);\n\n  Order alipay = loader.getExtension(\"alipay\");\n  System.out.println(alipay.way());\n  //\u540c\u4e00\u4e2a\u5b9e\u73b0\u7c7b\uff0c\u591a\u4e2a\u540d\u79f0\uff0c\u662f\u540c\u4e00\u4e2a\u5b9e\u4f8b\n  Order wechat = loader.getExtension(\"wechat\");\n  System.out.println(wechat.way());\n  Order wechat2 = loader.getExtension(\"wechat2\");\n  System.out.println(wechat2 == wechat);\n\n  /**\n   * \u7ed3\u679c:\n   * --- \u652f\u4ed8\u5b9dway() ---\n   * \u652f\u4ed8\u5b9d\u652f\u4ed8\u65b9\u5f0f\n   * --- \u5fae\u4fe1way() ---\n   * \u5fae\u4fe1\u652f\u4ed8\u65b9\u5f0f\n   * true\n   */\n}\n\npublic static void test2() {\n  ExtensionLoader<Order> loader = ExtensionLoader.getExtensionLoader(Order.class);\n  //\u9a8c\u8bc1\u4e0d\u6307\u5b9a\u524d\u7f00\u7684\u60c5\u51b5\uff0c\u8fd9\u91cc\u4f1a\u62a5\u9519\n  Order alipay = loader.getDefaultExtension();\n  System.out.println(alipay.way());\n  /**\n   * \u7ed3\u679c:\n   * Exception in thread \"main\" java.lang.IllegalArgumentException: Extension name == null\n   * \tat org.apache.dubbo.common.extension.ExtensionLoader.getExtension(ExtensionLoader.java:340)\n   * \tat com.example.spidemo.dubbo.adaptive.DubboSpiTest02.main(DubboSpiTest02.java:14)\n   */\n}\n```\n\n#### \u6d41\u7a0b\n\n```\n// 1.\u6784\u9020Order\u7684ExtensionLoader\uff0c\u5176\u4e2d\u8fd8\u6784\u9020\u4e86\u5bf9\u5e94\u7684ExtensionFactory -\u300bAdaptiveExtensionFactory();\n1.ExtensionLoader<Order> loader = ExtensionLoader.getExtensionLoader(Order.class);\n2.1.loader.getExtension(\"alipay\");\n2.2.loader.getDefaultExtension();\n2.3.loader.getAdaptiveExtension();\n2.4.loader.getActivateExtension(url, \"\", \"online\");\n```\n\n### ExtensionLoader\u7684\u6838\u5fc3\u5c5e\u6027\n\n```\n// \u52a0\u8f7d\u6587\u4ef6\u7684\u8def\u5f84\n// \"META-INF/services/\"\u3001\"META-INF/dubbo/\" \u3001\"META-INF/dubbo/internal/\"\nprivate static final String SERVICES_DIRECTORY = \"META-INF/services/\";\nprivate static final String DUBBO_DIRECTORY = \"META-INF/dubbo/\";\nprivate static final String DUBBO_INTERNAL_DIRECTORY = DUBBO_DIRECTORY + \"internal/\";\n\n// \u5b58\u50a8\u7684\u662f SPI\u63a5\u53e3\u7c7b\u548cExtensionLoader\u5bf9\u8c61\u7684\u6620\u5c04\u5173\u7cfb \u7f13\u5b58\u6c60\nprivate static final ConcurrentMap<Class<?>, ExtensionLoader<?>> EXTENSION_LOADERS = new ConcurrentHashMap<>();\n\n// \u5b58\u50a8\u7684\u662f \u6bcf\u4e2aSPI\u63a5\u53e3\u7684\u591a\u4e2a\u5b9e\u73b0\u7c7b\u548c\u5bf9\u5e94\u5b9e\u4f8b\u4e4b\u95f4\u7684\u5173\u7cfb\nprivate static final ConcurrentMap<Class<?>, Object> EXTENSION_INSTANCES = new ConcurrentHashMap<>();\n\n// \u63a5\u53e3\u7684\u7c7b\u578b\nprivate final Class<?> type;\n// \u83b7\u53d6\u5de5\u5382\u7c7b\uff0c\u7528\u4e8e\u83b7\u53d6Spring\u5bb9\u5668\u4e2d\u7684Bean\nprivate final ExtensionFactory objectFactory;\n// \u6269\u5c55\u7c7b\u548c\u6269\u5c55\u540d\u79f0\u6620\u5c04\u5173\u7cfb\nprivate final ConcurrentMap<Class<?>, String> cachedNames = new ConcurrentHashMap<>();\n// \u6269\u5c55\u540d\u79f0\u548c\u6269\u5c55\u7c7b\u7c7b\u578b\u6620\u5c04\u5173\u7cfb\nprivate final Holder<Map<String, Class<?>>> cachedClasses = new Holder<>();\n// \u6269\u5c55\u540d\u79f0\u548c\u81ea\u52a8\u6fc0\u6d3b\u6269\u5c55\u7c7b\u6620\u5c04\u5173\u7cfb\nprivate final Map<String, Object> cachedActivates = new ConcurrentHashMap<>();\n// \u6269\u5c55\u540d\u79f0\u548c\u6269\u5c55\u7c7b\u5b9e\u4f8b\u6620\u5c04\u5173\u7cfb\nprivate final ConcurrentMap<String, Holder<Object>> cachedInstances = new ConcurrentHashMap<>();\n// \u81ea\u9002\u5e94\u6269\u5c55\u7c7b\u5b9e\u4f8b\u7f13\u5b58\nprivate final Holder<Object> cachedAdaptiveInstance = new Holder<>();\n// \u81ea\u9002\u5e94\u6269\u5c55\u7c7b\nprivate volatile Class<?> cachedAdaptiveClass = null;\n// \u9ed8\u8ba4\u7684\u670d\u52a1\u63d0\u4f9b\u8005\u7684\u540d\u79f0\nprivate String cachedDefaultName;\n// \u5305\u88c5\u6269\u5c55\u7c7b\u96c6\u5408\nprivate Set<Class<?>> cachedWrapperClasses;\n```\n\n### \u6e90\u7801\u89e3\u6790\n\n#### ExtensionLoader.getExtensionLoader(Order.class);\n\n##### \u6d41\u7a0b\n\n\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c06542f8a054dbe84ad5a3a38ab23e6~tplv-k3u1fbpfcp-watermark.image?)\n##### \u4ee3\u7801\u89e3\u6790\n\n```\n// 1.ExtensionLoader.getExtensionLoader\u6e90\u7801\npublic static <T> ExtensionLoader<T> getExtensionLoader(Class<T> type) {\n  \t// \u63a5\u53e3\u7c7b\u4e0d\u80fd\u4e3a\u7a7a\n    if (type == null) {\n        throw new IllegalArgumentException(\"Extension type == null\");\n    }\n  \t// \u5fc5\u987b\u662f\u63a5\u53e3\n    if (!type.isInterface()) {\n        throw new IllegalArgumentException(\"Extension type (\" + type + \") is not an interface!\");\n    }\n  \t// \u5fc5\u987b\u6709@SPI\u6ce8\u89e3\n    if (!withExtensionAnnotation(type)) {\n        throw new IllegalArgumentException(\"Extension type (\" + type +\n                \") is not an extension, because it is NOT annotated with @\" \n                                           + SPI.class.getSimpleName() + \"!\");\n    }\n\t\t\n  \t// \u5728ExtensionLoader\u7f13\u5b58\u6c60\u4e2d\u83b7\u53d6\n    ExtensionLoader<T> loader = (ExtensionLoader<T>) EXTENSION_LOADERS.get(type);\n    if (loader == null) {\n      \t// \u4e0d\u5b58\u5728\uff0c\u5219new\u4e00\u4e2a\u5bf9\u5e94SPI\u7684ExtensionLoader\uff08***\u91cd\u70b9***\uff09\n        EXTENSION_LOADERS.putIfAbsent(type, new ExtensionLoader<T>(type));\n      \t// \u6dfb\u52a0\u5230\u7f13\u5b58\u6c60\u4e2d\n        loader = (ExtensionLoader<T>) EXTENSION_LOADERS.get(type);\n    }\n    return loader;\n}\n\n// withExtensionAnnotation\u65b9\u6cd5\nprivate static <T> boolean withExtensionAnnotation(Class<T> type) {\n    return type.isAnnotationPresent(SPI.class);\n}\n\n// 2.new ExtensionLoader<T>(type)\u6e90\u7801\u89e3\u6790\nprivate ExtensionLoader(Class<?> type) {\n  // \u8bbe\u7f6eSPI\u7684\u7c7b\u578b\n  this.type = type;\n  // type\u662f\u4e0d\u662f\u4e3aExtensionFactory\uff1f\u662f\u5219\u8fd4\u56denull\uff0c \u4e0d\u662f\u5219\u53bb\u83b7\u53d6\u4e00\u4e2aExtensionFactory\u7684ExtensionLoader\u7684\u9002\u914d\u5668\u6269\u5c55\u5668\n  objectFactory = (type == ExtensionFactory.class ? null : ExtensionLoader.getExtensionLoader(ExtensionFactory.class).getAdaptiveExtension());\n}\n\n// 3.getAdaptiveExtension()\u65b9\u6cd5\npublic T getAdaptiveExtension() {\n  \t// \u4ece\u5f53\u524d\u7684SPI\u7684ExtensionLoader\u4e2d\u7684\u7f13\u5b58\u6c60\u4e2d\u83b7\u53d6\u9002\u914d\u5668\n    Object instance = cachedAdaptiveInstance.get();\n  \t// dubbo check\n    if (instance == null) {\n        if (createAdaptiveInstanceError == null) {\n            synchronized (cachedAdaptiveInstance) {\n                instance = cachedAdaptiveInstance.get();\n                if (instance == null) {\n                    try {\n                      \t// \u521b\u5efa\u4e00\u4e2aSPI\u7684\u9002\u914d\u5668\u6269\u5c55\u5668\uff0c\u5e76\u653e\u5165\u7684\u7f13\u5b58\u6c60\u4e2d(***\u91cd\u70b9***)\n                        instance = createAdaptiveExtension();\n                        cachedAdaptiveInstance.set(instance);\n                    } catch (Throwable t) {\n                        createAdaptiveInstanceError = t;\n                        throw new IllegalStateException(\"Failed to create adaptive instance: \" + t.toString(), t);\n                    }\n                }\n            }\n        } else {\n            throw new IllegalStateException(\"Failed to create adaptive instance: \" + createAdaptiveInstanceError.toString(), createAdaptiveInstanceError);\n        }\n    }\n\n    return (T) instance;\n}\n\n// 4.createAdaptiveExtension()\u65b9\u6cd5\nprivate T createAdaptiveExtension() {\n    try {\n      \t// \u83b7\u53d6\u9002\u914d\u5668\u6269\u5c55\u5668\uff0c\u7136\u540e\u5728\u83b7\u53d6\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u518d\u6ce8\u5165\u5c5e\u6027(injectExtension\uff0cIOC\u7684\u5b9e\u73b0)\n        return injectExtension((T) getAdaptiveExtensionClass().newInstance());\n    } catch (Exception e) {\n        throw new IllegalStateException(\"Can't create adaptive extension \" + type + \", cause: \" + e.getMessage(), e);\n    }\n}\n\n// 5.\u83b7\u53d6\u6269\u5c55\u5668\u7684\u9002\u914d\u5668\nprivate Class<?> getAdaptiveExtensionClass() {\n    // 1.\u52a0\u8f7d\u9ed8\u8ba4\u7684\u6269\u5c55\u5668\u7684\u540d\u79f0\n    // 2.\u52a0\u8f7d\u5404\u4e2a\u76ee\u5f55\u4e0b\u7684SPI\u7684\u670d\u52a1\u63d0\u4f9b\u8005\uff1a\n    // 2.1.\u5982\u679c\u662f\u9002\u914d\u5668\uff0c\u5219\u52a0\u8f7d\u5230\u9002\u914d\u5668\u7684\u7f13\u5b58\u4e2d(PS:\u5728\u65b9\u6cd5\u4e0a\u52a0@Adaptive\uff0c\u4e0d\u4f1a\u88ab\u52a0\u8f7d\u5230\u9002\u914d\u5668\u7f13\u5b58\u6c60\u4e2d)\n    // 2.2.\u5982\u679c\u662f\u88c5\u9970\u5668\uff0c\u5219\u52a0\u8f7d\u5230\u88c5\u9970\u5668\u7684\u7f13\u5b58\u4e2d\n    // 2.3.\u52a0\u8f7d\u81ea\u52a8\u6fc0\u6d3b\u7684\u7f13\u5b58\u4e2d\n    // 2.4 \u52a0\u8f7d\u5230\u7f13\u5b58cachedNames\u4e2d\uff08k->class\uff0cv->name\uff09\n    getExtensionClasses();\n    if (cachedAdaptiveClass != null) {\n        return cachedAdaptiveClass;\n    }\n  \t// \u5982\u679c\u6ca1\u6709\u6269\u5c55\u5668\u7684\u9002\u914d\u5668\uff0c\u5219\u53bb\u52a8\u6001\u521b\u5efa\u4e00\u4e2a(\u6bd4\u8f83\u590d\u6742)\n    return cachedAdaptiveClass = createAdaptiveExtensionClass();\n}\n\n// 6. loadExtensionClasses()\u65b9\u6cd5\nprivate Map<String, Class<?>> loadExtensionClasses() {\n  // 1.\u83b7\u53d6SPI\u7684value\u83b7\u53d6\u9ed8\u8ba4\u540d\u5b57 \u52a0\u8f7d\u9ed8\u8ba4\u7684\u6269\u5c55\u5668\u7684\u540d\u79f0\n  cacheDefaultExtensionName();\n\n  // 2. \u52a0\u8f7d\u5404\u4e2a\u76ee\u5f55\u4e0b\u7684SPI\u7684\u914d\u7f6e\u6587\u4ef6\n  // 2.1.\u5982\u679c\u662f\u9002\u914d\u5668\uff0c\u5219\u52a0\u8f7d\u5230\u9002\u914d\u5668\u7684\u7f13\u5b58\u4e2d\n \t// 2.2.\u5982\u679c\u662f\u88c5\u9970\u5668\uff0c\u5219\u52a0\u8f7d\u5230\u88c5\u9970\u5668\u7684\u7f13\u5b58\u4e2d\n  // 2.3.\u628aname\u52a0\u8f7d\u81ea\u52a8\u6fc0\u6d3b\u7684\u7f13\u5b58\u4e2d\uff0c\u628aname\u5230SPI\u7684name\u7f13\u5b58\u6c60\uff0c\u628aSPI name\u548c\u7c7b\u7684\u5bf9\u5e94\u5173\u7cfb\u7f13\u5b58\u5230\n  Map<String, Class<?>> extensionClasses = new HashMap<>();\n  loadDirectory(extensionClasses, DUBBO_INTERNAL_DIRECTORY, type.getName());\n  loadDirectory(extensionClasses, DUBBO_INTERNAL_DIRECTORY, type.getName().replace(\"org.apache\", \"com.alibaba\"));\n  loadDirectory(extensionClasses, DUBBO_DIRECTORY, type.getName());\n  loadDirectory(extensionClasses, DUBBO_DIRECTORY, type.getName().replace(\"org.apache\", \"com.alibaba\"));\n  loadDirectory(extensionClasses, SERVICES_DIRECTORY, type.getName());\n  loadDirectory(extensionClasses, SERVICES_DIRECTORY, type.getName().replace(\"org.apache\", \"com.alibaba\"));\n  return extensionClasses;\n}\n\n// 7.loadDirectory\u52a0\u8f7d\u76ee\u5f55\u4e0b\u7684\u7c7b\nprivate void loadDirectory(Map<String, Class<?>> extensionClasses, String dir, String type) {\n  String fileName = dir + type;\n  try {\n    Enumeration<java.net.URL> urls;\n    ClassLoader classLoader = findClassLoader();\n    if (classLoader != null) {\n      urls = classLoader.getResources(fileName);\n    } else {\n      urls = ClassLoader.getSystemResources(fileName);\n    }\n    if (urls != null) {\n      while (urls.hasMoreElements()) {\n        java.net.URL resourceURL = urls.nextElement();\n        loadResource(extensionClasses, classLoader, resourceURL);\n      }\n    }\n  } catch (Throwable t) {\n    logger.error(\"Exception occurred when loading extension class (interface: \" +\n                 type + \", description file: \" + fileName + \").\", t);\n  }\n}\n// 8.\u52a0\u8f7d\u8d44\u6e90loadResource\n// 9.\u52a0\u8f7d\u7c7b\n    private void loadClass(Map<String, Class<?>> extensionClasses, java.net.URL resourceURL, Class<?> clazz, String name) throws NoSuchMethodException {\n        if (!type.isAssignableFrom(clazz)) {\n            throw new IllegalStateException(\"Error occurred when loading extension class (interface: \" +\n                    type + \", class line: \" + clazz.getName() + \"), class \"\n                    + clazz.getName() + \" is not subtype of interface.\");\n        }\n      \t// \u5982\u679c\u662f\u9002\u914d\u5668\uff0c\u5219\u52a0\u8f7d\u5230\u9002\u914d\u5668\u7684\u7f13\u5b58\u4e2d\n        if (clazz.isAnnotationPresent(Adaptive.class)) {\n            cacheAdaptiveClass(clazz);\n        // \u5982\u679c\u662f\u88c5\u9970\u5668\uff0c\u5219\u52a0\u8f7d\u5230\u88c5\u9970\u5668\u7684\u7f13\u5b58\u4e2d\n        } else if (isWrapperClass(clazz)) {\n            cacheWrapperClass(clazz);\n        } else {\n            clazz.getConstructor();\n            if (StringUtils.isEmpty(name)) {\n                name = findAnnotationName(clazz);\n                if (name.length() == 0) {\n                    throw new IllegalStateException(\"No such extension name for the class \" + clazz.getName() + \" in the config \" + resourceURL);\n                }\n            }\n\n            String[] names = NAME_SEPARATOR.split(name);\n            if (ArrayUtils.isNotEmpty(names)) {\n              \t// \u628aname\u52a0\u8f7d\u81ea\u52a8\u6fc0\u6d3b\u7684\u7f13\u5b58\u4e2d\n                cacheActivateClass(clazz, names[0]);\n                for (String n : names) {\n                  \t// \u628aname\u5230SPI\u7684name\u7f13\u5b58\u6c60\uff0c\u628aSPI name\u548c\u7c7b\u7684\u5bf9\u5e94\u5173\u7cfb\u7f13\u5b58\u5230\n                    cacheName(clazz, n);\n                    saveInExtensionClass(extensionClasses, clazz, n);\n                }\n            }\n        }\n    }\n```\n\n\u5176\u5b9e\u6211\u4eec\u4e0d\u96be\u53d1\u73b0\u4e0a\u8ff0\u53ea\u662f\u52a0\u8f7d\u7684\u6211\u4eecSPI\u5bf9\u5e94ExtensionLoader\u7684ExtensionFactory\u7684getAdaptiveExtension()\n\n--> AdaptiveExtensionFactory\n\n#### 1.\u5e38\u7528\u65b9\u6cd5extensionLoader.getExtension(\"alipay\");\n\n##### \u6d41\u7a0b\n\n\n![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0cdde654d52e4d658c34b34b393cf444~tplv-k3u1fbpfcp-watermark.image?)\n##### \u4ee3\u7801\u89e3\u6790\n\n```\n// 1.\u83b7\u53d6Order\u7684\u540d\u79f0\u4e3a\"alipay\"\u7684SPI\npublic T getExtension(String name) {\n  // \u6821\u9a8c\n  if (StringUtils.isEmpty(name)) {\n    throw new IllegalArgumentException(\"Extension name == null\");\n  }\n  // \u5982\u679c\u540d\u5b57\u4e3atrue\uff0c\u5219\u8fd4\u56de\u9ed8\u8ba4\u7684SPI\n  if (\"true\".equals(name)) {\n    return getDefaultExtension();\n  }\n  // \u4ececachedInstances\u7f13\u5b58\u6c60\u4e2d\u83b7\u53d6\"alipay\"\u7684\u5b9e\u73b0\u7c7b\u3002\n  final Holder<Object> holder = getOrCreateHolder(name);\n  Object instance = holder.get();\n  // dubbo check\n  if (instance == null) {\n    synchronized (holder) {\n      instance = holder.get();\n      if (instance == null) {\n        // \u521b\u5efa\u4e00\u4e2a\u5b9e\u73b0\u7c7b\u7684\u5b9e\u4f8bBean\uff0c\u5e76\u8bbe\u7f6e\u5230\u7f13\u5b58\u6c60\u4e2d\u3002\n        instance = createExtension(name);\n        holder.set(instance);\n      }\n    }\n  }\n  return (T) instance;\n}\n\n// 2.\u521b\u5efaExtension createExtension(name);\nprivate T createExtension(String name) {\n  // 1.\u52a0\u8f7d\u9ed8\u8ba4\u7684\u6269\u5c55\u5668\u7684\u540d\u79f0\n  // 2.\u52a0\u8f7d\u5404\u4e2a\u76ee\u5f55\u4e0b\u7684SPI\u7684\u670d\u52a1\u63d0\u4f9b\u8005\uff1a\n  // 2.1.\u5982\u679c\u662f\u9002\u914d\u5668\uff0c\u5219\u52a0\u8f7d\u5230\u9002\u914d\u5668\u7684\u7f13\u5b58\u4e2d(PS:\u5728\u65b9\u6cd5\u4e0a\u52a0@Adaptive\uff0c\u4e0d\u4f1a\u88ab\u52a0\u8f7d\u5230\u9002\u914d\u5668\u7f13\u5b58\u6c60\u4e2d)\n  // 2.2.\u5982\u679c\u662f\u88c5\u9970\u5668\uff0c\u5219\u52a0\u8f7d\u5230\u88c5\u9970\u5668\u7684\u7f13\u5b58\u4e2d\n  // 2.3.\u52a0\u8f7d\u81ea\u52a8\u6fc0\u6d3b\u7684\u7f13\u5b58\u4e2d\n  // 2.4 \u52a0\u8f7d\u5230\u7f13\u5b58cachedNames\u4e2d\uff08k->class\uff0cv->name\uff09\n  Class<?> clazz = getExtensionClasses().get(name);\n  if (clazz == null) {\n    // \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u627e\u4e0d\u5230\uff0c\u5219\u629b\u5f02\u5e38\u3002\n    throw findException(name);\n  }\n  try {\n    // \u5b9e\u4f8b\u5316class\u5bf9\u8c61\uff0c\u5e76\u653e\u5728\u7f13\u5b58\u6c60\u4e2d\n    T instance = (T) EXTENSION_INSTANCES.get(clazz);\n    if (instance == null) {\n      EXTENSION_INSTANCES.putIfAbsent(clazz, clazz.newInstance());\n      instance = (T) EXTENSION_INSTANCES.get(clazz);\n    }\n    // \u6ce8\u5165\u6570\u636e\n    injectExtension(instance);\n    // \u5224\u65ad\u662f\u5426\u6709\u88c5\u9970\u5668\uff0c\u6709\u5219\u904d\u5386\u88c5\u9970\u5668\n    Set<Class<?>> wrapperClasses = cachedWrapperClasses;\n    if (CollectionUtils.isNotEmpty(wrapperClasses)) {\n      // \u4e00\u5957\u53c8\u4e00\u5957\n      for (Class<?> wrapperClass : wrapperClasses) {\n        instance = injectExtension((T) wrapperClass.getConstructor(type).newInstance(instance));\n      }\n    }\n    return instance;\n  } catch (Throwable t) {\n    throw new IllegalStateException(\"Extension instance (name: \" + name + \", class: \" +\n                                    type + \") couldn't be instantiated: \" + t.getMessage(), t);\n  }\n}\n\n// 3.\u6ce8\u5165\u5c5e\u6027\nprivate T injectExtension(T instance) {\n  try {\n    if (objectFactory != null) {\n      for (Method method : instance.getClass().getMethods()) {\n        // \u53ea\u80fd\u6ce8\u5165setter\u65b9\u6cd5\u7684\u5c5e\u6027\u3002\n        if (isSetter(method)) {\n          /**\n           * Check {@link DisableInject} to see if we need auto injection for this property\n           */\n          if (method.getAnnotation(DisableInject.class) != null) {\n            continue;\n          }\n          Class<?> pt = method.getParameterTypes()[0];\n          if (ReflectUtils.isPrimitives(pt)) {\n            continue;\n          }\n          try {\n            String property = getSetterProperty(method);\n            // \u8c03\u7528AdaptiveExtensionFactory\u7684 \u65b9\u6cd5\u83b7\u53d6\u5c5e\u6027\u503c\u3002\n            Object object = objectFactory.getExtension(pt, property);\n            if (object != null) {\n              method.invoke(instance, object);\n            }\n          } catch (Exception e) {\n            logger.error(\"Failed to inject via method \" + method.getName()\n                         + \" of interface \" + type.getName() + \": \" + e.getMessage(), e);\n          }\n        }\n      }\n    }\n  } catch (Exception e) {\n    logger.error(e.getMessage(), e);\n  }\n  return instance;\n}\n\n// 3.1. \u8c03\u7528AdaptiveExtensionFactory\u7684getExtension(pt\uff0c property)\npublic <T> T getExtension(Class<T> type, String name) {\n  // \u5faa\u73af\u904d\u5386SpiExtensionFactory\u548cSpringExtensionFactory\u3002\n  for (ExtensionFactory factory : factories) {\n    T extension = factory.getExtension(type, name);\n    if (extension != null) {\n      return extension;\n    }\n  }\n  return null;\n}\n```\n\n#### 2.\u5e38\u7528\u65b9\u6cd5loader.getAdaptiveExtension();\n\n##### \u6d41\u7a0b\n\n\n![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e905ad8d287643719033bba135c41224~tplv-k3u1fbpfcp-watermark.image?)\n\n##### \u4ee3\u7801\u89e3\u6790\n\n```\n// loader.getAdaptiveExtension() ,\u6574\u4f53\u903b\u8f91\u548cgetExtension(\"alipay\") \u5dee\u4e0d\u591a\u3002\n// \u552f\u4e00\u6709\u533a\u522b\u7684\u662f\n// getAdaptiveExtension()\u662fcreateAdaptiveExtension()\n// getExtension(\"alipay\")\u662fcreateExtension(\"alipay\")\npublic T getAdaptiveExtension() {\n  // \u4ece\u9002\u914d\u5668\u7f13\u5b58\u6c60\u4e2d\u62ff\uff0c\u5982\u679c\u6ca1\u6709\u5219\u7528createAdaptiveExtension()\u751f\u6210\u4e00\u4e2a\uff0c\u518d\u8bbe\u7f6e\u5230\u7f13\u5b58\u6c60\u4e2d\u3002\n  Object instance = cachedAdaptiveInstance.get();\n  if (instance == null) {\n    if (createAdaptiveInstanceError == null) {\n      synchronized (cachedAdaptiveInstance) {\n        instance = cachedAdaptiveInstance.get();\n        if (instance == null) {\n          try {\n            // \u751f\u6210\u9002\u914d\u5668\u7c7b\u7684\u5b9e\u4f8b\u5bf9\u8c61instance\uff0c\u5e76\u8bbe\u7f6e\u5230\u7f13\u5b58\u4e2d\n            instance = createAdaptiveExtension();\n            cachedAdaptiveInstance.set(instance);\n          } catch (Throwable t) {\n            createAdaptiveInstanceError = t;\n            throw new IllegalStateException(\"Failed to create adaptive instance: \" + t.toString(), t);\n          }\n        }\n      }\n    } else {\n      throw new IllegalStateException(\"Failed to create adaptive instance: \" + createAdaptiveInstanceError.toString(), createAdaptiveInstanceError);\n    }\n  }\n\n  return (T) instance;\n}\n\n// 2.createAdaptiveExtension()\nprivate T createAdaptiveExtension() {\n  try {\n    return injectExtension((T) getAdaptiveExtensionClass().newInstance());\n  } catch (Exception e) {\n    throw new IllegalStateException(\"Can't create adaptive extension \" + type + \", cause: \" + e.getMessage(), e);\n  }\n}\n\n// 3.getAdaptiveExtensionClass()\nprivate Class<?> getAdaptiveExtensionClass() {\n  // 1.\u52a0\u8f7d\u9ed8\u8ba4\u7684\u6269\u5c55\u5668\u7684\u540d\u79f0\n  // 2.\u52a0\u8f7d\u5404\u4e2a\u76ee\u5f55\u4e0b\u7684SPI\u7684\u670d\u52a1\u63d0\u4f9b\u8005\uff1a\n  // 2.1.\u5982\u679c\u662f\u9002\u914d\u5668\uff0c\u5219\u52a0\u8f7d\u5230\u9002\u914d\u5668\u7684\u7f13\u5b58\u4e2d(PS:\u5728\u65b9\u6cd5\u4e0a\u52a0@Adaptive\uff0c\u4e0d\u4f1a\u88ab\u52a0\u8f7d\u5230\u9002\u914d\u5668\u7f13\u5b58\u6c60\u4e2d)\n  // 2.2.\u5982\u679c\u662f\u88c5\u9970\u5668\uff0c\u5219\u52a0\u8f7d\u5230\u88c5\u9970\u5668\u7684\u7f13\u5b58\u4e2d\n  // 2.3.\u52a0\u8f7d\u81ea\u52a8\u6fc0\u6d3b\u7684\u7f13\u5b58\u4e2d\n  // 2.4 \u52a0\u8f7d\u5230\u7f13\u5b58cachedNames\u4e2d\uff08k->class\uff0cv->name\uff09\n  getExtensionClasses();\n  // \u5982\u679c\u5728\u9002\u914d\u5668\u7684\u7f13\u5b58\u6c60\u6709\u5bf9\u5e94\u7684\u9002\u914d\u5668\u7c7b\uff0c\u5219\u8fd4\u56de\u5bf9\u5e94\u7684\u9002\u914d\u5668\u7c7b\n  if (cachedAdaptiveClass != null) {\n    return cachedAdaptiveClass;\n  }\n  // \u5982\u679c\u5728\u9002\u914d\u5668\u7f13\u5b58\u6c60\u4e2d\u6ca1\u6709\u5bf9\u5e94\u7684\u9002\u914d\u7c7b\uff0c\u5219\u521b\u5efa\u4e00\u4e2a\u3002\n  return cachedAdaptiveClass = createAdaptiveExtensionClass();\n}\n\n// 4.createAdaptiveExtensionClass() \u521b\u5efa\u4e00\u4e2a\u9002\u914d\u5668\u7c7b\nprivate Class<?> createAdaptiveExtensionClass() {\n  // \u751f\u6210\u9002\u914d\u5668\u7684\u6e90\u7801\n  String code = new AdaptiveClassCodeGenerator(type, cachedDefaultName).generate();\n  // \u7c7b\u52a0\u8f7d\u5668\n  ClassLoader classLoader = findClassLoader();\n  // \u901a\u8fc7SPI\u83b7\u53d6\u7f16\u8bd1\u5668\u7684\u9002\u914d\u5668\u7c7b\uff0c\u518d\u52a8\u6001\u7f16\u8bd1\u8fd9\u4e2a\u9002\u914d\u5668\u7684\u6e90\u7801\uff0c\u751f\u6210\u7c7b\u3002\n  org.apache.dubbo.common.compiler.Compiler compiler = ExtensionLoader.getExtensionLoader(org.apache.dubbo.common.compiler.Compiler.class).getAdaptiveExtension();\n  return compiler.compile(code, classLoader);\n}\n\n// 5.new AdaptiveClassCodeGenerator(type, cachedDefaultName).generate();\npublic String generate() {\n  // \u5982\u679c\u65b9\u6cd5\u4e2d\u6ca1\u6709@Adaptive\u6ce8\u89e3\uff0c\u5219\u629b\u5f02\u5e38\n  if (!hasAdaptiveMethod()) {\n    throw new IllegalStateException(\"No adaptive method exist on extension \" + type.getName() + \", refuse to create the adaptive class!\");\n  }\n\n  StringBuilder code = new StringBuilder();\n  // \u751f\u6210package\u4fe1\u606f\n  code.append(generatePackageInfo());\n  // \u751f\u6210import\u4fe1\u606f\n  code.append(generateImports());\n  // \u751f\u6210\u7c7b\u4fe1\u606f public class %s$Adaptive implements....\n  code.append(generateClassDeclaration());\n\n  // \u83b7\u53d6type\u7684\u65b9\u6cd5\uff0c\u751f\u6210\u65b9\u6cd5\u4fe1\u606f public %s %s(%s) %s {%s}\n  Method[] methods = type.getMethods();\n  for (Method method : methods) {\n    code.append(generateMethod(method));\n  }\n  code.append(\"}\");\n\n  if (logger.isDebugEnabled()) {\n    logger.debug(code.toString());\n  }\n  return code.toString();\n}\n```\n\n#### 3.\u5e38\u7528\u65b9\u6cd5loader.getActivateExtension(url, \"\", \"online\");\u8bfe\u540e\u8ba8\u8bba\uff1a\n\n```\n// 1.\u751f\u6210\u81ea\u52a8\u6fc0\u6d3b\u7684\u6269\u5c55\u7c7b\u96c6\u5408\npublic List<T> getActivateExtension(URL url, String key, String group) {\n  // \u83b7\u53d6URL\u7684key\u5bf9\u5e94\u7684value\n  String value = url.getParameter(key);\n  // value\u5373name\uff0c\u53ef\u4ee5\u7528\"\uff0c\"\u5206\u9694\n  return getActivateExtension(url, StringUtils.isEmpty(value) ? null : COMMA_SPLIT_PATTERN.split(value), group);\n}\n\n// 2\uff0c\u83b7\u53d6getActivateExtension()\npublic List<T> getActivateExtension(URL url, String[] values, String group) {\n  List<T> exts = new ArrayList<>();\n  List<String> names = values == null ? new ArrayList<>(0) : Arrays.asList(values);\n  // \u540d\u5b57\u4e2d\u4e0d\u5305\u542b\"-default\"\n  if (!names.contains(REMOVE_VALUE_PREFIX + DEFAULT_KEY)) {\n    // 1.\u52a0\u8f7d\u9ed8\u8ba4\u7684\u6269\u5c55\u5668\u7684\u540d\u79f0\n    // 2.\u52a0\u8f7d\u5404\u4e2a\u76ee\u5f55\u4e0b\u7684SPI\u7684\u670d\u52a1\u63d0\u4f9b\u8005\uff1a\n\t  // 2.1.\u5982\u679c\u662f\u9002\u914d\u5668\uff0c\u5219\u52a0\u8f7d\u5230\u9002\u914d\u5668\u7684\u7f13\u5b58\u4e2d(PS:\u5728\u65b9\u6cd5\u4e0a\u52a0@Adaptive\uff0c\u4e0d\u4f1a\u88ab\u52a0\u8f7d\u5230\u9002\u914d\u5668\u7f13\u5b58\u6c60\u4e2d)\n    // 2.2.\u5982\u679c\u662f\u88c5\u9970\u5668\uff0c\u5219\u52a0\u8f7d\u5230\u88c5\u9970\u5668\u7684\u7f13\u5b58\u4e2d\n    // 2.3.\u52a0\u8f7d\u81ea\u52a8\u6fc0\u6d3b\u7684\u7f13\u5b58\u4e2d(cachedActivates)\n    // 2.4 \u52a0\u8f7d\u5230\u7f13\u5b58cachedNames\u4e2d\uff08k->class\uff0cv->name\uff09\n    getExtensionClasses();\n    for (Map.Entry<String, Object> entry : cachedActivates.entrySet()) {\n      String name = entry.getKey();\n      Object activate = entry.getValue();\n\n      String[] activateGroup, activateValue;\n\n      if (activate instanceof Activate) {\n        activateGroup = ((Activate) activate).group();\n        activateValue = ((Activate) activate).value();\n      } else if (activate instanceof com.alibaba.dubbo.common.extension.Activate) {\n        // \u9002\u914dalibaba\u7248\u672c\u7684\uff0c\u73b0\u5728\u7684\u662fapache\u7248\u672c\n        activateGroup = ((com.alibaba.dubbo.common.extension.Activate) activate).group();\n        activateValue = ((com.alibaba.dubbo.common.extension.Activate) activate).value();\n      } else {\n        continue;\n      }\n      // activateGroup\u4e2d\u5305\u542b\u4e86group\n      if (isMatchGroup(group, activateGroup)) {\n        // \u83b7\u53d6\u6269\u5c55\u7c7b\u7684\u5b9e\u4f8b\n        T ext = getExtension(name);\n        if (!names.contains(name)\n            && !names.contains(REMOVE_VALUE_PREFIX + name)\n            && isActive(activateValue, url)) {\n          // \u7b26\u5408\u4e0a\u8ff0\u8981\u6c42\u5219\u52a0\u5230\u96c6\u5408\u4e2d\n          exts.add(ext);\n        }\n      }\n    }\n    // \u6839\u636e@Activate \u6392\u5e8f\n    exts.sort(ActivateComparator.COMPARATOR);\n  }\n  List<T> usrs = new ArrayList<>();\n  for (int i = 0; i < names.size(); i++) {\n    String name = names.get(i);\n    // value\u7684\u503c\u4e0d\u662f\u4ee5\"-\"\u5f00\u59cb\uff0c\u4e14 \u4e0d\u5305\u542b\"-\"+$name\n    if (!name.startsWith(REMOVE_VALUE_PREFIX)\n        && !names.contains(REMOVE_VALUE_PREFIX + name)) {\n      // \u5982\u679c\u540d\u5b57\u4e3a\"default\"\n      if (DEFAULT_KEY.equals(name)) {\n        if (!usrs.isEmpty()) {\n          exts.addAll(0, usrs);\n          usrs.clear();\n        }\n      } else {\n        // \u6839\u636ename\u83b7\u53d6Extension\u7684\u5b9e\u4f8b\uff0c\u5e76\u653e\u5165usrs\n        T ext = getExtension(name);\n        usrs.add(ext);\n      }\n    }\n  }\n  if (!usrs.isEmpty()) {\n    exts.addAll(usrs);\n  }\n  return exts;\n}\n```\n\n#### \u603b\u7ed3\n\nDubbo \u7684SPI\u7684\u4f18\u52bf\uff1a\n\n0.  \u6709\u7f13\u5b58\uff08\u90fd\u6709\u7f13\u5b58\uff09\n0.  \u53ef\u4ee5\u7ed3\u5408Spring\u5bb9\u5668\u5b9e\u73b0\u5c5e\u6027\u6ce8\u5165\u3002\n0.  \u901a\u8fc7wrapper \u88c5\u9970\u5668\u5b9e\u73b0\u7c7b\u4f3cAOP\u7684\u529f\u80fd\u3002\n0.  \u901a\u8fc7@Adaptive \u914d\u7f6e\u9002\u914d\u5668\u7684\u7c7b\uff0c\u5c31\u652f\u6301\u4e00\u4e2a\u573a\u666f\u4f7f\u7528\u591a\u79cd\u5b9e\u73b0\u7c7b\u3002",
    "mtime": "1660966625",
    "original_author": "",
    "original_type": 0,
    "rank_index": 5.74035982,
    "rtime": "1660966625",
    "status": 2,
    "tag_ids": [
      6809640408797167616,
      6809640404791590912
    ],
    "title": "Dubbo\u7684SPI\u673a\u5236\u7b80\u4ecb\u5206\u4eab",
    "user_id": "3879543765994920",
    "user_index": 7.888898584825661,
    "verify_status": 1,
    "view_count": 92,
    "visible_level": 0
  },
  {
    "article_id": "7133520098123317256",
    "audit_status": 2,
    "brief_content": "\u4eca\u5929\u6211\u4eec\u7684\u4e3b\u89d2\u662f gomonkey\uff0c\u4e00\u4e2a\u7528\u6765\u505a monkey patching \u7684\u6d4b\u8bd5\u5e93\u3002\u76ee\u6807\u662f\u8ba9\u7528\u6237\u5728\u5355\u5143\u6d4b\u8bd5\u4e2d\u4f4e\u6210\u672c\u7684\u5b8c\u6210\u6253\u6869\uff0c\u4ece\u800c\u5c06\u7cbe\u529b\u805a\u7126\u4e8e\u4e1a\u52a1\u529f\u80fd\u7684\u5f00\u53d1\u3002",
    "category_id": "6809637769959178254",
    "collect_count": 2,
    "comment_count": 0,
    "content": "",
    "cover_image": "",
    "ctime": "1660902111",
    "digg_count": 2,
    "display_count": 0,
    "draft_id": "7133405969563779079",
    "hot_index": 8,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "---\ntheme: channing-cyan\n---\n\u643a\u624b\u521b\u4f5c\uff0c\u5171\u540c\u6210\u957f\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 8 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c24\u5929\uff0c[\u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5](https://juejin.cn/post/7123120819437322247 \"https://juejin.cn/post/7123120819437322247\")\n\n\u4eca\u5929\u7ee7\u7eed\u6211\u4eec\u7684\u3010\u89e3\u6790 Golang \u6d4b\u8bd5\u3011\u4e4b\u65c5\uff0c\u7ecf\u8fc7\u524d\u9762\u7684\u6587\u7ae0\uff0c\u76f8\u4fe1\u5927\u5bb6\u5bf9\u4e8e\u5355\u6d4b\u7684\u6982\u5ff5\uff0c\u539f\u751f\u652f\u6301\uff0c\u4ee5\u53ca\u5e38\u89c1\u7684 fake\uff0cmock \u65b9\u6848\u90fd\u6709\u4e86\u4e00\u5b9a\u4e86\u89e3\u3002\u8fd8\u4e0d\u719f\u6089\u7684\u540c\u5b66\u5efa\u8bae\u56de\u987e\u4e00\u4e0b\u6211\u4eec\u6b64\u524d\u7684\u6587\u7ae0\u3002\n\n-   [\u89e3\u6790 Golang \u6d4b\u8bd5\uff081\uff09- \u539f\u751f\u652f\u6301](https://juejin.cn/post/7088592013339131912 \"https://juejin.cn/post/7088592013339131912\")\n-   [\u89e3\u6790 Golang \u6d4b\u8bd5\uff082\uff09- gomock](https://juejin.cn/post/7088905794607513608 \"https://juejin.cn/post/7088905794607513608\")\n-   [\u89e3\u6790 Golang \u6d4b\u8bd5\uff083\uff09- goconvey \u5b9e\u6218](https://juejin.cn/post/7130533292310265886 \"https://juejin.cn/post/7130533292310265886\")\n-   [\u89e3\u6790 Golang \u6d4b\u8bd5\uff084\uff09- \u4e00\u7bc7\u6587\u7ae0\u6559\u4f60\u5206\u6e05 Mock\uff0cStub\uff0cFake](https://juejin.cn/post/7130831772916383774 \"https://juejin.cn/post/7130831772916383774\")\n-   [\u89e3\u6790 Golang \u6d4b\u8bd5\uff085\uff09- MySQL \u7ecf\u5178 mock driver\u2014\u2014 sqlmock](https://juejin.cn/post/7131258433948352520 \"https://juejin.cn/post/7131258433948352520\")\n-   [\u89e3\u6790 Golang \u6d4b\u8bd5\uff086\uff09- \u5982\u4f55\u9488\u5bf9 MySQL \u8fdb\u884c Fake \u6d4b\u8bd5](https://juejin.cn/post/7131661977310461965 \"https://juejin.cn/post/7131661977310461965\")\n-   [\u89e3\u6790 Golang \u6d4b\u8bd5\uff087\uff09- \u5982\u4f55\u9488\u5bf9 Redis \u8fdb\u884c Fake \u6d4b\u8bd5](https://juejin.cn/post/7131933251538518029)\n\n\u4eca\u5929\u6211\u4eec\u7684\u4e3b\u89d2\u662f gomonkey\uff0c\u4e00\u4e2a\u7528\u6765\u505a monkey patching \u7684\u6d4b\u8bd5\u5e93\uff0c\u8fd9\u91cc\u5927\u5bb6\u53ef\u80fd\u5bf9 monkey patching \u7684\u6982\u5ff5\u4e0d\u592a\u719f\u6089\uff0c\u4e0d\u8981\u7740\u6025\uff0c\u6211\u4eec\u4e0b\u4e00\u8282\u5c31\u4f1a\u4e86\u89e3\u3002\u4ece\u4e00\u4e2a\u4e1a\u52a1\u5f00\u53d1\u8005\u7684\u89d2\u5ea6\uff0c\u6211\u4eec\u53ef\u4ee5\u7406\u89e3\u4e3a gomonkey \u63d0\u4f9b\u4e86\u5728\u8fd0\u884c\u65f6\u70ed\u66ff\u6362\u539f\u6709\u5b9e\u73b0\uff08\u5305\u542b\u53d8\u91cf\uff0c\u51fd\u6570\uff0c\u65b9\u6cd5\u7b49\uff09\u7684\u80fd\u529b\uff0c\u4ece Test Double \u7684\u89d2\u5ea6\u770b\uff0c\u5176\u5b9e gomonkey \u8d77\u5230\u7684\u4f5c\u7528\u8ddf gomock \u6709\u70b9\u50cf\uff0c\u4f46\u8fd8\u4e0d\u5b8c\u5168\u4e00\u6837\u3002\n\n- gomock \u662f\u57fa\u4e8e interface \u751f\u6210\u53e6\u4e00\u5957 mock \u5b9e\u73b0\uff0c\u6211\u4eec\u5355\u6d4b\u7684\u65f6\u5019\u9700\u8981\u4f9d\u8d56\u8fd9\u4e2a mock \u7684\u5b9e\u73b0\uff0c\u91c7\u7528\u4f9d\u8d56\u6ce8\u5165\u7684\u65b9\u5f0f\u6765\u8c03\u6574\u5176\u4ed6\u90e8\u5206\u5bf9\u4e8e\u8be5\u63a5\u53e3\u7684\u4f9d\u8d56\uff1b\n- gomonkey \u5219\u662f\u76f4\u63a5\u5728\u8fd0\u884c\u65f6\uff0c\u901a\u8fc7\u70ed\u66ff\u6362\u7684\u65b9\u5f0f\uff0c\u628a\u53d8\u91cf/\u51fd\u6570/\u65b9\u6cd5\u7684\u5185\u5bb9\u7ed9\u66ff\u6362\u4e86\uff0c\u5728 Reset \u56de\u6765\u524d\uff0c\u6211\u4eec\u76f4\u63a5\u8c03\u7528\u8001\u51fd\u6570\uff0c\u8001\u7684\u65b9\u6cd5\uff0c\u5176\u5b9e\u5df2\u7ecf\u662f\u65b0\u7684\uff0c\u88ab\u66ff\u6362\u7684\u5b9e\u73b0\u4e86\u3002\n\n\u800c goconvey \u548c\u8fd9\u4e24\u4e2a\u5219\u4e0d\u5728\u4e00\u4e2a\u7ef4\u5ea6\uff0c\u5927\u4f53\u5206\u7c7b\u4e0a\u8bf4\uff0cgomock \u548c gomonkey \u90fd\u5c5e\u4e8e\u5728 Test Double \u65b9\u9762\u63d0\u4f9b\u80fd\u529b\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u901a\u5e38\u8bf4\u7684\uff0c\u5e7f\u4e49\u7684 mock\uff0c\u6709\u4e86\u8fd9\u4e24\u4e2a\u5e93\uff0c\u4f60\u5c31\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u5957\u5b9e\u73b0\u6765\u8fdb\u884c\u66ff\u6362\u4e86\u3002\n\ngoconvey \u5219\u662f\u4e00\u4e2a\u3010\u6d4b\u8bd5\u6846\u67b6\u3011\uff0c\u63d0\u4f9b\u4e86 Convey \u548c So \u6765\u642d\u914d\u4f7f\u7528\uff0c\u6811\u5f62\u7ed3\u6784\u65b9\u4fbf\u6784\u9020\u5404\u79cd\u573a\u666f\u3002\u5b83\u672c\u8eab\u662f\u4e0d\u4f1a\u63d0\u4f9b mock \u80fd\u529b\u7684\uff0c\u4f60\u53ef\u4ee5\u57fa\u4e8e goconvey \u6765\u7ec4\u7ec7\u4f60\u7684\u5355\u6d4b\uff0c\u5728\u9700\u8981 mock \u7684\u65f6\u5019\u9009\u7528 gomock\uff0cgomonkey \u6216\u8005\u5176\u4ed6\u6211\u4eec\u4ecb\u7ecd\u8fc7\u7684\u5b9e\u73b0\u3002\n\n\n\u597d\u4e86\uff0c\u8fd9\u91cc\u662f\u4e00\u70b9\u6982\u5ff5\u7684\u62c6\u89e3\uff0c\u6211\u4eec\u4e0b\u6765\u8fdb\u5165\u6b63\u9898\uff0c\u770b\u770b gomonkey \u80fd\u5e26\u6765\u4ec0\u4e48\u80fd\u529b\uff0c\u600e\u4e48\u7528\u3002\n\n\n# Monkey Patching\n\n\u8981\u804a gomonkey\uff0c\u5148\u6765\u4e86\u89e3\u4e00\u4e0b\u5b83\u652f\u6301\u7684\u3010Monkey Patching\u3011\u5230\u5e95\u662f\u4ec0\u4e48\uff0c\u5728 Golang \u4e2d\u5982\u4f55\u843d\u5730\u3002\u5148\u6765\u770b\u770b [\u7ef4\u57fa\u767e\u79d1](https://en.wikipedia.org/wiki/Monkey_patch) \u4e2d\u7684\u89e3\u91ca\uff1a\n\n> A monkey patch is a way for a program to extend or modify supporting system software locally (affecting only the running instance of the program).\n> \n> The definition of the term varies depending upon the community using it. In Ruby,[2] Python,[3] and many other dynamic programming languages, the term monkey patch only refers to dynamic modifications of a class or module at runtime, motivated by the intent to patch existing third-party code as a workaround to a bug or feature which does not act as desired.\n\n\nmonkey patch \u5c31\u662f\u5728\u8fd0\u884c\u65f6\uff0c\u52a8\u6001\u4fee\u6539\u4e00\u4e9b\u53d8\u91cf/\u51fd\u6570/\u65b9\u6cd5/\u6a21\u5757 \u7684\u884c\u4e3a\u7684\u80fd\u529b\u3002\u5bf9\u4e8e\u6709\u4e9b\u4e09\u65b9\u7684\u5e93\uff0c\u6211\u4eec\u6ca1\u6709\u6743\u9650\u53bb\u8c03\u6574\u4ee3\u7801\u903b\u8f91\uff0c\u800c\u8fd9\u53c8\u4f1a\u5bf9\u6211\u4eec\u6d4b\u8bd5\u5e26\u6765\u5f71\u54cd\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u901a\u8fc7\u3010\u8fd0\u884c\u65f6\u66ff\u6362\u3011\u7684\u65b9\u6cd5\u6765\u6539\u6389\u8fd9\u4e9b\u5b9e\u4f53\u7684\u884c\u4e3a\u3002\n\n\u867d\u7136\u53d8\u91cf\u6211\u4eec\u6709\u65f6\u5019\u4e5f\u4f1a\u6d89\u53ca\uff0c\u4f46\u5176\u5b9e mock \u7684\u4e3b\u4f53\u8fd8\u662f\u51fd\u6570\uff0c\u6240\u4ee5\u7b80\u5316\u4e00\u4e0b\u8bc9\u6c42\u5c31\u53d8\u6210\uff1a\u5728\u8fd0\u884c\u65f6\u5c06\u539f\u672c\u9700\u8981\u8c03\u7528\u7684\u51fd\u6570\u66ff\u6362\u6210\u53e6\u4e00\u4e2a\u51fd\u6570\u3002\n\n\u5728 Golang \u4e2d\u505a monkey patching \u7684\u539f\u7406\u6bd4\u8f83\u590d\u6742\uff0c\u8981\u89e3\u91ca\u6e05\u695a\u7684\u8bdd\u8981\u4e0b\u6c89\u5230\u6c47\u7f16\u4ee3\u7801\uff0c\u6211\u4eec\u6682\u65f6\u7565\u8fc7\uff0c\u611f\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u53c2\u7167\u8377\u5170\u5de5\u7a0b\u5e08 [Bouke](https://github.com/bouk) \u7684 [blog](https://bou.ke/blog/monkey-patching-in-go/) \u6765\u4e86\u89e3\u4e00\u4e0b\u3002\n\n\n# gomonkey\n\n\n> gomonkey is a library to make monkey patching in unit tests easy.\n>\n> - support a patch for a function\n> - support a patch for a public member method\n> - support a patch for a private member method\n> - support a patch for a interface\n> - support a patch for a function variable\n> - support a patch for a global variable\n> - support patches of a specified sequence for a function\n> - support patches of a specified sequence for a member method\n> - support patches of a specified sequence for a interface\n> - support patches of a specified sequence for a function variable\n\n[gomonkey](https://github.com/agiledragon/gomonkey) \u5c31\u662f\u5728 Golang \u4e0b\u5bf9 monkey patching \u8fdb\u884c\u652f\u6301\u7684\u6d4b\u8bd5\u5e93\uff0c\u4e00\u4e2a\u6253\u6869\u6846\u67b6\u3002\u76ee\u6807\u662f\u8ba9\u7528\u6237\u5728\u5355\u5143\u6d4b\u8bd5\u4e2d\u4f4e\u6210\u672c\u7684\u5b8c\u6210\u6253\u6869\uff0c\u4ece\u800c\u5c06\u7cbe\u529b\u805a\u7126\u4e8e\u4e1a\u52a1\u529f\u80fd\u7684\u5f00\u53d1\u3002\n\n\u8fd9\u662f\u7531\u56fd\u4eba\u5927\u4f6c [\u5f20\u6653\u9f99](https://www.jianshu.com/u/1381dc29fed9) \u5f00\u53d1\u7684\u5e93\u3002\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u57fa\u672c\u4e0a\u4e00\u4e2a\u5f00\u53d1\u8005\u80fd\u9047\u5230\u7684\u5404\u79cd\u573a\u666f\uff0c\u90fd\u5df2\u7ecf\u88ab gomonkey \u8986\u76d6\u3002\u5305\u62ec\u51fd\u6570\uff0c\u5bfc\u51fa\u65b9\u6cd5\uff0c\u79c1\u6709\u65b9\u6cd5\uff0c\u63a5\u53e3\uff0c\u51fd\u6570\u53c2\u6570\uff0c\u5168\u5c40\u53d8\u91cf\u7b49\u3002\n\n# \u5b9e\u6218\u7528\u6cd5\n\n\u4f7f\u7528\u524d\u6211\u4eec\u8fd8\u662f\u7528 go get \u6dfb\u52a0\u4e00\u4e0b\u4f9d\u8d56\uff1a\n\n```\ngo get github.com/agiledragon/gomonkey/v2@v2.2.0\n```\n\n\u6709\u4e00\u70b9\u4e00\u5b9a\u8981\u6ce8\u610f\uff0cgolang\u7f16\u8bd1\u5668\u5728\u7f16\u8bd1\u65f6\u4f1a\u8fdb\u884c\u5185\u8054\u4f18\u5316\uff0c\u5373\u628a\u7b80\u77ed\u7684\u51fd\u6570\u5728\u8c03\u7528\u5b83\u7684\u5730\u65b9\u5c55\u5f00\uff0c\u4ece\u800c\u6d88\u9664\u8c03\u7528\u76ee\u6807\u51fd\u6570\u7684\u5f00\u9500\u3002\u4f46\u56e0\u4e3a\u5185\u8054\u6d88\u9664\u4e86\u8c03\u7528\u76ee\u6807\u51fd\u6570\u65f6\u7684\u8df3\u8f6c\u64cd\u4f5c\uff0c\u4f7f\u5f97go monkey\u586b\u5145\u5728\u76ee\u6807\u51fd\u6570\u5165\u53e3\u5904\u7684\u6307\u4ee4\u65e0\u6cd5\u6267\u884c\uff0c\u56e0\u800c\u4e5f\u65e0\u6cd5\u5b9e\u73b0\u51fd\u6570\u4f53\u7684\u8fd0\u884c\u65f6\u66ff\u6362\uff0c\u4f7fgo monkey\u5931\u6548\u3002\u6240\u4ee5\uff0c\u6267\u884c\u6d4b\u8bd5 case \u524d\u4e00\u5b9a\u8981\u6ce8\u610f\u52a0\u4e0a -gcflags=all=-l\n\n```\ngo test -gcflags=all=-l\n```\n\n\u5b98\u65b9\u7684[\u793a\u4f8b](https://github.com/agiledragon/gomonkey/tree/master/test) \u5176\u5b9e\u5c31\u662f\u4ed6\u4eec\u7684\u5355\u6d4bcase\uff0c\u8fd9\u662f\u5f88\u597d\u7684\u793a\u8303\uff0c\u628a\u5355\u6d4b\u5199\u597d\uff0c\u5199\u5bf9\uff0c\u7528\u5b83\u76f4\u63a5\u6765\u505a\u6587\u6863\uff0c\u6bd4\u5f88\u591a\u65f6\u5019\u6587\u6863\u548c code \u4e0d match \u597d\u7684\u591a\u3002\u5b98\u65b9\u6848\u4f8b\u8fd8\u662f\u7a0d\u5fae\u6709\u70b9\u590d\u6742\u7684\uff0c\u5efa\u8bae\u5927\u5bb6\u5148\u770b\u4e0b\u6211\u4eec\u4e0b\u9762\u7684\u7b80\u5355\u7684\u7528\u6cd5\uff0c\u518d\u8fc7\u4e00\u4e0b\u5b98\u65b9\u901a\u8fc7 goconvey \u7684\u5b9e\u8df5\u3002\n\n## \u51fd\u6570\u6253\u6869\n\n\u7ed9\u51fd\u6570\u6253\u6869\u662f\u6700\u5e38\u89c1\u7684\u573a\u666f\uff0cApplyFunc \u63a5\u53e3\u5b9a\u4e49\u5982\u4e0b\uff1a\n```\nfunc ApplyFunc(target, double interface{}) *Patches\nfunc (this *Patches) ApplyFunc(target, double interface{}) *Patches\n```\n\nApplyFunc\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u51fd\u6570\u540d\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u6869\u51fd\u6570\u3002\u6d4b\u8bd5\u5b8c\u6210\u540e\uff0cpatches \u5bf9\u8c61\u901a\u8fc7 Reset \u6210\u5458\u65b9\u6cd5\u5220\u9664\u6240\u6709\u6d4b\u8bd5\u6869\u3002\n\n\u8fd9\u91cc\u6211\u4eec\u770b\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u793a\u4f8b\uff0c\u6709\u65f6\u5019\u6211\u4eec\u5e0c\u671b time.Now() \u8fd4\u56de\u56fa\u5b9a\u65f6\u95f4\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u7684\u5b9e\u73b0\uff0c\u5c31\u53ef\u4ee5\u63d2\u6869\u6765\u6307\u5b9a\u3002\u6700\u540e\u901a\u8fc7 defer \u6765 Reset \u5c31\u597d\u3002[\u5b98\u65b9\u793a\u4f8b](https://github.com/agiledragon/gomonkey/blob/master/test/apply_func_test.go) \n\n```go\nnow := time.Now()\nvar p = gomonkey.ApplyFunc(time.Now, func() time.Time {\n\treturn now\n})\ndefer p.Reset()\n```\n\u8bb0\u5f97\u51fd\u6570\u6e05\u660e\u9700\u8981 match\uff0c\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a datasource \u5305\u4e0b\u7684 Get \u65b9\u6cd5\uff0c\u7b7e\u540d\u5982\u4e0b\uff1a\n```go\nfunc Get(ctx context.Context, key string) (string, error)\n```\n\u90a3\u4e48\u540c\u6837\uff0c\u5bf9\u9f50\u63d2\u6869\u7684\u65f6\u5019\u4e5f\u8981\u7528\u4e00\u6837\u7684\u7b7e\u540d\uff1a\n```go\nsaveValue := \"\"\nvar p = gomonkey.ApplyFunc(datasource.Get, func(ctx context.Context, key string) (string, error) {\n        return saveValue, nil\n})\ndefer p.Reset()\n```\n\n\u6b64\u5916\uff0cgomonkey \u8fd8\u652f\u6301\u5bf9\u51fd\u6570\u6253\u4e00\u4e2a\u7279\u5b9a\u7684\u6869\u5e8f\u5217\uff1a\n```go\nfunc TestApplyFuncSeq(t *testing.T) {\n  Convey(\"default times is 1\", t, func() {\n    info1 := \"hello cpp\"\n    info2 := \"hello golang\"\n    info3 := \"hello gomonkey\"\n    outputs := []OutputCell{\n      {Values: Params{info1, nil}},\n      {Values: Params{info2, nil}},\n      {Values: Params{info3, nil}},\n    }\n    patches := ApplyFuncSeq(fake.ReadLeaf, outputs)\n    defer patches.Reset()\n    \n    output, err := fake.ReadLeaf(\"\")\n    assert.Equal(t, nil, err)\n    assert.Equal(t, info1, output)\n    \n    output, err = fake.ReadLeaf(\"\")\n    assert.Equal(t, nil, err)\n    assert.Equal(t, info2, output)\n    \n    output, err = fake.ReadLeaf(\"\")\n    assert.Equal(t, nil, err)\n    assert.Equal(t, info3, output)\n  })\n}\n```\n\n## \u65b9\u6cd5\u6253\u6869\n\n\u8fd9\u91cc\u8981\u7528\u5230 ApplyMethod \u7684\u80fd\u529b\uff0c\u7b7e\u540d\u5982\u4e0b\n\n```\nfunc ApplyMethod(target reflect.Type, methodName string, double interface{}) *Patches\nfunc (this *Patches) ApplyMethod(target reflect.Type, methodName string, double interface{}) *Patches\n```\n\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u76ee\u6807\u7c7b\u7684\u6307\u9488\u53d8\u91cf\u7684\u53cd\u5c04\u7c7b\u578b\uff0c\u53ef\u4ee5\u7528 reflect.TypeOf \u6765\u83b7\u53d6\u3002\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684\u65b9\u6cd5\u540d\uff0c\u7b2c\u4e09\u4e2a\u53c2\u6570\u662f\u6869\u51fd\u6570\u3002\u6d4b\u8bd5\u5b8c\u6210\u540e\uff0cpatches \u5bf9\u8c61\u901a\u8fc7 Reset \u6210\u5458\u65b9\u6cd5\u5220\u9664\u6240\u6709\u6d4b\u8bd5\u6869\u3002\n\n\u6211\u4eec\u5728 fake \u5305\u5b9a\u4e49\u4e0b\u9762\u7684\u7ed3\u6784\uff1a\n\n```go\ntype Slice []int\n\nfunc NewSlice() Slice {\n    return make(Slice, 0)\n}\n\nfunc (this* Slice) Add(elem int) error {}\n\nfunc (this* Slice) Remove(elem int) error {}\n\nfunc (this *Slice) Append(elems ...int) int {}\n```\n\n\u4e00\u4e2a\u7c7b\u578b Slice\uff0c\u4ee5\u53ca\u4e0b\u9762\u7684 Add, Remove, Append \u4e09\u4e2a\u65b9\u6cd5\u3002\u5177\u4f53\u7684\u5b9e\u73b0\u7701\u7565\u3002\n\n\u73b0\u5728\u6211\u4eec\u8981\u9488\u5bf9 Add \u65b9\u6cd5\u6765\u6253\u6869\uff0c\u5c31\u53ef\u4ee5\u8fd9\u6837\uff1a\n\n```go\nslice := fake.NewSlice()\nvar s *fake.Slice\n\npatches := ApplyMethod(reflect.TypeOf(s), \"Add\", func(_ *fake.Slice, _ int) error {\n\treturn nil\n})\ndefer patches.Reset()\n```\n\u6ce8\u610f\uff0c\u4f7f\u7528ApplyMethod\u65f6\uff0creflect.TypeOf(caller)\u7684caller\u5165\u53c2\u548cfunc(_ caller)\u7684caller\u5165\u53c2\u5fc5\u987b\u548c\u539f\u65b9\u6cd5\u4e00\u81f4\uff0c\u539f\u65b9\u6cd5\u91c7\u7528\u7684\u662f\u7ed3\u6784\u4f53\u8c03\u7528\uff0c\u90a3\u4e48caller\u5c31\u5fc5\u987b\u4e3a\u7ed3\u6784\u4f53\uff0c\u53cd\u4e4b\u5c31\u90fd\u5f97\u4e3a\u6307\u9488\u3002\n\n\u5b98\u65b9\u5b8c\u6574\u793a\u4f8b\u5982\u4e0b:\n\n```go\nfunc TestApplyMethod(t *testing.T) {\n  slice := fake.NewSlice()\n  var s *fake.Slice\n  Convey(\"TestApplyMethod\", t, func() {\n\n    Convey(\"for succ\", func() {\n      err := slice.Add(1)\n      So(err, ShouldEqual, nil)\n      patches := ApplyMethod(reflect.TypeOf(s), \"Add\", func(_ *fake.Slice, _ int) error {\n        return nil\n      })\n      defer patches.Reset()\n      err = slice.Add(1)\n      assert.Equal(t, nil, err)\n      err = slice.Remove(1)\n      assert.Equal(t, nil, err)\n      assert.Equal(t, 0, len(slice))\n    })\n\n    //\u591a\u65b9\u6cd5\n    Convey(\"two methods\", func() {\n      err := slice.Add(3)\n      assert.Equal(t, nil, err)\n      defer slice.Remove(3)\n      patches := ApplyMethod(reflect.TypeOf(s), \"Add\", func(_ *fake.Slice, _ int) error {\n        return fake.ErrElemExsit\n      })\n      defer patches.Reset()\n      patches.ApplyMethod(reflect.TypeOf(s), \"Remove\", func(_ *fake.Slice, _ int) error {\n        return fake.ErrElemNotExsit\n      })\n      err = slice.Add(2)\n      assert.Equal(t, fake.ErrElemExsit, err)\n      err = slice.Remove(1)\n      assert.Equal(t, fake.ErrElemNotExsit, err)\n      assert.Equal(t, 1, len(slice))\n      assert.Equal(t, 3, slice[0])\n    })\n\n    //\u65b9\u6cd5and\u51fd\u6570\n    Convey(\"one func and one method\", func() {\n      err := slice.Add(4)\n      assert.Equal(t, nil, err)\n      defer slice.Remove(4)\n      patches := ApplyFunc(fake.Exec, func(_ string, _ ...string) (string, error) {\n        return outputExpect, nil\n      })\n      defer patches.Reset()\n      patches.ApplyMethod(reflect.TypeOf(s), \"Remove\", func(_ *fake.Slice, _ int) error {\n        return fake.ErrElemNotExsit\n      })\n      output, err := fake.Exec(\"\", \"\")\n      assert.Equal(t, nil, err)\n      assert.Equal(t, outputExpect, output)\n      err = slice.Remove(1)\n      assert.Equal(t, fake.ErrElemNotExsit, err)\n      assert.Equal(t, 1, len(slice))\n      assert.Equal(t, 4, slice[0])\n    })\n  })\n}\n```\n\n\u7c7b\u4f3c\u7684\uff0cgomonkey \u4e5f\u652f\u6301\u5bf9\u6210\u5458\u65b9\u6cd5\u6253\u7279\u5b9a\u7684\u6869\u5e8f\u5217\uff1a\n\n```\nfunc TestApplyMethodSeq(t *testing.T) {\n  e := &fake.Etcd{}\n  Convey(\"default times is 1\", t, func() {\n    info1 := \"hello cpp\"\n    info2 := \"hello golang\"\n    info3 := \"hello gomonkey\"\n    outputs := []OutputCell{\n      {Values: Params{info1, nil}},\n      {Values: Params{info2, nil}},\n      {Values: Params{info3, nil}},\n    }\n    patches := ApplyMethodSeq(reflect.TypeOf(e), \"Retrieve\", outputs)\n    defer patches.Reset()\n    output, err := e.Retrieve(\"\")\n    assert.Equal(t, nil, err)\n    assert.Equal(t, info1, output)\n    output, err = e.Retrieve(\"\")\n    assert.Equal(t, nil, err)\n    assert.Equal(t, info2, output)\n    output, err = e.Retrieve(\"\")\n    assert.Equal(t, nil, err)\n    assert.Equal(t, info3, output)\n  })\n}\n```\n\n## \u65b9\u6cd5\u6253\u6869\u5347\u7ea7\n\n\u5728 ApplyMethod \u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u6bcf\u6b21 reflect.TypeOf\uff0c\u4ee5\u53ca\u7b7e\u540d\u8981\u4f20 receiver \u8fd8\u662f\u6dfb\u52a0\u4e86\u5f88\u591a\u4e0d\u5fc5\u8981\u7684\u4ee3\u7801\u3002\u4e3a\u6b64\uff0c\u4f5c\u8005\u5bf9 gomonkey \u518d\u5ea6\u5347\u7ea7\u3002\u9000\u51fa\u4e86 ApplyMethodFunc\uff0c\u4ece\u800c\u652f\u6301\u4e86\uff1a\u4e3a method \u6253\u6869\u65f6\u53ef\u4ee5\u4e0d\u4f20\u5165 reflect.TypeOf \u7c7b\u578b\u53c2\u6570\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u4f20\u5165 receiver \u53c2\u6570\u3002\n\n\u6bd4\u4e0a\u9762 TestApplyMethod \u793a\u4f8b\u4ee3\u7801 ApplyMethod \u7684\u7b2c\u4e09\u4e2a\u51fd\u6570\u53c2\u6570 func(_ *fake.Slice, _ int) error \u5c11\u4e86\u7b2c\u4e00\u4e2a\u5b50\u53c2\u6570 *fake.Slice\uff0c\u800c\u7b80\u5316\u6210 func(_ int) error\u3002\n\n```go\nfunc TestApplyMethodFunc(t *testing.T) {\n    slice := fake.NewSlice()\n    var s *fake.Slice\n    Convey(\"TestApplyMethodFunc\", t, func() {\n        Convey(\"for succ\", func() {\n            err := slice.Add(1)\n            So(err, ShouldEqual, nil)\n            patches := ApplyMethodFunc(s, \"Add\", func(_ int) error {\n                return nil\n            })\n            defer patches.Reset()\n            err = slice.Add(1)\n            So(err, ShouldEqual, nil)\n            err = slice.Remove(1)\n            So(err, ShouldEqual, nil)\n            So(len(slice), ShouldEqual, 0)\n        })\n    })\n}\n```\n\n## \u6307\u5b9a\u8fd4\u56de\u503c\n\n\u5982\u679c\u4f60\u89c9\u5f97 ApplyFunc \u6216 ApplyMethod \u8fd8\u9700\u8981\u5199\u4ee3\u7801 hardcode \u4e00\u4e2a\u8fd4\u56de\u503c\uff0c\u90a3\u5176\u5b9e\u53ef\u4ee5\u76f4\u63a5\u7528 `ApplyMethodReturn` \u8fd9\u4e2a\u6765\u89e3\u51b3\uff0cApplyMethodReturn \u63a5\u53e3\u4ece\u7b2c\u4e09\u4e2a\u53c2\u6570\u5f00\u59cb\u5c31\u662f\u6869\u7684\u8fd4\u56de\u503c\u3002\n\n```go\nfunc TestApplyMethodReturn(t *testing.T) {\n    e := &fake.Etcd{}\n    Convey(\"TestApplyMethodReturn\", t, func() {\n        Convey(\"declares the values to be returned\", func() {\n            info := \"hello cpp\"\n            patches := ApplyMethodReturn(e, \"Retrieve\", info, nil)\n            defer patches.Reset()\n            for i := 0; i < 10; i++ {\n                output, err := e.Retrieve(\"\")\n                So(err, ShouldEqual, nil)\n                So(output, ShouldEqual, info)\n            }\n        })\n    })\n}\n```\n\u540c\u6837\u7684\u8fd8\u6709 ApplyFuncReturn, \u4ece\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5f00\u59cb\u5c31\u662f\u6869\u7684\u8fd4\u56de\u503c\u3002\n\n```go\nfunc TestApplyFuncReturn(t *testing.T) {\n    Convey(\"TestApplyFuncReturn\", t, func() {\n        Convey(\"declares the values to be returned\", func() {\n            info := \"hello cpp\"\n            patches := ApplyFuncReturn(fake.ReadLeaf, info, nil)\n            defer patches.Reset()\n            for i := 0; i < 10; i++ {\n                output, err := fake.ReadLeaf(\"\")\n                So(err, ShouldEqual, nil)\n                So(output, ShouldEqual, info)\n            }\n        })\n    })\n}\n```\n\n## \u5168\u5c40\u53d8\u91cf\u6253\u6869\n\n\u8fd9\u4e2a\u5f88\u7b80\u5355\uff0c\u76f4\u63a5 ApplyGlobalVar \u5c31ok\uff0c\u76f4\u63a5\u53c2\u8003\u4ee3\u7801\u5c31\u597d\u3002\n```go\nvar num = 10\n\nfunc TestApplyGlobalVar(t *testing.T) {\n  Convey(\"TestApplyGlobalVar\", t, func() {\n\n    Convey(\"change\", func() {\n      patches := ApplyGlobalVar(&num, 150)\n      defer patches.Reset()\n      assert.Equal(t, num, 150)\n    })\n\n    Convey(\"recover\", func() {\n      assert.Equal(t, num, 10)\n    })\n  })\n}\n```\n\n\n# \u539f\u7406\u6d45\u6790\n\n\u7b80\u5355\u8bf4\u4e0b\u5927\u4f53\u539f\u7406\u3002\u5728 Golang [runtime](https://github.com/golang/go/blob/e9d9d0befc634f6e9f906b5ef7476fbd7ebd25e3/src/runtime/runtime2.go#L75-L78) \u4e2d\uff0c\u51fd\u6570\u503c\u662f\u8fd9\u6837\u8868\u793a\u7684\uff1a\n\n```go\ntype funcval struct {\n\tfn uintptr\n\t// variable-size, fn-specific data here\n}\n```\n\n\u56de\u5fc6\u4e0b\u6211\u4eec\u4e4b\u524d\u63d0\u8fc7\u7684 [uintptr](https://juejin.cn/post/7127600972573966373)\uff0c\u5b83\u662f\u4e00\u4e2a\u7528\u6765\u5b58\u653e\u6307\u9488\u503c\u7684 int \u7c7b\u578b\u3002\u6240\u4ee5\u8fd9\u91cc fn \u5c31\u4fdd\u5b58\u4e86\u5185\u5b58\u4e2d\u51fd\u6570\u7684\u5730\u5740\u3002\u4e0b\u9762\u4e00\u884c\u6ce8\u91ca\u6307\u7684\u662f fn-\u4e13\u5c5e\u6570\u636e\u53ef\u53d8\u5927\u5c0f\uff0c\u8fd9\u662f\u95ed\u5305\u8fd9\u4e00\u7279\u6027\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u901a\u8fc7\u5728funcval\u4e2d\u5b58\u653e\u6355\u83b7\u7684\u53d8\u91cf\uff0c\u7531\u4e8e\u53d8\u91cf\u7684\u4e2a\u6570\u672a\u77e5\uff0c\u6240\u4ee5\u662fvarible-size\uff0c\u5177\u4f53\u5927\u5c0f\u7531\u7f16\u8bd1\u5668\u5206\u914d\u3002\n\n\n\u6211\u4eec\u7528\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\u6765\u6d4b\u8bd5\u4e00\u4e0b\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"unsafe\"\n)\n\nfunc a() int { return 1 }\n\nfunc main() {\n\tfmt.Printf(\"%p\\n\", a)\n\tfn := a\n\tfmt.Printf(\"0x%x\\n\", *(*uintptr)(unsafe.Pointer(&fn)))\n\tfmt.Printf(\"0x%x\\n\", **(**uintptr)(unsafe.Pointer(&fn)))\n}\n```\n\u6253\u5370\u7ed3\u679c\u5982\u4e0b\uff1a\n```\n0x482100\n0x4a1a50\n0x482100\n```\n\n\u6ce8\uff1a%p \u6253\u5370\u7684\u662f\u6307\u9488\u3002\n\n\u6211\u4eec\u4f1a\u53d1\u73b0\uff0c\u51fd\u6570\u503cfn\u5e76\u6ca1\u6709\u76f4\u63a5\u6301\u6709\u51fd\u6570a\u7684\u5730\u5740\u3002fn\u5b9e\u9645\u4e0a\u662f*funcval\u7c7b\u578b(\u6307\u9488)\uff0c\u5b83\u9664\u4e86\u5305\u542b\u51fd\u6570a\u7684\u5730\u5740\uff0c\u8fd8\u5305\u62ec\u4e86\u989d\u5916\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\u3002\u8fd9\u4e00\u5c42 funcval \u5b58\u5728\u7684\u610f\u4e49\u5c31\u662f\u4e3a\u4e86\u652f\u6301\u95ed\u5305\uff08\u4e00\u4e2a\u51fd\u6570\u80fd\u591f\u6355\u83b7\u53d8\u91cf\uff0c\u4f7f\u5f97\u8fd9\u4e2a\u53d8\u91cf\u53ef\u4ee5\u8131\u79bb\u5b83\u7684\u751f\u547d\u5468\u671f\u800c\u4f5c\u7528\uff09\u3002\n\n\n\u8fd9\u91cc\u6211\u4eec\u4e0d\u5c55\u5f00\u95ed\u5305\u7684\u8bdd\u9898\uff0c\u4ece\u51fd\u6570\u503c\u7684\u7ed3\u6784\u53ef\u4ee5\u770b\u51fa\u6765\uff0c\u65e2\u7136\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 funcval \u62ff\u5230\u51fd\u6570\u7684\u5730\u5740\uff0c\u5c31\u53ef\u4ee5\u628a\u8fd9\u91cc\u7684 `fn uintptr` \u66ff\u6362\u6210\u66ff\u6362\u51fd\u6570\u7684\u673a\u5668\u7801\uff0c\u8fd9\u6837\u5c31\u80fd\u505a\u5230\uff0c\u8c03\u7528\u76ee\u6807\u51fd\u6570\u65f6\u76f4\u63a5\u6267\u884c gomonkey \u586b\u5145\u7684\u8df3\u8f6c\u6307\u4ee4\u3002\n\n\u5e95\u5c42 gomonkey \u662f\u7ed3\u5408\u4e86\u6c47\u7f16\u547d\u4ee4\uff0c\u5bf9\u5e94\u4e0d\u540c\u64cd\u4f5c\u7cfb\u7edf\u4e0b\u7684\u5185\u5b58\u4fee\u6539\u7cfb\u7edf\u8c03\u7528\u6765\u505a\u5230\u7684\u3002\u611f\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u770b\u4e0b\u8fd9\u51e0\u4e2a\u6587\u4ef6\u3002\n\n![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/880fc33976934aa08d7ea1d7c7a362ee~tplv-k3u1fbpfcp-watermark.image?)\n\n-   jmp_amd64.go: \u8fd9\u91cc\u9762\u5c31\u662f\u6784\u9020\u6c47\u7f16\u6307\u4ee4\u7684\u8bed\u53e5\n-   patch.go\uff1a\u5c31\u662fgomonkey\u7684\u6838\u5fc3\u4ee3\u7801\n-   modify_binary_xxx.go\uff1a\u8fd9\u4e09\u4e2a\u6587\u4ef6\u5bf9\u5e94\u4e0d\u540c\u64cd\u4f5c\u7cfb\u7edf\u4e0b\u7684\u5185\u5b58\u4fee\u6539\u7cfb\u7edf\u8c03\u7528\uff0c\u56e0\u6b64\u4f1a\u6709\u6240\u533a\u522b\u3002\n\n\n![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2eeb69cf6ad14ff3896adcb5b21ad5e3~tplv-k3u1fbpfcp-watermark.image?)\n\n\u4ece\u5f00\u53d1\u8005\u7684\u89d2\u5ea6\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5173\u6ce8 patch.go \u91cc\u9762\u7684\u5185\u5bb9\u5373\u53ef\u3002gomonkey \u5bf9\u5916\u63d0\u4f9b\u7684\u51fd\u6570\u90fd\u662f\u5bf9 Patch \u7684\u6210\u5458\u65b9\u6cd5\u7684\u5305\u88c5\uff1a\n\n```go\ntype Patches struct {\n\toriginals    map[uintptr][]byte              // \u539f\u51fd\u6570\n\tvalues       map[reflect.Value]reflect.Value // \u539f\u53d8\u91cf\u7684\u503c\t\n\tvalueHolders map[reflect.Value]reflect.Value\n}\n\nfunc create() *Patches {\n\treturn &Patches{originals: make(map[uintptr][]byte), values: make(map[reflect.Value]reflect.Value), valueHolders: make(map[reflect.Value]reflect.Value)}\n}\n\nfunc NewPatches() *Patches {\n\treturn create()\n}\n\nfunc (this *Patches) ApplyFunc(target, double interface{}) *Patches {\n\tt := reflect.ValueOf(target)\n\td := reflect.ValueOf(double)\n\treturn this.ApplyCore(t, d)\n}\n\n\nfunc (this *Patches) ApplyCore(target, double reflect.Value) *Patches {\n        //\u68c0\u67e5\u4e24\u8005\u662f\u5426\u90fd\u4e3afunc\uff0c\u4ee5\u53catype\u662f\u5426\u76f8\u540c\n\tthis.check(target, double)\n\tassTarget := *(*uintptr)(getPointer(target))\n\toriginal := replace(assTarget, uintptr(getPointer(double)))\n\tif _, ok := this.originals[assTarget]; !ok {\n                //\u4fdd\u5b58\u539f\u6765\u7684\u51fd\u6570\uff0c\u7528\u4e8e\u6062\u590d\n\t\tthis.originals[assTarget] = original\n\t}\n\tthis.valueHolders[double] = double\n\treturn this\n}\n\nfunc replace(target, double uintptr) []byte {\n        //target \u6307\u5411\u51fd\u6570\u5165\u53e3\u5730\u5740\uff0cdouble\u6307\u5411\u66ff\u6362\u51fd\u6570\u7684funcVal\u7ed3\u6784\u5730\u5740\n        //\u6784\u9020\u6c47\u7f16\u6307\u4ee4\uff0c\u8df3\u8f6c\u5230double\u6307\u5411\u7684\u51fd\u6570\u4f4d\u7f6e\n\tcode := buildJmpDirective(double)\n\n        //\u62f7\u8d1d\u539f\u51fd\u6570\u4f53,\u8fd9\u91cc\u53ea\u9700\u8981\u62f7\u8d1d\u957f\u5ea6\u4e3a\u6211\u4eec\u63d2\u5165\u6c47\u7f16\u6307\u4ee4\u957f\u5ea6\u7684\u539f\u51fd\u6570\u4f53\u5373\u53ef\n\tbytes := entryAddress(target, len(code))\n\toriginal := make([]byte, len(bytes))\n        \n        //\u4fdd\u5b58\u5230original\u4e2d\uff0c\u7b49\u5f85Reset\n\tcopy(original, bytes)\n        \n        //\u4fee\u6539\u5185\u5b58\uff0c\u63d2\u5165\u6c47\u7f16\u6307\u4ee4\n\tmodifyBinary(target, code)\n\treturn original\n}\n\nfunc (this *Patches) Reset() {\n        // \u6062\u590d\u51fd\u6570\n\tfor target, bytes := range this.originals {\n\t\tmodifyBinary(target, bytes)\n\t\tdelete(this.originals, target)\n\t}\n        // \u6062\u590d\u53d8\u91cf\n\tfor target, variable := range this.values {\n\t\ttarget.Elem().Set(variable)\n\t}\n}\n```\nApplyFunc \u5305\u542b\u4e09\u6b65\uff1a\n\n- \u751f\u6210\u8df3\u8f6c\u6c47\u7f16\u4ee3\u7801\uff1b\n- \u4fdd\u5b58\u539f\u51fd\u6570\u7684\u51fd\u6570\u4f53\uff1b\n- \u7528\u65b0\u7684\u6c47\u7f16\u4ee3\u7801\u5b8c\u6210\u66ff\u6362\n\n\u5728\u6267\u884c\u7684\u6700\u540e\u6211\u4eec Reset \u56de\u6765\uff0c\u5c31\u53ef\u4ee5\u7528 Patch \u4fdd\u5b58\u7684 originals \u548c values \u6765\u6062\u590d\uff0c\u8fd9\u91cc\u7684 Reset \u4e00\u6b21\u8c03\u7528\u5c31\u5bf9\u6240\u6709\u63d2\u6869\u8fdb\u884c\u6062\u590d\u3002\n\n\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\uff0cmap\u5e76\u4e0d\u7ebf\u7a0b\u5b89\u5168\uff0c\u5982\u679c\u5728\u5355\u6d4b\u5e76\u53d1\u6267\u884c\u65f6\uff08\u4e3a\u4e86\u52a0\u5feb\u5355\u6d4b\u6267\u884c\u901f\u5ea6\uff09\uff0c\u4f1a\u51fa\u73b0\u95ee\u9898\uff0c\u7528 gomonkey \u7684\u65f6\u5019\u8981\u5c0f\u5fc3\u3002\n\n\n# \u7ed3\u8bed\n\n\u56fd\u4eba\u80fd\u5199\u51fa gomonkey \u8fd9\u6837\u5389\u5bb3\u7684\u5e93\uff0c\u4ee5\u53ca\u9002\u914d arm64 \u67b6\u6784\u8fd8\u662f\u975e\u5e38\u725b\u903c\u7684\u3002\u76ee\u524d gomonkey \u914d\u5408 goconvey \u4e00\u8d77\u6765\u5199\u5355\u6d4b\u5176\u5b9e\u662f\u5f88\u6210\u719f\u7684\u505a\u6cd5\uff0c\u4e0a\u9762\u6211\u4eec\u4ecb\u7ecd\u7684\u53ea\u662f\u6700\u5e38\u7528\u7684\u573a\u666f\uff0cgomonkey \u652f\u6301\u7684\u529f\u80fd\u5168\u96c6\u53ef\u4ee5\u8bf4\u5305\u542b\u4e86\u6240\u6709\u65e5\u5e38\u80fd\u6d89\u53ca\u7684\u6253\u6869\u573a\u666f\u3002\u8fd9\u91cc\u6211\u4eec\u4e0d\u8fc7\u591a\u6d89\u53ca\uff0c\u5efa\u8bae\u5927\u5bb6\u591a\u5c1d\u8bd5\u4e00\u4e0b\u4e0d\u540c\u7684\u529f\u80fd\u3002\u611f\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u7ee7\u7eed\u4e86\u89e3\u4e00\u4e0b\u4f5c\u8005\u5bf9\u65b0\u7528\u6cd5\u7684\u4ecb\u7ecd\uff1a\n\n- [\u4f60\u8be5\u5237\u65b0gomonkey\u7684\u60ef\u7528\u6cd5\u4e86](https://www.jianshu.com/p/25d49af216b7)\n- [gomonkey\u7528\u6237\u5982\u4f55\u5bf9\u6cdb\u578b\u6253\u6869](https://www.jianshu.com/p/8a52eae7f786)\n- [gomonkey\u7528\u6237\u5982\u4f55\u5bf9\u6869\u8ba1\u6570](https://www.jianshu.com/p/4f37a584c7e1)\n- [gomonkey 1.0 \u6b63\u5f0f\u53d1\u5e03\uff01](https://www.jianshu.com/p/633b55d73ddd)\n\n\n\n\u611f\u8c22\u9605\u8bfb\uff01\u6b22\u8fce\u5728\u8bc4\u8bba\u533a\u4ea4\u6d41\uff01\n",
    "mtime": "1660966588",
    "original_author": "",
    "original_type": 0,
    "rank_index": 7.90856649,
    "rtime": "1660966588",
    "status": 2,
    "tag_ids": [
      6809640408797167616,
      6809640364677267456,
      6809640427465998336
    ],
    "title": "\u89e3\u6790 Golang \u6d4b\u8bd5\uff088\uff09- gomonkey \u5b9e\u6218",
    "user_id": "325111172316839",
    "user_index": 8.505279830023289,
    "verify_status": 1,
    "view_count": 126,
    "visible_level": 0
  },
  {
    "article_id": "7133792765082599460",
    "audit_status": 2,
    "brief_content": "\u901a\u8fc7\u672c\u7bc7\u6587\u7ae0\uff0c\u53ef\u4ee5\u5e2e\u52a9\u8bfb\u8005\u5bf9\u6570\u636e\u53ef\u89c6\u5316\u7684\u6982\u5ff5\u548c\u539f\u7406\u6709\u4e00\u4e2a\u6574\u4f53\u7684\u8ba4\u77e5\uff0c\u5e76\u4e14\u4ecb\u7ecd\u4e86\u6570\u636e\u53ef\u89c6\u5316\u4e2d\u5e38\u89c1\u7684\u53ef\u89c6\u5316\u56fe\u8868\u7684\u79cd\u7c7b\u548c\u4f7f\u7528\u573a\u666f\u3002",
    "category_id": "6809637772874219534",
    "collect_count": 0,
    "comment_count": 0,
    "content": "",
    "cover_image": "https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78aeb2c5671a42b188b7fed3ca02fd5f~tplv-k3u1fbpfcp-watermark.image?",
    "ctime": "1660965630",
    "digg_count": 0,
    "display_count": 0,
    "draft_id": "7133792410458390564",
    "hot_index": 3,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "**\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u7b2c\u56db\u5c4a\u9752\u8bad\u8425 \u300d\u7b14\u8bb0\u521b\u4f5c\u6d3b\u52a8\u7684\u7684\u7b2c14\u5929**\n\n## \u8bfe\u7a0b\u8d44\u6599\n\n\u8bfe\u7a0b\u94fe\u63a5\uff1a<https://live.juejin.cn/4354/yc_visualization2>\n\n\u8bfe\u7a0bPPT\uff1a<https://bytedance.feishu.cn/file/boxcnhtPkpqQJTOBaVHU4ZpHTGc>\n\n\u5b66\u5458\u624b\u518c\uff1a<https://juejin.cn/post/7130134071232954404#heading-68>\n\n\u5b8c\u6574\u624b\u518c\uff1a<https://bytedance.feishu.cn/docx/doxcnECGEFkCKYqbxaDipK1qrVf>\n\n## \u4e00\u3001\u5b9a\u4e49\n\n### \u4ec0\u4e48\u662f\u6570\u636e\u53ef\u89c6\u5316\n\n\u5728\u79d1\u5b66\u53ef\u89c6\u5316\u9886\u57df\uff0c\u6570\u636e\u53ef\u89c6\u5316\u7684\u4f5c\u7528\u4e3b\u8981\u662f\u5f62\u8c61\u5316\u7684\u5448\u73b0\uff0c\u65b9\u4fbf\u4eba\u4eec\u7406\u89e3\u548c\u67e5\u770b\u3002\u6bd4\u5982\u533b\u5b66\u9886\u57df\u7684\u626b\u63cf\u6210\u50cf\uff0c\u53ef\u4ee5\u5927\u5927\u63d0\u9ad8\u533b\u751f\u63a2\u5bfb\u75c5\u56e0\u7684\u6548\u7387\u3002\n\n\u5448\u73b0\u6570\u636e\u5173\u7cfb\u7684\u4fe1\u606f\u53ef\u89c6\u5316\u662f\u6211\u4eec\u89c1\u5230\u6700\u591a\u7684\u53ef\u89c6\u5316\u65b9\u5f0f\uff0c\u6bd4\u5982\u901a\u8fc7\u5730\u7406\u4fe1\u606f\u4ee5\u53ca\u8fde\u7ebf\u5c55\u73b0\u5510\u4ee3\u4eba\u7269\u7684\u8fc1\u5f99\u8f68\u8ff9\u3002\n\n\u5728\u8ba1\u7b97\u673a\u8bde\u751f\u4e4b\u524d\uff0c\u53ef\u89c6\u5316\u90fd\u662f\u9759\u6001\u4f5c\u54c1\uff0c\u4eba\u4eec\u53ea\u80fd\u901a\u8fc7\u770b\u6765\u7406\u89e3\u6570\u636e\u3002\u968f\u7740\u8ba1\u7b97\u673a\u56fe\u5f62\u7684\u53d1\u5c55\uff0c\u4ea4\u4e92\u6210\u4e3a\u4e00\u4e2a\u91cd\u8981\u7814\u7a76\u65b9\u5411\uff0c\u53ef\u89c6\u5316\u548c\u56fe\u5f62\u4ea4\u4e92\u7684\u878d\u5408\uff0c\u4ea7\u751f\u4e86\u63a2\u7d22\u5f0f\u6570\u636e\u5206\u6790\u3002\u6bd4\u5982\u4e0b\u9762\u7684\u6570\u636e\u5206\u6790\u5de5\u5177Tableau\u7684\u4ea4\u4e92\u754c\u9762\u3002\n\n![image-20220820105911224](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/04e8be3be902478aa085f91dbd53b09c~tplv-k3u1fbpfcp-zoom-1.image)\n\n## \u4e8c\u3001\u539f\u7406\n\n### 2.1 \u6570\u636e\u53ef\u89c6\u5316\u57fa\u672c\u6d41\u7a0b\n\n![image-20220820110327695](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6455430d996649e39e29eb130f48817f~tplv-k3u1fbpfcp-zoom-1.image)\n\n**\u7b2c\u4e00\u6b65 : \u6570\u636e\u5904\u7406\uff08** **Abstract Data** **\uff09** \u53ea\u6709\u6ee1\u8db3\u7279\u5b9a\u7ed3\u6784\u7684\u6570\u636e\u624d\u80fd\u505a\u5bf9\u5e94\u7684\u53ef\u89c6\u5316\u5c55\u73b0\uff0c\u800c\u4e14\u4e3a\u4e86\u8fbe\u5230\u597d\u7684\u53ef\u89c6\u5316\u6548\u679c\u4e5f\u9700\u8981\u5bf9\u6570\u636e\u8fdb\u884c\u6e05\u6d17\u3001\u8f6c\u6362\u7b49\u64cd\u4f5c\u3002\n\n**\u7b2c\u4e8c\u6b65 : \u53ef\u89c6\u5316\u8bbe\u8ba1\u4e0e\u8868\u8fbe\uff08** **Visualization Design\uff09** \u6839\u636e\u6570\u636e\u7279\u5f81\u9009\u62e9\u5408\u9002\u7684\u5c55\u73b0\u6a21\u5f0f\uff0c\u5728\u6b64\u57fa\u7840\u4e0a\u901a\u8fc7\u5408\u7406\u7684\u4f7f\u7528\u89c6\u89c9\u7f16\u7801\uff0c\u6765\u5b9a\u4e49\u6700\u7ec8\u7684\u53ef\u89c6\u5316\u5c55\u73b0\u5185\u5bb9\u3002\n\n**\u7b2c\u4e09\u6b65\uff1a\u53ef\u89c6\u5316\u6e32\u67d3\uff08** **Rendering and Display\uff09**\n\n\u5c06\u5b9a\u4e49\u597d\u7684\u56fe\u5f62\u8f6c\u6362\u6210\u4e3a\u56fe\u50cf\uff0c\u5c55\u73b0\u7ed9\u89c2\u4f17\u3002\n\n**\u7b2c\u56db\u6b65\uff1a\u53ef\u89c6\u5316\u4ea4\u4e92\uff08** **Interactivity\uff09**\n\n\u5355\u4e00\u7684\u53ef\u89c6\u5316\u7ed3\u679c\u5e76\u4e0d\u80fd\u6ee1\u8db3\u7528\u6237\u7684\u591a\u65b9\u9762\u8bc9\u6c42\uff0c\u7528\u6237\u5f80\u5f80\u501f\u52a9\u4ea4\u4e92\u65b9\u5f0f\uff0c\u8fdb\u4e00\u6b65\u4e86\u89e3\u7ec6\u8282\u6216\u8005\u5bf9\u6570\u636e\u8fdb\u884c\u7b5b\u9009\u3001\u805a\u5408\u3001\u5206\u9762\u7b49\uff0c\u5bf9\u6570\u636e\u8fdb\u884c\u591a\u65b9\u9762\u7684\u63a2\u7d22\u3002\n\n## \u4e09\u3001\u6848\u4f8b\n\n\u4eba\u4eec\u76f4\u63a5\u53bb\u5206\u6790\u591a\u7ef4\u6570\u636e\uff0c\u5f80\u5f80\u662f\u975e\u5e38\u56f0\u96be\u7684\uff0c\u501f\u52a9\u53ef\u89c6\u5316\u53ef\u4ee5\u6781\u5927\u7684\u63d0\u5347\u6548\u7387\u3002\u5bf9\u591a\u7ef4\u6570\u636e\u8fdb\u884c\u53ef\u89c6\u5316\u7684\u65b9\u6cd5\u4e5f\u5f88\u591a\uff0c\u8fd9\u91cc\u7b80\u5355\u4ecb\u7ecd\u51e0\u79cd\u3002\n\n### 3.1 \u6563\u70b9\u56fe & \u6563\u70b9\u56fe\u77e9\u9635\n\n\u666e\u901a\u6563\u70b9\u56fe\u53ef\u4ee5\u901a\u8fc7\u5927\u5c0f\u3001\u989c\u8272\u548c\u4f4d\u7f6e\u8868\u8fbe\u4e09\u4e2a\u7ef4\u5ea6\u7684\u6570\u636e\uff0c\u4f46\u662f\u8fd9\u5bf9\u4e8e\u66f4\u591a\u7ef4\u7684\u6570\u636e\u6765\u8bb2\u662f\u8fdc\u8fdc\u4e0d\u591f\u7684\uff0c\u4e8e\u662f\u8bde\u751f\u4e86\u6563\u70b9\u56fe\u77e9\u9635\u3002\n\n\u6563\u70b9\u56fe\u77e9\u9635\u4e2d\u6bcf\u4e2a\u6563\u70b9\u56fe\u8868\u793a\u4e24\u4e2a\u7ef4\u5ea6\u4e4b\u95f4\u7684\u6570\u636e\u5173\u7cfb\u3002\u6211\u4eec\u770b\u4e0b\u9762\u7684\u4f8b\u5b50\uff08[www.jiqizhixin.com/articles/20\u2026](https://link.juejin.cn/?target=https%3A%2F%2Fwww.jiqizhixin.com%2Farticles%2F2018-05-06-2%EF%BC%89%E5%81%9A%E5%85%B7%E4%BD%93%E5%88%86%E6%9E%90%E3%80%82)\n\n\u5047\u8bbe\u6709\u5982\u4e0b\u56fe\u6240\u793a\u7684\u6570\u636e\uff1a\n\n![image-20220820110954581](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/01ba534a93dd453e950a6866a1180489~tplv-k3u1fbpfcp-zoom-1.image)\n\n\u6bcf\u4e00\u884c\u4ee3\u8868\u4e00\u4e2a\u56fd\u5bb6\u4e00\u5e74\u7684\u89c2\u5bdf\u6570\u636e\uff0c\u5217\u4ee3\u8868\u53d8\u91cf\uff08\u8fd9\u79cd\u683c\u5f0f\u7684\u6570\u636e\u88ab\u79f0\u4f5c\u6574\u6d01\u6570\u636e\uff0ctidy data\uff09\uff0c\u5176\u4e2d\u6709\u4e24\u4e2a\u7c7b\u522b\u5217\uff08\u56fd\u5bb6\u548c\u6d32\uff09\u548c\u56db\u4e2a\u6570\u503c\u5217\u3002\u8fd9\u4e9b\u5217\u7b80\u5355\u6613\u61c2\uff1alife_exp \u662f\u51fa\u751f\u65f6\u7684\u9884\u671f\u5bff\u547d\uff0c\u4ee5\u5e74\u4e3a\u5355\u4f4d\uff0cpopis \u662f\u4eba\u53e3\u6570\u91cf\uff0cgdp_per_cap \u662f\u4eba\u5747 GDP\uff08\u4ee5\u56fd\u9645\u5143\uff09\u4e3a\u5355\u4f4d\u3002\u53ea\u8003\u8651\u6570\u503c\u7c7b\u578b\u5c5e\u6027\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c \u53ef\u751f\u6210\u5982\u4e0b\u7684\u6563\u70b9\u56fe\u77e9\u9635\uff1a\n\n![image-20220820111024721](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/50ca94dd86ab4759a2ab48d7aaa6ef0d~tplv-k3u1fbpfcp-zoom-1.image)\n\n\u6563\u70b9\u56fe\u77e9\u9635\u53ef\u4ee5\u8fdb\u4e00\u6b65\u6269\u5c55\u4e3a\u666e\u901a\u7684\u77e9\u9635\uff0c\u5982\u4e0b\u56fe\uff1a\n\n![image-20220820111052851](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/47071f7dd46a46a7a2dbc7eae1e3f9d0~tplv-k3u1fbpfcp-zoom-1.image)\n\n### 3.2 \u5e73\u884c\u5750\u6807\u8f74\n\n\u5e73\u884c\u5750\u6807\u8f74\u65b9\u6cd5\u4e2d\uff0c\u6570\u636e\u7684\u4e0d\u540c\u7ef4\u5ea6\u88ab\u663e\u793a\u4e3a\u5e73\u884c\u7684\u5750\u6807\u8f74\uff0c\u6570\u636e\u5143\u7d20\u88ab\u8868\u793a\u4e3a\u4e00\u6839\u6298\u7ebf\u3002\n\n![image-20220820111146789](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68f6f2f9cf5f4c15afcc855d710aedbe~tplv-k3u1fbpfcp-zoom-1.image)\n\n\u8fd9\u79cd\u65b9\u6cd5\u9002\u7528\u4e8e\u6240\u6709\u8868\u683c\u7c7b\u578b\u7684\u6570\u636e\uff0c\u800c\u4e14\u652f\u6301\u5f02\u6784\u6570\u636e\u7684\u5c55\u73b0\u3002\u5e73\u884c\u5750\u6807\u8f74\u65b9\u6cd5\u4e5f\u6269\u5c55\u51fa\u591a\u79cd\u663e\u793a\u5f62\u5f0f\u3002\n\n![image-20220820111224717](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0d6889f30a3e4bbc81799345f046b0e7~tplv-k3u1fbpfcp-zoom-1.image)\n\n### 3.3 Glyph\n\nGlyph \u662f\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528\u591a\u4e2a\u89c6\u89c9\u901a\u9053\uff0c\u4f8b\u5982 \u56fe\u5f62\uff08shape\uff09\u3001\u989c\u8272\uff08colour\uff09\u3001\u6587\u672c\uff08texture\uff09\u3001\u5927\u5c0f\uff08size\uff09\u3001\u89d2\u5ea6\uff08orientation\uff09\u3001\u6bd4\u4f8b\uff08aspect ratio\uff09\u3001\u66f2\u7387\uff08curvature)\u7684\u4e00\u79cd\u7ec4\u5408\u56fe\u5143\u3002\u540c\u65f6\u6bcf\u4e2aglyph \u53ef\u4ee5\u5355\u72ec\u88ab\u8bc6\u522b\u51fa\u6765\uff0c\u4e3a\u591a\u573a\u878d\u5408\u53ef\u89c6\u5316\u63d0\u4f9b\u4e86\u53ef\u80fd\u3002\n\n\u6bd4\u5982\u4eba\u8138\u56fe\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e94\u5b98\u8981\u7d20\u5bf9\u591a\u4e2a\u53d8\u91cf\u8fdb\u884c\u7f16\u7801\u3002\n\n![image-20220820111310914](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fb4768747e124f56ad1875763bf8b36a~tplv-k3u1fbpfcp-zoom-1.image)\n\n\u4e0b\u56fe\u7684\u662f\u4e00\u4e2a\u6e29\u5ea6\u8ba1\u7ec4\u4ef6\u3002\u6c34\u94f6\u9ad8\u5ea6\u548c\u6e29\u5ea6\u8ba1\u5bbd\u5ea6\u53ef\u4ee5\u7528\u6765\u5c55\u73b0\u4e24\u4e2a\u53d8\u91cf\u3002\u901a\u5e38\u53ef\u4ee5\u4f5c\u4e3a\u6563\u70b9\u56fe\u7684\u53d8\u79cd\u3002\n\n![image-20220820111407836](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9d8aebb937cb46ff854f91c01d44edee~tplv-k3u1fbpfcp-zoom-1.image)\n\n### 3.4 \u6811\uff08\u56fe\uff09\u53ef\u89c6\u5316\n\n\u70b9\u7ebf\u56fe\n\n![image-20220820111511478](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/968d1c5bf5d94b0482c3f09dbc00d07f~tplv-k3u1fbpfcp-zoom-1.image)\n\n\u90bb\u63a5\u56fe\n\n\u901a\u8fc7\u53ef\u89c6\u5316\u8282\u70b9\u4e4b\u95f4\u7684\u76f8\u90bb\u4f4d\u7f6e\u5173\u7cfb\u4ee5\u5c55\u73b0\u6811\u7684\u62d3\u6251\u7ed3\u6784\uff0c\u8282\u70b9\u7684\u5927\u5c0f\uff0c\u5bbd\u5ea6\uff0c\u53ef\u4ee5\u7528\u6765\u5c55\u73b0\u53e6\u5916\u4e00\u4e2a\u6570\u636e\u7ef4\u5ea6\u3002\n\n![image-20220820111541787](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6de2066d82f6458a8ea4ebcbe57a49e3~tplv-k3u1fbpfcp-zoom-1.image)\n\n\u5305\u542b\u56fe\n\n![image-20220820111629374](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2e499473cc2642c3b24fd74ec9e02fc5~tplv-k3u1fbpfcp-zoom-1.image)\n\n\u90bb\u63a5\u77e9\u9635\n\n![image-20220820111712349](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/27feafdab86a4fbeb591ab479714379d~tplv-k3u1fbpfcp-zoom-1.image)\n",
    "mtime": "1660966561",
    "original_author": "",
    "original_type": 0,
    "rank_index": 5.73153578,
    "rtime": "1660966500",
    "status": 2,
    "tag_ids": [
      6809641211075231744
    ],
    "title": "\u5927\u6570\u636e\u53ef\u89c6\u5316\u7406\u8bba\u4e0e\u6848\u4f8b\u5206\u6790\uff5c\u9752\u8bad\u8425\u7b14\u8bb0",
    "user_id": "1434234537126808",
    "user_index": 9.177595572754374,
    "verify_status": 1,
    "view_count": 81,
    "visible_level": 0
  },
  {
    "article_id": "7133493064135507976",
    "audit_status": 2,
    "brief_content": "\u643a\u624b\u521b\u4f5c\uff0c\u5171\u540c\u6210\u957f\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 8 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c24\u5929\uff0c\u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5 \u80cc\u666f \u5728\u9879\u76ee\u5f00\u53d1\u4e2d\uff0c\u4e00\u822c\u6587\u4ef6\u5b58\u50a8\u5f88\u5c11\u518d\u4f7f\u7528SFTP\u670d\u52a1\uff0c\u4f46\u662f\u4e5f\u4e0d\u6392\u9664\u5408\u4f5c\u4f19\u4f34\u4f7f\u7528SFTP\u6765\u5b58\u50a8\u9879\u76ee\u4e2d\u7684\u6587",
    "category_id": "6809637769959178254",
    "collect_count": 0,
    "comment_count": 3,
    "content": "",
    "cover_image": "",
    "ctime": "1660895800",
    "digg_count": 11,
    "display_count": 0,
    "draft_id": "7133226321387192350",
    "hot_index": 20,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "---\ntheme: channing-cyan\n---\n\u643a\u624b\u521b\u4f5c\uff0c\u5171\u540c\u6210\u957f\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 8 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c24\u5929\uff0c[\u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5](https://juejin.cn/post/7123120819437322247 \"https://juejin.cn/post/7123120819437322247\")\n\n## \u80cc\u666f\n\n\u5728\u9879\u76ee\u5f00\u53d1\u4e2d\uff0c\u4e00\u822c\u6587\u4ef6\u5b58\u50a8\u5f88\u5c11\u518d\u4f7f\u7528SFTP\u670d\u52a1\uff0c\u4f46\u662f\u4e5f\u4e0d\u6392\u9664\u5408\u4f5c\u4f19\u4f34\u4f7f\u7528SFTP\u6765\u5b58\u50a8\u9879\u76ee\u4e2d\u7684\u6587\u4ef6\u6216\u8005\u901a\u8fc7SFTP\u6765\u5b9e\u73b0\u6587\u4ef6\u6570\u636e\u7684\u4ea4\u4e92\u3002\u6211\u9047\u5230\u7684\u9879\u76ee\u4e2d\uff0c\u5c31\u6709\u94f6\u884c\u548c\u4fdd\u9669\u516c\u53f8\u7b49\u5408\u4f5c\u4f19\u4f34\u901a\u8fc7SFTP\u670d\u52a1\u6765\u5b9e\u73b0\u4e0e\u6211\u4eec\u9879\u76ee\u7684\u6587\u4ef6\u6570\u636e\u7684\u4ea4\u4e92\u3002\n\n\u4e3a\u4e86\u80fd\u591f\u987a\u5229\u5730\u5b8c\u6210\u4e0e\u53cb\u5546\u7684SFTP\u670d\u52a1\u7684\u8fde\u901a\uff0c\u6211\u4eec\u9700\u8981\u5728\u81ea\u5df1\u7684\u9879\u76ee\u4e2d\u5b9e\u73b0\u4e00\u5957SFTP\u5ba2\u6237\u7aef\u5de5\u5177\u3002\u4e00\u822c\u6211\u4eec\u4f1a\u91c7\u7528Jsch\u6765\u5b9e\u73b0SFTP\u5ba2\u6237\u7aef\u3002\n\n## \u4f9d\u8d56\n\n```\n<!--\u6267\u884c\u8fdc\u7a0b\u64cd\u4f5c-->\n<dependency>\n \u00a0 \u00a0<groupId>com.jcraft</groupId>\n \u00a0 \u00a0<artifactId>jsch</artifactId>\n \u00a0 \u00a0<version>0.1.55</version>\n</dependency>\n \u00a0 \u00a0 <!--\u94fe\u63a5\u6c60-->\n<dependency>\n \u00a0 \u00a0<groupId>org.apache.commons</groupId>\n \u00a0 \u00a0<artifactId>commons-pool2</artifactId>\n \u00a0 \u00a0<version>2.11.1</version>\n</dependency>\n```\n\n\u9996\u5148\u6211\u4eec\u4e00\u5b9a\u8981\u5f15\u5165`jsch`\u4f9d\u8d56\uff0c\u8fd9\u4e2a\u662f\u6211\u4eec\u5b9e\u73b0SFTP\u5ba2\u6237\u7aef\u7684\u57fa\u77f3\uff1b\u5176\u6b21\u6211\u4eec\u5f15\u5165\u4e86\u94fe\u63a5\u6c60\u5de5\u5177\uff0c\u4e3a\u4e86\u907f\u514d\u6bcf\u6b21\u6267\u884cSFTP\u547d\u4ee4\u90fd\u8981\u91cd\u65b0\u521b\u5efa\u94fe\u63a5\uff0c\u6211\u4eec\u4f7f\u7528\u6c60\u5316\u7684\u65b9\u5f0f\u4f18\u5316\u4e86\u6bd4\u8f83\u6d88\u8017\u8d44\u6e90\u7684\u521b\u5efa\u64cd\u4f5c\u3002\n\n## \u521b\u5efa\u5de5\u5177\u7c7b\n\n\u4e3a\u4e86\u66f4\u597d\u7684\u4f7f\u7528SFTP\u5de5\u5177\uff0c\u6211\u4eec\u628a`jsch`\u4e2d\u5173\u4e8eSFTP\u7684\u76f8\u5173\u529f\u80fd\u63d0\u70bc\u51fa\u6765\uff0c\u505a\u4e86\u4e00\u6b21\u7b80\u5355\u7684\u5c01\u88c5\uff0c\u505a\u6210\u4e86\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u7684\u5de5\u5177\u7c7b\u3002\n\n\u91cc\u9762\u53ea\u6709\u4e24\u7c7b\u65b9\u6cd5\uff1a\n\n> 1.\u521b\u5efaSession\u4e0e\u5f00\u542fSession\uff1b\n>\n> session\u521b\u5efa\u597d\u540e\uff0c\u8fd8\u4e0d\u80fd\u521b\u5efachannel\uff0c\u9700\u8981\u5f00\u542fsession\u540e\u624d\u80fd\u521b\u5efachannel\uff1b\n>\n> 2.\u521b\u5efachannel\u4e0e\u5f00\u542fchannel\uff1b\n>\n> channel\u4e5f\u662f\u4e00\u6837\uff0c\u521b\u5efa\u597d\u7684channel\u9700\u8981\u5f00\u542f\u540e\u624d\u80fd\u771f\u6b63\u5730\u6267\u884c\u547d\u4ee4\uff1b\n\n```\npublic class JschUtil {\n  /**\n   * \u521b\u5efasession\n   *\n   * @param userName \u00a0 \u00a0 \u00a0 \u7528\u6237\u540d\n   * @param password \u00a0 \u00a0 \u00a0 \u5bc6\u7801\n   * @param host \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u57df\u540d\n   * @param port \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u7aef\u53e3\n   * @param privateKeyFile \u5bc6\u94a5\u6587\u4ef6\n   * @param passphrase \u00a0 \u00a0 \u53e3\u4ee4\n   * @return\n   * @throws AwesomeException\n   */\n  public static Session createSession(String userName, String password, String host, int port, String privateKeyFile, String passphrase) throws AwesomeException {\n    return createSession(new JSch(), userName, password, host, port, privateKeyFile, passphrase);\n  }\n\u200b\n\u200b\n  /**\n   * \u521b\u5efasession\n   *\n   * @param jSch\n   * @param userName \u00a0 \u00a0 \u00a0 \u7528\u6237\u540d\n   * @param password \u00a0 \u00a0 \u00a0 \u5bc6\u7801\n   * @param host \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u57df\u540d\n   * @param port \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u7aef\u53e3\n   * @param privateKeyFile \u5bc6\u94a5\n   * @param passphrase \u00a0 \u00a0 \u53e3\u4ee4\n   * @return\n   * @throws AwesomeException\n   */\n  public static Session createSession(JSch jSch, String userName, String password, String host, int port, String privateKeyFile, String passphrase) throws AwesomeException {\n    try {\n      if (!StringUtils.isEmpty(privateKeyFile)) {\n        // \u4f7f\u7528\u5bc6\u94a5\u9a8c\u8bc1\u65b9\u5f0f\uff0c\u5bc6\u94a5\u53ef\u4ee5\u662f\u6709\u53e3\u4ee4\u7684\u5bc6\u94a5\uff0c\u4e5f\u53ef\u4ee5\u662f\u6ca1\u6709\u53e3\u4ee4\u7684\u5bc6\u94a5\n        if (!StringUtils.isEmpty(passphrase)) {\n          jSch.addIdentity(privateKeyFile, passphrase);\n        } else {\n          jSch.addIdentity(privateKeyFile);\n        }\n      }\n      // \u83b7\u53d6session\n      Session session = jSch.getSession(userName, host, port);\n      if (!StringUtils.isEmpty(password)) {\n        session.setPassword(password);\n      }\n      // \u4e0d\u6821\u9a8c\u57df\u540d\n      session.setConfig(\"StrictHostKeyChecking\", \"no\");\n      return session;\n    } catch (Exception e) {\n      throw new AwesomeException(500, \"create session fail\");\n    }\n  }\n\u200b\n  /**\n   * \u521b\u5efasession\n   *\n   * @param jSch\n   * @param userName \u7528\u6237\u540d\n   * @param password \u5bc6\u7801\n   * @param host \u00a0 \u00a0 \u57df\u540d\n   * @param port \u00a0 \u00a0 \u7aef\u53e3\n   * @return\n   * @throws AwesomeException\n   */\n  public static Session createSession(JSch jSch, String userName, String password, String host, int port) throws AwesomeException {\n    return createSession(jSch, userName, password, host, port, StringUtils.EMPTY, StringUtils.EMPTY);\n  }\n\u200b\n\u200b\n  /**\n   * \u521b\u5efasession\n   *\n   * @param jSch\n   * @param userName \u7528\u6237\u540d\n   * @param host \u00a0 \u00a0 \u57df\u540d\n   * @param port \u00a0 \u00a0 \u7aef\u53e3\n   * @return\n   * @throws AwesomeException\n   */\n  private Session createSession(JSch jSch, String userName, String host, int port) throws AwesomeException {\n    return createSession(jSch, userName, StringUtils.EMPTY, host, port, StringUtils.EMPTY, StringUtils.EMPTY);\n  }\n\u200b\n\u200b\n  /**\n   * \u5f00\u542fsession\u94fe\u63a5\n   *\n   * @param jSch\n   * @param userName \u00a0 \u00a0 \u00a0 \u7528\u6237\u540d\n   * @param password \u00a0 \u00a0 \u00a0 \u5bc6\u7801\n   * @param host \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u57df\u540d\n   * @param port \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u7aef\u53e3\n   * @param privateKeyFile \u5bc6\u94a5\n   * @param passphrase \u00a0 \u00a0 \u53e3\u4ee4\n   * @param timeout \u00a0 \u00a0 \u00a0  \u94fe\u63a5\u8d85\u65f6\u65f6\u95f4\n   * @return\n   * @throws AwesomeException\n   */\n  public static Session openSession(JSch jSch, String userName, String password, String host, int port, String privateKeyFile, String passphrase, int timeout) throws AwesomeException {\n    Session session = createSession(jSch, userName, password, host, port, privateKeyFile, passphrase);\n    try {\n      if (timeout >= 0) {\n        session.connect(timeout);\n      } else {\n        session.connect();\n      }\n      return session;\n    } catch (Exception e) {\n      throw new AwesomeException(500, \"session connect fail\");\n    }\n  }\n\u200b\n  /**\n   * \u5f00\u542fsession\u94fe\u63a5\n   *\n   * @param userName \u00a0 \u00a0 \u00a0 \u7528\u6237\u540d\n   * @param password \u00a0 \u00a0 \u00a0 \u5bc6\u7801\n   * @param host \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u57df\u540d\n   * @param port \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u7aef\u53e3\n   * @param privateKeyFile \u5bc6\u94a5\n   * @param passphrase \u00a0 \u00a0 \u53e3\u4ee4\n   * @param timeout \u00a0 \u00a0 \u00a0  \u94fe\u63a5\u8d85\u65f6\u65f6\u95f4\n   * @return\n   * @throws AwesomeException\n   */\n  public static Session openSession(String userName, String password, String host, int port, String privateKeyFile, String passphrase, int timeout) throws AwesomeException {\n    Session session = createSession(userName, password, host, port, privateKeyFile, passphrase);\n    try {\n      if (timeout >= 0) {\n        session.connect(timeout);\n      } else {\n        session.connect();\n      }\n      return session;\n    } catch (Exception e) {\n      throw new AwesomeException(500, \"session connect fail\");\n    }\n  }\n\u200b\n  /**\n   * \u5f00\u542fsession\u94fe\u63a5\n   *\n   * @param jSch\n   * @param userName \u7528\u6237\u540d\n   * @param password \u5bc6\u7801\n   * @param host \u00a0 \u00a0 \u57df\u540d\n   * @param port \u00a0 \u00a0 \u7aef\u53e3\n   * @param timeout  \u94fe\u63a5\u8d85\u65f6\u65f6\u95f4\n   * @return\n   * @throws AwesomeException\n   */\n  public static Session openSession(JSch jSch, String userName, String password, String host, int port, int timeout) throws AwesomeException {\n    return openSession(jSch, userName, password, host, port, StringUtils.EMPTY, StringUtils.EMPTY, timeout);\n  }\n\u200b\n  /**\n   * \u5f00\u542fsession\u94fe\u63a5\n   *\n   * @param userName \u7528\u6237\u540d\n   * @param password \u5bc6\u7801\n   * @param host \u00a0 \u00a0 \u57df\u540d\n   * @param port \u00a0 \u00a0 \u7aef\u53e3\n   * @param timeout  \u94fe\u63a5\u8d85\u65f6\u65f6\u95f4\n   * @return\n   * @throws AwesomeException\n   */\n  public static Session openSession(String userName, String password, String host, int port, int timeout) throws AwesomeException {\n    return openSession(userName, password, host, port, StringUtils.EMPTY, StringUtils.EMPTY, timeout);\n  }\n\u200b\n  /**\n   * \u5f00\u542fsession\u94fe\u63a5\n   *\n   * @param jSch\n   * @param userName \u7528\u6237\u540d\n   * @param host \u00a0 \u00a0 \u57df\u540d\n   * @param port \u00a0 \u00a0 \u7aef\u53e3\n   * @param timeout  \u94fe\u63a5\u8d85\u65f6\u65f6\u95f4\n   * @return\n   * @throws AwesomeException\n   */\n  public static Session openSession(JSch jSch, String userName, String host, int port, int timeout) throws AwesomeException {\n    return openSession(jSch, userName, StringUtils.EMPTY, host, port, StringUtils.EMPTY, StringUtils.EMPTY, timeout);\n  }\n\u200b\n  /**\n   * \u5f00\u542fsession\u94fe\u63a5\n   *\n   * @param userName \u7528\u6237\u540d\n   * @param host \u00a0 \u00a0 \u57df\u540d\n   * @param port \u00a0 \u00a0 \u7aef\u53e3\n   * @param timeout  \u94fe\u63a5\u8d85\u65f6\u65f6\u95f4\n   * @return\n   * @throws AwesomeException\n   */\n  public static Session openSession(String userName, String host, int port, int timeout) throws AwesomeException {\n    return openSession(userName, StringUtils.EMPTY, host, port, StringUtils.EMPTY, StringUtils.EMPTY, timeout);\n  }\n\u200b\n  /**\n   * \u521b\u5efa\u6307\u5b9a\u901a\u9053\n   *\n   * @param session\n   * @param channelType\n   * @return\n   * @throws AwesomeException\n   */\n  public static Channel createChannel(Session session, ChannelType channelType) throws AwesomeException {\n    try {\n      if (!session.isConnected()) {\n        session.connect();\n      }\n      return session.openChannel(channelType.getValue());\n    } catch (Exception e) {\n      throw new AwesomeException(500, \"open channel fail\");\n    }\n  }\n\u200b\n\u200b\n  /**\n   * \u521b\u5efasftp\u901a\u9053\n   *\n   * @param session\n   * @return\n   * @throws AwesomeException\n   */\n  public static ChannelSftp createSftp(Session session) throws AwesomeException {\n    return (ChannelSftp) createChannel(session, ChannelType.SFTP);\n  }\n\u200b\n  /**\n   * \u521b\u5efashell\u901a\u9053\n   *\n   * @param session\n   * @return\n   * @throws AwesomeException\n   */\n  public static ChannelShell createShell(Session session) throws AwesomeException {\n    return (ChannelShell) createChannel(session, ChannelType.SHELL);\n  }\n\u200b\n  /**\n   * \u5f00\u542f\u901a\u9053\n   *\n   * @param session\n   * @param channelType\n   * @param timeout\n   * @return\n   * @throws AwesomeException\n   */\n  public static Channel openChannel(Session session, ChannelType channelType, int timeout) throws AwesomeException {\n    Channel channel = createChannel(session, channelType);\n    try {\n      if (timeout >= 0) {\n        channel.connect(timeout);\n      } else {\n        channel.connect();\n      }\n      return channel;\n    } catch (Exception e) {\n      throw new AwesomeException(500, \"connect channel fail\");\n    }\n  }\n\u200b\n  /**\n   * \u5f00\u542fsftp\u901a\u9053\n   *\n   * @param session\n   * @param timeout\n   * @return\n   * @throws AwesomeException\n   */\n  public static ChannelSftp openSftpChannel(Session session, int timeout) throws AwesomeException {\n    return (ChannelSftp) openChannel(session, ChannelType.SFTP, timeout);\n  }\n\u200b\n  /**\n   * \u5f00\u542fshell\u901a\u9053\n   *\n   * @param session\n   * @param timeout\n   * @return\n   * @throws AwesomeException\n   */\n  public static ChannelShell openShellChannel(Session session, int timeout) throws AwesomeException {\n    return (ChannelShell) openChannel(session, ChannelType.SHELL, timeout);\n  }\n\u200b\n\u200b\n  enum ChannelType {\n    SESSION(\"session\"),\n    SHELL(\"shell\"),\n    EXEC(\"exec\"),\n    X11(\"x11\"),\n    AGENT_FORWARDING(\"auth-agent@openssh.com\"),\n    DIRECT_TCPIP(\"direct-tcpip\"),\n    FORWARDED_TCPIP(\"forwarded-tcpip\"),\n    SFTP(\"sftp\"),\n    SUBSYSTEM(\"subsystem\");\n\u200b\n    private final String value;\n\u200b\n    ChannelType(String value) {\n      this.value = value;\n    }\n\u200b\n    public String getValue() {\n      return this.value;\n    }\n  }\n}\n```\n\n## SFTP\u94fe\u63a5\u6c60\u5316\n\n\u6211\u4eec\u901a\u8fc7\u5b9e\u73b0`BasePooledObjectFactory`\u7c7b\u6765\u6c60\u5316\u901a\u9053`ChannelSftp`\u3002\u8fd9\u5e76\u4e0d\u662f\u771f\u6b63\u6c60\u5316\u7684\u4ee3\u7801\uff0c\u4e0b\u9762\u7684\u4ee3\u7801\u53ea\u662f\u544a\u77e5\u6c60\u5316\u7ba1\u7406\u5668\u5982\u4f55\u521b\u5efa\u5bf9\u8c61\u548c\u9500\u6bc1\u5bf9\u8c61\u3002\n\n```\nstatic class SftpFactory extends BasePooledObjectFactory<ChannelSftp> implements AutoCloseable {\n\u200b\n    private Session session;\n\u200b\n    private SftpProperties properties;\n\u200b\n \u00a0 \u00a0// \u521d\u59cb\u5316SftpFactory\n \u00a0 \u00a0// \u91cc\u9762\u4e3b\u8981\u662f\u521b\u5efa\u76ee\u6807session\uff0c\u540e\u7eed\u53ef\u7528\u901a\u8fc7\u8fd9\u4e2asession\u4e0d\u65ad\u5730\u521b\u5efaChannelSftp\u3002\n    SftpFactory(SftpProperties properties) throws AwesomeException {\n      this.properties = properties;\n      String username = properties.getUsername();\n      String password = properties.getPassword();\n      String host = properties.getHost();\n      int port = properties.getPort();\n      String privateKeyFile = properties.getPrivateKeyFile();\n      String passphrase = properties.getPassphrase();\n      session = JschUtil.createSession(username, password, host, port, privateKeyFile, passphrase);\n    }\n\u200b\n \u00a0 \u00a0// \u9500\u6bc1\u5bf9\u8c61\uff0c\u4e3b\u8981\u662f\u9500\u6bc1ChannelSftp\n    @Override\n    public void destroyObject(PooledObject<ChannelSftp> p) throws Exception {\n      p.getObject().disconnect();\n    }\n\u200b\n \u00a0 \u00a0// \u521b\u5efa\u5bf9\u8c61ChannelSftp\n    @Override\n    public ChannelSftp create() throws Exception {\n      int timeout = properties.getTimeout();\n      return JschUtil.openSftpChannel(this.session, timeout);\n    }\n\u200b\n \u00a0 \u00a0// \u5305\u88c5\u521b\u5efa\u51fa\u6765\u7684\u5bf9\u8c61\n    @Override\n    public PooledObject<ChannelSftp> wrap(ChannelSftp channelSftp) {\n      return new DefaultPooledObject<>(channelSftp);\n    }\n\u200b\n \u00a0 \u00a0// \u9a8c\u8bc1\u5bf9\u8c61\u662f\u5426\u53ef\u7528\n    @Override\n    public boolean validateObject(PooledObject<ChannelSftp> p) {\n      return p.getObject().isConnected();\n    }\n\u200b\n \u00a0 \u00a0// \u9500\u6bc1\u8d44\u6e90\uff0c\u5173\u95edsession\n    @Override\n    public void close() throws Exception {\n      if (Objects.nonNull(session)) {\n        if (session.isConnected()) {\n          session.disconnect();\n        }\n        session = null;\n      }\n    }\n  }\n```\n\n\u4e3a\u4e86\u5b9e\u73b0\u771f\u6b63\u7684\u6c60\u5316\u64cd\u4f5c\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u4ee5\u4e0b\u4ee3\u7801\uff1a\n\n> 1.\u6211\u4eec\u9700\u8981\u5728SftpClient\u5bf9\u8c61\u4e2d\u521b\u5efa\u4e00\u4e2a`GenericObjectPool`\u5bf9\u8c61\u6c60\uff0c\u8fd9\u4e2a\u624d\u662f\u771f\u6b63\u7684\u6c60\u5b50\uff0c\u5b83\u8d1f\u8d23\u521b\u5efa\u548c\u5b58\u50a8\u6240\u6709\u7684\u5bf9\u8c61\u3002\n>\n> 2.\u6211\u4eec\u8fd8\u9700\u8981\u63d0\u4f9b\u8d44\u6e90\u9500\u6bc1\u7684\u529f\u80fd\uff0c\u4e5f\u5c31\u662f\u5b9e\u73b0`AutoCloseable`\uff0c\u5728\u670d\u52a1\u505c\u6b62\u65f6\uff0c\u9700\u8981\u628a\u76f8\u5173\u7684\u8d44\u6e90\u9500\u6bc1\u3002\n\n```\npublic class SftpClient implements AutoCloseable {\n\u200b\n  private SftpFactory sftpFactory;\n\u200b\n  GenericObjectPool<ChannelSftp> objectPool;\n\u200b\n \u00a0// \u6784\u9020\u65b9\u6cd51\n  public SftpClient(SftpProperties properties, GenericObjectPoolConfig<ChannelSftp> poolConfig) throws AwesomeException {\n    this.sftpFactory = new SftpFactory(properties);\n    objectPool = new GenericObjectPool<>(this.sftpFactory, poolConfig);\n  }\n\u200b\n \u00a0// \u6784\u9020\u65b9\u6cd52\n  public SftpClient(SftpProperties properties) throws AwesomeException {\n    this.sftpFactory = new SftpFactory(properties);\n    SftpProperties.PoolConfig config = properties.getPool();\n \u00a0 \u00a0// \u9ed8\u8ba4\u6c60\u5316\u914d\u7f6e\n    if (Objects.isNull(config)) {\n      objectPool = new GenericObjectPool<>(this.sftpFactory);\n    } else {\n \u00a0 \u00a0 \u00a0// \u81ea\u5b9a\u4e49\u6c60\u5316\u914d\u7f6e\n      GenericObjectPoolConfig<ChannelSftp> poolConfig = new GenericObjectPoolConfig<>();\n      poolConfig.setMaxIdle(config.getMaxIdle());\n      poolConfig.setMaxTotal(config.getMaxTotal());\n      poolConfig.setMinIdle(config.getMinIdle());\n      poolConfig.setTestOnBorrow(config.isTestOnBorrow());\n      poolConfig.setTestOnCreate(config.isTestOnCreate());\n      poolConfig.setTestOnReturn(config.isTestOnReturn());\n      poolConfig.setTestWhileIdle(config.isTestWhileIdle());\n      poolConfig.setBlockWhenExhausted(config.isBlockWhenExhausted());\n      poolConfig.setMaxWait(Duration.ofMillis(config.getMaxWaitMillis()));\n      poolConfig.setTimeBetweenEvictionRuns(Duration.ofMillis(config.getTimeBetweenEvictionRunsMillis()));\n      objectPool = new GenericObjectPool<>(this.sftpFactory, poolConfig);\n    }\n  }\n \u00a0\n \u00a0// \u9500\u6bc1\u8d44\u6e90\n    @Override\n  public void close() throws Exception {\n \u00a0 \u00a0// \u9500\u6bc1\u94fe\u63a5\u6c60\n    if (Objects.nonNull(this.objectPool)) {\n      if (!this.objectPool.isClosed()) {\n        this.objectPool.close();\n      }\n    }\n    this.objectPool = null;\n \u00a0 \u00a0// \u9500\u6bc1sftpFactory\n    if (Objects.nonNull(this.sftpFactory)) {\n      this.sftpFactory.close();\n    }\n  }\n}\n```\n\n## SFTP\u94fe\u63a5\u6c60\u7684\u4f7f\u7528\n\n\u6211\u4eec\u5df2\u7ecf\u5bf9\u94fe\u63a5\u6c60\u8fdb\u884c\u4e86\u521d\u59cb\u5316\uff0c\u4e0b\u9762\u6211\u4eec\u5c31\u53ef\u4ee5\u4ece\u94fe\u63a5\u6c60\u4e2d\u83b7\u53d6\u6211\u4eec\u9700\u8981\u7684`ChannelSftp`\u6765\u5b9e\u73b0\u6587\u4ef6\u7684\u4e0a\u4f20\u4e0b\u8f7d\u4e86\u3002\n\n\u4e0b\u9762\u5b9e\u73b0\u4e86\u591a\u79cd\u6587\u4ef6\u4e0a\u4f20\u548c\u4e0b\u8f7d\u7684\u65b9\u5f0f\uff1a\n\n> 1.\u76f4\u63a5\u628a\u672c\u5730\u6587\u4ef6\u4e0a\u4f20\u5230SFTP\u670d\u52a1\u5668\u7684\u6307\u5b9a\u8def\u5f84\uff1b\n>\n> 2.\u628aInputStream\u8f93\u5165\u6d41\u63d0\u4ea4\u5230SFTP\u670d\u52a1\u5668\u6307\u5b9a\u8def\u5f84\u4e2d\uff1b\n>\n> 3.\u53ef\u4ee5\u9488\u5bf9\u4ee5\u4e0a\u4e24\u79cd\u4e0a\u4f20\u65b9\u5f0f\u8fdb\u884c\u8fdb\u5ea6\u7684\u76d1\u6d4b\uff1b\n>\n> 4.\u628aSFTP\u670d\u52a1\u5668\u4e2d\u7684\u6307\u5b9a\u6587\u4ef6\u4e0b\u8f7d\u5230\u672c\u5730\u673a\u5668\u4e0a\uff1b\n>\n> 5.\u628aSFTP\u670d\u52a1\u5668\u02d9\u4e2d\u7684\u6587\u4ef6\u5199\u5165\u6307\u5b9a\u7684\u8f93\u51fa\u6d41\uff1b\n>\n> 6.\u9488\u5bf9\u4ee5\u4e0a\u4e24\u79cd\u4e0b\u8f7d\u65b9\u5f0f\uff0c\u76d1\u6d4b\u4e0b\u8f7d\u8fdb\u5ea6\uff1b\n\n```\n  /**\n   * \u4e0a\u4f20\u6587\u4ef6\n   *\n   * @param srcFilePath\n   * @param targetDir\n   * @param targetFileName\n   * @return\n   * @throws AwesomeException\n   */\n  public boolean uploadFile(String srcFilePath, String targetDir, String targetFileName) throws AwesomeException {\n    return uploadFile(srcFilePath, targetDir, targetFileName, null);\n  }\n\u200b\n  /**\n   * \u4e0a\u4f20\u6587\u4ef6\n   *\n   * @param srcFilePath\n   * @param targetDir\n   * @param targetFileName\n   * @param monitor\n   * @return\n   * @throws AwesomeException\n   */\n  public boolean uploadFile(String srcFilePath, String targetDir, String targetFileName, SftpProgressMonitor monitor) throws AwesomeException {\n    ChannelSftp channelSftp = null;\n    try {\n \u00a0 \u00a0 \u00a0// \u4ece\u94fe\u63a5\u6c60\u83b7\u53d6\u5bf9\u8c61\n      channelSftp = this.objectPool.borrowObject();\n      // \u5982\u679c\u4e0d\u5b58\u5728\u76ee\u6807\u6587\u4ef6\u5939\n      if (!exist(channelSftp, targetDir)) {\n        mkdirs(channelSftp, targetDir);\n      }\n      channelSftp.cd(targetDir);\n \u00a0 \u00a0 \u00a0// \u4e0a\u4f20\u6587\u4ef6\n      if (Objects.nonNull(monitor)) {\n        channelSftp.put(srcFilePath, targetFileName, monitor);\n      } else {\n        channelSftp.put(srcFilePath, targetFileName);\n      }\n      return true;\n    } catch (Exception e) {\n      throw new AwesomeException(500, \"upload file fail\");\n    } finally {\n      if (Objects.nonNull(channelSftp)) {\n \u00a0 \u00a0 \u00a0 \u00a0// \u8fd4\u8fd8\u5bf9\u8c61\u7ed9\u94fe\u63a5\u6c60\n        this.objectPool.returnObject(channelSftp);\n      }\n    }\n  }\n\u200b\n  /**\n   * \u4e0a\u4f20\u6587\u4ef6\u5230\u76ee\u6807\u6587\u4ef6\u5939\n   *\n   * @param in\n   * @param targetDir\n   * @param targetFileName\n   * @return\n   * @throws AwesomeException\n   */\n  public boolean uploadFile(InputStream in, String targetDir, String targetFileName) throws AwesomeException {\n    return uploadFile(in, targetDir, targetFileName, null);\n  }\n\u200b\n  /**\n   * \u4e0a\u4f20\u6587\u4ef6\uff0c\u6dfb\u52a0\u8fdb\u5ea6\u76d1\u89c6\u5668\n   *\n   * @param in\n   * @param targetDir\n   * @param targetFileName\n   * @param monitor\n   * @return\n   * @throws AwesomeException\n   */\n  public boolean uploadFile(InputStream in, String targetDir, String targetFileName, SftpProgressMonitor monitor) throws AwesomeException {\n    ChannelSftp channelSftp = null;\n    try {\n      channelSftp = this.objectPool.borrowObject();\n      // \u5982\u679c\u4e0d\u5b58\u5728\u76ee\u6807\u6587\u4ef6\u5939\n      if (!exist(channelSftp, targetDir)) {\n        mkdirs(channelSftp, targetDir);\n      }\n      channelSftp.cd(targetDir);\n      if (Objects.nonNull(monitor)) {\n        channelSftp.put(in, targetFileName, monitor);\n      } else {\n        channelSftp.put(in, targetFileName);\n      }\n      return true;\n    } catch (Exception e) {\n      throw new AwesomeException(500, \"upload file fail\");\n    } finally {\n      if (Objects.nonNull(channelSftp)) {\n        this.objectPool.returnObject(channelSftp);\n      }\n    }\n  }\n\u200b\n  /**\n   * \u4e0b\u8f7d\u6587\u4ef6\n   *\n   * @param remoteFile\n   * @param targetFilePath\n   * @return\n   * @throws AwesomeException\n   */\n  public boolean downloadFile(String remoteFile, String targetFilePath) throws AwesomeException {\n    return downloadFile(remoteFile, targetFilePath, null);\n  }\n\u200b\n  /**\n   * \u4e0b\u8f7d\u76ee\u6807\u6587\u4ef6\u5230\u672c\u5730\n   *\n   * @param remoteFile\n   * @param targetFilePath\n   * @return\n   * @throws AwesomeException\n   */\n  public boolean downloadFile(String remoteFile, String targetFilePath, SftpProgressMonitor monitor) throws AwesomeException {\n    ChannelSftp channelSftp = null;\n    try {\n      channelSftp = this.objectPool.borrowObject();\n      // \u5982\u679c\u4e0d\u5b58\u5728\u76ee\u6807\u6587\u4ef6\u5939\n      if (!exist(channelSftp, remoteFile)) {\n        // \u4e0d\u7528\u4e0b\u8f7d\u4e86\n        return false;\n      }\n      File targetFile = new File(targetFilePath);\n      try (FileOutputStream outputStream = new FileOutputStream(targetFile)) {\n        if (Objects.nonNull(monitor)) {\n          channelSftp.get(remoteFile, outputStream, monitor);\n        } else {\n          channelSftp.get(remoteFile, outputStream);\n        }\n      }\n      return true;\n    } catch (Exception e) {\n      throw new AwesomeException(500, \"upload file fail\");\n    } finally {\n      if (Objects.nonNull(channelSftp)) {\n        this.objectPool.returnObject(channelSftp);\n      }\n    }\n  }\n\u200b\n  /**\n   * \u4e0b\u8f7d\u6587\u4ef6\n   *\n   * @param remoteFile\n   * @param outputStream\n   * @return\n   * @throws AwesomeException\n   */\n  public boolean downloadFile(String remoteFile, OutputStream outputStream) throws AwesomeException {\n    return downloadFile(remoteFile, outputStream, null);\n  }\n\u200b\n  /**\n   * \u4e0b\u8f7d\u6587\u4ef6\n   *\n   * @param remoteFile\n   * @param outputStream\n   * @param monitor\n   * @return\n   * @throws AwesomeException\n   */\n  public boolean downloadFile(String remoteFile, OutputStream outputStream, SftpProgressMonitor monitor) throws AwesomeException {\n    ChannelSftp channelSftp = null;\n    try {\n      channelSftp = this.objectPool.borrowObject();\n      // \u5982\u679c\u4e0d\u5b58\u5728\u76ee\u6807\u6587\u4ef6\u5939\n      if (!exist(channelSftp, remoteFile)) {\n        // \u4e0d\u7528\u4e0b\u8f7d\u4e86\n        return false;\n      }\n      if (Objects.nonNull(monitor)) {\n        channelSftp.get(remoteFile, outputStream, monitor);\n      } else {\n        channelSftp.get(remoteFile, outputStream);\n      }\n      return true;\n    } catch (Exception e) {\n      throw new AwesomeException(500, \"upload file fail\");\n    } finally {\n      if (Objects.nonNull(channelSftp)) {\n        this.objectPool.returnObject(channelSftp);\n      }\n    }\n  }\n\u200b\n  /**\n   * \u521b\u5efa\u6587\u4ef6\u5939\n   *\n   * @param channelSftp\n   * @param dir\n   * @return\n   */\n  protected boolean mkdirs(ChannelSftp channelSftp, String dir) {\n    try {\n      String pwd = channelSftp.pwd();\n      if (StringUtils.contains(pwd, dir)) {\n        return true;\n      }\n      String relativePath = StringUtils.substringAfter(dir, pwd);\n      String[] dirs = StringUtils.splitByWholeSeparatorPreserveAllTokens(relativePath, \"/\");\n      for (String path : dirs) {\n        if (StringUtils.isBlank(path)) {\n          continue;\n        }\n        try {\n          channelSftp.cd(path);\n        } catch (SftpException e) {\n          channelSftp.mkdir(path);\n          channelSftp.cd(path);\n        }\n      }\n      return true;\n    } catch (Exception e) {\n      return false;\n    }\n  }\n\u200b\n  /**\n   * \u5224\u65ad\u6587\u4ef6\u5939\u662f\u5426\u5b58\u5728\n   *\n   * @param channelSftp\n   * @param dir\n   * @return\n   */\n  protected boolean exist(ChannelSftp channelSftp, String dir) {\n    try {\n      channelSftp.lstat(dir);\n      return true;\n    } catch (Exception e) {\n      return false;\n    }\n  }\n```\n\n## \u96c6\u6210\u5230SpringBoot\u4e2d\n\n\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7`java config`\u7684\u65b9\u5f0f\uff0c\u628a\u6211\u4eec\u5df2\u7ecf\u5b9e\u73b0\u597d\u7684`SftpClient`\u7c7b\u5b9e\u4f8b\u5316\u5230`Spring IOC`\u5bb9\u5668\u4e2d\u6765\u7ba1\u7406\uff0c\u4ee5\u4fbf\u8ba9\u5f00\u53d1\u4eba\u5458\u5728\u6574\u4e2a\u9879\u76ee\u4e2d\u901a\u8fc7`@Autowired`\u7684\u65b9\u5f0f\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u3002\n\n-   \u914d\u7f6e\n\n    ```\n    \u200b\n    import lombok.Data;\n    import org.springframework.boot.context.properties.ConfigurationProperties;\n    import org.springframework.context.annotation.Configuration;\n    \u200b\n    /**\n     * @author zouwei\n     * @className SftpProperties\n     * @date: 2022/8/19 \u4e0b\u534812:12\n     * @description:\n     */\n    @Data\n    @Configuration\n    @ConfigurationProperties(prefix = \"sftp.config\")\n    public class SftpProperties {\n      // \u7528\u6237\u540d\n      private String username;\n      // \u5bc6\u7801\n      private String password;\n      // \u4e3b\u673a\u540d\n      private String host;\n      // \u7aef\u53e3\n      private int port;\n      // \u5bc6\u94a5\n      private String privateKeyFile;\n      // \u53e3\u4ee4\n      private String passphrase;\n      // \u901a\u9053\u94fe\u63a5\u8d85\u65f6\u65f6\u95f4\n      private int timeout;\n    \u200b\n      // \u94fe\u63a5\u6c60\u914d\u7f6e\n      private PoolConfig pool;\n    \u200b\n      @Data\n      public static class PoolConfig {\n        //\u6700\u5927\u7a7a\u95f2\u5b9e\u4f8b\u6570\uff0c\u7a7a\u95f2\u8d85\u8fc7\u6b64\u503c\u5c06\u4f1a\u88ab\u9500\u6bc1\u6dd8\u6c70\n        private int maxIdle;\n        // \u6700\u5c0f\u7a7a\u95f2\u5b9e\u4f8b\u6570\uff0c\u5bf9\u8c61\u6c60\u5c06\u81f3\u5c11\u4fdd\u75592\u4e2a\u7a7a\u95f2\u5bf9\u8c61\n        private int minIdle;\n        //\u6700\u5927\u5bf9\u8c61\u6570\u91cf\uff0c\u5305\u542b\u501f\u51fa\u53bb\u7684\u548c\u7a7a\u95f2\u7684\n        private int maxTotal;\n        //\u5bf9\u8c61\u6c60\u6ee1\u4e86\uff0c\u662f\u5426\u963b\u585e\u83b7\u53d6\uff08false\u5219\u501f\u4e0d\u5230\u76f4\u63a5\u629b\u5f02\u5e38\uff09\n        private boolean blockWhenExhausted;\n        // BlockWhenExhausted\u4e3atrue\u65f6\u751f\u6548\uff0c\u5bf9\u8c61\u6c60\u6ee1\u4e86\u963b\u585e\u83b7\u53d6\u8d85\u65f6\uff0c\u4e0d\u8bbe\u7f6e\u5219\u963b\u585e\u83b7\u53d6\u4e0d\u8d85\u65f6\uff0c\u4e5f\u53ef\u5728borrowObject\u65b9\u6cd5\u4f20\u9012\u7b2c\u4e8c\u4e2a\u53c2\u6570\u6307\u5b9a\u672c\u6b21\u7684\u8d85\u65f6\u65f6\u95f4\n        private long maxWaitMillis;\n        // \u521b\u5efa\u5bf9\u8c61\u540e\u662f\u5426\u9a8c\u8bc1\u5bf9\u8c61\uff0c\u8c03\u7528objectFactory#validateObject\n        private boolean testOnCreate;\n        // \u501f\u7528\u5bf9\u8c61\u540e\u662f\u5426\u9a8c\u8bc1\u5bf9\u8c61 validateObject\n        private boolean testOnBorrow;\n        // \u5f52\u8fd8\u5bf9\u8c61\u540e\u662f\u5426\u9a8c\u8bc1\u5bf9\u8c61 validateObject\n        private boolean testOnReturn;\n        // \u5b9a\u65f6\u68c0\u67e5\u671f\u95f4\u662f\u5426\u9a8c\u8bc1\u5bf9\u8c61 validateObject\n        private boolean testWhileIdle;\n        //\u5b9a\u65f6\u68c0\u67e5\u6dd8\u6c70\u591a\u4f59\u7684\u5bf9\u8c61, \u542f\u7528\u5355\u72ec\u7684\u7ebf\u7a0b\u5904\u7406\n        private long timeBetweenEvictionRunsMillis;\n        //jmx\u76d1\u63a7\uff0c\u548cspringboot\u81ea\u5e26\u7684jmx\u51b2\u7a81\uff0c\u53ef\u4ee5\u9009\u62e9\u5173\u95ed\u6b64\u914d\u7f6e\u6216\u5173\u95edspringboot\u7684jmx\u914d\u7f6e\n        private boolean jmxEnabled;\n      }\n    }\n    \u200b\n    \u200b\n    ```\n\n<!---->\n\n-   java Bean\u6ce8\u5165\n\n    ```\n    import com.example.awesomespring.exception.AwesomeException;\n    import com.example.awesomespring.sftp.SftpClient;\n    import org.springframework.beans.factory.annotation.Autowired;\n    import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n    import org.springframework.context.annotation.Bean;\n    import org.springframework.context.annotation.Configuration;\n    \u200b\n    /**\n     * @author zouwei\n     * @className SftpConfig\n     * @date: 2022/8/19 \u4e0b\u534812:12\n     * @description:\n     */\n    @Configuration\n    public class SftpConfig {\n    \u200b\n      @Autowired\n      private SftpProperties properties;\n    \u200b\n     \u00a0// \u521b\u5efaSftpClient\u5bf9\u8c61\n      @Bean(destroyMethod = \"close\")\n      @ConditionalOnProperty(prefix = \"sftp.config\")\n      public SftpClient sftpClient() throws AwesomeException {\n        return new SftpClient(properties);\n      }\n    }\n    ```\n\n    \u901a\u8fc7\u4ee5\u4e0a\u4ee3\u7801\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u9879\u76ee\u7684\u4efb\u4f55\u5730\u65b9\u76f4\u63a5\u4f7f\u7528SFTP\u5ba2\u6237\u7aef\u6765\u4e0a\u4f20\u548c\u4e0b\u8f7d\u6587\u4ef6\u4e86\u3002\n",
    "mtime": "1660966016",
    "original_author": "",
    "original_type": 0,
    "rank_index": 11.94899135,
    "rtime": "1660966016",
    "status": 2,
    "tag_ids": [
      6809640408797167616,
      6809641037787561984
    ],
    "title": "\u624b\u628a\u624b\u6559\u4f60SpringBoot\u96c6\u6210SFTP\u5ba2\u6237\u7aef\u5b9e\u73b0\u6587\u4ef6\u4e0a\u4f20\u4e0b\u8f7d",
    "user_id": "4103831109771406",
    "user_index": 7.900311393078482,
    "verify_status": 1,
    "view_count": 139,
    "visible_level": 0
  },
  {
    "article_id": "7133790853532745741",
    "audit_status": 2,
    "brief_content": "\u643a\u624b\u521b\u4f5c\uff0c\u5171\u540c\u6210\u957f\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 8 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c25\u5929\uff0c\u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5 \u9898\u76ee\u63cf\u8ff0 \u8fd9\u662f LeetCode \u4e0a\u7684 654. \u6700\u5927\u4e8c\u53c9\u6811 \uff0c\u96be\u5ea6\u4e3a \u4e2d\u7b49\u3002 Tag : \u300c\u4e8c\u53c9\u6811\u300d\u3001",
    "category_id": "6809637769959178254",
    "collect_count": 0,
    "comment_count": 0,
    "content": "",
    "cover_image": "https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/35b22395480e43b391aaff28adf3a479~tplv-k3u1fbpfcp-watermark.image?",
    "ctime": "1660965183",
    "digg_count": 1,
    "display_count": 0,
    "draft_id": "7133790776705843237",
    "hot_index": 7,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "\u643a\u624b\u521b\u4f5c\uff0c\u5171\u540c\u6210\u957f\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 8 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c25\u5929\uff0c[\u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5](https://juejin.cn/post/7123120819437322247 \"https://juejin.cn/post/7123120819437322247\")\n\n## \u9898\u76ee\u63cf\u8ff0\n\n\u8fd9\u662f LeetCode \u4e0a\u7684 **[654. \u6700\u5927\u4e8c\u53c9\u6811](https://leetcode.cn/problems/maximum-binary-tree/solution/by-ac_oier-s0wc/)** \uff0c\u96be\u5ea6\u4e3a **\u4e2d\u7b49**\u3002\n\nTag : \u300c\u4e8c\u53c9\u6811\u300d\u3001\u300c\u9012\u5f52\u300d\u3001\u300c\u5206\u6cbb\u300d\u3001\u300c\u7ebf\u6bb5\u6811\u300d\u3001\u300c\u5355\u8c03\u6808\u300d\n\n\n\n\u7ed9\u5b9a\u4e00\u4e2a\u4e0d\u91cd\u590d\u7684\u6574\u6570\u6570\u7ec4\u00a0`nums`\u3002\u00a0\u6700\u5927\u4e8c\u53c9\u6811\u00a0\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u7b97\u6cd5\u4ece\u00a0`nums` \u9012\u5f52\u5730\u6784\u5efa:\n\n1. \u521b\u5efa\u4e00\u4e2a\u6839\u8282\u70b9\uff0c\u5176\u503c\u4e3a\u00a0`nums` \u4e2d\u7684\u6700\u5927\u503c\u3002\n2. \u9012\u5f52\u5730\u5728\u6700\u5927\u503c\u00a0\u5de6\u8fb9\u00a0\u7684\u00a0\u5b50\u6570\u7ec4\u524d\u7f00\u4e0a\u00a0\u6784\u5efa\u5de6\u5b50\u6811\u3002\n3. \u9012\u5f52\u5730\u5728\u6700\u5927\u503c \u53f3\u8fb9 \u7684\u00a0\u5b50\u6570\u7ec4\u540e\u7f00\u4e0a\u00a0\u6784\u5efa\u53f3\u5b50\u6811\u3002\n\n\u8fd4\u56de\u00a0`nums` \u6784\u5efa\u7684\u6700\u5927\u4e8c\u53c9\u6811\u3002\n\n\u793a\u4f8b 1\uff1a\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1283dd18290543f2978258b83749b3da~tplv-k3u1fbpfcp-zoom-1.image)\n```\n\u8f93\u5165\uff1anums = [3,2,1,6,0,5]\n\n\u8f93\u51fa\uff1a[6,3,5,null,2,0,null,null,1]\n\n\u89e3\u91ca\uff1a\u9012\u5f52\u8c03\u7528\u5982\u4e0b\u6240\u793a\uff1a\n- [3,2,1,6,0,5] \u4e2d\u7684\u6700\u5927\u503c\u662f 6 \uff0c\u5de6\u8fb9\u90e8\u5206\u662f [3,2,1] \uff0c\u53f3\u8fb9\u90e8\u5206\u662f [0,5] \u3002\n    - [3,2,1] \u4e2d\u7684\u6700\u5927\u503c\u662f 3 \uff0c\u5de6\u8fb9\u90e8\u5206\u662f [] \uff0c\u53f3\u8fb9\u90e8\u5206\u662f [2,1] \u3002\n        - \u7a7a\u6570\u7ec4\uff0c\u65e0\u5b50\u8282\u70b9\u3002\n        - [2,1] \u4e2d\u7684\u6700\u5927\u503c\u662f 2 \uff0c\u5de6\u8fb9\u90e8\u5206\u662f [] \uff0c\u53f3\u8fb9\u90e8\u5206\u662f [1] \u3002\n            - \u7a7a\u6570\u7ec4\uff0c\u65e0\u5b50\u8282\u70b9\u3002\n            - \u53ea\u6709\u4e00\u4e2a\u5143\u7d20\uff0c\u6240\u4ee5\u5b50\u8282\u70b9\u662f\u4e00\u4e2a\u503c\u4e3a 1 \u7684\u8282\u70b9\u3002\n    - [0,5] \u4e2d\u7684\u6700\u5927\u503c\u662f 5 \uff0c\u5de6\u8fb9\u90e8\u5206\u662f [0] \uff0c\u53f3\u8fb9\u90e8\u5206\u662f [] \u3002\n        - \u53ea\u6709\u4e00\u4e2a\u5143\u7d20\uff0c\u6240\u4ee5\u5b50\u8282\u70b9\u662f\u4e00\u4e2a\u503c\u4e3a 0 \u7684\u8282\u70b9\u3002\n        - \u7a7a\u6570\u7ec4\uff0c\u65e0\u5b50\u8282\u70b9\u3002\n```\n\u793a\u4f8b 2\uff1a\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f7ee8431242a48a9b219837ce6104b4e~tplv-k3u1fbpfcp-zoom-1.image)\n```\n\u8f93\u5165\uff1anums = [3,2,1]\n\n\u8f93\u51fa\uff1a[3,null,2,null,1]\n```\n\n\u63d0\u793a\uff1a\n* $1 <= nums.length <= 1000$\n* $0 <= nums[i] <= 1000$\n* `nums` \u4e2d\u7684\u6240\u6709\u6574\u6570 \u4e92\u4e0d\u76f8\u540c\n\n## \u57fa\u672c\u5206\u6790\n\n\u6839\u636e\u9898\u76ee\u63cf\u8ff0\uff0c\u53ef\u77e5\u8be5\u95ee\u9898\u672c\u8d28\u662f\u300c\u533a\u95f4\u6c42\u6700\u503c\u300d\u95ee\u9898\uff08RMQ\uff09\u3002\n\n\u800c\u6c42\u89e3 RMQ \u6709\u591a\u79cd\u65b9\u5f0f\uff1a\u9012\u5f52\u5206\u6cbb\u3001\u6709\u5e8f\u96c6\u5408/ST/\u7ebf\u6bb5\u6811 \u548c \u5355\u8c03\u6808\u3002\n\n\u5176\u4e2d\u9012\u5f52\u5206\u6cbb\u505a\u6cd5\u590d\u6742\u5ea6\u4e3a $O(n^2)$\uff0c\u5bf9\u672c\u9898\u6765\u8bf4\u53ef\u8fc7\uff1b\u800c\u5176\u4f59\u8bf8\u5982\u7ebf\u6bb5\u6811\u7684\u65b9\u5f0f\u9700\u8981 $O(n\\log{n})$ \u7684\u5efa\u6811\u548c\u5355\u6b21 $O(\\log{n})$ \u7684\u67e5\u8be2\uff0c\u6574\u4f53\u590d\u6742\u5ea6\u4e3a $O(n\\log{n})$\uff1b\u5355\u8c03\u6808\u89e3\u6cd5\u5219\u662f\u6574\u4f53\u590d\u6742\u5ea6\u4e3a $O(n)$\u3002\n\n## \u9012\u5f52\u5206\u6cbb\n\n\u8bbe\u7f6e\u9012\u5f52\u51fd\u6570 `TreeNode build(int[] nums, int l, int r)` \u542b\u4e49\u4e3a\u4ece `nums` \u4e2d\u7684 $[l, r]$ \u4e0b\u6807\u8303\u56f4\u8fdb\u884c\u6784\u5efa\uff0c\u8fd4\u56de\u6784\u5efa\u540e\u7684\u5934\u7ed3\u70b9\u3002\n\n\u5f53 $l > r$ \u65f6\uff0c\u8fd4\u56de\u7a7a\u8282\u70b9\uff0c\u5426\u5219\u5728 $[l, r]$ \u4e2d\u8fdb\u884c\u626b\u63cf\uff0c\u627e\u5230\u6700\u5927\u503c\u5bf9\u5e94\u7684\u4e0b\u6807 `idx` \u5e76\u521b\u5efa\u5bf9\u5e94\u7684\u5934\u7ed3\u70b9\uff0c\u9012\u5f52\u6784\u5efa $[l, idx - 1]$ \u548c $[idx + 1, r]$ \u4f5c\u4e3a\u5934\u8282\u70b9\u7684\u5de6\u53f3\u5b50\u6811\u3002\n\nJava \u4ee3\u7801\uff1a\n```Java\nclass Solution {\n    public TreeNode constructMaximumBinaryTree(int[] nums) {\n        return build(nums, 0, nums.length - 1);\n    }\n    TreeNode build(int[] nums, int l, int r) {\n        if (l > r) return null;\n        int idx = l;\n        for (int i = l; i <= r; i++) {\n            if (nums[i] > nums[idx]) idx = i;\n        }\n        TreeNode ans = new TreeNode(nums[idx]);\n        ans.left = build(nums, l, idx - 1);\n        ans.right = build(nums, idx + 1, r);\n        return ans;\n    }\n}\n```\nTypeScript \u4ee3\u7801\uff1a\n```TypeScript\nfunction constructMaximumBinaryTree(nums: number[]): TreeNode | null {\n    return build(nums, 0, nums.length - 1)\n};\nfunction build(nums: number[], l: number, r: number): TreeNode | null {\n    if (l > r) return null\n    let idx = l\n    for (let i = l; i <= r; i++) {\n        if (nums[i] > nums[idx]) idx = i\n    }\n    const ans = new TreeNode(nums[idx])\n    ans.left = build(nums, l, idx - 1)\n    ans.right = build(nums, idx + 1, r)\n    return ans\n}\n```\n* \u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n^2)$\n* \u7a7a\u95f4\u590d\u6742\u5ea6\uff1a\u5ffd\u7565\u9012\u5f52\u5e26\u6765\u7684\u989d\u5916\u7a7a\u95f4\u5f00\u9500\uff0c\u590d\u6742\u5ea6\u4e3a $O(1)$\n\n## \u7ebf\u6bb5\u6811 \n\n\u62bd\u8c61\u6210\u533a\u95f4\u6c42\u548c\u95ee\u9898\u540e\uff0c\u6d89\u53ca\u300c\u5355\u70b9\u4fee\u6539\u300d\u548c\u300c\u533a\u95f4\u67e5\u8be2\u300d\uff0c\u518d\u7ed3\u5408\u8282\u70b9\u6570\u91cf\u4e3a $1e3$\uff0c\u53ef\u4f7f\u7528 `build` $4n$ \u7a7a\u95f4\u4e0d\u5e26\u61d2\u6807\u8bb0\u7684\u7ebf\u6bb5\u6811\u8fdb\u884c\u6c42\u89e3\u3002\n\n\u8bbe\u8ba1\u7ebf\u6bb5\u6811\u8282\u70b9 `Node` \u5305\u542b\u5c5e\u6027\uff1a\u5de6\u8282\u70b9\u4e0b\u6807 `l`\u3001\u53f3\u8282\u70b9\u4e0b\u6807 `r` \u548c\u5f53\u524d\u533a\u95f4 $[l, r]$ \u6240\u5bf9\u5e94\u7684\u6700\u503c $val$\u3002\n\n\u6784\u5efa\u7ebf\u6bb5\u6811\u7684\u8fc7\u7a0b\u4e3a\u57fa\u672c\u7684\u7ebf\u6bb5\u6811\u6a21\u677f\u5185\u5bb9\uff0c\u800c\u6784\u5efa\u7b54\u6848\u6811\u7684\u8fc7\u7a0b\u4e0e\u9012\u5f52\u5206\u6cbb\u8fc7\u7a0b\u7c7b\u578b\uff08\u5c06\u7ebf\u6027\u627e\u6700\u503c\u8fc7\u7a0b\u7528\u7ebf\u6bb5\u6811\u4f18\u5316\uff09\u3002\n\nJava \u4ee3\u7801\uff1a\n```Java\nclass Solution {\n    class Node {\n        int l, r, val;\n        Node (int _l, int _r) {\n            l = _l; r = _r;\n        }\n    }\n    void build(int u, int l, int r) {\n        tr[u] = new Node(l, r);\n        if (l == r) return ;\n        int mid = l + r >> 1;\n        build(u << 1, l, mid);\n        build(u << 1 | 1, mid + 1, r);\n    }\n    void update(int u, int x, int v) {\n        if (tr[u].l == x && tr[u].r == x) {\n            tr[u].val = Math.max(tr[u].val, v);\n            return ;\n        }\n        int mid = tr[u].l + tr[u].r >> 1;\n        if (x <= mid) update(u << 1, x, v);\n        else update(u << 1 | 1, x, v);\n        pushup(u);\n    }\n    int query(int u, int l, int r) {\n        if (l <= tr[u].l && tr[u].r <= r) return tr[u].val;\n        int mid = tr[u].l + tr[u].r >> 1, ans = 0;\n        if (l <= mid) ans = query(u << 1, l, r);\n        if (r > mid) ans = Math.max(ans, query(u << 1 | 1, l, r));\n        return ans;\n    }\n    void pushup(int u) {\n        tr[u].val = Math.max(tr[u << 1].val, tr[u << 1 | 1].val);\n    }\n    Node[] tr = new Node[4010];\n    int[] hash = new int[1010];\n    public TreeNode constructMaximumBinaryTree(int[] nums) {\n        int n = nums.length;\n        build(1, 1, n);\n        for (int i = 0; i < n; i++) {\n            hash[nums[i]] = i + 1;\n            update(1, i + 1, nums[i]);\n        }\n        return dfs(nums, 1, n);\n    }\n    TreeNode dfs(int[] nums, int l, int r) {\n        if (l > r) return null;\n        int val = query(1, l, r), idx = hash[val];\n        TreeNode ans = new TreeNode(val);\n        ans.left = dfs(nums, l, idx - 1);\n        ans.right = dfs(nums, idx + 1, r);\n        return ans;\n    }\n}\n```\nTypeScript \u4ee3\u7801\uff1a\n```TypeScript\nclass TNode {\n    l = 0; r = 0; val = 0;\n    constructor (_l: number, _r: number) {\n        this.l = _l; this.r = _r;\n    }\n}\nconst tr: TNode[] = new Array<TNode>(4010)\nconst hash: number[] = new Array<number>(1010)\nfunction constructMaximumBinaryTree(nums: number[]): TreeNode | null {\n    const n = nums.length\n    build(1, 1, n)\n    for (let i = 0; i < n; i++) {\n        hash[nums[i]] = i + 1\n        update(1, i + 1, nums[i])\n    }\n    return dfs(nums, 1, n)\n};\nfunction build(u: number, l: number, r: number): void {\n    tr[u] = new TNode(l, r)\n    if (l == r) return \n    const mid = l + r >> 1\n    build(u << 1, l, mid)\n    build(u << 1 | 1, mid + 1, r)\n}\nfunction update(u: number, x: number, v: number): void {\n    if (tr[u].l == x && tr[u].r == x) {\n        tr[u].val = Math.max(tr[u].val, v)\n        return \n    }\n    const mid = tr[u].l + tr[u].r >> 1\n    if (x <= mid) update(u << 1, x, v)\n    else update(u << 1 | 1, x, v)\n    pushup(u)\n}\nfunction query(u: number, l: number, r: number): number {\n    if (l <= tr[u].l && tr[u].r <= r) return tr[u].val\n    let mid = tr[u].l + tr[u].r >> 1, ans = 0\n    if (l <= mid) ans = query(u << 1, l, r)\n    if (r > mid) ans = Math.max(ans, query(u << 1 | 1, l, r))\n    return ans\n}\nfunction pushup(u: number): void {\n    tr[u].val = Math.max(tr[u << 1].val, tr[u << 1 | 1].val)\n}\nfunction dfs(nums: number[], l: number, r: number): TreeNode {\n    if (l > r) return null\n    let val = query(1, l, r), idx = hash[val]\n    const ans = new TreeNode(val)\n    ans.left = dfs(nums, l, idx - 1)\n    ans.right = dfs(nums, idx + 1, r)\n    return ans\n}\n\n```\n* \u65f6\u95f4\u590d\u6742\u5ea6\uff1a\u6784\u5efa\u7ebf\u6bb5\u6811\u590d\u6742\u5ea6\u4e3a $O(n\\log{n})$\uff1b\u6784\u9020\u7b54\u6848\u6811\u590d\u6742\u5ea6\u4e3a $O(n\\log{n})$\u3002\u6574\u4f53\u590d\u6742\u5ea6\u4e3a $O(n\\log{n})$\n* \u7a7a\u95f4\u590d\u6742\u5ea6\uff1a$O(n)$\n\n## \u5355\u8c03\u6808\n\n\u66f4\u8fdb\u4e00\u6b65\uff0c\u6839\u636e\u9898\u76ee\u5bf9\u6811\u7684\u6784\u5efa\u7684\u63cf\u8ff0\u53ef\u77e5\uff0c`nums` \u4e2d\u7684\u4efb\u4e8c\u8282\u70b9\u6240\u5728\u6784\u5efa\u6811\u7684\u6c34\u5e73\u622a\u9762\u4e0a\u7684\u4f4d\u7f6e\u4ec5\u7531\u4e0b\u6807\u5927\u5c0f\u51b3\u5b9a\u3002\n\n\u4e0d\u96be\u60f3\u5230\u53ef\u62bd\u8c61\u4e3a\u627e\u6700\u8fd1\u5143\u7d20\u95ee\u9898\uff0c\u53ef\u4f7f\u7528\u5355\u8c03\u6808\u6c42\u89e3\u3002\n\n\u5177\u4f53\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u4ece\u524d\u5f80\u540e\u5904\u7406\u6240\u6709\u7684 $nums[i]$\uff0c\u82e5\u5b58\u5728\u6808\u9876\u5143\u7d20\u5e76\u4e14\u6808\u9876\u5143\u7d20\u7684\u503c\u6bd4\u5f53\u524d\u503c\u8981\u5c0f\uff0c\u6839\u636e\u6211\u4eec\u4ece\u524d\u5f80\u540e\u5904\u7406\u7684\u903b\u8f91\uff0c\u53ef\u786e\u5b9a\u6808\u9876\u5143\u7d20\u53ef\u4f5c\u4e3a\u5f53\u524d $nums[i]$ \u5bf9\u5e94\u8282\u70b9\u7684\u5de6\u8282\u70b9\uff0c\u540c\u65f6\u4e3a\u4e86\u786e\u4fdd\u6700\u7ec8 $nums[i]$ \u7684\u5de6\u8282\u70b9\u4e3a $[0, i - 1]$ \u8303\u56f4\u7684\u6700\u5927\u503c\uff0c\u6211\u4eec\u9700\u8981\u786e\u4fdd\u5728\u6784\u5efa $nums[i]$ \u8282\u70b9\u4e0e\u5176\u5de6\u8282\u70b9\u7684\u5173\u7cfb\u65f6\uff0c$[0, i - 1]$ \u4e2d\u7684\u6700\u5927\u503c\u6700\u540e\u51fa\u961f\uff0c\u6b64\u65f6\u53ef\u77e5\u5bb9\u5668\u6808\u5177\u6709\u300c\u5355\u8c03\u9012\u51cf\u300d\u7279\u6027\u3002\u57fa\u4e8e\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u5206\u6790\u51fa\uff0c\u5f53\u5904\u7406\u5b8c $nums[i]$ \u8282\u70b9\u4e0e\u5176\u5de6\u8282\u70b9\u5173\u7cfb\u540e\uff0c\u53ef\u660e\u786e $nums[i]$ \u53ef\u4f5c\u4e3a\u672a\u51fa\u6808\u7684\u6808\u9876\u5143\u7d20\u7684\u53f3\u8282\u70b9\u3002\n\n> \u4e00\u4e9b\u7ec6\u8282\uff1a`Java` \u5bb9\u6613\u4f7f\u7528 `ArrayDeque` \u5145\u5f53\u5bb9\u5668\uff0c\u4f46\u4e3a\u4e0e `TS` \u4fdd\u5b58\u4e00\u81f4\uff0c\u4e24\u8005\u5747\u4f7f\u7528\u6570\u7ec4\u5145\u5f53\u5bb9\u5668\u3002\n\nJava \u4ee3\u7801\uff1a\n```Java\nclass Solution {\n    static TreeNode[] stk = new TreeNode[1010];\n    public TreeNode constructMaximumBinaryTree(int[] nums) {\n        int he = 0, ta = 0;\n        for (int x : nums) {\n            TreeNode node = new TreeNode(x);\n            while (he < ta && stk[ta - 1].val < x) node.left = stk[--ta];\n            if (he < ta) stk[ta - 1].right = node;\n            stk[ta++] = node;\n        }\n        return stk[0];\n    }\n}\n```\nTypeScript \u4ee3\u7801\uff1a\n```TypeScript\nconst stk = new Array<TreeNode>(1010)\nfunction constructMaximumBinaryTree(nums: number[]): TreeNode | null {\n    let he = 0, ta = 0\n    for (const x of nums) {\n        const node = new TreeNode(x)\n        while (he < ta && stk[ta - 1].val < x) node.left = stk[--ta]\n        if (he < ta) stk[ta - 1].right = node\n        stk[ta++] = node\n    }\n    return stk[0]\n};\n```\n* \u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n)$\n* \u7a7a\u95f4\u590d\u6742\u5ea6\uff1a$O(n)$\n\n## \u6700\u540e\n\n\u8fd9\u662f\u6211\u4eec\u300c\u5237\u7a7f LeetCode\u300d\u7cfb\u5217\u6587\u7ae0\u7684\u7b2c `No.654` \u7bc7\uff0c\u7cfb\u5217\u5f00\u59cb\u4e8e 2021/01/01\uff0c\u622a\u6b62\u4e8e\u8d77\u59cb\u65e5 LeetCode \u4e0a\u5171\u6709 1916 \u9053\u9898\u76ee\uff0c\u90e8\u5206\u662f\u6709\u9501\u9898\uff0c\u6211\u4eec\u5c06\u5148\u628a\u6240\u6709\u4e0d\u5e26\u9501\u7684\u9898\u76ee\u5237\u5b8c\u3002\n\n\u5728\u8fd9\u4e2a\u7cfb\u5217\u6587\u7ae0\u91cc\u9762\uff0c\u9664\u4e86\u8bb2\u89e3\u89e3\u9898\u601d\u8def\u4ee5\u5916\uff0c\u8fd8\u4f1a\u5c3d\u53ef\u80fd\u7ed9\u51fa\u6700\u4e3a\u7b80\u6d01\u7684\u4ee3\u7801\u3002\u5982\u679c\u6d89\u53ca\u901a\u89e3\u8fd8\u4f1a\u76f8\u5e94\u7684\u4ee3\u7801\u6a21\u677f\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\u5404\u4f4d\u540c\u5b66\u80fd\u591f\u7535\u8111\u4e0a\u8fdb\u884c\u8c03\u8bd5\u548c\u63d0\u4ea4\u4ee3\u7801\uff0c\u6211\u5efa\u7acb\u4e86\u76f8\u5173\u7684\u4ed3\u5e93\uff1ahttps://github.com/SharingSource/LogicStack-LeetCode \u3002\n\n\u5728\u4ed3\u5e93\u5730\u5740\u91cc\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u7cfb\u5217\u6587\u7ae0\u7684\u9898\u89e3\u94fe\u63a5\u3001\u7cfb\u5217\u6587\u7ae0\u7684\u76f8\u5e94\u4ee3\u7801\u3001LeetCode \u539f\u9898\u94fe\u63a5\u548c\u5176\u4ed6\u4f18\u9009\u9898\u89e3\u3002\n\n\u66f4\u591a\u66f4\u5168\u66f4\u70ed\u95e8\u7684\u300c\u7b14\u8bd5/\u9762\u8bd5\u300d\u76f8\u5173\u8d44\u6599\u53ef\u8bbf\u95ee\u6392\u7248\u7cbe\u7f8e\u7684 [\u5408\u96c6\u65b0\u57fa\u5730](https://www.acoier.com/archives/) \ud83c\udf89\ud83c\udf89\n",
    "mtime": "1660965905",
    "original_author": "",
    "original_type": 0,
    "rank_index": 6.51452873,
    "rtime": "1660965904",
    "status": 2,
    "tag_ids": [
      6809640408797167616,
      6809640445233070080,
      6809640499062767616
    ],
    "title": "\u6c42\u89e3 RMQ \u7684\u51e0\u79cd\u65b9\u5f0f :\u300c\u9012\u5f52\u5206\u6cbb\u300d&\u300c\u7ebf\u6bb5\u6811\u300d&\u300c\u5355\u8c03\u6808\u300d",
    "user_id": "2612095355996743",
    "user_index": 8.532308782457594,
    "verify_status": 1,
    "view_count": 125,
    "visible_level": 0
  },
  {
    "article_id": "7133787358033346567",
    "audit_status": 2,
    "brief_content": "\u524d\u8a00 \u6700\u8fd1\u5199\u4e00\u4e2a puppeteer \u722c\u866b\u5de5\u5177\uff0c\u9700\u8981\u7ecf\u5e38\u3010ssh \u767b\u9646 - \u8f93\u5165\u5bc6\u7801 -- \u6267\u884c shell - \u670d\u52a1\u5668\u67e5\u770b\u65e5\u5fd7\u3011\uff0c\u8fd9\u4e2a\u7b80\u5355\u7684\u52a8\u4f5c\u5728\u91cd\u590d\u4e86\u65e0\u6570\u904d\u540e\u53d8\u5f97\u4e0d\u53ef\u5fcd\u53d7\uff0c\u7a0b\u5e8f\u5458\u6700\u5927\u7684\u5929\u654c\u662f\u65e0\u610f\u4e49",
    "category_id": "6809637767543259144",
    "collect_count": 0,
    "comment_count": 0,
    "content": "",
    "cover_image": "https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9598b53bac024f60a110f9f9264613d8~tplv-k3u1fbpfcp-watermark.image?",
    "ctime": "1660964387",
    "digg_count": 0,
    "display_count": 0,
    "draft_id": "7133785837136773150",
    "hot_index": 7,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "---\ntheme: cyanosis\nhighlight: atom-one-dark\n---\n\n\n> \u738b\u5fd7\u8fdc\uff0c\u5fae\u533b\u524d\u7aef\u6280\u672f\u90e8\n\n## \u524d\u8a00\n\n\u6700\u8fd1\u5199\u4e00\u4e2a puppeteer \u722c\u866b\u5de5\u5177\uff0c\u9700\u8981\u7ecf\u5e38\u3010ssh \u767b\u9646 - \u8f93\u5165\u5bc6\u7801 -- \u6267\u884c shell - \u670d\u52a1\u5668\u67e5\u770b\u65e5\u5fd7\u3011\uff0c\u8fd9\u4e2a\u7b80\u5355\u7684\u52a8\u4f5c\u5728\u91cd\u590d\u4e86\u65e0\u6570\u904d\u540e\u53d8\u5f97\u4e0d\u53ef\u5fcd\u53d7\uff0c\u7a0b\u5e8f\u5458\u6700\u5927\u7684\u5929\u654c\u662f\u65e0\u610f\u4e49\u7684\u91cd\u590d\uff0c\u4e8e\u662f\u6709\u4e86\u5982\u4e0b\u6f14\u53d8\n\n-   \u8f93\u5165\u5bc6\u7801\uff1a\u91c7\u7528 ssh \u914d\u7f6e\u5b9e\u73b0\u514d\u5bc6\u767b\u9646\n-   \u767b\u9646\u670d\u52a1\u5668\uff1avscode \u63d2\u4ef6 Remote-SSH\n-   shell \u8c03\u8bd5\uff1aShell-format, shellman \u63d2\u4ef6\n\n\u9664\u4e86\u6838\u5fc3\u6d41\u7a0b\u5916\uff0c\u8fd8\u6709\u4e9b\u5229\u7528 shell \u81ea\u52a8\u5316\u7684\u5c0f\u4f18\u5316\uff0c\u6bd4\u5982\u3010\u91c7\u7528 ssh \u914d\u7f6e\u5b9e\u73b0\u514d\u5bc6\u767b\u9646\u3011\uff0c\u52a8\u4f5c\u7e41\u7410\u56fa\u5316\uff0c\u91c7\u7528 shell \u811a\u672c\u53bb\u5b9e\u73b0\u5c31\u53d8\u5f97\u901a\u7528\u5feb\u6377\u4e86\u8d77\u6765\uff08puppeteer \u662f\u6d4f\u89c8\u5668\u884c\u4e3a\u7684\u81ea\u52a8\u5316\u3001\u811a\u672c\u662f\u547d\u4ee4\u884c\u4e3a\u7684\u81ea\u52a8\u5316\uff0c\u6211\u53ef\u592a\u7231\u81ea\u52a8\u5316\u4e86\uff09\u3002\n\n\u5e9f\u8bdd\u5c11\u8bf4\uff0c\u8ba9\u6211\u4eec\u5f00\u59cb\u5427\u3002\n\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1aad1e7b2942451999648150d0b0d4d2~tplv-k3u1fbpfcp-zoom-1.image)\n\n## \u672c\u6587\u76ee\u6807\n\n0.  \u514d\u5bc6\u767b\u9646\uff1a\u53ea\u9700\u8981`sh \u522b\u540d`\uff0c\u65e0\u9700\u8f93\u5165\u5bc6\u7801\u5c31\u80fd\u591f\u505a\u5230\u514d\u5bc6\u767b\u9646\uff0c\u89e3\u51b3\u672c\u5730\u767b\u9646\u8f93\u5bc6\u7801\u7e41\u7410\u95ee\u9898\uff0c\n0.  shell \u811a\u672c\u81ea\u52a8\u5316\u914d\u7f6e\uff1a`.ssh/config`+shell \u811a\u672c\u5b9e\u73b0\u8fdc\u7aef\u670d\u52a1\u5668\u7684\u7ba1\u7406\uff0c\u89e3\u51b3\u591a\u670d\u52a1\u5668\u7ba1\u7406\u95ee\u9898\n0.  \u81ea\u5b9e\u73b0 vscode \u63d2\u4ef6 weiyi-tools \u652f\u6301\u56fe\u5f62\u5316\u7ba1\u7406\u6267\u884c\u811a\u672c\u529f\u80fd\u63a8\u8350\uff1a\u89e3\u51b3\u6267\u884c\u3001\u7ba1\u7406 shell \u811a\u672c\u9ebb\u70e6\u95ee\u9898\n0.  vscode \u795e\u5668 Remote-SSH \u63a8\u8350\u53ca\u4f7f\u7528\u6307\u5357\n\n![bfd01186db5e7514349f9b7146cdb437](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/05b104e018c44b2590a61afcb63988f9~tplv-k3u1fbpfcp-zoom-1.image)\n\n## \u8f93\u5165\u5bc6\u7801\uff1a\u91c7\u7528 ssh \u914d\u7f6e\u5b9e\u73b0\u514d\u5bc6\u767b\u9646\n\n\u5bc6\u7801\u5176\u5b9e\u5c31\u662f\u4e2a\u8ba4\u8bc1\u624b\u6bb5\uff0c\u800c\u5982\u679c\u6211\u4eec\u8ba4\u5b9a\u67d0\u7528\u6237\uff08\u7535\u8111\uff09\u4e00\u5b9a\u53ef\u4fe1\u4efb\uff0c\u5c31\u4e0d\u7528\u8ba4\u8bc1\u4e86\uff0c\u90a3\u7528\u6237\u8be5\u600e\u4e48\u81ea\u8bc1\u8eab\u4efd\u5462\uff1fssh \u516c\u79c1\u94a5\uff0c\u672c\u6587\u4f1a\u5b9e\u73b0\u5982\u4f55\u914d\u7f6e ssh \u516c\u79c1\u94a5\u4ece\u800c\u8fbe\u5230\u514d\u5bc6\u767b\u9646\u7684\u76ee\u7684\n\n### \u8fbe\u5230\u7684\u6548\u679c\n\n\u53ea\u9700\u8981`sh \u522b\u540d`\uff0c\u65e0\u9700\u8f93\u5165\u5bc6\u7801\u5c31\u80fd\u591f\u505a\u5230\u514d\u5bc6\u767b\u9646\u3002\n\n![2022-08-20 09.16.05](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/277c43c9831448f2bf88af4c441ba240~tplv-k3u1fbpfcp-zoom-1.image)\n\n\u8ba9\u6211\u4eec\u6765\u5b9e\u73b0\u53ed\uff01\n\n### \u6b65\u9aa4\u4e00\uff1a\u83b7\u53d6\u672c\u673a\u5bf9\u5e94\u516c\u94a5\n\n\u5982\u679c\u5df2\u7ecf\u6709\u4e86\uff0c\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u83b7\u53d6\n\n```\ncat ~/.ssh/id_rsa.pub\n```\n\n\u5982\u679c\u63d0\u793a\u6ca1\u6709\uff0c\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u521b\u5efa\uff0c\u4e00\u76f4\u56de\u8f66\u5c31\u597d\n\n```\nssh-keygen -t rsa\n```\n\n### \u6b65\u9aa4\u4e8c\uff1a\u5c06\u516c\u94a5\u590d\u5236\u5230\u4e91\u670d\u52a1\u5668\u4e0a\n\n\u8fd9\u91cc\u6211\u4eec\u6709\u4e24\u4e2a\u65b9\u6848\uff0c\u4efb\u9009\u4e00\u4e2a\u5c31\u597d\n\n-   ssh-copy-id \u672c\u5730\u76f4\u63a5\u4f20\u8f93\uff08\u63a8\u8350\uff09\n-   \u4e91\u670d\u52a1\u5668\u64cd\u4f5c\u540e\u53f0\u914d\u7f6e\uff08\u4ee5\u817e\u8baf\u4e91\u4e3a\u4f8b\uff09\n\n##### \u672c\u5730\u76f4\u63a5\u4f20\u8f93\n\n\u6267\u884c\u547d\u4ee4`ssh-copy-id`\uff0c\u672c\u8d28\u4e0a\u5176\u5b9e\u5c31\u662f\u5c06\u672c\u673a\u7684\u516c\u94a5\u590d\u5236\u5230\u8fdc\u7a0b\u673a\u5668\u7684`~/.ssh/authorized_keys`\u6587\u4ef6\u4e2d\n\n```\nssh-copy-id -i id_rsa.pub -p 22 root@[ip]\n```\n\n![image-20211108094235963](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e958dd70996947b2a32c5180391ad2e7~tplv-k3u1fbpfcp-zoom-1.image)\n\n##### \u4e91\u670d\u52a1\u5668\u64cd\u4f5c\u540e\u53f0\u914d\u7f6e\n\n\u767b\u5f55\u817e\u8baf\u4e91\u670d\u52a1\u5668\u7ba1\u7406\u53f0\uff0c\u540d\u79f0\u4efb\u610f\u586b\u5199\n\n![img](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/58ebb744442a4659b8b009affdb16b34~tplv-k3u1fbpfcp-zoom-1.image)\n\n\u7136\u540e\u8fdb\u884c\u7ed1\u5b9a\u5373\u53ef\n\n![image-20220425164919543](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5993267325914136a17f5a6b790450d9~tplv-k3u1fbpfcp-zoom-1.image)\n\n\u6b64\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u505a\u5230\u76f4\u63a5\u6267\u884c`ssh root@[ip`\u76f4\u63a5\u514d\u5bc6\u767b\u9646\u4e86\uff0c\u4f46\u6211\u4eec\u4e0d\u5e0c\u671b\u8bb0\u5fc6\u4e00\u5806 ip\uff0c\u5e0c\u671b\u76f4\u63a5\u8f93\u5165\u522b\u540d\u5c31\u53ef\u4ee5\u767b\u9646\uff0c\u90a3\u5c31\u53ef\u4ee5\u7ee7\u7eed\u4e0b\u9762\u7684\u64cd\u4f5c\uff0c\u66f4\u6539\u914d\u7f6e\u6587\u4ef6\uff0c\u8bbe\u7f6e\u8fdc\u7a0b\u670d\u52a1\u5668\u522b\u540d\n\n### \u6b65\u9aa4\u4e09\uff1a\u672c\u5730 SSH \u8bbe\u7f6e\u8fdc\u7a0b\u670d\u52a1\u5668\u522b\u540d\n\n0.  ##### \u8bbe\u7f6e\u8fdc\u7a0b\u670d\u52a1\u5668\u522b\u540d\n\n\u6267\u884c\u4e0b\u9762\u547d\u4ee4\u8fdb\u884c\u66f4\u6539\u5bf9\u5e94\u6587\u4ef6\n\n```\nvi ~/.ssh/config\n```\n\n\u8f93\u5165\u5982\u4e0b\u5185\u5bb9 \uff0c\u8bb0\u5f97\u66f4\u6539\u81ea\u5b9a\u4e49\u90e8\u5206\n\n```\nHost [\u522b\u540d]\nHostName [ip]\nPort 22\nUser root\nIdentityFile ~/.ssh/id_rsa\n```\n\n2.  ##### \u8bbe\u7f6e\u81ea\u52a8 passphrase\n\n\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u5b9e\u73b0\u5c06\u4e13\u7528\u5bc6\u94a5\u6dfb\u52a0\u5230[ssh-agent](http://man.linuxde.net/ssh-agent)\u7684\u9ad8\u901f\u7f13\u5b58\u4e2d\n\n```\nssh-add\n```\n\n##### shell \u81ea\u52a8\u5316\n\n\u8fd9\u4e9b\u52a8\u4f5c\u5f88\u56fa\u5316\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528 shell \u8fdb\u884c\u5b9e\u73b0\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u518d\u5bf9\u7740\u6587\u6863\u4e00\u6b65\u6b65\u8d70\u4e86\uff0c\u800c\u662f\u53ef\u4ee5\u76f4\u63a5\u6267\u884c\u5b8c\u6210\u3002\n\n\u65b0\u5efa\u5982\u4e0b\u811a\u672c\u6587\u4ef6\uff0c\u7136\u540e\u6267\u884c\u547d\u4ee4\u5373\u53ef\n\n```\n sudo chmod 777 ./ && sh ./ssh-noAuth-local.sh [\u522b\u540d] [ip]\n```\n\n\u811a\u672c\u5185\u5bb9\u5982\u4e0b\n\n```\n#!/bin/sh\n# \u672c\u5730 SSH \u8bbe\u7f6e\u8fdc\u7a0b\u670d\u52a1\u5668\u522b\u540d\n# \u4f7f\u7528\u65b9\u6cd5\uff1ash ./ssh-noAuth-local.sh [\u522b\u540d] [ip]\n# \u793a\u4f8b\uff1ash ./ssh-noAuth-local.sh fq 124.223.43.155\nhost=$1\nip=$2\ncat >> ~/.ssh/config << EOF\nHost ${host}\n  HostName ${ip}\n  Port 22\n  User root\n  IdentityFile ~/.ssh/id_rsa\nEOF\n\u200b\ncd ~/.ssh\nssh-copy-id -i id_rsa.pub -p 22 root@${ip} << EOF\nLfq12345\nEOF\n# \u8bbe\u7f6e\u81ea\u52a8 passphrase\nssh-add\n```\n\n**\u65b0\u5f00\u4e2a\u7ec8\u7aef**\uff0c\u518d\u8bd5\u8bd5\u5427\uff01\n\n\u8fd9\u4e2a\u3010\u65b0\u5efa\u6587\u4ef6 - \u6267\u884c\u3011\u7684\u52a8\u4f5c\u4e5f\u5f88\u9ebb\u70e6\uff0c\u800c\u4e14\u6bcf\u6b21\u7528\u7684\u65f6\u5019\u8fd8\u5f97\u81ea\u5df1\u627e\uff0c\u5b89\u5229\u4e0b\u672c\u4eba\u7684 vscode \u63d2\u4ef6\u3010weiyi-tools\u3011\uff0c\u5176\u4e2d\u6709\u4e2a\u547d\u4ee4\u3010shell\u3011\uff0c\u4f1a\u5f39\u51fa\u8981\u6267\u884c\u7684 sh \u547d\u4ee4\uff0c\u70b9\u51fb\u5373\u4f1a\u6267\u884c\uff1b\u63a8\u8350\u7406\u7531\u5982\u4e0b\n\n0.  \u7701\u65f6\u7701\u529b\uff1a\u4e0d\u9700\u8981\u81ea\u5df1\u521b\u5efa\u3001\u4fdd\u7ba1\u811a\u672c\u5566\n0.  \u66f4\u591a\u5de5\u5177\uff1a\u6240\u6709\u7684\u4e2a\u4eba\u63d0\u6548\u811a\u672c\u90fd\u4f1a\u653e\u5728\u8fd9\u4e2a\u5de5\u5177\u91cc\uff0c\u4ee5\u56fe\u5f62\u754c\u9762\u5f62\u5f0f\u652f\u6301\u4f7f\u7528\n0.  \u6269\u5c55\u6027\uff1a\u652f\u6301\u4e0a\u4f20\u81ea\u5df1\u7684 shell \u811a\u672c\uff08\u8be6\u89c1 readme\n\n## \u767b\u9646\u670d\u52a1\u5668\uff1avscode \u63d2\u4ef6 Remote-SSH\n\n\u7ecf\u8fc7 ssh \u514d\u5bc6\u767b\u9646\u914d\u7f6e\uff0c\u6211\u4eec\u767b\u9646\u53d8\u5f97\u5f88\u4fbf\u6377\u4e86\uff0c\u4f46\u770b\u7740\u8fd9\u4e2a\u5c0f\u7a97\u53e3\uff0c\u9f20\u6807\u53d8\u5f97\u7d22\u7136\u65e0\u5473\uff0c\u8fd8\u662f\u5f88\u4e0d\u4e60\u60ef\u3002\u67e5\u770b\u4e2a\u65e5\u5fd7\u90fd\u5f97\u5148\u5207\u76ee\u5f55\u3001\u518d cat\u3002\u7279\u522b\u662f\u722c\u866b\u9879\u76ee\uff0c\u51fa\u95ee\u9898\u7684\u60c5\u51b5\u592a\u591a\u4e86\uff0c\u767b\u9646\u6001\u5931\u6548\u3001\u7f51\u7edc\u6545\u969c\u3001\u88ab\u5899\u7b49\u7b49\u7b49\uff0c\u7a0b\u5e8f\u4e2d\u65ad\u5f02\u5e38\u65f6\u5019\uff0c\u65e5\u5fd7\u5c31\u6210\u4e86\u6700\u5173\u952e\u7684\u4e1c\u897f\u3002\u67e5\u770b\u65e5\u5fd7\u7684\u7e41\u7410\u5374\u8ba9\u6211\u5fc3\u70e6\u3002\n\n\u4e8e\u662f\u60f3\uff0c\u6211\u80fd\u4e0d\u80fd\u641e\u4e2a\u672c\u5730 shell \u5462\uff1f\u3010\u5229\u7528 vscode \u63d2\u4ef6\u7684 node \u80fd\u529b\uff0c\u901a\u8fc7 scp \u5b9e\u65f6\u6293\u53d6\u6307\u5b9a\u670d\u52a1\u5668\u8def\u5f84\u4e0a\u7684\u65e5\u5fd7\uff0c\u653e\u5728\u672c\u5730\u5c55\u793a\u3011\uff0c\u7406\u8bba\u4e0a\u662f\u8d70\u5f97\u901a\u7684\uff1b\u6b63\u5f53\u6211\u60f3\u5f00\u641e\u4e4b\u65f6\uff0c\u8033\u65c1\u60f3\u8d77\u4e86\u6211\u7684\u540c\u684c\u5927\u4f6c\u5e38\u5e38\u561f\u56d4\u7684\u4e00\u53e5\u8bdd\n\n\u201c\u4f60\u60f3\u505a\u7684\uff0c\u57fa\u672c\u4e0a\u90fd\u6709\u4eba\u505a\u4e86\uff0c\u5148\u627e\u73b0\u6210\uff0c\u518d\u5b9a\u5236\uff1b\u4e0d\u8981\u65e0\u610f\u4e49\u9020\u8f6e\u5b50\u201d\u3002\n\n\u9042\u53bb\u7f51\u4e0a\u67e5\u627e\uff0c\u679c\u7136\uff0cvscode \u63d2\u4ef6 Remote-SSH\uff0c\u53ef\u592a\u5f3a\u5927\u4e86\n\n0.  \u652f\u6301\u65e0\u4ee3\u7801\u5f0f\u6dfb\u52a0 ssh \u914d\u7f6e\n0.  \u652f\u6301\u8fdc\u7a0b\u8fde\u63a5\u670d\u52a1\u5668\u5e76\u5728\u672c\u5730 vscode \u4e2d\u4ee5\u6587\u4ef6\u5939\u5f62\u5f0f\u51fa\u73b0\uff08\u5c31\u548c\u672c\u5730\u6253\u5f00\u4e2a\u6587\u4ef6\u5939\u4e00\u6837\uff0c\u67e5\u770b\u65e5\u5fd7\u4e0d\u5728\u8bdd\u4e0b\uff09\n0.  \u652f\u6301\u672c\u5730\u548c\u8fdc\u7aef\u76f4\u63a5\u4f20\u8f93\n0.  \u914d\u7f6e\u7279\u5b9a\u63d2\u4ef6\uff0c\u53ef\u4ee5\u652f\u6301 shell \u811a\u672c\u8c03\u8bd5\u3001\u667a\u80fd\u63d0\u9192\n\n\u8fd9\u4e2a\u53ef\u592a\u5f3a\u5927\u4e86\uff0c\u6240\u4ee5\u6211\u81ea\u5df1\u53bb\u5199\u7684\u60f3\u6cd5\u98de\u5230\u4e86\u4e5d\u9704\u4e91\u5916\u3002\u56e0\u6b64\u672c\u90e8\u5206\u5185\u5bb9\u53ea\u5206\u4eab\u5982\u4f55\u4f7f\u7528\u8fd9\u4e2a\u5de5\u5177\n\n\u4ecb\u7ecd\u5b8c\u6bd5\uff0c\u5f00\u5de5\uff01\n\n### \u8fbe\u5230\u7684\u6548\u679c\n\n\u56fe\u5f62\u5316\u754c\u9762\u8fde\u63a5\u8fdc\u7aef\u670d\u52a1\u5668\uff0c\u4ee5\u64cd\u4f5c\u672c\u5730\u6587\u4ef6\u7684\u5f62\u5f0f\u64cd\u4f5c\u8fdc\u7aef\u670d\u52a1\u5668\u7684\u6587\u4ef6\u5185\u5bb9\n\n![2022-08-20 10.33.46](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8d1649ade35d45a08e4ecdfb2d6fb843~tplv-k3u1fbpfcp-zoom-1.image)\n\n### \u6b65\u9aa4\u4e00\uff1a\u5b89\u88c5\u6240\u9700 vscode \u63d2\u4ef6\n\n0.  \u5b89\u88c5 Remote-SSH \u63d2\u4ef6\uff1a\u5b89\u88c5\u5b8c\u6210\u4f1a\u51fa\u73b0 SSH explore\n0.  \u5b89\u88c5 Shell-format, shellman \u63d2\u4ef6\uff1a\u65b9\u4fbf shell \u7f16\u5199\u662f\u667a\u80fd\u63d0\u793a\n0.  \u5b89\u88c5 Code Runner \u63d2\u4ef6\uff1a\u53f3\u51fb\u53ef\u4ee5\u5b9e\u65f6\u8fd0\u884c shell \u811a\u672c\n\n### \u6b65\u9aa4\u4e8c\uff1a\u8fde\u63a5\u8fdc\u7a0b\u670d\u52a1\u5668\n\n-   `cmd+shift+p` \u641c\u7d22\u3010remote-ssh\u3011 ![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e6db04542a0c4134af09a9d9e6e3ec5a~tplv-k3u1fbpfcp-zoom-1.image)\n-   \u9009\u62e9\u914d\u7f6e\u6587\u4ef6\uff1a\u8fd9\u91cc\u6211\u4eec\u9009\u62e9\u3010~/.ssh/config\u3011\uff0c\u5982\u679c\u6309\u4e0a\u6587\u5df2\u7ecf\u914d\u7f6e\u597d\u4e86 config\uff0c\u8fd9\u91cc\u76f4\u63a5\u5bfc\u5165\u5c31\u6709\u9009\u62e9\u9879\u4e86\n-   \u8fde\u63a5\u670d\u52a1\u5668\uff1a\u70b9\u51fb\u9009\u62e9\u9879\uff0c\u4f1a\u81ea\u52a8\u5b8c\u6210\u8fde\u63a5\n\n## \u5c3e\u58f0\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u5c31\u5b8c\u6210\u672c\u6587\u76ee\u6807\u5566~\n\n![1651cbfd336d45bb12a38491cc85061d](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5da939b61f7a411897795d97d328dfe7~tplv-k3u1fbpfcp-zoom-1.image)\n\n## \u53c2\u8003\u6587\u6863\n\n-   SSH \u7684 config \u914d\u7f6e\u4e4b\u591a\u8d26\u53f7\u7b80\u5355\u7ba1\u7406\uff1a<https://jingwei.link/2018/12/15/ssh-config-multi-app-manager.html>\n-   [ssh \u7684\u7528\u6237\u914d\u7f6e\u6587\u4ef6 config \u7ba1\u7406 ssh \u4f1a\u8bdd](https://www.cnblogs.com/zhonghuasong/p/7236989.html)\n-   [\u5982\u4f55\u4f18\u96c5\u7684\u7ba1\u7406\u4f60\u7684 SSH \u8fde\u63a5](https://segmentfault.com/a/1190000021165296)\n-   VScode \u8fdc\u7a0b\u5f00\u53d1 shell \u8fdc\u7a0b\u7f16\u5199\u8c03\u8bd5\uff1a<https://blog.csdn.net/u010953692/article/details/103324732>",
    "mtime": "1660964592",
    "original_author": "",
    "original_type": 0,
    "rank_index": 5.40365083,
    "rtime": "1660964591",
    "status": 2,
    "tag_ids": [
      6809640837895585792,
      6809641057333018624
    ],
    "title": "\u8fdc\u7aef\u670d\u52a1\u5668\u4e8c\u4e09\u4e8b | \u514d\u5bc6\u767b\u9646 + vscode\u56fe\u5f62\u5316\u7ba1\u7406\u8fdc\u7aef\u670d\u52a1\u5668",
    "user_id": "3368559357463416",
    "user_index": 9.098776835383294,
    "verify_status": 1,
    "view_count": 158,
    "visible_level": 0
  },
  {
    "article_id": "7133785987141861383",
    "audit_status": 2,
    "brief_content": "\u53d1\u73b0\u5f53\u524d\u5b89\u88c5\u7684Werkzeug\u7248\u672c\u4e3a1.0.1\uff0c\u4e8e\u662f\u7ffb\u9605werkzeug\u7684\u5b98\u65b9\u6587\u6863 \u9996\u5148\u53d1\u73b0\u4e86\u8fd9\u6bb5\u8bdd\uff1a Some modules that already issued deprecation war",
    "category_id": "6809637769959178254",
    "collect_count": 0,
    "comment_count": 0,
    "content": "",
    "cover_image": "https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a13ece70bceb4493a81743f812d707f5~tplv-k3u1fbpfcp-watermark.image?",
    "ctime": "1660963990",
    "digg_count": 0,
    "display_count": 0,
    "draft_id": "7133785046019899423",
    "hot_index": 7,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a779b9c1c404b31a71cdf5b2a3ce2ef~tplv-k3u1fbpfcp-zoom-1.image)\\\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/21652c08f8fd4afa8e0a8bc3f963e5e3~tplv-k3u1fbpfcp-zoom-1.image)\n\n\n\u53d1\u73b0\u5f53\u524d\u5b89\u88c5\u7684Werkzeug\u7248\u672c\u4e3a1.0.1\uff0c\u4e8e\u662f\u7ffb\u9605werkzeug\u7684\u5b98\u65b9\u6587\u6863\n\n\u9996\u5148\u53d1\u73b0\u4e86\u8fd9\u6bb5\u8bdd\uff1a\n\n> The contrib modules are deprecated and will either be moved into werkzeug core or removed completely in version 1.0.\nSome modules that already issued deprecation warnings have been removed.\nBe sure to run or test your code with python -W default::DeprecationWarning to catch any deprecated code you\u2019re using. (#4)\n\n\u610f\u601d\u662f\uff1a werkzeug.contrib\u5df2\u7ecf\u57281.0\u7248\u672c\u88ab\u79fb\u9664\u4e86\uff01\n\n```python\npip3 uninstall Werkzeug    # will uninstall earlier version\npip3 install Werkzeug==0.11.15  -i http://pypi.douban.com/simple --trusted-host pypi.douban.com \n```",
    "mtime": "1660966846",
    "original_author": "",
    "original_type": 0,
    "rank_index": 4.04586908,
    "rtime": "1660964240",
    "status": 2,
    "tag_ids": [
      6809640448827588608
    ],
    "title": "ModuleNotFoundError: No module named \u2018werkzeug.contrib\u2018 \u89e3\u51b3\u65b9\u6cd5",
    "user_id": "1390236459600743",
    "user_index": 5.717266903797437,
    "verify_status": 1,
    "view_count": 166,
    "visible_level": 0
  },
  {
    "article_id": "7133785574062129183",
    "audit_status": 2,
    "brief_content": "\u643a\u624b\u521b\u4f5c\uff0c\u5171\u540c\u6210\u957f\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 8 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c21\u5929\uff0c\u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5 initLifecycle \u751f\u547d\u5468\u671f\u521d\u59cb\u5316 \u5728 new Vue \u8fc7\u7a0b \u4e00\u8282\u4e2d\uff0c\u8bb2\u5230 Vue \u5b9e\u4f8b\u5728\u521d\u59cb\u5316",
    "category_id": "6809637767543259144",
    "collect_count": 0,
    "comment_count": 0,
    "content": "",
    "cover_image": "https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7abcd7014cf24d22a5f38579cbacff44~tplv-k3u1fbpfcp-watermark.image?",
    "ctime": "1660963912",
    "digg_count": 2,
    "display_count": 0,
    "draft_id": "7132735287293116424",
    "hot_index": 10,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "---\ntheme: scrolls-light\nhighlight: a11y-dark\n---\n\n\u643a\u624b\u521b\u4f5c\uff0c\u5171\u540c\u6210\u957f\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 8 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c21\u5929\uff0c[\u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5](https://juejin.cn/post/7123120819437322247)\n\n## initLifecycle \u751f\u547d\u5468\u671f\u521d\u59cb\u5316\n\n\u5728 **new Vue \u8fc7\u7a0b** \u4e00\u8282\u4e2d\uff0c\u8bb2\u5230 Vue \u5b9e\u4f8b\u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u4f1a\u6267\u884c **_init()** \u65b9\u6cd5\u3002\u5176\u4e2d\u9996\u5148\u662f\u6267\u884c\u914d\u7f6e\u7684\u6807\u51c6\u5316\u4e0e\u914d\u7f6e\u5408\u5e76 **MergeOptions**\n\n\u5728\u914d\u7f6e\u5408\u5e76\u5b8c\u6210\u4e4b\u540e\uff0c\u5c31\u4f1a\u8c03\u7528 **initLifecycle(vm)** \u6765\u8fdb\u884c\u5b9e\u4f8b\u58f0\u660e\u5468\u671f\u7684\u521d\u59cb\u5316\u4e86\u3002\n\n**initLifecycle** \u65b9\u6cd5\u7684\u4ee3\u7801\u4e0e\u5b9a\u4e49 Vue \u6784\u9020\u51fd\u6570\u65f6\u5019\u4f7f\u7528\u7684 **lifecycleMixin** \u65b9\u6cd5\u5728\u540c\u4e00\u4e2a\u6587\u4ef6\u4e0b\uff0c\u4f4d\u4e8e src/core/instance/lifecycle.ts\n\n```typescript\nexport function initLifecycle(vm: Component) {\n  const options = vm.$options\n  \n  let parent = options.parent\n  if (parent && !options.abstract) {\n    while (parent.$options.abstract && parent.$parent) {\n      parent = parent.$parent\n    }\n    parent.$children.push(vm)\n  }\n\n  vm.$parent = parent\n  vm.$root = parent ? parent.$root : vm\n\n  vm.$children = []\n  vm.$refs = {}\n\n  vm._provided = parent ? parent._provided : Object.create(null)\n  vm._watcher = null\n  vm._inactive = null\n  vm._directInactive = false\n  vm._isMounted = false\n  vm._isDestroyed = false\n  vm._isBeingDestroyed = false\n}\n```\n\n> **vm.$options** \u5c31\u662f\u5408\u5e76\u540e\u7684\u5b8c\u6574\u914d\u7f6e\n\n**\u8fd9\u91cc\u6709\u4e00\u6bb5\u67e5\u627e parent \u5b9e\u4f8b\u7684\u4ee3\u7801**\n\n```typescript\nlet parent = options.parent\nif (parent && !options.abstract) {\n  while (parent.$options.abstract && parent.$parent) {\n    parent = parent.$parent\n  }\n  parent.$children.push(vm)\n}\nvm.$parent = parent\n```\n\n\u8fd9\u91cc\u7684\u6838\u5fc3\u903b\u8f91\u5c31\u662f\uff1a\u5982\u679c **\u5f53\u524d\u7684\u7ec4\u4ef6\u4e0d\u662f\u62bd\u8c61\u7ec4\u4ef6** \u5e76\u4e14 **\u5177\u6709\u7236\u7ea7\u7ec4\u4ef6\u914d\u7f6e**\uff0c\u5c31\u4ece **options** \u914d\u7f6e\u4e2d\u5411\u4e0a\u5c42\u67e5\u627e\uff0c\u76f4\u5230\u627e\u5230\u7b2c\u4e00\u4e2a **\u4e0d\u662f\u62bd\u8c61\u7ec4\u4ef6** \u7684\u5b9e\u4f8b\uff0c\u5728\u8be5\u5b9e\u4f8b\u7684 **$children** \u5b50\u5b9e\u4f8b\u6570\u7ec4\u4e2d\u63d2\u5165\u5f53\u524d\u5b9e\u4f8b\u3002\u5e76\u66f4\u65b0\u5f53\u524d\u5b9e\u4f8b\u7684\u7236\u5143\u7d20\u5b9e\u4f8b\u4e3a\u90a3\u4e2a\u975e\u62bd\u8c61\u5b9e\u4f8b\u3002\n\n**\u7136\u540e\u4f1a\u7ed1\u5b9a\u8fd9\u4e2a\u7ec4\u4ef6\u5173\u7cfb\u91cc\u9762\u7684\u6839\u7ec4\u4ef6** **root**\n\n```typescript\nvm.$root = parent ? parent.$root : vm\n```\n\n\u8fd9\u91cc\u5176\u5b9e\u4e5f\u597d\u7406\u89e3\u3002\u56e0\u4e3a\u7ec4\u4ef6\u7684\u5b9e\u4f8b\u5316\u8fc7\u7a0b\u662f\u4ece **\u6700\u5916\u5c42\u6a21\u677f\u5411\u5185\u89e3\u6790** \uff0c\u5f53\u5f00\u59cb\u5904\u7406\u5f53\u524d\u7684\u5b9e\u4f8b\u7684\u65f6\u5019\uff0c\u5982\u679c\u5b58\u5728\u7236\u7ea7\uff0c\u90a3\u4e48\u7236\u7ea7\u7ec4\u4ef6\u5b9e\u4f8b\u7ed1\u5b9a\u7684\u6839\u7ec4\u4ef6\u5b9e\u4f8b\u4e00\u5b9a\u4e5f\u662f\u5f53\u524d\u5b9e\u4f8b\u7684\u6839\u7ec4\u4ef6\u3002\u5982\u679c\u8fde\u7236\u7ec4\u4ef6\u5b9e\u4f8b\u90fd\u6ca1\u6709\u7684\u8bdd\uff0c\u90a3\u4e48\u5f53\u524d\u7ec4\u4ef6\u4e00\u5b9a\u662f\u5728\u6700\u5916\u5c42\uff0c\u6240\u4ee5\u5b83\u81ea\u5df1\u5c31\u662f\u6839\u7ec4\u4ef6\uff08\u8fd9\u91cc\u628a $root \u6307\u5411\u81ea\u8eab\uff0c\u4e5f\u662f\u4e3a\u4e86\u5b50\u7ec4\u4ef6\u5b9e\u4f8b\u80fd\u591f\u6b63\u786e\u7684\u83b7\u53d6\u5230\u6839\u7ec4\u4ef6\u5b9e\u4f8b\uff09\u3002\n\n**\u6700\u540e\uff0c\u5219\u662f\u521d\u59cb\u5316\u4e00\u4e9b\u7ec4\u4ef6\u6ce8\u5165\u6570\u636e\u3001\u76d1\u542c\u4f9d\u8d56\uff0c\u548c\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u6807\u5fd7**\n\n```typescript\nvm.$children = [] // \u5b50\u7ec4\u4ef6\u5b9e\u4f8b\u6570\u7ec4\nvm.$refs = {} // refs \u7ed1\u5b9a\u6570\u636e\uff0c\u5305\u62ec dom \u5b9e\u4f8b\u548c\u7ec4\u4ef6\u5b9e\u4f8b\n\nvm._provided = parent ? parent._provided : Object.create(null) // \u4e0a\u5c42\u6ce8\u5165\u7684\u6570\u636e\nvm._watcher = null\nvm._inactive = null\nvm._directInactive = false\nvm._isMounted = false  // \u751f\u547d\u5468\u671f\u6807\u8bc6\nvm._isDestroyed = false\nvm._isBeingDestroyed = false\n```\n\n",
    "mtime": "1660964168",
    "original_author": "",
    "original_type": 0,
    "rank_index": 6.54216847,
    "rtime": "1660964167",
    "status": 2,
    "tag_ids": [
      6809640407484334080,
      6809640398105870336,
      6809640369764958208
    ],
    "title": "Vue 2 \u9605\u8bfb\u7406\u89e3\uff08\u5341\uff09\u4e4b \u751f\u547d\u5468\u671f\u521d\u59cb\u5316",
    "user_id": "747323639208391",
    "user_index": 10.789159033325634,
    "verify_status": 1,
    "view_count": 180,
    "visible_level": 0
  },
  {
    "article_id": "7133772101428707358",
    "audit_status": 2,
    "brief_content": "\u6700\u8fd1\u5728\u505a\u4e2a\u8868\u60c5\u5305\u7684\u5c0f\u7a0b\u5e8f\uff0c\u6d89\u53ca\u5230\u8868\u60c5\u5305\u641c\u7d22\u529f\u80fd\u3002\u6211\u4eec\u4e0a\u4f20\u8868\u60c5\u5305\u7684\u65f6\u5019\uff0c\u53ea\u6709\u4e00\u5f20\u56fe\uff0c\u600e\u4e48\u641c\u7d22\uff1f\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u60f3\u5230\u5c31\u662f\u5c06\u8868\u60c5\u5305\u7684\u6587\u5b57\u63d0\u53d6\u51fa\u6765\uff0c\u4f5c\u4e3a\u641c\u7d22\u7684\u5185\u5bb9\u3002\u90a3\u4e48\u8fd9\u5c31\u9700\u8981\u7528\u5230 ocr \u6280\u672f\u4e86\u3002 \u7ecf\u8fc7\u51e0\u4e2a o",
    "category_id": "6809637767543259144",
    "collect_count": 0,
    "comment_count": 0,
    "content": "",
    "cover_image": "",
    "ctime": "1660960809",
    "digg_count": 1,
    "display_count": 0,
    "draft_id": "7133771626172121125",
    "hot_index": 12,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "\u6700\u8fd1\u5728\u505a\u4e2a\u8868\u60c5\u5305\u7684\u5c0f\u7a0b\u5e8f\uff0c\u6d89\u53ca\u5230\u8868\u60c5\u5305\u641c\u7d22\u529f\u80fd\u3002\u6211\u4eec\u4e0a\u4f20\u8868\u60c5\u5305\u7684\u65f6\u5019\uff0c\u53ea\u6709\u4e00\u5f20\u56fe\uff0c\u600e\u4e48\u641c\u7d22\uff1f\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u60f3\u5230\u5c31\u662f\u5c06\u8868\u60c5\u5305\u7684\u6587\u5b57\u63d0\u53d6\u51fa\u6765\uff0c\u4f5c\u4e3a\u641c\u7d22\u7684\u5185\u5bb9\u3002\u90a3\u4e48\u8fd9\u5c31\u9700\u8981\u7528\u5230 ocr \u6280\u672f\u4e86\u3002\n\n\u7ecf\u8fc7\u51e0\u4e2a ocr \u7684\u5e93\u7684\u4f7f\u7528\uff0c\u5c0f\u7f16\u5f3a\u70c8\u63a8\u8350\u4f7f\u7528 [PaddleOCR](https://github.com/PaddlePaddle/PaddleOCR)\uff0c\u4e00\u6b3e\u6587\u672c\u8bc6\u522b\u6548\u679c\u4e0d\u8f93\u4e8e\u5546\u7528\u7684Python\u5e93\uff01\n\n\u5bf9\u4e8e [PaddleOCR](https://github.com/PaddlePaddle/PaddleOCR) \u672c\u6587\u4e0d\u4f1a\u8fc7\u591a\u4ecb\u7ecd\uff0c\u53ef\u81ea\u884c\u641c\u7d22\u3002\u91cd\u70b9\u662f\u5982\u4f55\u4f7f\u7528 PaddleOCR \u89e3\u51b3\u6211\u7684\u95ee\u9898\u3002\n\n## \u5b89\u88c5 PaddleOCR \n\n```shell\npip install paddlepaddle\npip install paddleocr\n```\n\n\u6211\u8fd9\u8fb9\u5b89\u88c5\u540e\u7684\u7248\u672c\uff1a\n\n```shell\npaddleocr==2.5.0.3\npaddlepaddle==2.3.1\n```\n\n\u5728 macOS \u5b89\u88c5\u540e\uff0c\u9879\u76ee\u8fd0\u884c\u62a5\u9519\u62a5\u9519\uff0c\u5fd8\u4e86\u622a\u56fe\uff0c\u5e94\u8be5\u662f\u4e0e setuptools \u7248\u672c\u6709\u5173\uff0c\u89e3\u51b3\u65b9\u5f0f\uff1a\n\n```shell\npip install --upgrade setuptools==59.8.0\n```\n\n\u5b8c\u6210\u8fd9\u4e9b\u914d\u7f6e\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6109\u5feb\u7684\u73a9\u800d\u4e86\u3002\n\n## \u672c\u5730\u5904\u7406\n\n```py\nimport hashlib\nimport io\nfrom PIL import Image\nfrom paddleocr import PaddleOCR\n\ndef get_gif_pic_path(url):\n    '''\u4e0b\u8f7d\u56fe\u7247\uff0c\u8fd4\u56de\u56fe\u7247\u7b2c\u4e00\u5e27\u8def\u5f84'''\n    response = requests.get(url)\n    filename = hashlib.md5(url.encode(encoding='utf-8')).hexdigest()\n    img = Image.open(io.BytesIO(response.content))\n    current = img.tell()\n    img_path = f'bqb/{filename}_{current}.png'\n    img.save(img_path)\n    return img_path\n\ndef ocr_get_gif_text_sec(url) -> str:\n    '''\u8bc6\u522bgif\u7b2c\u4e00\u5e27\u56fe\u7247\u7684\u6587\u5b57'''\n    img_path = get_gif_pic_path(url)\n    ocr = PaddleOCR(use_angle_cls=True, lang='ch')\n    result = ocr.ocr(img_path, cls=True)\n    data = []\n    for item in result:\n        data.append(item[1][0])\n    return \",\".join(data)\n    \nocr_get_gif_text_sec('https://xxxxxx')\n```\n\n\u7531\u4e8e gif \u662f\u4e2a\u52a8\u56fe\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u53d6\u51fa\u56fe\u7247\u7684\u7b2c\u4e00\u5e27\u8fdb\u884c\u8bc6\u522b\uff0c`get_gif_pic_path`\u5b9e\u73b0\u4e86\u8fd9\u4e2a\u529f\u80fd\u3002`ocr_get_gif_text_sec` \u4ece gif \u7b2c\u4e00\u5e27\u7684\u56fe\u8fdb\u884c\u6587\u5b57\u63d0\u53d6\uff0c\u8fd4\u56de\u7684 `result` \u662f\u4e2a\u6570\u7ec4\uff0c\u6211\u4eec\u901a\u8fc7\u904d\u5386\u8fdb\u884c\u63d0\u53d6\u51fa\u6765\u3002\n\n\u63d0\u53d6 gif \u56fe\u7247\u7684\u5185\u5bb9\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\uff0c\u4e24\u4e2a\u51fd\u6570\u7684\u529f\u80fd\u4e5f\u6bd4\u8f83\u7b80\u5355\u3002\u672c\u6587\u6ca1\u505a gif \u5168\u90e8\u6587\u5b57\u7684\u63d0\u53d6\uff0c\u6709\u5174\u8da3\u53ef\u4ee5\u6311\u6218\u4e0b\u3002\n\n## \u5728 flask \u4e2d\u5904\u7406\n\n\u5f53\u6211\u4eec\u60f3\u5728\u4e0a\u4f20\u56fe\u7247\u7684\u65f6\u5019\uff0c\u8fdb\u884c\u5bf9\u56fe\u7247\u6587\u5b57\u7684\u5904\u7406\u600e\u4e48\u529e\uff1f\u96be\u9053\u8981\u5c06\u4e0a\u4f20\u7684\u56fe\u4fdd\u5b58\u5230\u8def\u5f84\u518d\u53bb\u8bc6\u522b\u4e48\uff1f\u8fd9\u4e5f\u662f\u6211\u5728\u5f00\u53d1\u4e2d\u9047\u5230\u7684\u4e00\u4e2a\u95ee\u9898\uff0c\u7ecf\u8fc7\u62c6\u5751\uff0c\u7b54\u6848\u662f\uff1a\u4e0d\uff0c\u4f60\u4e0d\u9700\u8981\u3002\n\n\u601d\u8def\uff1a\u6211\u4eec\u53ef\u4ee5\u4ece\u8868\u5355\u4e2d\u83b7\u53d6\u4e0a\u4f20\u7684\u56fe\u7247\u7684\u4e8c\u8fdb\u5236\uff0c\u7136\u540e\u5c06\u8fd9\u4e2a\u4e8c\u8fdb\u5236\u4f20\u7ed9`ocr.ocr()`\uff0c\u90a3\u4e48`ocr.ocr()` \u652f\u6301\u8fd9\u4e2a\u7c7b\u578b\u4e48\uff1f\u7ecf\u8fc7\u67e5\u770b\u6b64\u51fd\u6570\u6e90\u7801\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9\u5b83\u652f\u6301\u3002\n\n\u5c06\u56fe\u7247\u4e8c\u8fdb\u5236\u8f6c\u5316\u4e3a nparray \u7c7b\u578b\u5373\u53ef\u3002\u4e0b\u9762\u662f\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u5177\u4f53\u4ee3\u7801\n\n```py\nfrom paddleocr import PaddleOCR\nimport numpy as np\nimport cv2\n\n@app.route('/v1/upload_img', methods=['POST'])\ndef api_v1_upload_img():\n    if 'file' not in request.files:\n        return \"no file part\"\n    file = request.files['file']\n    if file.filename == '':\n        return \"no selected file\"\n    if file:\n        file_name = file.filename\n        # \u83b7\u53d6\u56fe\u7247\u7684\u4e8c\u8fdb\u5236\n        res = upload_image(bytes=file.read(), filename=file_name)\n        return res\n    else:\n        return \"no file\"\n\ndef upload_image(bytes, filename = None, mime_type = None):\n    ocr = PaddleOCR(use_angle_cls=True, lang=\"ch\")\n    \n    ## \u6838\u5fc3\u6b65\u9aa4\n    np_arr = np.frombuffer(bytes, dtype=np.uint8)\n    img = cv2.imdecode(np_arr, cv2.IMREAD_COLOR)\n    \n    # \u8fdb\u884c\u8bc6\u522b\n    result = ocr.ocr(img=img, cls=True)\n    ocr_result = []\n    for line in result:\n        ocr_result.append(line[1][0].strip())\n    img_content = ' '.join(ocr_result)\n    return img_content   \n```\n\n\u5728`api_v1_upload_img`\u6211\u4eec\u83b7\u53d6\u5230\u56fe\u7247\u4e8c\u8fdb\u5236\u4ee5\u53ca\u56fe\u7247\u540d\uff0c\u5c06\u8fd9\u4e9b\u4f5c\u4e3a\u53c2\u6570\u4f20\u5230`upload_image`\uff0c\u5728`upload_image`\u4e2d\uff1a\n\n```py\nnp_arr = np.frombuffer(bytes, dtype=np.uint8)\nimg = cv2.imdecode(np_arr, cv2.IMREAD_COLOR)\n```\n\n\u4e0a\u9762\u4e24\u884c\u4ee3\u7801\u662f\u8fd9\u4e2a\u9700\u6c42\u7684\u6838\u5fc3\u7a81\u7834\u70b9\u3002\n\n\u8fd8\u6709\u4e00\u70b9\u5c31\u662f\u5efa\u8bae**\u4e0d\u8981\u5c06\u6b64\u8bc6\u522b\u529f\u80fd\u90e8\u7f72\u5230\u6027\u80fd\u5dee\u7684\u673a\u5668\u4e0a**\uff0c\u5e76\u53d1\u4e00\u4e0b\uff0c\u5b8c\u5168\u625b\u4e0d\u4f4f\uff0c\u9ed8\u9ed8\u7684\u7559\u4e0b\u4e24\u884c\u773c\u6cea\u3002\n\n\u66f4\u591a\u5b9e\u7528\u6587\u7ae0\uff0c\u8bf7\u5173\u6ce8 **OldBirds** \u5fae\u4fe1\u516c\u4f17\u53f7\uff01",
    "mtime": "1660963374",
    "original_author": "",
    "original_type": 0,
    "rank_index": 6.12425139,
    "rtime": "1660963374",
    "status": 2,
    "tag_ids": [
      6809640448827588608,
      6809641090145058816,
      6809640391457898496
    ],
    "title": "\u7528 PaddleOCR \u8bc6\u522b\u8868\u60c5\u5305\u6587\u5b57",
    "user_id": "325111172054350",
    "user_index": 9.782093913883518,
    "verify_status": 1,
    "view_count": 225,
    "visible_level": 0
  },
  {
    "article_id": "7133779387081555999",
    "audit_status": 2,
    "brief_content": "\u643a\u624b\u521b\u4f5c\uff0c\u5171\u540c\u6210\u957f\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 8 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c22\u5929\uff0c\u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5 MongoDB\u5b89\u88c5 1\u3001\u4e0b\u8f7d\u5b89\u88c5\uff08http://www.mongodb.org/downloads\uff09\uff0c\u5b89",
    "category_id": "6809637767543259144",
    "collect_count": 0,
    "comment_count": 0,
    "content": "",
    "cover_image": "",
    "ctime": "1660962526",
    "digg_count": 1,
    "display_count": 0,
    "draft_id": "7131194312091500552",
    "hot_index": 10,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "\u643a\u624b\u521b\u4f5c\uff0c\u5171\u540c\u6210\u957f\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 8 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c22\u5929\uff0c[\u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5](https://juejin.cn/post/7123120819437322247 \"https://juejin.cn/post/7123120819437322247\")\n\n> \u5728\u5b66\u4e60\u4e00\u95e8\u6280\u80fd\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8bb0\u8bb0\u7b14\u8bb0\uff0c\u65e5\u8ba1\u6708\u7d2f\uff0c\u53d1\u73b0\u6709\u4e00\u4e9b\u6548\u679c\uff01\n\n\n## MongoDB\u5b89\u88c5\n\n- 1\u3001\u4e0b\u8f7d\u5b89\u88c5\uff08[http://www.mongodb.org/downloads](http://www.mongodb.org/downloads)\uff09\uff0c\u5b89\u88c5\u76ee\u5f55\uff1a`c:\\MongoDB`\n\n- 2\u3001\u5728 `c:\\MongoDB`\u4e0b\u65b0\u5efa `data\\db` \u76ee\u5f55\n\n- 3\u3001\u547d\u4ee4\u884c\u8fd0\u884c\u670d\u52a1\u7aef\u7a0b\u5e8f `mongod.exe\uff1a`\n```\nC:\\>cd C:\\MongoDB\\bin\nC:\\MongoDB\\bin>mongod.exe --dbpath=C:\\MongoDB\\data\\db --directoryperdb  --logpath=C:\\MongoDB\\data\\logs --logappend\n```\n\n- 4\u3001\u65b0\u5efa\u547d\u4ee4\u884c\uff0c\u8fd0\u884c\u5ba2\u6237\u7aef\u7a0b\u5e8f `mongo.exe` (\u4e0d\u8981\u5173\u95ed `mongod.exe` \u8fd9\u4e2a\u547d\u4ee4\u884c\u7a97\u53e3)\n\n## MongoDB\u6982\u5ff5\n\n- databases: \u6570\u636e\u5e93;\n\n- collections:\u8868\uff1b\uff08colloections \u7ec4\u6210\u4e86 databases\uff09\n\n- documents:\u884c\uff1b\uff08documents \u7ec4\u6210\u4e86 collections\uff09\n\n> MongoDB \u6ca1\u6709\u65b0\u5efa\u6570\u636e\u5e93\u7684\u547d\u4ee4\uff0c\u53ea\u8981\u8fdb\u884c `insert` \u6216\u5176\u5b83\u64cd\u4f5c\uff0cMongoDB \u5c31\u4f1a\u81ea\u52a8\u5e2e\u4f60\u5efa\u7acb\u6570\u636e\u5e93\u548c `collection`\u3002\u5f53\u67e5\u8be2\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684 `collection` \u65f6\u4e5f\u4e0d\u4f1a\u51fa\u9519\uff0cMongo \u4f1a\u8ba4\u4e3a\u90a3\u662f\u4e00\u4e2a\u7a7a\u7684 `collection`\u3002\n\n> \u4e00\u4e2a\u5bf9\u8c61\u88ab\u63d2\u5165\u5230\u6570\u636e\u5e93\u4e2d\u65f6\uff0c\u5982\u679c\u5b83\u6ca1\u6709 ID\uff0c\u4f1a\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u201c`_id`\u201d\u5b57\u6bb5\uff0c\u4e3a `12` \u5b57\u8282(24\u4f4d)`16` \u8fdb\u5236\u6570\u3002\n\u5f53\u7136\u5982\u679c\u63d2\u5165\u6587\u6863\u4e0d\u5e26_id,\u5219\u7cfb\u7edf\u4f1a\u5e2e\u4f60\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\uff0c\u5982\u679c\u81ea\u5df1\u6307\u5b9a\u4e86\u5c31\u7528\u81ea\u5df1\u6307\u5b9a\u7684\u3002\n\n### \u547d\u540d\n\n\u5b57\u6bb5\u540d\u9650\u5236\uff1a\u4e0d\u80fd\u4ee5\u201c$\u201d\u5f00\u5934\uff1b\u4e0d\u80fd\u5305\u542b`\u201c.\u201d`\uff1b`\u201c_id\u201d`\u662f\u7cfb\u7edf\u4fdd\u7559\u7684\u5b57\u6bb5\uff0c\u4f46\u7528\u6237\u53ef\u4ee5\u81ea\u5df1\u50a8\u5b58\u552f\u4e00\u6027\u7684\u6570\u636e\u5728\u5b57\u6bb5\u4e2d\u3002\n\n### \u5ba2\u6237\u7aef\u8bed\u6cd5\uff1a\n\n- `show dbs`  // \u5217\u51fa\u6240\u6709\u6570\u636e\u5e93\n\n- `use memo`  // \u4f7f\u7528\u6570\u636e\u5e93 memo\u3002\u5373\u4f7f\u8fd9\u4e2a\u6570\u636e\u5e93\u4e0d\u5b58\u5728\u4e5f\u53ef\u4ee5\u6267\u884c\uff0c\u4f46\u8be5\u6570\u636e\u5e93\u4e0d\u4f1a\u7acb\u523b\u88ab\u65b0\u5efa\uff0c\u8981\u7b49\u5230\u6267\u884c\u4e86insert\u7b49\u7684\u64cd\u4f5c\u65f6\uff0c\u624d\u4f1a\u5efa\u7acb\u8fd9\u4e2a\u6570\u636e\u5e93\u3002\n\n- `show collections`  // \u5217\u51fa\u5f53\u524d\u6570\u636e\u5e93\u7684collections(\u5f53\u524d\u6570\u636e\u5e93\u4e0b\u7684\u8868)\n\n- `db`  // \u663e\u793a\u5f53\u524d\u6570\u636e\u5e93\n\n- `show users`  // \u5217\u51fa\u7528\u6237\n\n- `db.\u8868\u540d.insert({name:\"jack\",addr:\"fujian\"})`;//\u5411\u8868\u63d2\u5165\u5b57\u6bb5\n\n- `db.\u8868\u540d.find();` //\u67e5\u8be2-\u4f5c\u7528\u76f8\u5f53\u4e8e `select * from` \u8868\u540d\n\n\n#### \u67e5\u8be2\u6570\u636e\n\n- `$lt`    ->less then  \u5c0f\u4e8e\n\n- `$lte`  ->less than and equal   \u4e0d\u5927\u4e8e \n\n-`$lt `   ->less then  \u5c0f\u4e8e\n\n- `$gt`   ->greater then      \u5927\u4e8e\n\n- `$gte` ->greater then and equal  \u4e0d\u5c0f\u4e8e\uff09\n\n- `$ne`  ->not equal     \u4e0d\u7b49\u4e8e\n\n```\ndb.foo.find() // select * from foo\ndb.foo.find().limit(10)  // select * from foo limit 10\ndb.foo.find().sort({x:1})  // select * from foo order by x asc  1:\u5347\u5e8f  -1:\u964d\u5e8f \ndb.foo.find().sort({x:1}).skip(5).limit(10)  // select * from foo order by x asc limit 5, 10\ndb.foo.find({x:10})  // select * from foo where x = 10\ndb.foo.find({x: {$lt:10}})  // select * from foo where x <= 10\ndb.foo.find({}, {y:true})  // select y from foo\n// \u4e00\u4e9bSQL\u4e0d\u80fd\u505a\u7684\uff0cMongoDB\u4e5f\u53ef\u4ee5\u505a\uff1a\ndb.foo.find({\"address.city\":\"gz\"})  // \u641c\u7d22\u5d4c\u5957\u6587\u6863address\u4e2dcity\u503c\u4e3agz\u7684\u8bb0\u5f55\ndb.foo.find({likes:\"math\"})  // \u641c\u7d22\u6570\u7ec4\ndb.foo.ensureIndex({\"address.city\":1})  // \u5728\u5d4c\u5957\u6587\u6863\u7684\u5b57\u6bb5\u4e0a\u5efa\u7d22\u5f15\n  ```\n\n#### \u66f4\u65b0\u6570\u636e\n\n-  `db.foo.update({},{})`  //\u66f4\u65b0\u5bf9\u8c61\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u67e5\u8be2\u5bf9\u8c61\uff0c\u7b2c\u4e8c\u4e2a\u662f\u66ff\u4ee3\u7684,\u53ef\u4ee5\u5728\u7b2c\u4e8c\u4e2a\u5bf9\u8c61\u91cc\u6307\u5b9a\u66f4\u65b0\u54ea\u4e9b\u5b57\u6bb5\uff0c\u8981\u4f7f\u7528$set\u3002\"$set\"\u7528\u6765\u6307\u5b9a\u4e00\u4e2a\u952e\u7684\u503c\u3002\u5982\u679c\u8fd9\u4e2a\u952e\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\u5b83\uff0c\u5982\u679c\u5b58\u5728\u5219\u66f4\u65b0\n\n ` db.foo.update({name:\"jack\"},{$set:{name:\"zky\"}});`\n\n #### \u5220\u9664\u8bb0\u5f55\n\n- `db.foo.remove({});/` /\u7b2c\u4e00\u4e2a\u53c2\u6570\u8981\u5220\u9664\u7684\u8bb0\u5f55,\u53ea\u5220\u9664\u5339\u914d\u7684\u5bf9\u8c61\n\n#### \u5220\u9664\u6570\u636e\u5e93\u8868\n\n-  `db.foo.drop();` //\u5220\u9664foo\u8fd9\u4e2a\u8868\n\n#### \u5220\u9664\u5f53\u524d\u6570\u636e\u5e93\n\n-  `db.dropDatebase();`\n\n\n#### \u5b57\u6bb5\u64cd\u4f5c\n\n- `$push`\uff1a\u589e\u52a0\u6570\u7ec4\u5143\u7d20\uff1b\n\n`db.foo.update({name:'xxx'},{$push:{age:\"10\"}});`\n\n- `$pop`\uff1a\u51cf\u5c11\u6570\u7ec4\u5143\u7d20\uff1b\n\n- `$or\uff0c$and\u548c$exists`\n\n`db.people.find({\"name\":\"yhb\",$or:[{\"age\":18},{\"age\":20}]})`   //\u627e\u51faname\u4e3ayhb,age\u4e3a18\u6216\u800520\u7684;\n\n`db.people.find({\"addr\":{$exists:false}})`     //\u627e\u51fa\u4e0d\u5b58\u5728addr field\n\n`db.people.find({$or:[{\"name\":\"yhb\",\"age\":18},{\"name\":\"lwy\",\"age\":19}]}) `\n// \u627e\u51fa people \u4e2d name \u4e3a yhb\uff0c\u5e74\u9f84\u4e3a 18\uff0c\u6216\u8005 name \u4e3a lwy\uff0cname \u4e3a 19 \u7684\n\n#### \u5c0f\u7ed3\n> \u5982\u679c\u662f`or\uff1a ->> {$or:[{\u6761\u4ef61},{\u6761\u4ef62}]}`\n\u5982\u679c\u662f `and\uff1a ->> {$and:[{\u6761\u4ef61},{\u6761\u4ef62}]}`\n\n#### \u7d22\u5f15\n\n```\ndb.foo.ensureIndex({productid:1})  // \u5728productid\u4e0a\u5efa\u7acb\u666e\u901a\u7d22\u5f15\n\ndb.foo.ensureIndex({district:1, plate:1})  // \u591a\u5b57\u6bb5\u7d22\u5f15\n\ndb.foo.ensureIndex({productid:1}, {unique:true}) // \u552f\u4e00\u7d22\u5f15\n```\n\n## \u5907\u4efd\u4e0e\u6062\u590d\n\n### (1)\u3001\u5907\u4efd\u5de5\u5177 mongodump;\n\n\u547d\u4ee4\u884c\u6267\u884c\uff1a\n```\nc:\\MongoDB\\bin\\mongodump.exe --help \u67e5\u770b\u5e2e\u52a9\u547d\u4ee4\n```\n\u793a\u4f8b-\u5907\u4efd\u6570\u636e\u5e93\uff1a\n\n\u547d\u4ee4\u884c\u6267\u884c\uff1a\n```\nc:\\MongoDB\\bin\\mongodump -o ../data/backup/test \uff08\u5907\u4efd\u6570\u636e\u5230backuo/test\u76ee\u5f55\u4e0b\uff09\n```\n### (2)\u3001\u6062\u590d\u6570\u636e mongorestore:\n\n\u793a\u4f8b-\u6062\u590d\u6570\u636e\u5e93\uff1a\n\n\u547d\u4ee4\u884c\u6267\u884c\uff1a\n```\nc:\\MongoDB\\bin\\mongorestore -d test -c t002 c:\\MongoDB\\data\\backup\\test\\t002.bson\n```\n\n## \u6570\u636e \u5bfc\u5165& \u5bfc\u51fa\n\n\u6bcf\u6b21\u53ea\u5bfc\u5165\\\u5bfc\u51fa\u4e00\u4e2a\u8868\uff0cjson\u6216csv\u683c\u5f0f\uff1b\n\n### (1)\u3001\u5bfc\u5165  mongoimport\n\n\u793a\u4f8b\uff1a\n```\nmongoimport -d test -c t004 drop c:\\MongoDB\\data\\backup\\test_t001.json\n```\n### (2)\u3001\u5bfc\u51fa mongoexport\n\n\u793a\u4f8b\uff1a\n```\nmongoexport -d test -c t001 -o c:\\MongoDB\\data\\backup\\test_t001.json\n```\n\n## \u5b89\u5168\u4e0e\u8ba4\u8bc1\n\n> MongoDB\u672c\u8eab\u662f\u6ca1\u6709\u5f00\u542f\u5b89\u5168\u6027\u68c0\u67e5\u7684\uff0c\u5728\u5f00\u542f\u4e4b\u524d\uff0c\u9700\u8981\u81f3\u5c11\u4e00\u4e2a\u7ba1\u7406\u5458\u8d26\u53f7\u3002\n\n\u5f00\u542f\u5b89\u5168\u6027\u68c0\u67e5\uff0c\u53ea\u6709\u6570\u636e\u5e93\u8ba4\u8bc1\u7528\u6237\u624d\u80fd\u6267\u884c\u8bfb\u6216\u5199\u7684\u64cd\u4f5c\u3002\n\n#### \u589e\u52a0\u7528\u6237\n\n\u6ce8\uff1aV3\u7248\u672cmongoDB\u5df2\u7ecf\u4e0d\u518d\u4f7f\u7528addUser\uff0c\u800c\u662f\u91c7\u7528\u4e86db.createUser\uff1b\n\n\u793a\u4f8b\uff1a\n\n```c\nuse admin\n\ndb.createUser(\n   {\n     user: \"accountUser\",\n     pwd: \"password\",\n     roles: [ \"readWrite\", \"dbAdmin\" ]\n   }\n)\n\n```\n\n#### \u5bf9\u7528\u6237\u5f00\u542f\u5b89\u5168\u8ba4\u8bc1\n\n\n\n1\u3001\u91cd\u542f\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\uff1b\n\n2\u3001\u7136\u540e\u5207\u6362\u5230\u5ba2\u6237\u7aef\u547d\u4ee4\u884c\uff1a\n\n```c\nuse admin\n\ndb.auth(\"root\",\"root\")\n\n\u8fd9\u6837\uff0c\u67d0\u79cd\u6743\u9650\u7684\u7528\u6237\u53ea\u6709\u5207\u6362\u5230\u5bf9\u5e94\u7684\u6570\u636e\u5e93\u624d\u80fd\u6267\u884c\u67d0\u4e9b\u64cd\u4f5c\u3002\n\n```\n\n## \u53c2\u8003\n\nhttp://www.open-open.com/lib/view/open1335003001358.html\n\nhttp://www.runoob.com/mongodb/mongodb-tutorial.html\n\n### MongoDB\u53ef\u89c6\u5316\u5ba2\u6237\u7aef\u5de5\u5177\n\n- **[robomongo](https://robomongo.org/)**  ",
    "mtime": "1660962669",
    "original_author": "",
    "original_type": 0,
    "rank_index": 4.44726819,
    "rtime": "1660962669",
    "status": 2,
    "tag_ids": [
      6809640407484334080,
      6809640372352843776,
      6809640600502009856
    ],
    "title": "\u6211\u7684 MongoDB \u5b66\u4e60\u7b14\u8bb0\uff1a\u57fa\u672c\u64cd\u4f5c\u548c\u5e38\u7528\u547d\u4ee4",
    "user_id": "1679709497208941",
    "user_index": 7.3514483977972,
    "verify_status": 1,
    "view_count": 193,
    "visible_level": 0
  },
  {
    "article_id": "7133599300919459871",
    "audit_status": 2,
    "brief_content": "react router \u5df2\u7ecf\u66f4\u65b0\u5230 v6 \u7248\u672c\uff0c\u672c\u6587\u901a\u8fc7\u65b0\u8001\u7248\u672c\u8def\u7531\u7684\u4f7f\u7528\u5bf9\u6bd4\uff0c\u65b0\u7248\u8def\u7531\u90e8\u5206\u6e90\u7801\u89e3\u6790\uff0c\u5e26\u4f60\u4e86\u89e3\u3001\u641e\u61c2 v6 \u7248\u672c\u8def\u7531\u7684\u5965\u79d8\u3002",
    "category_id": "6809637767543259144",
    "collect_count": 3,
    "comment_count": 8,
    "content": "",
    "cover_image": "https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/de1d9f77e99644f9b51c4eb00e806b6c~tplv-k3u1fbpfcp-watermark.image?",
    "ctime": "1660920532",
    "digg_count": 10,
    "display_count": 0,
    "draft_id": "7133597547293048868",
    "hot_index": 36,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "### \u524d\u8a00\n\n\u6700\u8fd1\u516c\u53f8\u65b0\u8d77\u9879\u76ee\uff0c\u60f3\u8d77\u6765 react router \u5df2\u7ecf\u66f4\u65b0\u5230 v6 \u7248\u672c\uff0c\u4e8e\u662f\u4f7f\u7528\u4e86\u65b0\u7248\u672c\u7684\u8def\u7531\uff0c\u5728\u6b64\u8bb0\u5f55\u4e00\u4e0b\u4e0e\u4e4b\u524d\u7248\u672c\u7684\u533a\u522b\u4ee5\u53ca\u65b0\u7248\u672c\u7684\u5177\u4f53\u4f7f\u7528\u65b9\u6cd5\n\n### \u8001\u7248\u672c\u8def\u7531\u4f7f\u7528\n\n- BrowserRouter\uff1a\u901a\u8fc7 history \u5e93\uff0c\u4f20\u9012 history \u5bf9\u8c61\uff0clocation \u5bf9\u8c61\uff08\u4e00\u822c\u670d\u52a1\u7aef\u652f\u6301\u4e0d\u4f7f\u7528 HashRouter\uff09\n  - hash \u5730\u5740\u5c31\u662f\u6307 # \u53f7\u540e\u9762\u7684 url\n- Switch\uff1a\u5339\u914d\u552f\u4e00\u7684\u8def\u7531 Route\uff0c\u5c55\u793a\u6b63\u786e\u7684\u8def\u7531\u7ec4\u4ef6\n- Route\uff1a\u89c6\u56fe\u627f\u8f7d\u5bb9\u5668\uff0c\u63a7\u5236\u6e32\u67d3 UI \u7ec4\u4ef6\n- \u83b7\u53d6\u8def\u7531\u72b6\u6001\n  - props + Route\uff1a\u53ef\u4ee5\u901a\u8fc7 props \u9010\u5c42\u4f20\u9012\n  - withRouter\uff1awithRouter \u662f\u4e00\u4e2a\u9ad8\u9636\u7ec4\u4ef6 HOC \uff0c\u56e0\u4e3a\u9ed8\u8ba4\u53ea\u6709\u88ab Route \u5305\u88f9\u7684\u7ec4\u4ef6\u624d\u80fd\u83b7\u53d6\u5230\u8def\u7531\u72b6\u6001\uff0c\u5982\u679c\u5f53\u524d\u975e\u8def\u7531\u7ec4\u4ef6\u60f3\u8981\u83b7\u53d6\u72b6\u6001\uff0c\u90a3\u4e48\u53ef\u4ee5\u901a\u8fc7 withRouter \u5305\u88f9\u6765\u83b7\u53d6 history\u3001location\u3001match \u4fe1\u606f\n  - useHistory\u3001useLocation\u3001useParams\uff1a\u51fd\u6570\u7ec4\u4ef6\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e24\u4e2a\u6765\u83b7\u53d6 history\u3001location\u3001params \u5bf9\u8c61\n\n#### \u8def\u7531\u8df3\u8f6c\n\n1. react-router-dom \u5185\u7f6e\u7684 Link\u3001NavLink \u6765\u8df3\u8f6c\n\n   ```javascript\n   // \u8df3\u8f6c\n   <Link to=\"/detail/123\">skip</Link>\n   ```\n\n2. \u901a\u8fc7 history \u5bf9\u8c61\u4e0b\u9762\u7684\u8def\u7531\u8df3\u8f6c\u65b9\u6cd5\n\n- history.push()\n- history.replace() \uff0c\u6e05\u9664\u5386\u53f2\u8bb0\u5f55\n  - \u6b64\u65b9\u5f0f\u8df3\u8f6c\u4f1a\u5220\u9664\u5386\u53f2\u8bb0\u5f55\uff0c\u4e0d\u4f1a\u5411 history \u6dfb\u52a0\u65b0\u8bb0\u5f55\uff0c\u4f7f\u7528\u548c\u4f20\u53c2\u65b9\u5f0f\u548c history.push() \u76f8\u540c\n  - Link \u7ec4\u4ef6\u4e5f\u53ef\u4ee5\u4f7f\u7528 replace \u65b9\u5f0f\uff0c\u53ea\u9700\u8981\u5728 Link \u6807\u7b7e\u4e0a\u6dfb\u52a0 replace \u5c5e\u6027\u5373\u53ef\n- history.go(num) \u8def\u7531\u8df3\u8f6c\uff0c\u524d\u8fdb\u3001\u540e\u9000\n\n  ```javascript\n  // \u8df3\u8f6c\n  import { useHistory } from 'react-router-dom';\n  const history = useHistory();\n  history.push({\n    pathname: '/breeze',\n    search: 'test=123',\n    state: { test: 'test' },\n    query: { id: 456 },\n  });\n  ```\n\n#### \u63a5\u6536\u53c2\u6570\n\n1. \u8def\u7531\u4f20\u53c2\uff1a\u901a\u8fc7 withRouter \u5305\u88f9\u7ec4\u4ef6\uff0c\u5728 props \u4e0a\u62ff\u5230 match \u83b7\u53d6\u5230\uff1b\u6216\u8005\u4f7f\u7528 useParams \u62ff\u5230\u53c2\u6570\n\n   ```javascript\n   // \u7ec4\u4ef6\n   <Route exact path=\"/detail/:id\" component={Detail}></Route>\n\n   // \u8df3\u8f6c\n   <Link to=\"/detail/123\">skip</Link>\n   history.push('/detail/123')\n\n   // \u83b7\u53d6\u53c2\u6570\n   import { withRouter, useParams } from 'react-router-dom';\n   export default withRouter((props) => {\n     const { match } = props; // props\u65b9\u6cd5\n     const params = useParams(); // useParams \u65b9\u6cd5\n     console.log(params);\n     return 123\n   })\n   ```\n\n2. params \u5f62\u5f0f\u4f20\u53c2\uff08\u51fa\u73b0\u5728\u5730\u5740\u680f\uff09\uff1a\u901a\u8fc7 props \u7684 location \u62ff\u5230\uff1b\u6216\u8005\u901a\u8fc7 useLocation\n\n   ```javascript\n   //\u8df3\u8f6c\n   history.push({ pathname: '/detail', search: 'id=123' })\n   <Link to={{ pathname: '/detail', search: 'id=123' }} >skip</Link>\n   <Link to={'/detail?id=123'} >skip</Link>\n\n   // \u83b7\u53d6\u53c2\u6570\n   import { useLocation } from 'react-router-dom'\n   export default withRouter((props) => {\n     const { search } = useLocation()\n     const { location } = props\n     console.log(location.search)\n     return 123\n   })\n   ```\n\n3. state \u5f62\u5f0f\u4f20\u53c2\uff1a\u9875\u9762\u5237\u65b0\u4e0d\u4f1a\u4e22\u5931\u6570\u636e\uff0c\u5e76\u4e14\u5730\u5740\u680f\u4e5f\u770b\u4e0d\u5230\u6570\u636e;\n\n   ```javascript\n   // \u8df3\u8f6c\n   history.push({ pathname: '/detail', state: { test: 'test' } });\n   // \u83b7\u53d6\u53c2\u6570\n   export default withRouter((props) => {\n     const { state } = useLocation();\n     const { location } = props;\n     console.log(location.state);\n     return 123;\n   });\n   ```\n\n4. query \u5f62\u5f0f\u4f20\u53c2\uff1a\u4f20\u53c2\u5730\u5740\u680f\u4e0d\u663e\u793a\uff0c\u5237\u65b0\u5730\u5740\u680f\uff0c\u53c2\u6570\u4e22\u5931;\n\n   ```javascript\n   // \u8df3\u8f6c\n   history.push({ pathname: '/detail', query: { test: 'test' } });\n\n   // \u83b7\u53d6\u53c2\u6570\n   export default withRouter((props) => {\n     const { query } = useLocation();\n     const { location } = props;\n     console.log(location.query);\n     return 123;\n   });\n   ```\n\n### react router v6\n\n#### \u4ecb\u7ecd\n\n- BrowserRouter \u548c HashRouter \u8fd8\u662f\u5728\u6574\u4e2a\u5e94\u7528\u7684\u6700\u9876\u5c42\uff0c\u63d0\u4f9b\u4e86 history \u7b49\u6838\u5fc3\u7684\u5bf9\u8c61\n\n#### Routes\u3001Route\n\n##### Route\n\n- Route \u7684 `component` \u6539\u6210\u4e86 `element`\n- Route `caseSensitive` \u5c5e\u6027 caseSensitive: boolean\uff0c\u7528\u4e8e\u6b63\u5219\u5339\u914d path \u65f6\u662f\u5426\u5f00\u542f ignore \u6a21\u5f0f\uff08\u5339\u914d\u65f6\u662f\u5426\u5ffd\u7565\u5927\u5c0f\u5199\uff09\n- index \u8def\u7531\uff1a\u52a0\u4e86 index \u5c5e\u6027\uff0c\u6709\u591a\u4e2a\u5b50\u8def\u7531\u7684\u60c5\u51b5\u4e0b\uff0c\u9ed8\u8ba4\u6e32\u67d3\u52a0\u4e86 index \u5c5e\u6027\u7684\u8def\u7531\u7ec4\u4ef6\n\n  ```javascript\n  <Routes>\n    <Route path=\"/\" element={<Layout />}>\n      <Route index element={<List />} />\n      <Route path=\"list\" element={<List />} />\n      <Route path=\"detail\" element={<Detail />} />\n    </Route>\n  </Routes>\n  ```\n\n- \u53ea\u652f\u6301\u4e24\u79cd\u52a8\u6001\u5360\u4f4d\u7b26\n\n  ```javascript\n  :id\n  path='article/:id'\n  path='article/:id/detail'\n\n  \u901a\u914d\u7b26\uff0c\u53ea\u80fd\u5728 path \u7684\u672b\u5c3e\u4f7f\u7528\uff0c\u5982 article/*\n  ```\n\n- Route \u4ee3\u7801\u5206\u6790\uff1aRoute \u63d0\u4f9b\u4e09\u79cd props\uff0c\u4e3b\u8981\u4f7f\u7528\u53c2\u6570\u7684\u542b\u4e49\u4e0a\u6587\u5df2\u7ecf\u8bb2\u8fc7\n\n  1. \u8def\u5f84\u8def\u7531\n\n     ```javascript\n     export interface PathRouteProps {\n       caseSensitive?: boolean;\n       // children \u4ee3\u8868\u5b50\u8def\u7531\n       children?: React.ReactNode;\n       element?: React.ReactNode | null;\n       index?: false;\n       path: string;\n     }\n     ```\n\n  2. \u5e03\u5c40\u8def\u7531\n\n  - \u7ec4\u4ef6\u6ca1\u6709 path \u5c5e\u6027\uff0c\u5339\u914d\u5f53\u524d\u5185\u90e8\u7684\u5b50\u8def\u7531\uff0c\u5339\u914d\u5b8c\u5b50\u8def\u7531\u5411\u4e0a\u5bfb\u627e\u7236\u8def\u7531\u63d0\u4f9b\u7684 element \u8fdb\u884c\u6e32\u67d3\n\n    ```javascript\n    export interface LayoutRouteProps {\n      children?: React.ReactNode;\n      element?: React.ReactNode | null;\n    }\n    ```\n\n  - \u53ef\u4ee5\u907f\u514d\u91cd\u590d\u7ec4\u4ef6\u6e32\u67d3\uff0c\u5982\u4e0b\n\n    ```javascript\n      <Route element={<PageLayout />}>\n        <Route path=\"/privacy\" element={<Privacy />} />\n        <Route path=\"/tos\" element={<Tos />} />\n      </Route>\n\n      // \u5426\u5219\u53ef\u80fd\u9700\u8981\u7684\u5199\u6cd5\uff0c\u91cd\u590d\u6e32\u67d3\u4e86 PageLayout \u7ec4\u4ef6\n      <Route\n        path=\"/privacy\"\n        element={\n          <PageLayout>\n            <Privacy />\n          </PageLayout>\n        }\n      />\n      <Route\n        path=\"/tos\"\n        element={\n          <PageLayout>\n            <Tos />\n          </PageLayout>\n        }\n      />\n\n    ```\n\n  3. \u7d22\u5f15\u8def\u7531\uff1aindex \u7684\u4f5c\u7528\n\n     ```javascript\n     export interface IndexRouteProps {\n       element?: React.ReactNode | null;\n       index: true;\n     }\n     ```\n\n##### Routes\n\n- v6 \u53d6\u6d88 Switch\uff08\u53ef\u4ee5\u6839\u636e\u5f53\u524d\u7684\u8def\u7531 path \uff0c\u5339\u914d\u552f\u4e00\u7684 Route \u7ec4\u4ef6\u52a0\u4ee5\u6e32\u67d3\uff09 \u7ec4\u4ef6\uff0c\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\u5728 Route \u7684\u5916\u5c42\u5fc5\u987b\u52a0\u4e0a Routes \u7ec4\u4ef6\uff0c\u5426\u5219\u62a5\u9519\n\n- \u5b50\u8def\u7531\u5d4c\u5957\n\n  ```javascript\n  import { BrowserRouter, Routes , Route , Outlet, Link } from 'react-router\n\n  function App() {\n    return (\n      <BrowserRouter >\n        <Routes>\n          <Route element={<Home />} path=\"/home\" ></Route>\n          <Route element={<Layout />} path=\"/father\" >\n            <Route element={<Child/>} path=\"/father/child\" ></Route>\n          </Route>\n        </Routes>\n      </BrowserRouter>\n    )\n  }\n\n  function Layout() {\n    return (\n      <div>\n        <Link to=\"child\">to child</Link>\n        <Outlet />\n      </div>\n    )\n  }\n\n  ```\n\n- \u5982\u679c\u4e0d\u662f\u76f4\u63a5\u5d4c\u5957\uff0c\u800c\u662f\u5728\u5b50\u7ec4\u4ef6\u4e2d\uff0c\u9700\u8981\u5c3e\u90e8\u52a0\u4e0a `*`\n\n  ```javascript\n  <BrowserRouter>\n    <Routes>\n      <Route path=\"/\" element={<Home />} />\n      <Route path=\"father/*\" element={<Layout />} />\n    </Routes>\n  </BrowserRouter>\n\n  function Layout() {\n    return (\n      <div>\n        <Routes>\n          <Route element={<ChildLayout />}>\n          <Route path=\"child\" element={<Child />} />\n        </Route>\n      </div>\n    );\n  }\n\n  function ChildLayout () {\n    return (\n      <div>\n        <Link to=\"child\">to child</Link>\n        <Outlet />\n      </div>\n    );\n  }\n\n  ```\n\n- \u4ee3\u7801\u5206\u6790\uff1a\n\n  1.  \u5148\u770b\u4e0b props \u53c2\u6570\u4ee5\u53ca Routes \u65b9\u6cd5\n\n      ```javascript\n      export interface RoutesProps {\n        children?: React.ReactNode;\n        // \u7528\u6237\u4f20\u5165\u7684 location \u5bf9\u8c61\uff0c\u4e00\u822c\u4e0d\u4f20\uff0c\u9ed8\u8ba4\u7528\u5f53\u524d\u6d4f\u89c8\u5668\u7684 location\n        location?: Partial<Location> | string;\n      }\n\n      export function Routes({ children, location }: RoutesProps): React.ReactElement | null {\n        // \u6b64\u5904\u8c03\u7528\u4e86 useRoutes \u8fd9\u4e2a hook\uff0c\u5e76\u4e14\u4f7f\u7528\u4e86 createRoutesFromChildren \u5c06 children \u8f6c\u6362\u6210\u4e86 useRoutes \u6240\u9700\u8981\u914d\u7f6e\u7684\u53c2\u6570\u683c\u5f0f\n        return useRoutes(createRoutesFromChildren(children), location);\n      }\n      ```\n\n  2.  createRoutesFromChildren \u65b9\u6cd5\n\n      ```javascript\n      // \u53c2\u6570\uff0c\u548c\u4e0a\u9762\u8def\u5f84\u8def\u7531\u7684\u53c2\u6570\u4e00\u81f4\n      export interface RouteObject {\n        caseSensitive?: boolean;\n        children?: RouteObject[];\n        element?: React.ReactNode;\n        index?: boolean;\n        path?: string;\n      }\n\n      export function createRoutesFromChildren(children: React.ReactNode): RouteObject[] {\n        let routes: RouteObject[] = [];\n\n        // \u5c31\u662f\u9012\u5f52\u904d\u5386 children \u7136\u540e\u683c\u5f0f\u5316\u540e\u63a8\u5165 routes \u6570\u7ec4\u4e2d\n        React.Children.forEach(children, (element) => {\n          // Ignore non-elements.\n          if (!React.isValidElement(element)) {\n            return;\n          }\n\n          // \u7a7a\u8282\u70b9\uff0c\u5ffd\u7565\u6389\u7ee7\u7eed\u5f80\u4e0b\u904d\u5386\n          if (element.type === React.Fragment) {\n            // \u76f8\u5f53\u4e8e routes.push(...createRoutesFromChildren(element.props.children))\n            routes.push.apply(routes, createRoutesFromChildren(element.props.children));\n            return;\n          }\n\n          let route: RouteObject = {\n            caseSensitive: element.props.caseSensitive,\n            element: element.props.element,\n            index: element.props.index,\n            path: element.props.path,\n          };\n\n          // \u9012\u5f52\n          if (element.props.children) {\n            route.children = createRoutesFromChildren(element.props.children);\n          }\n\n          routes.push(route);\n        });\n\n        return routes;\n      }\n      ```\n\n#### useRoutes\n\n- \u901a\u8fc7 useRoutes \u751f\u6210\u5143\u7d20\n\n  ```javascript\n  import { useRoutes } from 'react-router-dom';\n  function App() {\n    const options = [\n      {\n        path: '/',\n        element: <Layout />,\n        children: [\n          {\n            path: 'detail',\n            element: <Detail />,\n          },\n        ],\n      },\n    ];\n\n    const element = useRoutes(options);\n\n    return <div>{element}</div>;\n  }\n  ```\n\n- \u4ee3\u7801\u5206\u6790\n\n  - useRoutes \u4e3a\u6574\u4e2a v6 \u7248\u672c\u7684\u6838\u5fc3\uff1a\u5373\u4f7f\u524d\u9762\u4f7f\u7528\u4e86\u547d\u4ee4\u5f0f\u7684\u914d\u7f6e\u8def\u7531\u65b9\u5f0f\uff0c\u6839\u636e\u4ee3\u7801\u5206\u6790\u4e5f\u662f\u53ef\u4ee5\u770b\u51fa\uff0c\u6700\u7ec8\u4e5f\u662f\u4f7f\u7528\u4e86 useRoutes \u8fdb\u884c\u4e86\u8f6c\u6362\n\n  - useRoutes \u5206\u4e3a\u8def\u7531\u4e0a\u4e0b\u6587\u89e3\u6790\uff08\u7236\u5b50\u8def\u7531\uff09\u3001\u8def\u7531\u5339\u914d\u3001\u8def\u7531\u6e32\u67d3\u4e09\u4e2a\u6b65\u9aa4\n\n    ```javascript\n    function useRoutes(\n      routes: RouteObject[],\n      locationArg?: Partial<Location> | string\n    ): React.ReactElement | null {\n      invariant(\n        // \u5916\u5c42\u9700\u8981 router \u5305\u88f9\uff0c\u5426\u5219\u62a5\u9519\n        useInRouterContext(),\n        // TODO: This error is probably because they somehow have 2 versions of the\n        // router loaded. We can help them understand how to avoid that.\n        `useRoutes() may be used only in the context of a <Router> component.`\n      );\n      let { matches: parentMatches } = React.useContext(RouteContext);\n\n      let routeMatch = parentMatches[parentMatches.length - 1]; // \u6700\u540e\u7684\u4e00\u4e2a route \u5c06\u4f5c\u4e3a\u7236\u8def\u7531\uff0c\u540e\u7eed\u7684 routes \u90fd\u662f\u5176\u5b50\u8def\u7531\n      let parentParams = routeMatch ? routeMatch.params : {}; // \u7236\u8def\u7531\u53c2\u6570\n      // \u7236\u8def\u7531\u5b8c\u6574 pathname\uff0c\u5982\u679c\u8def\u7531\u8bbe\u7f6e /article/*\uff0c\u5f53\u524d\u5bfc\u822a /article/1\uff0c\u90a3\u4e48\u503c\u4e3a /article/1\n      let parentPathname = routeMatch ? routeMatch.pathname : '/';\n      // \u540c\u4e0a\u7c7b\u6bd4\uff0c\u770b base \u547d\u540d\u53ef\u4ee5\u770b\u51fa\u503c\u4e3a /article\n      let parentPathnameBase = routeMatch ? routeMatch.pathnameBase : '/';\n      let parentRoute = routeMatch && routeMatch.route;\n\n      let locationFromContext = useLocation(); // \u83b7\u53d6\u5f53\u524d\u7684 location \u72b6\u6001\n      let location;\n      // \u5224\u65ad\u662f\u5426\u4f20\u5165 locationArg \u53c2\u6570\uff0c\u6ca1\u6709\u7684\u8bdd\u4f7f\u7528\u5f53\u524d\u7684 location\n      if (locationArg) {\n        // \u683c\u5f0f\u5316\u4e3a Path \u5bf9\u8c61\n        let parsedLocationArg =\n          typeof locationArg === 'string' ? parsePath(locationArg) : locationArg;\n        // \u5982\u679c\u4f20\u5165\u4e86 location\uff0c\u5224\u65ad\u662f\u5426\u4e0e\u7236\u7ea7\u8def\u7531\u5339\u914d\uff08\u4f5c\u4e3a\u5b50\u8def\u7531\u5b58\u5728\uff09\n        invariant(\n          parentPathnameBase === '/' || parsedLocationArg.pathname?.startsWith(parentPathnameBase),\n          `When overriding the location using \\`<Routes location>\\` or \\`useRoutes(routes, location)\\`, ` +\n            `the location pathname must begin with the portion of the URL pathname that was ` +\n            `matched by all parent routes. The current pathname base is \"${parentPathnameBase}\" ` +\n            `but pathname \"${parsedLocationArg.pathname}\" was given in the \\`location\\` prop.`\n        );\n\n        location = parsedLocationArg;\n      } else {\n        location = locationFromContext;\n      }\n\n      let pathname = location.pathname || '/';\n      let remainingPathname =\n        parentPathnameBase === '/' ? pathname : pathname.slice(parentPathnameBase.length) || '/';\n\n      // \u901a\u8fc7\u4f20\u5165\u7684 routes \u914d\u7f6e\u9879\u4e0e\u5f53\u524d\u7684\u8def\u5f84\uff0c\u5339\u914d\u5bf9\u5e94\u6e32\u67d3\u7684\u8def\u7531\n      let matches = matchRoutes(routes, { pathname: remainingPathname });\n\n      // \u8c03\u7528_renderMatches\u65b9\u6cd5\uff0c\u8fd4\u56de\u7684\u662f React.Element\uff0c\u6e32\u67d3\u6240\u6709\u7684 matches \u5bf9\u8c61\n      return __renderMatches(\n        matches &&\n          // \u5408\u5e76\u5916\u5c42\u8c03\u7528 useRoutes \u5f97\u5230\u7684\u53c2\u6570\uff0c\u5185\u90e8\u7684 Route \u4f1a\u6709\u5916\u5c42 Route\uff08\u5176\u5b9e\u8fd9\u4e5f\u53eb\u7236 Route\uff09 \u7684\u6240\u6709\u5339\u914d\u5c5e\u6027\u3002\n          matches.map((match) =>\n            Object.assign({}, match, {\n              params: Object.assign({}, parentParams, match.params),\n              // joinPaths \u51fd\u6570\u7528\u4e8e\u5408\u5e76\u5b57\u7b26\u4e32\n              pathname: joinPaths([parentPathnameBase, match.pathname]),\n              pathnameBase:\n                match.pathnameBase === '/'\n                  ? parentPathnameBase\n                  : joinPaths([parentPathnameBase, match.pathnameBase]),\n            })\n          ),\n        // \u5916\u5c42 parentMatches \u90e8\u5206\uff0c\u6700\u540e\u4f1a\u4e00\u8d77\u52a0\u5165\u6700\u7ec8 matches \u53c2\u6570\u4e2d\n        parentMatches\n      );\n    }\n    ```\n\n    1. \u89e3\u6790\u4e0a\u4e0b\u6587\u8c03\u7528 useRoutes \u7684\u5730\u65b9\uff0c\u5982\u679c\u662f\u5b50\u8def\u7531\u8c03\u7528\uff0c\u5408\u5e76\u7236\u8def\u7531\u7684\u5339\u914d\u4fe1\u606f\n    2. \u8def\u7531\u5339\u914d\uff1a\u8c03\u7528 matchRoutes \u8fd4\u56de matches \u6570\u7ec4\n\n       ```javaScript\n       function matchRoutes(\n         routes: RouteObject[],\n         locationArg: Partial<Location> | string, // \u5f53\u524d\u5339\u914d\u5230\u7684 location\n         basename = \"/\"\n       ): RouteMatch[] | null {\n         // \u8f6c\u4e3a path \u5bf9\u8c61\n         let location = typeof locationArg === \"string\" ? parsePath(locationArg) : locationArg; // \u8f6c\u4e3a path \u5bf9\u8c61\n         let pathname = stripBasename(location.pathname || \"/\", basename);\n         if (pathname == null) {\n           return null;\n         }\n         let branches = flattenRoutes(routes); // \u6241\u5e73\u5316 routes \u4e3a\u4e00\u7ef4\u6570\u7ec4\uff0c\u5305\u542b\u5f53\u524d\u8def\u7531\u7684\u6743\u91cd\n         rankRouteBranches(branches); // \u6839\u636e\u6743\u91cd\u6392\u5e8f\n\n         let matches = null;\n         // \u8fd9\u8fb9\u904d\u5386\uff0c\u5224\u65ad\u6761\u4ef6\u5982\u679c\u6ca1\u6709\u5339\u914d\u5230\u5c31\u7ee7\u7eed\uff0c\u5339\u914d\u5230\u5c31\u7ed3\u675f\uff0c\u77e5\u9053\u6240\u6709\u7684\u5168\u90e8\u904d\u5386\u5b8c\n         for (let i = 0; matches == null && i < branches.length; ++i)   {\n           // \u904d\u5386\u6241\u5e73\u5316\u7684 routes\uff0c\u67e5\u770b\u6bcf\u4e2a branch \u7684\u8def\u5f84\u5339\u914d\u89c4\u5219\u662f\u5426\u80fd\u5339\u914d\u5230 pathname\n           matches = matchRouteBranch(branches[i], pathname);\n         }\n         return matches;\n       }\n       ```\n\n    3. \u8def\u7531\u6e32\u67d3\uff1a\\_renderMatches \u65b9\u6cd5\n\n       - \\_renderMatches\n\n         ```javascript\n         function _renderMatches(\n           matches: RouteMatch[] | null,\n           // \u5982\u679c\u5728\u5df2\u6709 match \u7684 route \u5185\u90e8\u8c03\u7528\uff0c\u4f1a\u5408\u5e76\u7236 context \u7684 match\n           parentMatches: RouteMatch[] = []\n         ): React.ReactElement | null {\n           if (matches == null) return null;\n           // \u751f\u6210 outlet \u7ec4\u4ef6\uff0c\u8fd9\u8fb9\u5c31\u662f\u6e32\u67d3 RouteContext.Provider \u7ec4\u4ef6\uff08\u5d4c\u5957\u5173\u7cfb\uff09\n           return matches.reduceRight((outlet, match, index) => {\n             // \u6709 element \u5c31\u6e32\u67d3 element\uff0c\u5982\u679c\u6ca1\u6709\u5219\u9ed8\u8ba4\u662f <Outlet />\uff0c\u7ee7\u7eed\u6e32\u67d3\u5185\u5d4c\u7684 <Route />\n             return (\n              <RouteContext.Provider\n                children={ match.route.element !== undefined ? match.route.element : <Outlet /> }\n                value={{ outlet, matches: parentMatches.concat(matches.slice(0, index + 1)) }}\n              />\n             );\n           // \u6700\u5185\u5c42\u7684 outlet \u4e3a null\uff0c\u4e5f\u5c31\u662f\u6700\u540e\u7684\u5b50\u8def\u7531\n           }, null as React.ReactElement | null);\n         }\n         ```\n\n       - RouteContext\n\n         ```javascript\n         export type Params<Key extends string = string> = {\n           readonly [key in Key]: string | undefined;\n         };\n\n         export interface RouteMatch<ParamKey extends string = string> {\n           // params \u53c2\u6570\uff0c\u6bd4\u5982 :id \u7b49\n           params: Params<ParamKey>;\n           pathname: string;\n           // \u5b50\u8def\u7531\u5339\u914d\u4e4b\u524d\u7684\u8def\u5f84 url\uff0c\u8fd9\u91cc\u53ef\u4ee5\u628a\u5b83\u770b\u505a\u662f\u53ea\u8981\u4ee5 /* \u7ed3\u5c3e\u8def\u5f84\uff08\u8fd9\u662f\u7236\u8def\u7531\u7684\u8def\u5f84\uff09\u4e2d /* \u4e4b\u524d\u7684\u90e8\u5206\n           pathnameBase: string;\n           route: RouteObject;\n         }\n\n         interface RouteContextObject {\n           // \u4e00\u4e2a ReactElement\uff0c\u5185\u90e8\u5305\u542b\u6709\u6240\u6709\u5b50\u8def\u7531\u7ec4\u6210\u7684\u805a\u5408\u7ec4\u4ef6\uff0c\u5176\u5b9e Outlet \u7ec4\u4ef6\u5185\u90e8\u5c31\u662f\u5b83\n           outlet: React.ReactElement | null;\n           // \u4e00\u4e2a\u6210\u529f\u5339\u914d\u5230\u7684\u8def\u7531\u6570\u7ec4\uff0c\u7d22\u5f15\u4ece\u5c0f\u5230\u5927\u5c42\u7ea7\u4f9d\u6b21\u53d8\u6df1\n           matches: RouteMatch[];\n         }\n\n         // \u5305\u542b\u5168\u90e8\u5339\u914d\u5230\u7684\u8def\u7531\uff0c\u5b98\u65b9\u4e0d\u63a8\u8350\u5728\u5916\u76f4\u63a5\u4f7f\u7528\n         const RouteContext = React.createContext<RouteContextObject>({\n           outlet: null,\n           matches: []\n         });\n\n         export {\n           RouteContext as UNSAFE_RouteContext\n         };\n         ```\n\n#### Outlet\n\n- \u4e00\u822c\u4f5c\u4e3a\u7236 Route \u7ec4\u4ef6\u91cc\u7684\u5360\u4f4d\u5143\u7d20\uff0cOutlet \u662f\u7528\u6765\u771f\u6b63\u6e32\u67d3\u5b50\u8def\u7531\u7ec4\u4ef6\n  - \u5b9e\u9645\u4e0a\u5c31\u662f\u5185\u90e8\u6e32\u67d3 RouteContext \u7684 outlet \u5c5e\u6027\n- \u63d0\u4f9b\u4e86\u4e24\u79cd\u65b9\u5f0f\uff1a`useOutlet`\uff0c`<Outlet />`\n\n  ```javascript\n  import { Outlet, useOutlet } from 'react-router';\n  function Child() {\n    const outlet = useOutlet();\n    return (\n      <div>\n        <h1>Dashboard</h1>\n        {outlet}\n        {/* or */}\n        {/* <Outlet /> */}\n      </div>\n    );\n  }\n\n  function Father() {\n    return (\n      <Routes>\n        <Route path=\"/\" element={<Child />}>\n          <Route path=\"detail\" element={<Detail />} />\n          <Route path=\"user\" element={<User />} />\n        </Route>\n      </Routes>\n    );\n  }\n  ```\n\n- \u4ee3\u7801\u5206\u6790\n\n  ```javascript\n  // \u5728 outlet \u4e2d\u4f20\u5165\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\n  const OutletContext = React.createContext < unknown > null;\n\n  //\u53ef\u4ee5\u5728\u5d4c\u5957\u7684 routes \u4e2d\u4f7f\u7528\uff0c\u8fd9\u91cc\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\u662f\u7528\u6237\u5728\u4f7f\u7528 <Outlet /> \u6216\u8005 useOutlet \u65f6\u4f20\u5165\u7684\n  export function useOutletContext<Context = unknown>(): Context {\n    return React.useContext(OutletContext) as Context;\n  }\n\n  export function useOutlet(context?: unknown): React.ReactElement | null {\n    let outlet = React.useContext(RouteContext).outlet;\n    // \u53ef\u4ee5\u770b\u5230\uff0c\u5f53 context \u6709\u503c\u65f6\u624d\u4f7f\u7528 OutletContext.Provider\uff0c\u5982\u679c\u6ca1\u6709\u503c\u4f1a\u7ee7\u7eed\u6cbf\u7528\u7236\u8def\u7531\u7684 OutletContext.Provider \u4e2d\u7684\u503c\n    if (outlet) {\n      return (\n        <OutletContext.Provider value={context}>{outlet}</OutletContext.Provider>\n      );\n    }\n    return outlet;\n  }\n\n  export interface OutletProps {\n    // \u53ef\u4ee5\u4f20\u5165\u8981\u63d0\u4f9b\u7ed9 outlet \u5185\u90e8\u5143\u7d20\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\n    context?: unknown;\n  }\n\n  export function Outlet(props: OutletProps): React.ReactElement | null {\n    return useOutlet(props.context);\n  }\n  ```\n\n  - \u53ef\u4ee5\u770b\u5230 Outlet \u4e0a\u53ef\u4ee5\u4f20\u5165 context \u53c2\u6570\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f20\u503c\n\n    ```javascript\n    import { Outlet, useOutlet, useOutletContext } from 'react-router';\n\n    function Parent() {\n      const [count, setCount] = React.useState(0);\n      // \u4e0b\u9762\u4e24\u79cd\u65b9\u5f0f\u7b49\u540c\n      // const outlet = useOutlet([count, setCount])\n      return <Outlet context={[count, setCount]} />;\n    }\n\n    // \u5728\u5b50\u8def\u7531\u4e2d\u83b7\u53d6\u4f20\u5165\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\n    function Child() {\n      const [count, setCount] = useOutletContext();\n      const add = () => setCount((c) => c + 1);\n      return <button onClick={add}>{count}</button>;\n    }\n    ```\n\n#### \u8def\u7531\u8df3\u8f6c\n\n##### Link\n\n- \u8def\u5f84\u7684\u5199\u6cd5\u652f\u6301\u76f8\u5bf9\u8def\u5f84\n\n  - \u5728 v5 \u7248\u672c\u4e2d\uff0c\u4f8b\u5982\u7236\u7ec4\u4ef6 `Article` \u4e2d, `<Link to=\"detail\">` \u4f1a\u8df3\u8f6c\u5230 `/detail`\uff0c\u60f3\u8981\u6b63\u5e38\u8df3\u8f6c\u9700\u8981\u5199\u6210 `<Link to=\"/article/detail\">`\n  - v6 \u4e2d\u76f4\u63a5\u5199\u6210 `<Link to=\"detail\">` \u5373\u53ef\u6b63\u5e38\u8df3\u8f6c\n\n- \u5728 v6 \u4e2d\uff0c\u8def\u7531\u8df3\u8f6c\uff0c\u50cf\u5e38\u7528\u7684 cd \u547d\u4ee4\n\n  ```javascript\n\n  \u5f53\u524d\u8def\u7531\u4e3a /dashboard/article \u6216\u8005 /dashboard/article/\n\n  <Link to=\"detail\"> -> /dashboard/article/detail\n  <Link to=\"../detail\"> -> /dashboard/detail\n  <Link to=\"../../detail\"> -> /detail\n  ```\n\n##### useNavigate\n\n- \u65b0\u7248\u672c\u63d0\u4f9b useNavigate\uff08useHistory \u6ca1\u4e86\uff09\n\n  - navigate \u9ed8\u8ba4\u5c31\u662f history.push\n\n    ```javascript\n    import { useNavigate } from 'react-router-dom';\n    const navigate = useNavigate();\n    navigate('/detail?id=1', { state: 'test' }); // \u9ed8\u8ba4\u5c31\u662f history.push()\n    ```\n\n  - naviaget(to, { replace: true }) \u7b49\u540c\u4e8e history.replace\n  - naviaget(number) \u7b49\u540c\u4e8e history.go\n\n    ```javascript\n    navigate(-2); // go 2 pages back\n    navigate(-1); // go back\n    navigate(1); // go forward\n    navigate(2); // go 2 pages forward\n    ```\n\n#### \u83b7\u53d6\u53c2\u6570\u4ee5\u53ca\u72b6\u6001\n\n##### useParams\n\n- \u83b7\u53d6\u52a8\u6001\u8def\u7531\u53c2\u6570\n\n  ```javascript\n  <Route element={<Detail/>} path=\"/detail/:id\"></Route>\n  <button onClick={() => { navigate('/detail/1') } } >\u8df3\u8f6c\u8be6\u60c5\u9875</button>\n  const params = useParams()\n  console.log(params,'params')\n  ```\n\n##### useLocation\n\n- \u83b7\u53d6\u72b6\u6001\uff0c\u6709 hash\u3001key\u3001pathname\u3001search\u3001state\n\n  ```javascript\n  import { useLocation } from 'react-router-dom';\n  let location = useLocation();\n  ```\n\n##### useSearchParams\n\n- \u83b7\u53d6\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u83b7\u53d6\u53c2\u6570\uff0c\u7b2c\u4e8c\u4e2a\u8bbe\u7f6e\u53c2\u6570\n\n  ```javascript\n  import { useSearchParams } from 'react-router-dom';\n  const [getParams, setParam] = useSearchParams();\n  console.log(getParams.get('id'));\n  setParam({ id: '2' });\n  ```\n\n## \u53c2\u8003\n\n- https://reactrouter.com/docs/en/v6 \uff08react router \u6587\u6863\uff09\n\n- https://github.com/remix-run/react-router/tree/main/packages/react-router-dom\n",
    "mtime": "1660962631",
    "original_author": "",
    "original_type": 0,
    "rank_index": 11.68572476,
    "rtime": "1660962631",
    "status": 2,
    "tag_ids": [
      6809640407484334080,
      6809640398105870336,
      6809640357354012672
    ],
    "title": "react router v6 \u4f7f\u7528\u8be6\u89e3\u4ee5\u53ca\u90e8\u5206\u6e90\u7801\u89e3\u6790\uff08\u65b0\u8001\u7248\u672c\u5bf9\u6bd4\uff09",
    "user_id": "1777249910270984",
    "user_index": 9.81180764707855,
    "verify_status": 1,
    "view_count": 376,
    "visible_level": 0
  },
  {
    "article_id": "7133585539680174087",
    "audit_status": 2,
    "brief_content": "\u5728React\u7684\u5f00\u53d1\u5de5\u7a0b\u4e2d\uff0c\u4e0d\u7ba1\u662f\u7ec4\u4ef6\u7684\u8bbe\u8ba1\u4e5f\u597d\uff0c\u6027\u80fd\u4f18\u5316\u4e5f\u597d\uff0c\u5b83\u4eec\u4e4b\u95f4\u5f7c\u6b64\u76f8\u5bf9\u6bd4\u8f83\u5272\u88c2\uff0c\u5e76\u4e0d\u80fd\u53cd\u6620\u771f\u5b9e\u7684\u524d\u7aef\u5de5\u7a0b\u9879\u76ee\u8d28\u91cf\uff0c\u4e5f\u4e0d\u80fd\u53cd\u6620\u4ee3\u7801\u7684\u8d28\u91cf\u3002\u6211\u4eec\u8981\u77e5\u9053\u4ee3\u7801\u8be5\u5982\u4f55\u5199\u3001\u5982\u4f55\u653e\u3001\u4ee5\u53ca\u5982\u4f55\u6b63\u786e\u7684\u4f7f\u7528...",
    "category_id": "6809637767543259144",
    "collect_count": 0,
    "comment_count": 0,
    "content": "",
    "cover_image": "https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8ca804f9abf04741921a9bb5c11cad75~tplv-k3u1fbpfcp-watermark.image?",
    "ctime": "1660917368",
    "digg_count": 5,
    "display_count": 0,
    "draft_id": "7131642846834065445",
    "hot_index": 14,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "---\ntheme: cyanosis\nhighlight: a11y-dark\n---\n***\u643a\u624b\u521b\u4f5c\uff0c\u5171\u540c\u6210\u957f\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 8 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c 24 \u5929\uff0c[\u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5](https://juejin.cn/post/7123120819437322247)***\n\n### \u8d77\u56e0\n\u5728 `React` \u7684\u5f00\u53d1\u5de5\u7a0b\u4e2d\uff0c\u4e0d\u7ba1\u662f\u7ec4\u4ef6\u7684\u8bbe\u8ba1\u4e5f\u597d\uff0c\u6027\u80fd\u4f18\u5316\u4e5f\u597d\uff0c\u5b83\u4eec\u4e4b\u95f4\u5f7c\u6b64\u76f8\u5bf9\u6bd4\u8f83\u5272\u88c2\uff0c\u5e76\u4e0d\u80fd\u53cd\u6620\u771f\u5b9e\u7684\u524d\u7aef\u5de5\u7a0b\u9879\u76ee\u8d28\u91cf\uff0c\u4e5f\u4e0d\u80fd\u53cd\u6620\u4ee3\u7801\u7684\u8d28\u91cf\u3002\u4e0d\u7ba1\u662f\u5728\u65e5\u5e38\u7684\u5de5\u4f5c\u8fd8\u662f\u9762\u8bd5\u4e2d\uff0c\u6211\u4eec\u90fd\u9700\u8981\u843d\u5730\u771f\u5b9e\u7684\u4ee3\u7801\uff0c\u5e76\u4e14\u8981\u77e5\u9053\u4ee3\u7801\u5982\u4f55\u5199\u3001\u5982\u4f55\u653e\u3001\u4ee5\u53ca\u5982\u4f55\u7528\uff0c\u624d\u80fd\u66f4\u597d\u7684\u7ef4\u62a4\u3002\u56e0\u6b64\u5728\u9762\u8bd5\u4e2d\uff0c`\u5982\u4f55\u63d0\u5347 React \u4ee3\u7801\u7684\u53ef\u7ef4\u62a4\u6027`\u4e5f\u662f\u9762\u8bd5\u5b98\u5e38\u95ee\u7684\u4e00\u4e2a\u95ee\u9898\uff0c\u4eca\u5929\u6211\u4eec\u5c31\u4e00\u8d77\u6765\u63a2\u8ba8\u4e00\u4e0b `React` \u4ee3\u7801\u53ef\u7ef4\u62a4\u6027\u7684 `\u6700\u4f73\u5b9e\u8df5`\u3002\n\n\u5f53\u6211\u4eec\u5728\u63a2\u8ba8 `React` \u4ee3\u7801\u7684 `\u53ef\u7ef4\u62a4\u6027` \u65f6\uff0c\u6211\u4eec\u7a76\u7adf\u662f\u5728\u63a2\u8ba8\u4ec0\u4e48\uff1f\u5f88\u96be\u7528\u4e00\u53e5\u8bdd\u6765\u89e3\u91ca\u8fd9\u4e2a\u6a21\u7cca\u7684\u6982\u5ff5\u3002\n\n`\u53ef\u7ef4\u62a4\u6027` \u662f\u6307\u4ee3\u7801\u7684\u89c4\u8303\uff0c\u8fd8\u662f\u6307\u8bbe\u8ba1\u6a21\u5f0f\uff1f\u5982\u679c\u6211\u4eec\u8981\u8ba4\u771f\u63a2\u8ba8\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u4ece\u591a\u4e2a\u7ef4\u5ea6\u5c55\u5f00\uff0c\u5e76\u6ca1\u6709\u4e00\u4e2a\u6807\u51c6\u7684\u7b54\u6848\u3002\n\n### \u53ef\u7ef4\u62a4\u6027\n\u8868\u9762\u4e0a\u6211\u4eec\u8ba8\u8bba\u7684\u662f `React` \u7684\u4ee3\u7801\uff0c\u5b9e\u9645\u4e0a\u662f\u57fa\u4e8e `React` \u5f00\u53d1\u7684\u9879\u76ee\u6765\u5c55\u5f00\uff0c\u56e0\u6b64\u53ef\u4ee5\u4ece `\u8f6f\u4ef6\u5de5\u7a0b\u7684\u89d2\u5ea6` \u53bb\u5c1d\u8bd5\u7406\u89e3\u3002\n\n\u5728\u8f6f\u4ef6\u5de5\u7a0b\u4e2d\uff0c\u53ef\u7ef4\u62a4\u6027\u7684\u5355\u8bcd\u662f -- **Maintainability**\uff0c\u4e0e\u5b83\u76f8\u8fd1\u7684\u6982\u5ff5\u8fd8\u6709\u6280\u672f\u503a\u548c\u4ee3\u7801\u5f02\u53d8\uff0c\u8fd9\u4e9b\u540d\u8bcd\u90fd\u53ef\u4ee5\u7528\u6765\u8868\u793a\u5f53\u524d\u4ee3\u7801\u8fed\u4ee3\u7684\u96be\u6613\u7a0b\u5ea6\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u5f53\u9879\u76ee\u53ef\u7ef4\u62a4\u6027\u5f88\u5dee\u7684\u65f6\u5019\uff0c\u5f80\u5f80\u610f\u5473\u7740\u8be5\u9879\u76ee\u65e2\u96be\u4ee5\u4fee\u6539\uff0c\u4e5f\u96be\u4ee5\u62d3\u5c55\u3002\n\n\u5f53\u6211\u4eec\u4f7f\u7528 `React` \u6784\u5efa\u9879\u76ee\u65f6\uff0c\u53ef\u7ef4\u62a4\u6027\u901a\u8fc7\u4ec0\u4e48\u989d\u5916\u7684\u65b9\u6848\u6765\u4fdd\u969c\u5462\uff1f\u4f8b\u5982\uff1a\u7279\u6b8a\u7684\u6587\u6863\u89c4\u8303\u3001\u8bbe\u8ba1\u51c6\u5219\u6216\u662f\u81ea\u52a8\u5316\u68c0\u6d4b\u5de5\u5177\u7b49\u7b49\u3002\u56e0\u6b64\u6211\u4eec\u9700\u8981\u5efa\u7acb\u7279\u5f81\u4e0e\u65b9\u6848\u4e4b\u95f4\u7684\u8054\u7cfb\u3002\n\n\u5728\u5b9e\u9645\u7684\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4eba\u5de5\u5e72\u9884\u7684\u624b\u6bb5\u5bf9\u4ee3\u7801\u8fdb\u884c\u68c0\u67e5\uff0c\u4fd7\u79f0 `Code Review`\uff0c\u4f46\u662f\u4e0d\u53ef\u80fd\u6240\u6709\u7684\u4ee3\u7801\u90fd\u8fdb\u884c `Code Review`\u3002\u5de5\u4e1a\u7684\u53d1\u5c55\u8fd8\u662f\u9700\u8981\u501f\u52a9\u76f8\u5173\u7684\u5de5\u5177\uff0c\u800c\u901a\u5e38\u5728\u9879\u76ee\u7684\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u80fd\u501f\u52a9\u7684\u5de5\u5177\u5c31\u6709`JSLint`\u3001`JSHint`\u3001`ESLint` \u7b49\u3002\u4e1a\u754c\u57fa\u4e8e`ESLint`\u603b\u7ed3\u4e86\u5f88\u591a\u6700\u4f73\u5b9e\u8df5\uff0c\u6700\u7ecf\u5178\u7684\u914d\u7f6e\u65b9\u6848\u83ab\u8fc7\u4e8e`airbab`\u51fa\u54c1\u7684[`eslint-config-airbnb`](https://github.com/airbnb/javascript/tree/master/packages/eslint-config-airbnb)\uff0c\u8fd9\u4e9b\u89c4\u5219\u65b9\u6848\u5c06\u4eba\u5de5\u5ba1\u67e5\u5de5\u4f5c\u8f6c\u5316\u4e3a\u5de5\u5177\u81ea\u52a8\u5316\u5ba1\u67e5\uff0c\u8282\u7701\u4e86\u56e2\u961f\u5185\u90e8\u5927\u91cf\u7684\u65f6\u95f4\uff0c\u90a3\u4e48 `Code Review` \u662f\u5426\u5c31\u6ca1\u7528\u4e86\u5462\uff1f\u5176\u5b9e\u5e76\u4e0d\u662f\uff0c\u56e0\u4e3a\u5de5\u5177\u53ea\u80fd\u6821\u9a8c\u4ee3\u7801\u7684\u7f16\u5199\uff0c\u800c\u4e0d\u80fd\u6821\u9a8c\u4e1a\u52a1\u903b\u8f91\u7684\u6b63\u786e\u6027\uff0c\u56e0\u6b64\u66f4\u63a8\u8350\u56e2\u961f\u5185\u90e8\u5c06 `Code Review` \u7684\u91cd\u5fc3\u653e\u5728\u4ee3\u7801\u7684\u4e1a\u52a1\u903b\u8f91\u4e0a\u3002\n\n\u5728\u5b9e\u9645\u7684\u9879\u76ee\u53d1\u5e03\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u914d\u5907\u6709\u4e00\u5b9a\u7684\u515c\u5e95\u65b9\u6848\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u80fd\u591f\u5feb\u901f\u5b9a\u4f4d\u7ebf\u4e0a\u7684\u62a5\u9519\u3002\u4e00\u822c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u4ee3\u7801\u901a\u5e38\u90fd\u662f\u7ecf\u8fc7 `UglifyJS` \u8fdb\u884c\u6df7\u6dc6\u5e76\u538b\u7f29\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u65e0\u6cd5\u76f4\u63a5\u5b9a\u4f4d\u5230\u5177\u4f53\u7684\u62a5\u9519\u4fe1\u606f\u5728\u4ec0\u4e48\u5730\u65b9\uff0c\u4e0d\u5229\u4e8e\u8fdb\u884c\u95ee\u9898\u7684\u6392\u67e5\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u8003\u8651\u4ee3\u7801\u62a5\u9519\u4fe1\u606f\u8be5\u5982\u4f55\u6536\u96c6\uff0c\u624d\u80fd\u5728\u7ebf\u4e0a\u73af\u5883\u62a5\u9519\u540e\u80fd\u591f\u53ca\u65f6\u8fdb\u884c\u95ee\u9898\u7684\u5b9a\u4f4d\u548c\u4fee\u590d\u3002\n\n\u6700\u7406\u60f3\u7684\u60c5\u51b5\u83ab\u8fc7\u4e8e\u6539\u9020\u7f16\u8bd1\u6d41\u6c34\u7ebf\uff0c\u5728\u53d1\u5e03\u7684\u8fc7\u7a0b\u4e2d\u5c06 `sourcemap` \u4e0a\u4f20\u5230\u62a5\u9519\u6536\u96c6\u5e73\u53f0\u3002\u76ee\u524d\u4e1a\u754c\u5f00\u6e90\u5e76\u4e14\u6bd4\u8f83\u597d\u7528\u7684\u5e73\u53f0\u6709 `Sentry`\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 `Webpack` \u7684\u914d\u7f6e\u9879\uff0c\u6dfb\u52a0 `sourcemap` \u7684\u76f8\u5173\u63d2\u4ef6\u5c31\u53ef\u4ee5\u5728\u7f16\u8bd1\u7684\u8fc7\u7a0b\u4e2d\u76f4\u63a5\u5c06 `sourcemap` \u4e0a\u4f20\u5230 `Sentry` \u7684\u62a5\u9519\u5e73\u53f0\uff0c\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff1a\n```js\nconst SentryWebpackPlugin = require(\"@sentry/webpack-plugin\");\n\nmodule.exports = {\n    configureWebpack: {\n        plugins: [\n            new SentryWebpackPlugin({\n                authToken: process.env.SENTRY_AUTH_TOKEN,\n                org: \"example-org\",\n                project: \"example-project\",\n                include: \".\",\n                ignore: [\"node_modules\", \"webpack.config.js\"]\n            })\n        ]\n    }\n};\n```\n\u901a\u8fc7\u5b8c\u6210\u4e0a\u8ff0\u7684 `Webpack` \u914d\u7f6e\u540e\uff0c\u6211\u4eec\u5728\u4f7f\u7528 `Sentry` \u6355\u83b7\u62a5\u9519\u4fe1\u606f\u65f6\uff0c\u5c31\u80fd\u591f\u76f4\u63a5\u67e5\u770b\u5230\u76f8\u5173\u7684\u6e90\u7801\u4e86\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\n```js\ntry {\n    exampleFunction();\n} catch (err) {\n    Sentry.captureException(err);\n}\n```\n\u6211\u4eec\u901a\u8fc7 `try...catch...` \u6765\u6355\u83b7\u4ee3\u7801\u7684\u62a5\u9519\u4fe1\u606f\uff0c\u7136\u540e\u4f7f\u7528 `Sentry.captureException()` \u5c06\u9519\u8bef\u4fe1\u606f\u6536\u96c6\u5230 `Sentry` \u7684\u5e73\u53f0\u4e2d\u3002\n\n\u5982\u679c\u5f53\u524d\u7684\u62a5\u9519\u5e73\u53f0\u4e0d\u652f\u6301 `sourcemap` \u7684\u8bbf\u95ee\uff0c\u90a3\u6211\u4eec\u8be5\u600e\u4e48\u529e\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 **Mozilla** \u5f00\u6e90\u7684\u5de5\u5177 [`sourcemap`](https://github.com/mozilla/source-map)\uff0c\u76f4\u63a5\u5c06\u62a5\u9519\u4ee3\u7801\u6062\u590d\u5230\u5bf9\u5e94\u7684\u6e90\u4ee3\u7801\u4fe1\u606f\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b2480cabb444cdfb2cf73607dfacfab~tplv-k3u1fbpfcp-watermark.image?)\n\n### \u53ef\u6539\u53d8\u6027\n\u4ece\u4ee3\u7801\u7684\u5c42\u9762\u6765\u8bf4\uff0c\u53ef\u53d8\u6027\u4ee3\u8868\u4e86\u4ee3\u7801\u7684\u53ef\u62d3\u5c55\u80fd\u529b\u3002\u6211\u4eec\u53ef\u4ee5\u4ece\u4e24\u4e2a\u601d\u8def\u63d0\u5347\u4ee3\u7801\u7684\u53ef\u62d3\u5c55\u6027\uff1a\n- \u4ece\u7ec4\u4ef6\u7684\u89d2\u5ea6\u51fa\u53d1\uff0c\u901a\u8fc7\u5206\u79bb\u5bb9\u5668\u7ec4\u4ef6\u4e0e\u6728\u5076\u7ec4\u4ef6\u7684\u65b9\u5f0f\u6765\u5206\u79bb\u6a21\u5757\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `Storybook` \u6216\u8005 `dumi` \u6765\u6c89\u6dc0\u5c55\u793a\u7ec4\u4ef6\u3002\n- \u4ece\u72b6\u6001\u7ba1\u7406\u6846\u67b6\u51fa\u53d1\uff0c\u72b6\u6001\u7ba1\u7406\u6846\u67b6\u4e2d\u6709\u76f8\u5f53\u6210\u719f\u7684\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u4f8b\u5982 `Reudx` \u4e2d\u7684 `action`\u3001`reducer`\u7b49\uff0c\u5b83\u7684\u8fb9\u754c\u5f88\u6e05\u695a\uff0c\u6211\u4eec\u4e5f\u5f88\u5bb9\u6613\u660e\u767d\u4e1a\u52a1\u903b\u8f91\u8be5\u5982\u4f55\u62c6\u89e3\u3001\u5982\u4f55\u653e\u5165\u6a21\u5757\u4e2d\u3002\n\n### \u7a33\u5b9a\u6027\n\u5728\u5f00\u53d1\u4e2d\uff0c\u5982\u679c\u8981\u589e\u5f3a\u9879\u76ee\u7684\u7a33\u5b9a\u6027\uff0c\u4ece\u4ee3\u7801\u5c42\u9762\u6765\u8bf4\uff0c\u5e38\u89c4\u7684\u601d\u8def\u662f\u9700\u8981\u6dfb\u52a0`\u6d4b\u8bd5`\uff0c\u4f46\u5199`\u6d4b\u8bd5`\u5e76\u4e0d\u662f\u4e00\u4ef6\u5bb9\u6613\u7684\u4e8b\u60c5\u3002\n\n\u5728\u6211\u4eec\u5f00\u53d1\u7684\u9879\u76ee\u4e2d\uff0c\u65e0\u8bba\u662f\u5355\u5143\u6d4b\u8bd5\u8fd8\u662f\u96c6\u6210\u6d4b\u8bd5\uff0c\u6574\u4f53\u7684\u8986\u76d6\u6bd4\u4f8b\u90fd\u5f88\u4f4e\uff0c\u5f80\u5f80\u53ea\u80fd\u901a\u8fc7\u6d4b\u8bd5\u4eba\u5458\u8fdb\u884c\u4eba\u5de5\u7684`\u70b9\u70b9\u70b9`\u7684\u64cd\u4f5c\u65b9\u6cd5\u6765\u4fdd\u8bc1\u4ee3\u7801\u7684\u7a33\u5b9a\u6027\u3002\n\n\u4e4b\u6240\u4ee5\u6d4b\u8bd5\u4ee3\u7801\u7684\u8986\u76d6\u7387\u4f4e\uff0c\u4e3b\u8981\u7684\u539f\u56e0\u4e5f\u662f\u56e0\u4e3a\u524d\u7aef\u6d4b\u8bd5\u5e76\u4e0d\u597d\u5199\uff0c\u8fd9\u91cc\u8bf4\u7684\u4e0d\u597d\u5199\u5e76\u4e0d\u662f\u6307\u6d4b\u8bd5\u4ee3\u7801\u4e0d\u597d\u5199\uff0c\u800c\u662f\u6307 `UI` \u5c42\u7684\u6d4b\u8bd5\u4e0d\u597d\u5199\uff0c\u56e0\u4e3a\u6211\u4eec\u9879\u76ee\u7684\u8fed\u4ee3\u5468\u671f\u90fd\u5f88\u77ed\uff0c\u77ed\u5230\u4f60\u8fd8\u6ca1\u6765\u5f97\u53ca\u7f16\u5199\u76f8\u5173\u7684 `UI` \u5c42\u6d4b\u8bd5\u4ee3\u7801\uff0c\u53ef\u80fd\u5c31\u8981\u53d1\u5e03\u4e0a\u7ebf\u4e86\uff0c\u56e0\u6b64\u6211\u4eec\u5982\u679c\u6709\u4e00\u5b9a\u7684\u7f16\u5199`\u6d4b\u8bd5`\u7684\u6761\u4ef6\uff0c\u4e5f\u662f\u4f18\u5148\u7ed9\u6838\u5fc3\u4e1a\u52a1\u4ee3\u7801\u5199`\u6d4b\u8bd5`\u3002\n\n\u4f8b\u5982\uff1a\u8d2d\u7269\u8f66\u4e2d\u5546\u54c1\u4e0e\u4ef7\u683c\u7684\u8ba1\u7b97\u903b\u8f91\uff0c\u6bcf\u5f53\u6709\u4eba\u4fee\u6539\u4ee3\u7801\u65f6\uff0c\u5fc5\u7136\u4f1a\u5fc3\u60ca\u80c6\u6218\u7684\uff0c\u751f\u6015\u4e00\u4e2a\u4e0d\u5c0f\u5fc3\u5c31\u9020\u6210\u751f\u4ea7\u4e8b\u6545\u3002\u5982\u679c\u53ef\u4ee5\u9488\u5bf9\u8fd9\u6837\u7684\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\u4ee3\u7801\u7f16\u5199\u4e00\u5b9a\u7684\u6d4b\u8bd5\u7528\u4f8b\uff0c\u5e76\u4e14\u5c3d\u91cf\u4fdd\u8bc1\u80fd\u591f\u505a\u5230\u5b8c\u5168\u8986\u76d6\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u8fd9\u6837\u786e\u4fdd\u5728\u540e\u7eed\u7684\u5f00\u53d1\u4e2d\u4fee\u6539\u76f8\u5173\u4ee3\u7801\u540e\u80fd\u591f\u81ea\u52a8\u5316\u7684\u8dd1\u4e00\u6b21\u5355\u5143\u6d4b\u8bd5\u3002\n\n\u5728\u524d\u7aef\u5f00\u53d1\u7684\u9886\u57df\u4e2d\uff0c\u5355\u5143\u6d4b\u8bd5\u4e3b\u8981\u6709 `Chai`\u3001`Mocha` \u548c `Jest`\uff0c\u5176\u4e2d `Jest` \u4e0e `React` \u7684\u751f\u6001\u6700\u4e3a\u7d27\u5bc6\uff0c\u4e5f\u662f `Facebook` \u4e3b\u63a8\u7684**\u6d4b\u8bd5\u6846\u67b6**\u3002\u7531\u4e8e `UI` \u5c42\u7684\u8fed\u4ee3\u66f4\u65b0\u5feb\uff0c\u56e0\u6b64\u5728\u4ee3\u7801\u7684\u7f16\u5199\u4e2d\uff0c\u6211\u4eec\u66f4\u5e94\u8be5\u9009\u53d6\u4e1a\u52a1\u6838\u5fc3\u903b\u8f91\u4ee3\u7801\u7f16\u5199\u76f8\u5173\u7684\u6d4b\u8bd5\u7528\u4f8b\uff0c\u8fd9\u6837\u66f4\u6709\u5229\u4e8e\u6574\u4f53\u9879\u76ee\u7684\u7a33\u5b9a\u6027\u3002\n\n### \u6700\u540e\n\u603b\u7ed3\u6765\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u8981\u63d0\u5347 `React`\u4ee3\u7801\u7684\u53ef\u7ef4\u62a4\u6027\uff0c\u5c31\u9700\u8981\u4ece\u591a\u4e2a\u4e0d\u540c\u7684\u7ef4\u5ea6\u6765\u5c55\u5f00\u3002\u901a\u8fc7\u641c\u96c6 `sourcemap` \u7684\u62a5\u9519\u4fe1\u606f\u6765\u63d0\u5347\u5feb\u901f\u89e3\u51b3 `bug` \u7684\u80fd\u529b\uff1b\u901a\u8fc7\u7f16\u5199\u4ee3\u7801 `\u6d4b\u8bd5` \u6765\u63d0\u5347\u4ee3\u7801\u7684\u7a33\u5b9a\u6027\uff1b\u4ee5\u53ca\u901a\u8fc7 `Code Review` \u548c `Eslint` \u6765\u5bf9\u4ee3\u7801\u8fdb\u884c\u89c4\u8303\u7684\u7ea6\u675f\u7684\u903b\u8f91\u7684\u68c0\u67e5\uff0c\u8fd9\u6837\u5bf9\u4ee3\u7801\u7684\u53ef\u7ef4\u62a4\u6027\u5c06\u4f1a\u5927\u5927\u7684\u63d0\u9ad8\uff0c\u5f53\u7136\u8fd9\u4e9b\u7ef4\u5ea6\u4e5f\u4e0d\u4ec5\u4ec5\u53ea\u9002\u7528\u4e8e `React`\uff0c\u5728\u5176\u5b83\u7684\u9879\u76ee\u4e2d\u4e5f\u53ef\u4ee5\u57fa\u4e8e\u76f8\u5173\u7684\u539f\u5219\u6765\u8fdb\u884c\u4ee3\u7801\u7684\u7f16\u5199\u548c\u7ef4\u62a4\u3002\n\n**\u6700\u540e\uff0c\u5982\u679c\u8fd9\u7bc7\u6587\u7ae0\u6709\u5e2e\u52a9\u5230\u4f60\uff0c\u2764\ufe0f\u5173\u6ce8+\u70b9\u8d5e\u2764\ufe0f\u9f13\u52b1\u4e00\u4e0b\u4f5c\u8005\uff0c\u8c22\u8c22\u5927\u5bb6**\n\n### \u5f80\u671f\u56de\u987e\n[\u5728 React \u4e2d\u4e3a\u4ec0\u4e48\u8981\u7528JSX\uff1f](https://juejin.cn/post/7132472958051680287)\n\n[setState \u662f\u540c\u6b65\u66f4\u65b0\u8fd8\u662f\u5f02\u6b65\u66f4\u65b0\uff1f](https://juejin.cn/post/7132654365541662728)\n\n[useEffect \u4e0e useLayoutEffect \u6709\u4ec0\u4e48\u533a\u522b\uff1f](https://juejin.cn/post/7132878706707529759)",
    "mtime": "1660962459",
    "original_author": "",
    "original_type": 0,
    "rank_index": 5.67284205,
    "rtime": "1660962459",
    "status": 2,
    "tag_ids": [
      6809640407484334080,
      6809640398105870336,
      6809640357354012672
    ],
    "title": "\u4e0d\u4f1a\u5427\uff1f\u4f60\u8fd8\u4e0d\u77e5\u9053\u5982\u4f55\u63d0\u5347 React \u4ee3\u7801\u7684\u53ef\u7ef4\u62a4\u6027\uff1f",
    "user_id": "1275089219770840",
    "user_index": 8.723312689775678,
    "verify_status": 1,
    "view_count": 199,
    "visible_level": 0
  },
  {
    "article_id": "7133774689490436133",
    "audit_status": 2,
    "brief_content": "\u643a\u624b\u521b\u4f5c\uff0c\u5171\u540c\u6210\u957f\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 8 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c25\u5929\uff0c\u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5 \u8f85\u52a9\u670d\u52a1\u6a21\u5757 (ASM) \u4f7f\u5ba2\u6237\u670d\u52a1\u4eba\u5458\u80fd\u591f\u4f7f\u7528 Spartacus \u5e97\u9762\u63d0\u4f9b\u5b9e\u65f6\u5ba2\u6237\u9500\u552e\u548c\u670d\u52a1\u652f\u6301\u3002 ",
    "category_id": "6809637767543259144",
    "collect_count": 0,
    "comment_count": 0,
    "content": "",
    "cover_image": "https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/513699f531124c5bb62b34b69dd25c4c~tplv-k3u1fbpfcp-watermark.image?",
    "ctime": "1660961389",
    "digg_count": 0,
    "display_count": 0,
    "draft_id": "7133774007358193671",
    "hot_index": 7,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "\u643a\u624b\u521b\u4f5c\uff0c\u5171\u540c\u6210\u957f\uff01\u8fd9\u662f\u6211\u53c2\u4e0e\u300c\u6398\u91d1\u65e5\u65b0\u8ba1\u5212 \u00b7 8 \u6708\u66f4\u6587\u6311\u6218\u300d\u7684\u7b2c25\u5929\uff0c[\u70b9\u51fb\u67e5\u770b\u6d3b\u52a8\u8be6\u60c5](https://juejin.cn/post/7123120819437322247 \"https://juejin.cn/post/7123120819437322247\")\n\n\u8f85\u52a9\u670d\u52a1\u6a21\u5757 (ASM) \u4f7f\u5ba2\u6237\u670d\u52a1\u4eba\u5458\u80fd\u591f\u4f7f\u7528 Spartacus \u5e97\u9762\u63d0\u4f9b\u5b9e\u65f6\u5ba2\u6237\u9500\u552e\u548c\u670d\u52a1\u652f\u6301\u3002\n\nSpartacus \u4e2d\u7684\u8f85\u52a9\u670d\u52a1\u6a21\u5757\u529f\u80fd\u9700\u8981 SAP Commerce Cloud \u7248\u672c 1905.5 \u6216\u66f4\u9ad8\u7248\u672c\u3002 \u5728 assistedservicewebservices \u7aef\u70b9\u4e2d\u542f\u7528 CORS \u9700\u8981\u6700\u4f4e\u7248\u672c 1905.5\u3002\n\nSpartacus \u4e2d\u7684 ASM \u9700\u8981\u4ee5\u4e0b SAP Commerce Cloud \u6269\u5c55\uff1a\n\n- assistedservicewebservices extension\n- assistedservicestorefront AddOn\n\n\u8981\u5728 Spartacus \u4e2d\u542f\u7528 ASM\uff0c\u9700\u8981\u6267\u884c\u4ee5\u4e0b\u90e8\u5206\u4e2d\u7684\u6b65\u9aa4\uff1a\n\n- \u6388\u4e88 CMS \u6743\u9650\n- \u914d\u7f6e CORS\n\nasagentgroup \u7528\u6237\u7ec4\u9700\u8981\u7279\u5b9a\u6743\u9650\u624d\u80fd\u4ece OCC \u8bfb\u53d6 CMS \u6570\u636e\u3002\n\n\u5982\u679c\u4ece\u5934\u5f00\u59cb\u5e76\u4f7f\u7528 1905.5 \u6216\u66f4\u9ad8\u7248\u672c\u521d\u59cb\u5316 SAP Commerce Cloud \u7cfb\u7edf\uff0c\u5219 asagentgroup \u5c06\u83b7\u5f97\u901a\u8fc7 Spartacus \u548c OCC \u4f7f\u7528 CMS \u6570\u636e\u6240\u9700\u7684\u6743\u9650\u3002 \u65e0\u9700\u91c7\u53d6\u8fdb\u4e00\u6b65\u884c\u52a8\u3002\n\n\u4f46\u662f\uff0c\u5982\u679c\u4ece\u65e9\u4e8e 1905.5 \u7684\u7248\u672c\u5347\u7ea7 SAP Commerce Cloud\uff0c\u5219\u9700\u8981\u901a\u8fc7 ImpEx \u63a7\u5236\u53f0\u5bfc\u5165\u4ee5\u4e0b ImpEx \u6570\u636e\u6765\u6388\u4e88 asagentgroup \u6743\u9650\uff1a\n\n```sql\n# Access rights for asagentgroup\n# - These are needed for rendering (cmsoccaddon).\n\n$START_USERRIGHTS;;;;;;;;;\nType;UID;MemberOfGroups;Password;Target;read;change;create;remove;change_perm\nUserGroup;asagentgroup;;;;;;;;\n\n# general\n;;;;Item;+;;;;;\n;;;;Type;+;;;;;\n\n# access rights for Products, Store, Site and Catalogs\n;;;;Product;+;;;;;\n;;;;Category;+;;;;;\n;;;;VariantType;+;;;;;\n;;;;BaseSite;+;;;;;\n;;;;BaseStore;+;;;;;\n;;;;Catalog;+;;;;;\n;;;;CatalogVersion;+;;;;;\n;;;;ContentCatalog;+;;;;;\n;;;;MediaContainer;+;-;-;-;-;\n;;;;MediaContext;+;-;-;-;-;\n;;;;MediaFormat;+;-;-;-;-;\n;;;;MediaFormatMapping;+;-;-;-;-;\n\n# cms2 items\n;;;;CMSItem;+;-;-;-;-;\n\n$END_USERRIGHTS;;;;;\n```\n\n[\u5916\u94fe\u56fe\u7247\u8f6c\u5b58\u5931\u8d25,\u6e90\u7ad9\u53ef\u80fd\u6709\u9632\u76d7\u94fe\u673a\u5236,\u5efa\u8bae\u5c06\u56fe\u7247\u4fdd\u5b58\u4e0b\u6765\u76f4\u63a5\u4e0a\u4f20(img-o8tEMtYv-1660574832212)(https://upload-images.jianshu.io/upload_images/2085791-f60896638bf390cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)]\n\n# Configuring CORS\n\nassistedservicewebservices \u6269\u5c55\u9700\u8981 CORS \u914d\u7f6e\uff0c\u8fd9\u53ef\u4ee5\u901a\u8fc7 SAP Commerce Cloud \u7248\u672c 1905.5 \u6216\u66f4\u9ad8\u7248\u672c\u5b9e\u73b0\u3002 assistedservicewebservices \u7684 CORS \u914d\u7f6e\u5177\u6709\u5728 assistedservicewebservices \u7684 project.properties \u6587\u4ef6\u4e2d\u6307\u5b9a\u7684\u9ed8\u8ba4\u503c\u3002 \u9ed8\u8ba4\u503c\u5982\u4e0b\uff1a\n\n```sql\ncorsfilter.assistedservicewebservices.allowedOrigins=http://localhost:4200 https://localhost:4200\ncorsfilter.assistedservicewebservices.allowedMethods=GET HEAD OPTIONS PATCH PUT POST DELETE\ncorsfilter.assistedservicewebservices.allowedHeaders=origin content-type accept authorization\n```\n\n# Customizing the CORS Configuration\n\n\u901a\u8fc7 local.properties \u6587\u4ef6\u8986\u76d6\u9ed8\u8ba4\u914d\u7f6e\u6765\u81ea\u5b9a\u4e49 CORS \u914d\u7f6e\u3002\n\n\u7531\u4e8e\u914d\u7f6e\u5728 local.properties \u4e2d\u88ab\u8986\u76d6\uff0c\u5982\u679c\u8981\u6dfb\u52a0\u914d\u7f6e\u5143\u7d20\u800c\u4e0d\u4e22\u5931\u9ed8\u8ba4\u503c\uff0c\u5219\u9664\u4e86\u4efb\u4f55\u65b0\u5143\u7d20\u4e4b\u5916\uff0c\u8fd8\u9700\u8981\u6dfb\u52a0\u6240\u6709\u9ed8\u8ba4\u503c\u3002 \u4f8b\u5982\uff0c\u8981\u5728 allowedHeaders \u5217\u8868\u4e2d\u6dfb\u52a0 my-new-header\uff0c\u9664\u4e86\u9ed8\u8ba4\u6807\u5934\u4e4b\u5916\uff0c\u8fd8\u9700\u8981\u5728 local.properties \u6587\u4ef6\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\uff1a\n\n> corsfilter.assistedservicewebservices.allowedHeaders=origin content-type accept authorization my-new-header.\n\n\u8981\u81ea\u5b9a\u4e49 allowedMethods \u6216 allowedHeaders\uff0c\u5e94\u8be5\u6dfb\u52a0\u5230\u9ed8\u8ba4\u503c\u3002\n\n\u8981\u81ea\u5b9a\u4e49 assistedservicewebservices \u7684 allowedOrigins \u5c5e\u6027\uff0c\u9700\u8981\u4f7f\u7528\u4e0e\u60a8\u7684\u73af\u5883\u76f8\u5173\u7684\u4e3b\u673a\u540d\u8986\u76d6\uff08\u5373\u66ff\u6362\uff09local.properties \u6587\u4ef6\u4e2d\u7684\u9ed8\u8ba4\u503c\u3002 \u4e0b\u9762\u662f\u4e00\u4e2a\u4f8b\u5b50\uff1a\n\n> corsfilter.assistedservicewebservices.allowedOrigins=https://my-new-host:4200\n\n\u4ec5\u51fa\u4e8e\u5f00\u53d1\u76ee\u7684\uff0c\u53ef\u4ee5\u5c06\u503c\u8bbe\u7f6e\u4e3a\u901a\u914d\u7b26 (`*`)\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a\n\n> orsfilter.assistedservicewebservices.allowedOrigins=*\n\n\u6ce8\u610f\uff1a\u8fd9\u79cd\u901a\u914d\u7b26\u914d\u7f6e\u5bf9\u4e8e\u5f00\u53d1\u73af\u5883\u5f88\u7075\u6d3b\uff0c\u4f46\u5e76\u4e0d\u5b89\u5168\u3002 \u751f\u4ea7\u4f7f\u7528\u9700\u8981\u66f4\u4e25\u683c\u7684\u914d\u7f6e\u3002\n\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9aa6e73668154a7584b2828058568501~tplv-k3u1fbpfcp-zoom-1.image)\n",
    "mtime": "1660966311",
    "original_author": "",
    "original_type": 0,
    "rank_index": 1.92624591,
    "rtime": "1660962232",
    "status": 2,
    "tag_ids": [
      6809640407484334080,
      6809640398105870336
    ],
    "title": "SAP \u7535\u5546\u4e91 Spartacus UI \u91cc\u7684 ASM \u6a21\u5757\u542f\u7528\u7684\u524d\u7f6e\u6761\u4ef6",
    "user_id": "624178334538984",
    "user_index": 0.9339911052899,
    "verify_status": 1,
    "view_count": 159,
    "visible_level": 0
  },
  {
    "article_id": "7133543264505823269",
    "audit_status": 2,
    "brief_content": "\u7f51\u9875\u62c9\u8d77\u652f\u4ed8\u7684\u6d41\u7a0b\uff0c\u4ee5\u53ca\u5fae\u4fe1app\u548c\u652f\u4ed8\u5b9d\u62c9\u8d77\u652f\u4ed8\uff0c\u4f7f\u7528sdk\u6216\u8005jsiap\u4ee5\u53cah5\u652f\u4ed8\uff0c\u8fdb\u884c\u652f\u4ed8\u3002",
    "category_id": "6809637767543259144",
    "collect_count": 0,
    "comment_count": 0,
    "content": "",
    "cover_image": "",
    "ctime": "1660907492",
    "digg_count": 0,
    "display_count": 0,
    "draft_id": "7133510546128650247",
    "hot_index": 7,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 0,
    "is_original": 1,
    "link_url": "",
    "mark_content": "\u524d\u63d0\uff1a\u524d\u4e24\u5929\u6709\u4e2a\u9700\u6c42\uff0c\u60f3\u8981\u5199\u4e00\u4e2a\u652f\u4ed8\u9875\u9762\uff0c\u6b64\u9875\u9762\u53ef\u4ee5\u5728\u5fae\u4fe1\u73af\u5883\u6253\u5f00\uff0c\u53ef\u4ee5\u5728\u652f\u4ed8\u5b9d\u73af\u5883\u6253\u5f00\uff0c\u53ef\u4ee5\u5728\u6d4f\u89c8\u5668\u73af\u5883\u6253\u5f00\uff0c\u7136\u540e\u8fdb\u884c\u652f\u4ed8\u3002\u4e00\u8138\u61f5\uff0c\u4e8c\u8138\u61f5\uff0c\u4e09\u8138\u61f5\u3002\n\n\u7ecf\u8fc7\u6f2b\u957f\u7684\u67e5\u6587\u6863\u4e4b\u8def\uff0c\u603b\u7ed3\u4e00\u4e0b\u6211\u5f00\u53d1\u7684\u65f6\u5019\u7684\u5751\uff0c\u907f\u514d\u5927\u5bb6\u548c\u6211\u9047\u5230\u4e00\u6837\u7684\u95ee\u9898\u800c\u6d6a\u8d39\u65f6\u95f4\uff0c\u603b\u7ed3\u4e86\u4e00\u4e9b\u70b9\n\n**\u5fae\u4fe1\u73af\u5883\uff1a**\n---------\n\n**\u76f4\u63a5\u4e0a\u6587\u6863\u5148\u770b\u770b\uff1a**[https://pay.weixin.qq.com/wiki/doc/apiv3/index.shtml](https://pay.weixin.qq.com/wiki/doc/apiv3/index.shtml)\n\n\u00a0 \u00a0\u00a0![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/858c64014f874744a0c9ceaec2c5cacf~tplv-k3u1fbpfcp-watermark.image?)\n\n\u4ece\u4e0a\u9762\u770b\u6709\u597d\u51e0\u79cd\u65b9\u5f0f\u8fd9\u6b21\u54b1\u4eec\u53ea\u8981\u770b**h5\u652f\u4ed8**\u548c**jsAPI\u652f\u4ed8**\n\n**jsapi\u652f\u4ed8\uff08\u5fae\u4fe1app\u5185\u90e8\u6253\u5f00\uff09**\n----------------------\n\n**1\\. \u63a5\u5165\u524d\u7684\u51c6\u5907\u64cd\u4f5c\u8fd8\u662f\u6709\u5fc5\u8981\u786e\u8ba4\u4e00\u4e0b\u7684\uff08\u7279\u522b\u662f[https://pay.weixin.qq.com/wiki/doc/apiv3/index.shtml](https://pay.weixin.qq.com/wiki/doc/apiv3/index.shtml)\u91cc\u9762\u7684\uff1a\u57fa\u7840\u652f\u4ed8-jsiap-\u63a5\u5165\u94b1\u51c6\u5907-5\u914d\u7f6e\u5e94\u7528\uff1a\u8bbe\u7f6e**\u652f\u4ed8\u57df\u540d\u914d\u7f6e**\u4ee5\u53ca\u8bbe\u7f6e\u6388\u6743\u57df\u540d\uff0c\u5f88\u591a\u60c5\u51b5\u90fd\u662f\u5230\u4e86\u6700\u540e\u4e00\u6b65\u4e86\u4e00\u76f4\u652f\u4ed8\u4e0d\u6210\u529f\uff09**\n\n**\u652f\u4ed8\u57df\u540d\u914d\u7f6e\u662f\uff1a\u652f\u4ed8\u7684\u65f6\u5019\u8981\u6709\u6b64\u914d\u7f6e\uff0c\u5426\u5219\u652f\u4ed8\u4e0d\u6210\u529f**\n\n**\u6388\u6743\u57df\u540d\u7684\u914d\u7f6e\u662f\uff1a\u8c03\u7528\u5fae\u4fe1\u652f\u4ed8\u7684\u65f6\u5019\u524d\u63d0\u6761\u4ef6\u662f\u9700\u8981\u6388\u6743\uff0c\u5426\u5219\u6388\u6743\u4e0d\u6210\u529f**\n\n\uff08\u867d\u7136\u4ee5\u4e0a\u4e0d\u662f\u54b1\u4eecweb\u4eba\u5458\u6240\u505a\u7684\u64cd\u4f5c\uff0c\u4f46\u662f\u9700\u8981\u786e\u8ba4\uff0c\u5426\u5219\u540e\u7eed\u4f1a\u5e26\u6765\u4e0d\u5fc5\u8981\u7684\u9ebb\u70e6\uff09\n\n**2\\. \u4ee5\u4e0b\u95ee\u9898\u7ecf\u5e38\u4f1a\u9047\u5230\uff0c\u53ef\u4ee5\u5bf9\u6bd4\u4e00\u4e0b\u8fdb\u884c\u6392\u67e5\uff0c\u662f\u5426\u548c\u81ea\u5df1\u7684\u9519\u8bef\u6709\u7c7b\u4f3c\u7684\u60c5\u51b5**\n\n![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2c2646265b6a468289b42b7fe2b30560~tplv-k3u1fbpfcp-watermark.image?)  \n\n**3\\. \u62c9\u8d77\u652f\u4ed8\uff08[https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7\\_7&index=6](https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_7&index=6)\uff09\u8fd9\u4e2a\u7684\u524d\u63d0\u662f\u6388\u6743\uff0c\u4e0b\u4e00\u4e2a\u53d9\u8ff0\u7684\u662f\u6388\u6743\u7684\u64cd\u4f5c\uff0c\u6388\u6743\u4e4b\u540e\u5c31\u53ef\u4ee5\u652f\u4ed8\u4e86**\n\n    function onBridgeReady(){\n       WeixinJSBridge.invoke(\n          'getBrandWCPayRequest', {\n             \"appId\":\"wx2421b1c4370ec43b\",     //\u516c\u4f17\u53f7ID\uff0c\u7531\u5546\u6237\u4f20\u5165     \n             \"timeStamp\":\"1395712654\",         //\u65f6\u95f4\u6233\uff0c\u81ea1970\u5e74\u4ee5\u6765\u7684\u79d2\u6570     \n             \"nonceStr\":\"e61463f8efa94090b1f366cccfbbb444\", //\u968f\u673a\u4e32     \n             \"package\":\"prepay_id=u802345jgfjsdfgsdg888\",     \n             \"signType\":\"MD5\",         //\u5fae\u4fe1\u7b7e\u540d\u65b9\u5f0f\uff1a     \n             \"paySign\":\"70EA570631E4BB79628FBCA90534C63FF7FADD89\" //\u5fae\u4fe1\u7b7e\u540d \n          },\n          function(res){\n          if(res.err_msg == \"get_brand_wcpay_request:ok\" ){\n          // \u4f7f\u7528\u4ee5\u4e0a\u65b9\u5f0f\u5224\u65ad\u524d\u7aef\u8fd4\u56de,\u5fae\u4fe1\u56e2\u961f\u90d1\u91cd\u63d0\u793a\uff1a\n                //res.err_msg\u5c06\u5728\u7528\u6237\u652f\u4ed8\u6210\u529f\u540e\u8fd4\u56deok\uff0c\u4f46\u5e76\u4e0d\u4fdd\u8bc1\u5b83\u7edd\u5bf9\u53ef\u9760\u3002\n          } \n       }); \n    }\n    if (typeof WeixinJSBridge == \"undefined\"){\n       if( document.addEventListener ){\n           document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);\n       }else if (document.attachEvent){\n           document.attachEvent('WeixinJSBridgeReady', onBridgeReady); \n           document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);\n       }\n    }else{\n       onBridgeReady();\n    }\n\n\u6ce8\u610f\uff1aWeixinJSBridge\u5185\u7f6e\u5bf9\u8c61\u5728\u5176\u4ed6\u6d4f\u89c8\u5668\u4e2d\u65e0\u6548\u3002\n\n**3.1 \u8fd9\u91cc\u6709\u4e00\u4e9b\u522b\u7684\u652f\u4ed8\u65f6\u5019\u7684\u62a5\u9519\u4e5f\u662f\u53ef\u4ee5\u5bf9\u6bd4\u4e00\u4e0b\u81ea\u5df1\u7684\u95ee\u9898\u7684[https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7\\_9&index=7](https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_9&index=7)**\n\n**3.2 \u5fae\u4fe1\u652f\u4ed8\u7684\u7ed3\u679c\uff08\u53ef\u4ee5\u77e5\u9053\u7684\u4e09\u79cd\u72b6\u6001\uff09**\n\n![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/edaa706892af4d90842af81698f40798~tplv-k3u1fbpfcp-watermark.image?)  \n\n**4\\. \u6388\u6743\u64cd\u4f5c\uff08\u8fd9\u4e2a\u662f\u4e2a\u91cd\u70b9\uff0c\u9700\u8981\u8ba4\u771f\u770b\u770b\u7684\uff09(****[https://developers.weixin.qq.com/doc/offiaccount/OA\\_Web\\_Apps/Wechat\\_webpage\\_authorization.html](https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html)****)**\n\n**4.1\u5f15\u5bfc\u7528\u6237\u6253\u5f00\u6388\u6743\u9875\u9762\uff1a**\n\n    location.href='https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&redirect_uri=REDIRECT_URI&response_type=code&scope=SCOPE&state=STATE#wechat_redirect'\n\n**4.2 \u70b9\u51fb\u4e0a\u9762\u7684\u94fe\u63a5\uff0c\u53ea\u8981\u5c06\u81ea\u5df1\u7684\u914d\u7f6e\u4fe1\u606f\u6dfb\u52a0\u5b8c\u6210\uff0c\u5fae\u4fe1\u4f1a\u6839\u636e\u914d\u7f6e\u7684\u91cd\u5b9a\u5411\u7684\u94fe\u63a5\u8df3\u8f6c\u4e00\u4e2a\u65b0\u7684\u9875\u9762\uff08redirect\\_uri\uff09\u5e76\u4e14\u5728\u94fe\u63a5\u540e\u9762\u4f1a\u62fc\u63a5code\u4ee5\u53castate\u53c2\u6570\uff08\u6709\u8fd9\u4e24\u4e2a\u53c2\u6570\uff0c\u8868\u793a\u4f60\u6388\u6743\u6210\u529f\u4e86\uff09**\n\n**h5\u652f\u4ed8\uff08\u6d4f\u89c8\u5668\u6253\u5f00\u5fae\u4fe1\uff0c\u6b64\u65b9\u6cd5\u4e0d\u53ef\u4ee5\u518d\u5fae\u4fe1app\u5185\u90e8\u8fdb\u884c\u4f7f\u7528\uff0c\u65e0\u6548\u64cd\u4f5c\uff09**\n-----------------------------------------\n\n**1\\. \u63a5\u5165\u524d\u7684\u51c6\u5907\u64cd\u4f5c\u8fd8\u662f\u6709\u5fc5\u8981\u786e\u8ba4\u4e00\u4e0b\u7684\uff08****\u7279\u522b\u662f[https://pay.weixin.qq.com/wiki/doc/apiv3/index.shtml](https://pay.weixin.qq.com/wiki/doc/apiv3/index.shtml)\u91cc\u9762\u7684\uff1a\u57fa\u7840\u652f\u4ed8-jsiap-\u63a5\u5165\u94b1\u51c6\u5907-5\u914d\u7f6e\u5e94\u7528\uff1a\u8bbe\u7f6e**\u652f\u4ed8\u57df\u540d\u914d\u7f6e**\u4ee5\u53ca\u8bbe\u7f6e\u6388\u6743\u57df\u540d\uff0c\u5f88\u591a\u60c5\u51b5\u90fd\u662f\u5230\u4e86\u6700\u540e\u4e00\u6b65\u4e86\u4e00\u76f4\u652f\u4ed8\u4e0d\u6210\u529f\uff09**\n\n**\u652f\u4ed8\u57df\u540d\u914d\u7f6e\u662f\uff1a\u652f\u4ed8\u7684\u65f6\u5019\u8981\u6709\u6b64\u914d\u7f6e\uff0c\u5426\u5219\u652f\u4ed8\u4e0d\u6210\u529f**\n\n**2.** [**https://pay.weixin.qq.com/wiki/doc/apiv3/apis/chapter3\\_3\\_4.shtml**](https://pay.weixin.qq.com/wiki/doc/apiv3/apis/chapter3_3_4.shtml)\n\n**h5\u652f\u4ed8\u7684\u6d41\u7a0b\u5bf9\u4e8eweb\u6765\u8bf4\u76f8\u5bf9\u7b80\u5355\u4e00\u70b9\uff0c\u56e0\u4e3a\u90fd\u662f\u670d\u52a1\u7aef\u7684\u4e00\u4e9b\u64cd\u4f5c\uff0cweb\u8fd9\u8fb9\u53ea\u9700\u8981\u63a5\u6536\u540e\u7aef\u8fd4\u56de\u7684\u4e00\u4e2aurl\u5373\u53ef**\n\n![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/87744afa38e44c829cdb2133c4bb9856~tplv-k3u1fbpfcp-watermark.image?)  \n\n  \n\n  \n\n  \n\n\u652f\u4ed8\u5b9d\u73af\u5883\n-----\n\n\u652f\u4ed8\u5b9d\u652f\u4ed8\u5462\u4e5f\u662f\u6709\u524d\u63d0\u6761\u4ef6\u7684\uff0c\u8fd9\u6b21\u53ea\u9700\u8981**\u914d\u7f6e\u652f\u4ed8\u7684\u57df\u540d\u6743\u9650**\u5c31\u53ef\u4ee5\uff0c\u652f\u4ed8\u5b9d\u6ca1\u6709\u6388\u6743\u7684\u6743\u9650\uff0c\u6240\u4ee5\u8fd9\u4e2a\u4e0d\u7528\u914d\u7f6e\u6388\u6743\u7684\u57df\u540d\n\n  \n\n  \n\n\u652f\u4ed8\u5b9d\u652f\u4ed8\u4f7f\u7528\u7684sdk \uff08\u53ea\u80fd\u652f\u4ed8\u5b9d\u7684app\u5185\u90e8\u4f7f\u7528\uff09\n---------------------------\n\n### \u8fd9\u4e2a\u6709\u56de\u8c03\u7684\u65b9\u6cd5\u00a0\u00a0[https://myjsapi.alipay.com/alipayjsapi/util/pay/tradePay.html](https://myjsapi.alipay.com/alipayjsapi/util/pay/tradePay.html)\n\n    \u652f\u4ed8\u5b9d\u8ba2\u5355\u5b57\u7b26\u4e32\u5524\u8d77\u652f\u4ed8<script src=\"https://gw.alipayobjects.com/as/g/h5-lib/alipayjsapi/3.1.1/alipayjsapi.inc.min.js\"></script>\n    \n    <button id=\"J_btn\" class=\"btn btn-default\">\u652f\u4ed8</button>\n    <script>\n      var btn = document.querySelector('#J_btn');\n      btn.addEventListener('click', function(){\n        ap.tradePay({\n          orderStr: 'timestamp=2016-12-27%2018%3A00%3A00&method=alipay.trade.app.pay&app_id=2014073000007292......'\n        }, function(res){\n          ap.alert(res.resultCode);\n        });\n      });\n    </script>\n\n**\u6ce8\u610f\uff1a\u652f\u4ed8\u5b9d\u56de\u8c03\u7684\u51fd\u6570\u91cc\u9762\u7684\u7c7b\u578b\u662f\u5b57\u7b26\u4e32\u7684**\n\n![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2ffb5d25cab94ef7ae105461f6bb6eff~tplv-k3u1fbpfcp-watermark.image?)  \n\n**h5\u652f\u4ed8\uff08\u6b64\u65b9\u6cd5\u6d4f\u89c8\u5668\u548capp\u5185\u90e8\u5747\u53ef\u4ee5\u4f7f\u7528\uff09**\n---------------------------\n\n**\uff08**[**https://opendocs.alipay.com/open/02ivbs?scene=21**](https://opendocs.alipay.com/open/02ivbs?scene=21)**\uff09**\n\n**\u6ca1\u6709\u56de\u8c03\u65b9\u6cd5\uff0c\u65e0\u6cd5\u76d1\u542c\u652f\u4ed8\u5b8c\u6210\u7684\u64cd\u4f5c**\n\n     location.href = `https://openapi.alipay.com/gateway.do?xxxxx`;\n    xxxx\u6307\u7684\u662f\u540e\u7aef\u63a5\u53e3\u4e0b\u5355\u7684\u65f6\u5019\u8fd4\u56de\u7684\u6709\u5173\u963f\u91cc\u652f\u4ed8\u7684\u4e00\u4e9b\u4e3b\u8981\u53c2\u6570\n\n\u94fe\u63a5\u91cc\u9762\u6709\u4f8b\u5b50\n\n![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9107541c094445389465c6729d70cdfe~tplv-k3u1fbpfcp-watermark.image?)  \n\n  \n\n  \n\n**\u4ee5\u4e0a\u662f\u6211\u8fdb\u884c\u7684\u603b\u7ed3\uff0c\u5982\u679c\u603b\u7ed3\u7684\u6709\u4ec0\u4e48\u95ee\u9898\uff0c\u53ef\u4ee5\u968f\u65f6\u63d0\u51fa**",
    "mtime": "1660961935",
    "original_author": "",
    "original_type": 0,
    "rank_index": 3.23912282,
    "rtime": "1660961935",
    "status": 2,
    "tag_ids": [
      6809640407484334080,
      6809640398105870336
    ],
    "title": "\u5fae\u4fe1\u652f\u4ed8\u5b9d\u7f51\u9875\u7248\u62c9\u8d77\u652f\u4ed8\u7684\u6d41\u7a0b\u603b\u7ed3",
    "user_id": "1662117313259374",
    "user_index": 6.82516626688477,
    "verify_status": 1,
    "view_count": 157,
    "visible_level": 0
  },
  {
    "article_id": "7133534750664294430",
    "audit_status": 2,
    "brief_content": "Flutter Web \u8c03\u7814\u6d4b\u8bd5 Typescript \u751f\u6210 Flutter \u4ee3\u7801 Web \u4e0e APP UI \u4e00\u81f4\u6027\u65b9\u6848",
    "category_id": "6809637767543259144",
    "collect_count": 0,
    "comment_count": 0,
    "content": "",
    "cover_image": "",
    "ctime": "1660905509",
    "digg_count": 0,
    "display_count": 0,
    "draft_id": "7132771731634126885",
    "hot_index": 7,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "\u672c\u6587\u5df2\u53c2\u4e0e\u300c\u65b0\u4eba\u521b\u4f5c\u793c\u300d\u6d3b\u52a8\uff0c\u4e00\u8d77\u5f00\u542f\u6398\u91d1\u521b\u4f5c\u4e4b\u8def\u3002\n\n\u5f53\u4ea7\u54c1\u8bf4\u8981\u628a\u6240\u6709\u79fb\u52a8\u7aef\uff08\u5c0f\u7a0b\u5e8f\u3001H5\u3001APP\uff09\u7b49 UI \u505a\u6210\u4e00\u81f4\uff0c\u53c8\u4e0d\u60f3\u6295\u5165\u66f4\u591a\u7684\u5f00\u53d1\u4eba\u529b\u3002\u90a3\u4f5c\u4e3a\u5f00\u53d1\uff0c\u6709\u54ea\u4e9b\u65b9\u6848\u53ef\u4ee5\u7528\u5462\uff1f\n\n1. \u6574\u4f53 Web \u5316\uff0c\u6bd4\u5982 `Canva` \u5c31\u662f\u5b8c\u5168\u5957\u58f3\u7684 APP\uff0c\u7528\u4e86\u4e00\u5957 Web \u54cd\u5e94\u5f0f\u5e03\u5c40\uff0c\u9002\u914d\u4e86 All\u3002\u4f46\u7f3a\u70b9\u4e5f\u5f88\u660e\u663e\uff0c\u5728 APP \u4e0a\u53ea\u80fd\u662f\u901a\u8fc7 webview\uff0c\u4f1a\u9891\u7e41\u7684\u767d\u5c4f\u53ca\u91cd\u7ed8\uff08\u770b\u6eda\u52a8\u6761\u4f4d\u7f6e\u5c31\u80fd\u770b\u51fa\u6765\uff0c\u4fdd\u5b58\u4e0d\u4f4f\u4e0a\u51e0\u4e2a\u9875\u9762\u7684\u9875\u9762\u72b6\u6001\uff09\uff0c\u66f4\u641e\u7b11\u7684\u662f\u6ca1\u505a\u79bb\u7ebf\u5316\uff0c\u5f31\u7f51\u7edc\u6253\u5f00 APP \u4f1a\u5361\u5728 launch \u9875\uff0c\u9996\u9875\u90fd\u8fdb\u4e0d\u53bb [\u624b\u52a8\u72d7\u5934]\u3002\n2. uni-app \u7b49\u8de8\u7aef\u65b9\u6848, \u597d\u51e0\u5e74\u524d\u7b14\u8005\u4e5f\u4e86\u89e3\u5c1d\u8bd5\u8fc7\uff0c\u8fd9\u7c7b\u6280\u672f\u4f18\u7f3a\u70b9\u4e5f\u5f88\u660e\u663e\uff0c\u5982\u679c\u662f\u5f00\u53d1\u7b80\u5355 App\uff0c\u786e\u5b9e\u53ef\u4ee5\u4e00\u628a\u68ad\u3002\u4f46\u51e1\u9700\u8981\u4f53\u9a8c\u66f4\u4f18\u96c5\u70b9\u3001\u529f\u80fd\u66f4\u590d\u6742\u70b9\u5c31\u9700\u8981\u82b1\u8d39\u51e0\u500d\u529b\u6c14\u3002\n3. \u5c31\u662f\u672c\u6587\u8981\u8bf4\u7684 Flutter \u4e86\uff0c\u53ef\u4ee5\u53c2\u8003 [\u7f8e\u56e2\u5916\u5356\u5728 Flutter Web \u4e0a\u7684\u5b9e\u8df5](https://tech.meituan.com/2021/03/18/flutterweb-in-meituanwaimai.html) \n\n\u5728 Flutter 3.0 \u65f6\u4ee3\u540e\uff0cFlutter \u5b98\u65b9\u7b97\u662f\u8fdb\u4e00\u6b65\u4f18\u5316\u4e86 build web \u7684\u4e00\u4e9b\u95ee\u9898\uff0c\u51cf\u5c11\u4e86\u5305\u4f53\u79ef\uff0c\u81f3\u6b64\uff0c\u7b14\u8005\u4e5f\u7531\u4e8e\u67d0\u4e9b\u539f\u56e0\u5174\uff08bei\uff09\u8da3\uff08po\uff09\u6ee1\uff08wu\uff09\u6ee1\uff08nai\uff09\u7684\u5f00\u59cb\u5c1d\u8bd5\u8fd9\u5927\u524d\u7aef\u6781\u81f4\u4e92\u5377\u4e4b\u8def\u3002\n\n# \u601d\u8003\u65b9\u6848\n\n\u7528 Flutter \u6765\u505a Web \u6700\u4e3b\u8981\u7684\u662f\u60f3\u590d\u7528 APP \u7684 UI\u3002\uff08\u5176\u4ed6\u65b9\u9762\u786e\u5b9e\u8d76\u4e0d\u4e0a\u76f4\u63a5\u7528 React / Vue \u6765\u5f00\u53d1\u6765\u7684\u8212\u9002\u3002\u7279\u522b\u662f\u9700\u8981\u66f4\u4e3a\u91cd\u89c6 SEO \u7684\u4e1a\u52a1\uff0cFlutter \u5b98\u65b9\u5bf9 SEO \u90fd\u6ca1\u6709\u4efb\u4f55\u5efa\u8bae\uff09\n\n\u5148\u770b\u4e00\u4e0b\u603b\u4f53\u67b6\u6784\u8bbe\u8ba1\uff1a\n\n![M \u7ad9\u67b6\u6784\u8bbe\u8ba1.drawio.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e66469c11ff41619c7e7adad1e4d032~tplv-k3u1fbpfcp-watermark.image?)\n\n\u8fd9\u4e2a\u8bbe\u8ba1\u7684\u76ee\u7684\uff1a\n1. \u6700\u5927\u7a0b\u5ea6\u5171\u7528 App \u7684 Flutter UI \u7ec4\u4ef6\u3002\n2. \u5c3d\u53ef\u80fd\u7684\u590d\u7528 Web \u73b0\u6709\u7684\u80fd\u529b\u3002\n3. \u8981\u652f\u6491 Flutter Web \u548c Vue Web \u9875\u7684\u6df7\u7528\u3002\n4. \u540e\u671f\u53ef\u4ee5\u65b9\u4fbf\u66ff\u6362\u6210 Rust \u5b8c\u6210\u524d\u540e\u7aef\u4e1a\u52a1\u80fd\u529b\u5927\u4e00\u7edf\u3002\n\n\u90a3\u5176\u5b9e\u91cd\u70b9\u7684\u9700\u8981\u6709\u4e00\u4e2a\u901a\u4fe1\u5c42\uff0c\u8ba9 TS / JS \u4e0e Flutter web \u53ef\u4ee5\u4f18\u96c5\u7684\u901a\u4fe1\u3002\n\n## \u901a\u4fe1\u5c42\n\u8ba9 Flutter \u5f00\u53d1\u540c\u5b66\u53ea\u5173\u5fc3 UI \u5c55\u793a\uff0c\u8ba9\u524d\u7aef\u540c\u5b66\u53ea\u5173\u5fc3\u4e1a\u52a1\u5b9e\u73b0\uff0c\u5c3d\u53ef\u80fd\u51cf\u5c11\u6c9f\u901a\u53ca\u8bed\u8a00\u5b66\u4e60\u6210\u672c\u3002\n\n\u90a3\u5176\u5b9e\u901a\u4fe1\u5c42\u4e0a\u5c31\u9700\u8981\u505a\u5230\u53cc\u7aef\u65e0\u611f\uff0c\u8fd9\u5f88\u5bb9\u6613\u60f3\u5230\u4f7f\u7528 codegen \u7684\u65b9\u5f0f\uff08codegen \u4f1a\u5355\u72ec\u5f00\u4e00\u4e2a\u4e13\u680f\u6765\u804a\u4e00\u804a\uff09\u3002\n\n\u4ee3\u7801\u6838\u5fc3\u4e0a\uff0c\u4e3b\u8981\u662f\u4f7f\u7528 Flutter \u63d0\u4f9b\u7684\u5b98\u65b9\u4e00\u65b9\u5e93\u00a0[https://pub.dev/packages/js](https://pub.dev/packages/js/example)\u00a0, \u867d\u7136\u5b83\u7684\u7248\u672c\u662f 0.6+\uff0c\u6ca1\u6709\u5230 1.0 \u6b63\u5f0f\u7248\uff0c\u4f46\u96b6\u5c5e\u4e8e dart-lang/sdk \u8fd8\u662f\u53ef\u4fe1\u8d56\u7684\u3002\n\n\u5728\u7814\u7a76\u4e86\u8be5\u5e93\u7684 example\u00a0<https://github.com/google/chartjs.dart/>\u00a0\uff08google \u7ec4\u7ec7\u4e0b\uff0c\u4e5f\u662f\u5f88\u6709\u4fdd\u8bc1\u7684\uff09\u540e\u53d1\u73b0\u4e86\u4e00\u4e2a\u5b98\u65b9\u4f7f\u7528\u7684 codegen \u751f\u6210 chartjs.dart \u7c7b\u7684\u5de5\u5177\u3002\n\n\u300a[\u00a0https://github.com/dart-lang/js_facade_gen](https://github.com/dart-lang/js_facade_gen)\u00a0\u300b\u6839\u636e TS \u4ee3\u7801\u751f\u6210 dart \u62bd\u8c61\u8c03\u7528\u5c42\u3002\n\n\u5728\u5404\u79cd\u6320\u5934\u5c1d\u8bd5\u4e0b\uff0c\u6700\u7ec8\u786e\u8ba4\u8fd9\u5e93\u662f\u7528\u4e0d\u4e86\u7684 [\u624b\u52a8\u72d7\u5934]\n\n\u7528\u4e0d\u4e86\u7684\u539f\u56e0\u4e5f\u5f88\u7b80\u5355\n\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b726670312d24a418c51c2d3c9929f91~tplv-k3u1fbpfcp-watermark.image?)\n\n\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u867d\u7136\u8fd9\u5e93\u4e5f\u662f\u5728 dart-lang \u4e2d\uff0c\u4f46\u8fd9\u5e93\u5df2\u7ecf3\u5e74\u6ca1\u66f4\u65b0\u4e86\uff0cFlutter \u8fd93\u5e74\u5927\u5927\u5c0f\u5c0f\u4e5f\u53d1\u4e86\u51e0\u5341\u4e2a\u7248\u672c\uff0c\u751f\u6210\u7684 dart \u4ee3\u7801\u4e0a\u6797\u6797\u603b\u603b\u5404\u79cd\u62a5\u9519\u4e0d\u80fd\u7528 ...\n\n> \u90a3\u662f\u5426\u8981\u91cd\u65b0\u9020\u8f6e\u5b50\uff1f\n\n\u5728\u7814\u7a76\u4e86\u5b83\u7684\u6e90\u7801\u540e\uff0c\u53d1\u73b0\u5176\u5b9e\u4e5f\u8fd8\u662f\u5bf9 TS \u7684 AST \u8fdb\u884c\u5b57\u7b26\u4e32\u5904\u7406\uff08codegen \u7684\u672c\u8d28\u5c31\u662f\u5b57\u7b26\u4e32\u5904\u7406\u00a0[\u624b\u52a8\u72d7\u5934]\uff09\n\n\u90a3\u6211\u4eec\u5c31\u53ef\u4ee5\u6539\u9020\u6e90\u7801\u7684\u65b9\u5f0f\u8fdb\u884c\u672c\u5730\u4f7f\u7528\u3002\n\n\u4f8b\u5982\u53bb\u652f\u6301\u751f\u6210 Flutter \u7a7a\u5b89\u5168\u8bed\u6cd5\uff1a\n\n![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ebfec174a7eb41879d5c9c6ab1efb5a3~tplv-k3u1fbpfcp-watermark.image?)\n\n\u4e5f\u505a\u4e86\u4e0d\u5c11\u589e\u5f3a\u6027\u5de5\u4f5c\uff0c\u539f\u56e0\u662f\u8fd9\u4e24\u70b9\uff1a\n1.  \u7ecf\u8fc7\u9a8c\u8bc1\uff0c\u867d\u7136 Flutter \u8c03\u7528 JS \u6ca1\u95ee\u9898\uff0c\u4f46 JS \u5bf9\u8c61\u8fd4\u56de\u540e\u5728 Flutter \u4e0a\u65e0\u6cd5\u88ab\u89e3\u6790\uff0c\u800c\u4e14\u5728 dart2js / dart2jsdev \u4e0a\uff0c\u4e24\u8005\u7684 JS \u5bf9\u8c61\u8fd8\u662f\u4e0d\u540c\u7684\uff0c\u6839\u672c\u6ca1\u6cd5\u76f4\u63a5\u4f7f\u7528\u3002\n1.  \u5c31\u7b97\u628a JS \u5bf9\u8c61\u8f6c\u6362\u6210 Map\uff0c\u4e5f\u4e0d\u7b26\u5408\u6211\u4eec\u5bf9 API \u7684\u8981\u6c42\uff0c\u6211\u4eec\u5e0c\u671b\u7684\u662f JS \u5bf9\u8c61\u5b8c\u7f8e\u4f53\u73b0\u5728 Flutter \u4e0a\uff0c\u8fd9\u6837\u6a21\u578b\u5c42\u5c31\u65e0\u9700\u5199\u4e24\u904d\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5728 TS \u4e2d\u589e\u52a0\u4e86 @DartObject \u6ce8\u89e3\u6765\u505a\u5b9a\u4e49\uff0c\u901a\u8fc7\u5185\u7f6e `json_annotation` \u76f4\u63a5\u751f\u6210 Flutter Model\uff08\u5f53\u7136\u8fd9\u9700\u8981\u6267\u884c\u989d\u5916\u7684\u547d\u4ee4\uff0c\u4f46\u6211\u4eec\u628a\u5b83\u5c01\u88c5\u6210\u4e00\u4e2a `vscode extensions` \u5373\u53ef\u5f88\u65b9\u4fbf\u4f7f\u7528\uff09\u3002\n\n\u4ee3\u7801\u4e0a\u53ea\u8981\u5199 TS \u4ee3\u7801\u5373\u53ef\u3002\n\n```TS\n/**\n * \u9996\u9875\u6a21\u7248 Model\n */\n@DartObject()\nexport class GDHomeTemplateListModel {\n  /**\n   * id\n   */\n  id?: string\n  /**\n   * \u6a21\u7248\u540d\u79f0\n   */\n  name?: string\n  /**\n   * \u9884\u89c8\u56fe\n   */\n  preview?: GDHomeTemplateListPreviewModel\n\n  test?: string\n}\n```\n> \u4e0d\u80fd\u6dfb\u52a0\u89c6\u9891\uff0c\u6240\u4ee5\u4e0d\u592a\u597d\u63cf\u8ff0 - -\uff5c\n\n\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6d4b\u8bd5\u662f\u6a21\u7248\u63a5\u53e3\u8c03\u7528\n\n\u4e0b\u56fe\u662f TS \u901a\u8fc7 fetchAPI \u5b9e\u73b0\u63a5\u53e3\u8c03\u7528\u7684\u6d4b\u8bd5\u4ee3\u7801\n\n![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/16b8e79b65604cb8ba0549afdce0db69~tplv-k3u1fbpfcp-watermark.image?)\n\n\u4e0b\u56fe\u662f Flutter \u901a\u8fc7\u751f\u6210\u7684 `GDModuleAPI.home.fetchTemplates` \u65b9\u6cd5\u76f4\u63a5\u8c03\u7528 TS \u5c42\u4ee3\u7801\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/48689a6794e644f781584ad38c4296a9~tplv-k3u1fbpfcp-watermark.image?)\n\n\u53ef\u4ee5\u770b\u5230 Flutter \u6b63\u5e38\u4f7f\u7528 TS \u5b9a\u4e49\u7684\u6a21\u578b\u4e86\n\n\u518d\u653e\u4e00\u5f20\u6d4b\u8bd5\u7ed3\u679c\u56fe\uff1a\n\n![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5eac4f96cf934a3aa12d5a512bd17839~tplv-k3u1fbpfcp-watermark.image?)\n\n\u53ef\u4ee5\u770b\u5230\uff0c\u63a5\u53e3\u8bf7\u6c42\u771f\u5b9e\u53d1\u751f\u4e14\u5df2\u5c06\u6a21\u7248\u5217\u8868\u6e32\u67d3\u6210\u529f\u3002\n\n## \u7ed3\u8bba\n\n\u53ef\u4ee5\u770b\u5230\u8fc7\u7a0b\u4e0a\u505a\u5230\u4e86\u6781\u5927\u89e3\u8026:\n1. Flutter UI Components \u5f00\u53d1\n2. JS API \u5f00\u53d1\n3. Flutter \u9875\u9762\u62fc\u88c5 JS API \u4e0e Flutter UI Components\n\n# \u540e\u7eed\n\n\u672c\u6587\u4e3b\u8981\u662f\u8bb0\u5f55\u4e0b\u8c03\u7814\u8fc7\u7a0b\uff0c\u6574\u4f53\u65b9\u6848\u5df2\u7ecf\u662f\u53ef\u7528\u7684\uff0c\u63a5\u4e0b\u6765\u5c31\u4f1a\u8fdb\u5165\u5230\u65b9\u6848\u5f00\u53d1\u3002\n\n> \u81f3\u4e8e\u672c\u6587\u4e2d\u95f4\u751f\u6210\u7684\u8fc7\u7a0b\uff0c\u540e\u7eed\u4f1a\u5355\u72ec\u5f00\u7bc7\u8bb2\u4e00\u4e0b\u7b14\u8005\u5f00\u53d1\u6216\u7528\u5230\u7684\u5404\u7c7b codegen \u5de5\u5177\u3002\n\n\u6709\u4efb\u4f55\u95ee\u9898\u53ef\u4ee5\u8bc4\u8bba\u533a\u95ee\u6211 \uff5e",
    "mtime": "1660961862",
    "original_author": "",
    "original_type": 0,
    "rank_index": 3.8670022,
    "rtime": "1660961862",
    "status": 2,
    "tag_ids": [
      6809641090145058816,
      6809640543006490624
    ],
    "title": "Flutter Web  - \u8ba9 Web \u4e0e APP UI \u4e00\u81f4\u7684\u53e6\u4e00\u79cd\u53ef\u80fd",
    "user_id": "831705151963870",
    "user_index": 9.648235883183691,
    "verify_status": 1,
    "view_count": 151,
    "visible_level": 0
  },
  {
    "article_id": "7133514836667236365",
    "audit_status": 2,
    "brief_content": "\u539f\u751f Canvas\u3001React-konva \u753b\u7f51\u683c \u6211\u4eec\u8bbe\u5b9a canvas \u521d\u59cb\u5316\u5de6\u4e0a\u89d2\u9876\u70b9\u4e3a 0,0 \u70b9\uff0c\u5411\u53f3\ud83d\udc49\u548c\u5411\u4e0b\ud83d\udc47\u662f X Y \u8f74\u6b63\u65b9\u5411 \u4e00\u3001\u539f\u751f Canvas \u753b\u7f51\u683c 1\u3001\u4f7f\u7528 Canvas ",
    "category_id": "6809637767543259144",
    "collect_count": 0,
    "comment_count": 0,
    "content": "",
    "cover_image": "https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ecab00e0cfa443c29d42b8e0114ef3e3~tplv-k3u1fbpfcp-watermark.image?",
    "ctime": "1660900885",
    "digg_count": 4,
    "display_count": 0,
    "draft_id": "7133513689985974309",
    "hot_index": 13,
    "is_english": 0,
    "is_gfw": 0,
    "is_hot": 0,
    "is_markdown": 1,
    "is_original": 1,
    "link_url": "",
    "mark_content": "# \u539f\u751f Canvas\u3001React-konva \u753b\u7f51\u683c\n\n>\u7f51\u683c\uff1a\u4e00\u79cd\u53ef\u4ee5\u5728 `canvas` \u9762\u677f\u4e0a\u7ed8\u5236\u56fe\u5f62\u7684\u8f85\u52a9\u7ebf\u96c6\u5408\u3002\n\n\n![grid.jpg](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/94ce95f2cf4f4ae8a7e4b683a381e347~tplv-k3u1fbpfcp-watermark.image?)\n\n\u6211\u4eec\u8bbe\u5b9a `canvas` \u521d\u59cb\u5316\u5de6\u4e0a\u89d2\u9876\u70b9\u4e3a `0,0` \u70b9\uff0c\u5411\u53f3\ud83d\udc49\u548c\u5411\u4e0b\ud83d\udc47\u662f `X` `Y` \u8f74\u6b63\u65b9\u5411\n\n## \u4e00\u3001\u539f\u751f `Canvas` \u753b\u7f51\u683c\n### 1\u3001\u4f7f\u7528 `Canvas` \u7684\u65b9\u6cd5\n> \u539f\u751f\u753b\u7f51\u683c\uff0c\u53ea\u9700\u8981\u4f7f\u7528 `ctx` \u7684 `moveTo`\u3001`lineTo`\u3001`strokeStyle`\n#### 1. `moveTo`\n> \u662f Canvas 2D API \u5c06\u4e00\u4e2a\u65b0\u7684\u5b50\u8def\u5f84\u7684\u8d77\u59cb\u70b9\u79fb\u52a8\u5230 (x\uff0cy) \u5750\u6807\u7684\u65b9\u6cd5\u3002\n\n> `ctx.moveTo(x, y);`\n#### 2. `lineTo`\n> \u662f Canvas 2D API \u4f7f\u7528\u76f4\u7ebf\u8fde\u63a5\u5b50\u8def\u5f84\u7684\u7ec8\u70b9\u5230 x\uff0cy \u5750\u6807\u7684\u65b9\u6cd5\u3002\n\n> `ctx.lineTo(x, y);`\n#### 3. `strokeStyle`\n> \u662f Canvas 2D API \u63cf\u8ff0\u753b\u7b14\uff08\u7ed8\u5236\u56fe\u5f62\uff09\u989c\u8272\u6216\u8005\u6837\u5f0f\u7684\u5c5e\u6027\u3002\u9ed8\u8ba4\u503c\u662f #000\n\n> `ctx.strokeStyle = '#ff0000'`\n\n### 2\u3001\u4ee3\u7801\n\n```ts\nimport React, { useEffect, useState } from 'react';\nimport { Button } from 'antd';\n\ninterface IPageSlicePosType {\n    x: number;\n    y: number;\n}\n\nexport const CanvasGrid = () => {\n\n    // \u5f53\u524d canvas \u7684 0 0 \u5750\u6807\uff0c\u6211\u4eec\u8bbe\u7f6e canvas \u5de6\u4e0a\u89d2\u9876\u70b9\u4e3a 0 0\uff0c\u5411\u53f3\ud83d\udc49\u548c\u5411\u4e0b\ud83d\udc47\u662f X Y \u8f74\u6b63\u65b9\u5411\uff0c0\uff0c0 \u4e3a pageSlicePos \u521d\u59cb\u503c\n    const [pageSlicePos, setPageSlicePos] = useState<IPageSlicePosType>({\n        x: 0,\n        y: 0,\n    });\n    const [ctxVal, setCtxVal] = useState<any>(null); // canvas \u7684 ctx\n    const [scale, setScale] = useState<number>(1); // \u7f29\u653e\u6bd4\u4f8b\n    const [solidColor] = useState<string>('#CCCCCC70'); // \u5b9e\u7ebf\u989c\u8272\n    const [dashedColor] = useState<string>('#CCCCCC25'); // \u865a\u7ebf\u989c\u8272\n    const [zeroColor] = useState<string>('#358bf3'); // 0 \u70b9\u5750\u6807\u7cfb\u989c\u8272\n\n    // \u76d1\u542c pageSlicePos \u6570\u636e\uff0c\u6709\u53d8\u52a8\u5219\u8fdb\u884c canvas \u7684\u7ed8\u5236\n    useEffect(() => {\n        if (ctxVal) {\n            // \u91cd\u65b0\u7ed8\u5236\u4e4b\u524d\u6e05\u7a7a canvas\n            ctxVal.clearRect(0, 0, ctxVal.canvas.width, ctxVal.canvas.height);\n        }\n        drawLineGrid();\n    }, [pageSlicePos]);\n\n    /**\n     * \u7ed8\u5236\u7f51\u683c\n     * @param scaleVal \u7f29\u653e\u500d\u6570\n     */\n    const drawLineGrid = (scaleVal = scale) => {\n        /*\u83b7\u53d6\u5143\u7d20*/\n        var myCanvas: any = document.querySelector('#myCanvas');\n        /*\u83b7\u53d6\u7ed8\u56fe\u5de5\u5177*/\n        var ctx = ctxVal || myCanvas.getContext('2d');\n        setCtxVal(ctx);\n        // \u8bbe\u7f6e\u7f51\u683c\u5927\u5c0f\n        var girdSize = 5 * scaleVal;\n\n        // \u83b7\u53d6Canvas\u7684width\u3001height\n        var CanvasWidth = ctx.canvas.width;\n        var CanvasHeight = ctx.canvas.height;\n\n        // \u5728 pageSlicePos \u7684 x\uff0cy \u70b9\u4f4d\u753b\u4e00\u4e2a 10 * 10 \u7684\u7ea2\u8272\u6807\u8bb0\u7528\u6765\u8868\u793a\u5f53\u524d\u9875\u9762\u7684 0 0 \u5750\u6807\n        ctx.fillRect(pageSlicePos.x, pageSlicePos.y, 10, 10); // \u6548\u679c\u56fe\u7ea2\u8272\u5c0f\u65b9\u5757\n        ctx.fillStyle = 'red';\n\n        const canvasXHeight = CanvasHeight - pageSlicePos.y;\n        const canvasYWidth = CanvasWidth - pageSlicePos.x;\n        // \u4ece pageSlicePos.y \u5904\u5f00\u59cb\u5f80 Y \u8f74\u6b63\u65b9\u5411\u753b X \u8f74\u7f51\u683c\n        const xPageSliceTotal = Math.ceil(canvasXHeight / girdSize);\n        for (let i = 0; i < xPageSliceTotal; i++) {\n            ctx.beginPath(); // \u5f00\u542f\u8def\u5f84\uff0c\u8bbe\u7f6e\u4e0d\u540c\u7684\u6837\u5f0f\n            ctx.moveTo(0, pageSlicePos.y + girdSize * i);\n            ctx.lineTo(CanvasWidth, pageSlicePos.y + girdSize * i);\n            ctx.strokeStyle = i === 0 ? zeroColor : (i % 5 === 0 ? solidColor : dashedColor); // \u5982\u679c\u4e3a 0 \u5219\u7528\u84dd\u8272\u6807\u8bb0\uff0c\u53d6\u4f59 5 \u4e3a\u5b9e\u7ebf\uff0c\u5176\u4f59\u4e3a\u6bd4\u8f83\u6de1\u7684\u7ebf\n            ctx.stroke();\n        }\n\n        // \u4ece pageSlicePos.y \u5904\u5f00\u59cb\u5f80 Y \u8f74\u8d1f\u65b9\u5411\u753b X \u8f74\u7f51\u683c\n        const xRemaining = pageSlicePos.y;\n        const xRemainingTotal = Math.ceil(xRemaining / girdSize);\n        for (let i = 0; i < xRemainingTotal; i++) {\n            if (i === 0) continue;\n            ctx.beginPath(); // \u5f00\u542f\u8def\u5f84\uff0c\u8bbe\u7f6e\u4e0d\u540c\u7684\u6837\u5f0f\n            ctx.moveTo(0, pageSlicePos.y - girdSize * i); // -0.5\u662f\u4e3a\u4e86\u89e3\u51b3\u50cf\u7d20\u6a21\u7cca\u95ee\u9898\n            ctx.lineTo(CanvasWidth, pageSlicePos.y - girdSize * i);\n            ctx.strokeStyle = i === 0 ? zeroColor : (i % 5 === 0 ? solidColor : dashedColor);// \u5982\u679c\u4e3a 0 \u5219\u7528\u84dd\u8272\u6807\u8bb0\uff0c\u53d6\u4f59 5 \u4e3a\u5b9e\u7ebf\uff0c\u5176\u4f59\u4e3a\u6bd4\u8f83\u6de1\u7684\u7ebf\n            ctx.stroke();\n        }\n\n        // \u4ece pageSlicePos.x \u5904\u5f00\u59cb\u5f80 X \u8f74\u6b63\u65b9\u5411\u753b Y \u8f74\u7f51\u683c\n        const yPageSliceTotal = Math.ceil(canvasYWidth / girdSize); // \u8ba1\u7b97\u9700\u8981\u7ed8\u753by\u8f74\u7684\u6761\u6570\n        for (let j = 0; j < yPageSliceTotal; j++) {\n            ctx.beginPath(); // \u5f00\u542f\u8def\u5f84\uff0c\u8bbe\u7f6e\u4e0d\u540c\u7684\u6837\u5f0f\n            ctx.moveTo(pageSlicePos.x + girdSize * j, 0);\n            ctx.lineTo(pageSlicePos.x + girdSize * j, CanvasHeight);\n            ctx.strokeStyle = j === 0 ? zeroColor : (j % 5 === 0 ? solidColor : dashedColor);// \u5982\u679c\u4e3a 0 \u5219\u7528\u84dd\u8272\u6807\u8bb0\uff0c\u53d6\u4f59 5 \u4e3a\u5b9e\u7ebf\uff0c\u5176\u4f59\u4e3a\u6bd4\u8f83\u6de1\u7684\u7ebf\n            ctx.stroke();\n        }\n\n        // \u4ece pageSlicePos.x \u5904\u5f00\u59cb\u5f80 X \u8f74\u8d1f\u65b9\u5411\u753b Y \u8f74\u7f51\u683c\n        const yRemaining = pageSlicePos.x;\n        const yRemainingTotal = Math.ceil(yRemaining / girdSize);\n        for (let j = 0; j < yRemainingTotal; j++) {\n            if (j === 0) continue;\n            ctx.beginPath(); // \u5f00\u542f\u8def\u5f84\uff0c\u8bbe\u7f6e\u4e0d\u540c\u7684\u6837\u5f0f\n            ctx.moveTo(pageSlicePos.x - girdSize * j, 0);\n            ctx.lineTo(pageSlicePos.x - girdSize * j, CanvasHeight);\n            ctx.strokeStyle = j === 0 ? zeroColor : (j % 5 === 0 ? solidColor : dashedColor);// \u5982\u679c\u4e3a 0 \u5219\u7528\u84dd\u8272\u6807\u8bb0\uff0c\u53d6\u4f59 5 \u4e3a\u5b9e\u7ebf\uff0c\u5176\u4f59\u4e3a\u6bd4\u8f83\u6de1\u7684\u7ebf\n            ctx.stroke();\n        }\n    };\n    \n\t/**\n     * \u70b9\u51fb\u7f29\u653e\uff0c\u8bbe\u7f6e\u7f29\u653e\u500d\u6570\n     */\n    const clickScale = () => {\n        const scaleVal = scale + 1 > 6 ? 1 : scale + 1;\n        setScale(scaleVal);\n        ctxVal.clearRect(0, 0, ctxVal.canvas.width, ctxVal.canvas.height);\n        drawLineGrid(scaleVal);\n    }\n\n    /**\n     * \u62d6\u52a8 canvas \u52a8\u6001\u6e32\u67d3\uff0c\u62d6\u52a8\u65f6\uff0c\u52a8\u6001\u8bbe\u7f6e pageSlicePos \u7684\u503c\n     * @param e Event\n     */\n    const mouseDown = (e: any) => {\n        const downX = e.clientX;\n        const downY = e.clientY;\n        const { x, y } = pageSlicePos;\n        var myCanvas: any = document.querySelector('#myCanvas');\n        myCanvas.onmousemove = (ev: any) => {\n            const moveX = ev.clientX;\n            const moveY = ev.clientY;\n            setPageSlicePos({\n                x: x + (moveX - downX),\n                y: y + (moveY - downY),\n            });\n            myCanvas.onmouseup = (en: any) => {\n                myCanvas.onmousemove = null;\n                myCanvas.onmouseup = null;\n            };\n        }\n        myCanvas.onmouseup = (en: any) => {\n            myCanvas.onmousemove = null;\n            myCanvas.onmouseup = null;\n        };\n    }\n    return (\n        <div className='canvas'>\n            <div>\n                <Button onClick={clickScale}>\u7f29\u653e{scale}</Button>\n            </div>\n            <div style={{ width: '600px', margin: '0 auto'}}>\n                <canvas onMouseDown={mouseDown} id=\"myCanvas\" width=\"600\" height=\"400\"></canvas>\n            </div>\n        </div>\n    )\n}\n```\n### 3\u3001\u6548\u679c\u5c55\u793a\n\n![ys-canvas.jpg](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1c7165d31564424ba6f505f0ccf8d78b~tplv-k3u1fbpfcp-watermark.image?)\n\n\n## \u4e8c\u3001`React-konva`\n### 1\u3001`konva` \u4ecb\u7ecd\n[`Konva` \u4e2d\u6587\u7f51](http://konvajs-doc.bluehymn.com/)\n[`React-konva`](https://konvajs.org/docs/react/Intro.html)\n### 2\u3001`react-konva` \u793a\u4f8b\n```ts\nimport { Stage, Layer, Rect, Circle } from 'react-konva';\n\nexport const App = () => {\n  return (\n    // Stage - is a div wrapper\n    // Layer - is an actual 2d canvas element, so you can have several layers inside the stage\n    // Rect and Circle are not DOM elements. They are 2d shapes on canvas\n    <Stage width={window.innerWidth} height={window.innerHeight}>\n      <Layer>\n        <Rect width={50} height={50} fill=\"red\" />\n        <Circle x={200} y={200} stroke=\"black\" radius={50} />\n      </Layer>\n    </Stage>\n  );\n}\n```\n### 3\u3001\u4ee3\u7801\n#### 1. `konva-canvas.tsx`\n```ts\nimport React, { useState } from \"react\";\nimport { Button } from 'antd';\nimport { Stage } from \"react-konva\";\nimport { LineGrid } from '../components/line-grid';\n\nexport const KonvasCanvas = () => {\n    const [scale, setScale] = useState<number>(1); // \u7f29\u653e\u6bd4\u4f8b\n    const [stagePos, setStagePos] = React.useState({ x: 0, y: 0 }); // \u9875\u9762 0 0 \u5750\u6807\u4f4d\u7f6e\n    const [CanvasWidth] = useState<number>(600); // canvas \u5bbd\u5ea6\n    const [CanvasHeight] = useState<number>(400); // canvas \u9ad8\u5ea6\n    \n    /**\n     * \u70b9\u51fb\u7f29\u653e\n     */\n    const clickScale = () => {\n        const scaleVal = scale + 1 > 6 ? 1 : scale + 1;\n        setScale(scaleVal);\n    }\n    return (\n        <div className='konva' style={{ width: '600px', margin: '20px auto', }}>\n            <Button onClick={clickScale}>\u7f29\u653e{scale}</Button>\n            <div id=\"konva-canvas\">\n                <Stage\n                    x={stagePos.x}\n                    y={stagePos.y}\n                    width={CanvasWidth}\n                    height={CanvasHeight}\n                    strokeWidth={1}\n                    draggable\n                    onDragMove={e => {\n                    \t// \u62d6\u52a8\u4e8b\u4ef6\uff0c\u8bbe\u7f6e stagePos \u503c\n                        const { x, y } = e.currentTarget.position();\n                        setStagePos({\n                            x: Math.round(x),\n                            y: Math.round(y),\n                        });\n                    }}\n                >\n                    <LineGrid scale={scale} CanvasWidth={CanvasWidth} CanvasHeight={CanvasHeight} stagePos={stagePos} />\n                </Stage>\n            </div>\n        </div>\n    )\n};\n```\n#### 2. `LineGrid.tsx`\n```ts\nimport React, { useState } from 'react';\nimport { Layer, Rect, Line } from \"react-konva\";\n\nexport const LineGrid = (props: any) => {\n    const { scale, stagePos, CanvasWidth, CanvasHeight } = props;\n    // \u9700\u8981\u63d2\u5165\u7684\u7f51\u683c components\n    const gridComponents = [];\n    // \u7f51\u683c\u5206\u6210\u591a\u5c11\u4efd \u5bbd\u5ea6 * \u500d\u6570 / \u9700\u8981\u591a\u5c11\u7f51\u683c\u6570\n    const girdSize = 100 * scale / 20;\n    // canvas X\u3001Y \u8f74\u8ddd\u79bb stagePos x y \u7684\u8ddd\u79bb\n    const canvasXHeight = CanvasHeight - stagePos.y;\n    const canvasYWidth = CanvasWidth - stagePos.x;\n    const [solidColor] = useState<string>('#CCCCCC70'); // \u5b9e\u7ebf\u989c\u8272\n    const [dashedColor] = useState<string>('#CCCCCC25'); // \u865a\u7ebf\u989c\u8272\n    const [zeroColor] = useState<string>('#358bf3'); // 0 \u70b9\u989c\u8272\n    const [strokeWidth] = useState<number>(1); // strokeWidth\n    const [shadowOpacity] = useState<number>(0); // shadowOpacity\n    const [shadowEnabled] = useState<boolean>(false); // shadowEnabled\n\n    // \u4ece pageSlicePos.y \u5904\u5f00\u59cb\u5f80 Y \u8f74\u6b63\u65b9\u5411\u753b X \u8f74\u7f51\u683c\n    const xPageSliceTotal = Math.ceil(canvasXHeight / girdSize);\n    for (let i = 0; i < xPageSliceTotal; i++) {\n        gridComponents.push(<Line\n            x={0 - stagePos.x}\n            y={girdSize * i}\n            strokeWidth={strokeWidth}\n            shadowOpacity={shadowOpacity}\n            shadowEnabled={shadowEnabled}\n            points={[0, 0, CanvasWidth, 0]}\n            stroke={i === 0 ? zeroColor : i % 5 === 0 ? solidColor : dashedColor}\n        />)\n    }\n\n    // \u4ece pageSlicePos.y \u5904\u5f00\u59cb\u5f80 Y \u8f74\u8d1f\u65b9\u5411\u753b X \u8f74\u7f51\u683c\n    const xRemaining = stagePos.y;\n    const xRemainingTotal = Math.ceil(xRemaining / girdSize);\n    for (let i = 0; i < xRemainingTotal; i++) {\n        if (i === 0) continue;\n        gridComponents.push(<Line\n            x={0 - stagePos.x}\n            y={-girdSize * i}\n            strokeWidth={strokeWidth}\n            shadowOpacity={shadowOpacity}\n            shadowEnabled={shadowEnabled}\n            points={[0, 0, CanvasWidth, 0]}\n            stroke={i === 0 ? zeroColor : i % 5 === 0 ? solidColor : dashedColor}\n        />)\n    }\n\n    // \u4ece pageSlicePos.x \u5904\u5f00\u59cb\u5f80 X \u8f74\u6b63\u65b9\u5411\u753b Y \u8f74\u7f51\u683c\n    const yPageSliceTotal = Math.ceil(canvasYWidth / girdSize); // \u8ba1\u7b97\u9700\u8981\u7ed8\u753by\u8f74\u7684\u6761\u6570\n    for (let j = 0; j < yPageSliceTotal; j++) {\n        gridComponents.push(<Line\n            x={girdSize * j}\n            y={0 - stagePos.y}\n            strokeWidth={strokeWidth}\n            shadowOpacity={shadowOpacity}\n            shadowEnabled={shadowEnabled}\n            points={[0, 0, 0, CanvasHeight]}\n            stroke={j === 0 ? zeroColor : j % 5 === 0 ? solidColor : dashedColor}\n        />)\n    }\n\n    // \u4ece pageSlicePos.x \u5904\u5f00\u59cb\u5f80 X \u8f74\u8d1f\u65b9\u5411\u753b Y \u8f74\u7f51\u683c\n    const yRemaining = stagePos.x;\n    const yRemainingTotal = Math.ceil(yRemaining / girdSize);\n    for (let j = 0; j < yRemainingTotal; j++) {\n        if (j === 0) continue;\n        gridComponents.push(<Line\n            x={-girdSize * j}\n            y={0 - stagePos.y}\n            strokeWidth={strokeWidth}\n            shadowOpacity={shadowOpacity}\n            shadowEnabled={shadowEnabled}\n            points={[0, 0, 0, CanvasHeight]}\n            stroke={j === 0 ? zeroColor : j % 5 === 0 ? solidColor : dashedColor}\n        />)\n    }\n\n    // 0 0 \u4f4d\u7f6e\u753b\u4e00\u4e2a 10 10 \u7684\u7ea2\u8272 rect \u77e9\u5f62\n    gridComponents.push(<Rect\n        x={0}\n        y={0}\n        width={10}\n        height={10}\n        fill=\"red\"\n    />);\n\n    return (\n        <Layer>\n            {gridComponents}\n        </Layer>\n    );\n};\n```\n### 4\u3001\u6548\u679c\u56fe\n\n\n![konva-canvas.jpg](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f89c52138c784eb089c1a5bcb7c72d54~tplv-k3u1fbpfcp-watermark.image?)\n\n## \u4e09\u3001\u4ee3\u7801\n[github \u94fe\u63a5](https://github.com/18055975947/canvas-grid)\n\n[\u7801\u4e91\u94fe\u63a5](https://gitee.com/guoqiankun/canvas-grid)",
    "mtime": "1660959886",
    "original_author": "",
    "original_type": 0,
    "rank_index": 4.01086995,
    "rtime": "1660959886",
    "status": 2,
    "tag_ids": [
      6809640407484334080,
      6809640497393434624,
      6809640357354012672
    ],
    "title": "\u7f51\u683c\u753b\u6cd5\uff1a\u539f\u751f Canvas\u3001React-konva \u753b\u7f51\u683c\uff0c\u53ef\u62d6\u52a8\u3001\u53ef\u653e\u5927\u7f29\u5c0f\u3001\u5e76\u5e26\u6709\u5750\u6807\u7cfb 0 0 \u4f4d\u7f6e\u8f85\u52a9\u7ebf",
    "user_id": "2409752520033768",
    "user_index": 8.378932841735544,
    "verify_status": 1,
    "view_count": 199,
    "visible_level": 0
  }
]